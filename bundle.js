!function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var p="function"==typeof require&&require;if(!f&&p)return p(i,!0);if(u)return u(i,!0);throw(p=new Error("Cannot find module '"+i+"'")).code="MODULE_NOT_FOUND",p}p=n[i]={exports:{}},e[i][0].call(p.exports,function(r){return o(e[i][1][r]||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}({1:[function(require,module,exports){!function(){var d3={version:"3.5.17"},d3_arraySlice=[].slice,d3_array=function(list){return d3_arraySlice.call(list)},d3_document=this.document;function d3_documentElement(node){return node&&(node.ownerDocument||node.document||node).documentElement}function d3_window(node){return node&&(node.ownerDocument&&node.ownerDocument.defaultView||node.document&&node||node.defaultView)}if(d3_document)try{d3_array(d3_document.documentElement.childNodes)[0].nodeType}catch(e){d3_array=function(list){for(var i=list.length,array=new Array(i);i--;)array[i]=list[i];return array}}if(Date.now||(Date.now=function(){return+new Date}),d3_document)try{d3_document.createElement("DIV").style.setProperty("opacity",0,"")}catch(error){var d3_time_formatUtc=this.Element.prototype,d3_element_setAttribute=d3_time_formatUtc.setAttribute,d3_element_setAttributeNS=d3_time_formatUtc.setAttributeNS,d3_time_formatIso=this.CSSStyleDeclaration.prototype,d3_style_setProperty=d3_time_formatIso.setProperty;d3_time_formatUtc.setAttribute=function(name,value){d3_element_setAttribute.call(this,name,value+"")},d3_time_formatUtc.setAttributeNS=function(space,local,value){d3_element_setAttributeNS.call(this,space,local,value+"")},d3_time_formatIso.setProperty=function(name,value,priority){d3_style_setProperty.call(this,name,value+"",priority)}}function d3_ascending(a,b){return a<b?-1:b<a?1:b<=a?0:NaN}function d3_number(x){return null===x?NaN:+x}function d3_numeric(x){return!isNaN(x)}function d3_bisector(compare){return{left:function(a,x,lo,hi){for(arguments.length<3&&(lo=0),arguments.length<4&&(hi=a.length);lo<hi;){var mid=lo+hi>>>1;compare(a[mid],x)<0?lo=1+mid:hi=mid}return lo},right:function(a,x,lo,hi){for(arguments.length<3&&(lo=0),arguments.length<4&&(hi=a.length);lo<hi;){var mid=lo+hi>>>1;0<compare(a[mid],x)?hi=mid:lo=1+mid}return lo}}}d3.ascending=d3_ascending,d3.descending=function(a,b){return b<a?-1:a<b?1:a<=b?0:NaN},d3.min=function(array,f){var a,b,i=-1,n=array.length;if(1===arguments.length){for(;++i<n;)if(null!=(b=array[i])&&b<=b){a=b;break}for(;++i<n;)null!=(b=array[i])&&b<a&&(a=b)}else{for(;++i<n;)if(null!=(b=f.call(array,array[i],i))&&b<=b){a=b;break}for(;++i<n;)null!=(b=f.call(array,array[i],i))&&b<a&&(a=b)}return a},d3.max=function(array,f){var a,b,i=-1,n=array.length;if(1===arguments.length){for(;++i<n;)if(null!=(b=array[i])&&b<=b){a=b;break}for(;++i<n;)null!=(b=array[i])&&a<b&&(a=b)}else{for(;++i<n;)if(null!=(b=f.call(array,array[i],i))&&b<=b){a=b;break}for(;++i<n;)null!=(b=f.call(array,array[i],i))&&a<b&&(a=b)}return a},d3.extent=function(array,f){var a,b,c,i=-1,n=array.length;if(1===arguments.length){for(;++i<n;)if(null!=(b=array[i])&&b<=b){a=c=b;break}for(;++i<n;)null!=(b=array[i])&&(b<a&&(a=b),c<b&&(c=b))}else{for(;++i<n;)if(null!=(b=f.call(array,array[i],i))&&b<=b){a=c=b;break}for(;++i<n;)null!=(b=f.call(array,array[i],i))&&(b<a&&(a=b),c<b&&(c=b))}return[a,c]},d3.sum=function(array,f){var a,s=0,n=array.length,i=-1;if(1===arguments.length)for(;++i<n;)d3_numeric(a=+array[i])&&(s+=a);else for(;++i<n;)d3_numeric(a=+f.call(array,array[i],i))&&(s+=a);return s},d3.mean=function(array,f){var a,s=0,n=array.length,i=-1,j=n;if(1===arguments.length)for(;++i<n;)d3_numeric(a=d3_number(array[i]))?s+=a:--j;else for(;++i<n;)d3_numeric(a=d3_number(f.call(array,array[i],i)))?s+=a:--j;if(j)return s/j},d3.quantile=function(values,v){var e=(values.length-1)*v+1,h=Math.floor(e),v=+values[h-1],e=e-h;return e?v+e*(values[h]-v):v},d3.median=function(array,f){var a,numbers=[],n=array.length,i=-1;if(1===arguments.length)for(;++i<n;)d3_numeric(a=d3_number(array[i]))&&numbers.push(a);else for(;++i<n;)d3_numeric(a=d3_number(f.call(array,array[i],i)))&&numbers.push(a);if(numbers.length)return d3.quantile(numbers.sort(d3_ascending),.5)},d3.variance=function(array,f){var a,d,n=array.length,m=0,s=0,i=-1,j=0;if(1===arguments.length)for(;++i<n;)d3_numeric(a=d3_number(array[i]))&&(s+=(d=a-m)*(a-(m+=d/++j)));else for(;++i<n;)d3_numeric(a=d3_number(f.call(array,array[i],i)))&&(s+=(d=a-m)*(a-(m+=d/++j)));if(1<j)return s/(j-1)},d3.deviation=function(){var v=d3.variance.apply(this,arguments);return v&&Math.sqrt(v)};var d3_time_format=d3_bisector(d3_ascending);function d3_transposeLength(d){return d.length}d3.bisectLeft=d3_time_format.left,d3.bisect=d3.bisectRight=d3_time_format.right,d3.bisector=function(f){return d3_bisector(1===f.length?function(d,x){return d3_ascending(f(d),x)}:f)},d3.shuffle=function(array,i0,i1){(m=arguments.length)<3&&(i1=array.length,m<2&&(i0=0));for(var t,i,m=i1-i0;m;)i=Math.random()*m--|0,t=array[m+i0],array[m+i0]=array[i+i0],array[i+i0]=t;return array},d3.permute=function(array,indexes){for(var i=indexes.length,permutes=new Array(i);i--;)permutes[i]=array[indexes[i]];return permutes},d3.pairs=function(array){for(var i=0,n=array.length-1,p1=array[0],pairs=new Array(n<0?0:n);i<n;)pairs[i]=[p1,p1=array[++i]];return pairs},d3.transpose=function(matrix){if(!(n=matrix.length))return[];for(var i=-1,m=d3.min(matrix,d3_transposeLength),transpose=new Array(m);++i<m;)for(var n,j=-1,row=transpose[i]=new Array(n);++j<n;)row[j]=matrix[j][i];return transpose},d3.zip=function(){return d3.transpose(arguments)},d3.keys=function(map){var key,keys=[];for(key in map)keys.push(key);return keys},d3.values=function(map){var key,values=[];for(key in map)values.push(map[key]);return values},d3.entries=function(map){var key,entries=[];for(key in map)entries.push({key:key,value:map[key]});return entries},d3.merge=function(arrays){for(var m,merged,array,n=arrays.length,i=-1,j=0;++i<n;)j+=arrays[i].length;for(merged=new Array(j);0<=--n;)for(m=(array=arrays[n]).length;0<=--m;)merged[--j]=array[m];return merged};var abs=Math.abs;function d3_class(ctor,properties){for(var key in properties)Object.defineProperty(ctor.prototype,key,{value:properties[key],enumerable:!1})}function d3_Map(){this._=Object.create(null)}d3.range=function(start,stop,step){if(arguments.length<3&&(step=1,arguments.length<2&&(stop=start,start=0)),(stop-start)/step==1/0)throw new Error("infinite range");var j,range=[],k=function(x){var k=1;for(;x*k%1;)k*=10;return k}(abs(step)),i=-1;if(start*=k,stop*=k,(step*=k)<0)for(;(j=start+step*++i)>stop;)range.push(j/k);else for(;(j=start+step*++i)<stop;)range.push(j/k);return range},d3.map=function(object,f){var map=new d3_Map;if(object instanceof d3_Map)object.forEach(function(key,value){map.set(key,value)});else if(Array.isArray(object)){var o,i=-1,n=object.length;if(1===arguments.length)for(;++i<n;)map.set(i,object[i]);else for(;++i<n;)map.set(f.call(object,o=object[i],i),o)}else for(var key in object)map.set(key,object[key]);return map};var d3_map_proto="__proto__",d3_map_zero="\0";function d3_map_escape(key){return(key+="")===d3_map_proto||key[0]===d3_map_zero?d3_map_zero+key:key}function d3_map_unescape(key){return(key+="")[0]===d3_map_zero?key.slice(1):key}function d3_map_has(key){return d3_map_escape(key)in this._}function d3_map_remove(key){return(key=d3_map_escape(key))in this._&&delete this._[key]}function d3_map_keys(){var key,keys=[];for(key in this._)keys.push(d3_map_unescape(key));return keys}function d3_map_size(){var key,size=0;for(key in this._)++size;return size}function d3_map_empty(){for(var key in this._)return!1;return!0}function d3_Set(){this._=Object.create(null)}function d3_identity(d){return d}function d3_vendorSymbol(object,name){if(name in object)return name;name=name.charAt(0).toUpperCase()+name.slice(1);for(var i=0,n=d3_vendorPrefixes.length;i<n;++i){var prefixName=d3_vendorPrefixes[i]+name;if(prefixName in object)return prefixName}}d3_class(d3_Map,{has:d3_map_has,get:function(key){return this._[d3_map_escape(key)]},set:function(key,value){return this._[d3_map_escape(key)]=value},remove:d3_map_remove,keys:d3_map_keys,values:function(){var key,values=[];for(key in this._)values.push(this._[key]);return values},entries:function(){var key,entries=[];for(key in this._)entries.push({key:d3_map_unescape(key),value:this._[key]});return entries},size:d3_map_size,empty:d3_map_empty,forEach:function(f){for(var key in this._)f.call(this,d3_map_unescape(key),this._[key])}}),d3.nest=function(){var sortValues,rollup,nest={},keys=[],sortKeys=[];function map(mapType,array,depth){if(depth>=keys.length)return rollup?rollup.call(nest,array):sortValues?array.sort(sortValues):array;for(var keyValue,object,setter,values,i=-1,n=array.length,key=keys[depth++],valuesByKey=new d3_Map;++i<n;)(values=valuesByKey.get(keyValue=key(object=array[i])))?values.push(object):valuesByKey.set(keyValue,[object]);return setter=mapType?(object=mapType(),function(keyValue,values){object.set(keyValue,map(mapType,values,depth))}):(object={},function(keyValue,values){object[keyValue]=map(mapType,values,depth)}),valuesByKey.forEach(setter),object}return nest.map=function(array,mapType){return map(mapType,array,0)},nest.entries=function(array){return function entries(map,depth){if(depth>=keys.length)return map;var array=[],sortKey=sortKeys[depth++];return map.forEach(function(key,keyMap){array.push({key:key,values:entries(keyMap,depth)})}),sortKey?array.sort(function(a,b){return sortKey(a.key,b.key)}):array}(map(d3.map,array,0),0)},nest.key=function(d){return keys.push(d),nest},nest.sortKeys=function(order){return sortKeys[keys.length-1]=order,nest},nest.sortValues=function(order){return sortValues=order,nest},nest.rollup=function(f){return rollup=f,nest},nest},d3.set=function(array){var set=new d3_Set;if(array)for(var i=0,n=array.length;i<n;++i)set.add(array[i]);return set},d3_class(d3_Set,{has:d3_map_has,add:function(key){return this._[d3_map_escape(key+="")]=!0,key},remove:d3_map_remove,values:d3_map_keys,size:d3_map_size,empty:d3_map_empty,forEach:function(f){for(var key in this._)f.call(this,d3_map_unescape(key))}}),d3.behavior={},d3.rebind=function(target,source){for(var method,i=1,n=arguments.length;++i<n;)target[method=arguments[i]]=function(target,source,method){return function(){var value=method.apply(source,arguments);return value===source?target:value}}(target,source,source[method]);return target};var d3_vendorPrefixes=["webkit","ms","moz","Moz","o","O"];function d3_noop(){}function d3_dispatch(){}function d3_dispatch_event(dispatch){var listeners=[],listenerByName=new d3_Map;function event(){for(var l,z=listeners,i=-1,n=z.length;++i<n;)(l=z[i].on)&&l.apply(this,arguments);return dispatch}return event.on=function(name,listener){var i=listenerByName.get(name);return arguments.length<2?i&&i.on:(i&&(i.on=null,listeners=listeners.slice(0,i=listeners.indexOf(i)).concat(listeners.slice(i+1)),listenerByName.remove(name)),listener&&listeners.push(listenerByName.set(name,{on:listener})),dispatch)},event}function d3_eventPreventDefault(){d3.event.preventDefault()}function d3_eventSource(){for(var s,e=d3.event;s=e.sourceEvent;)e=s;return e}function d3_eventDispatch(target){for(var dispatch=new d3_dispatch,i=0,n=arguments.length;++i<n;)dispatch[arguments[i]]=d3_dispatch_event(dispatch);return dispatch.of=function(thiz,argumentz){return function(e1){try{var e0=e1.sourceEvent=d3.event;e1.target=target,d3.event=e1,dispatch[e1.type].apply(thiz,argumentz)}finally{d3.event=e0}}},dispatch}d3.dispatch=function(){for(var dispatch=new d3_dispatch,i=-1,n=arguments.length;++i<n;)dispatch[arguments[i]]=d3_dispatch_event(dispatch);return dispatch},d3_dispatch.prototype.on=function(type,listener){var i=type.indexOf("."),name="";if(0<=i&&(name=type.slice(i+1),type=type.slice(0,i)),type)return arguments.length<2?this[type].on(name):this[type].on(name,listener);if(2===arguments.length){if(null==listener)for(type in this)this.hasOwnProperty(type)&&this[type].on(name,null);return this}},d3.event=null,d3.requote=function(s){return s.replace(d3_requote_re,"\\$&")};var d3_requote_re=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g,d3_subclass={}.__proto__?function(object,prototype){object.__proto__=prototype}:function(object,prototype){for(var property in prototype)object[property]=prototype[property]};function d3_selection(groups){return d3_subclass(groups,d3_selectionPrototype),groups}var d3_select=function(s,n){return n.querySelector(s)},d3_selectAll=function(s,n){return n.querySelectorAll(s)},d3_selectMatches=function(n,s){var d3_selectMatcher=n.matches||n[d3_vendorSymbol(n,"matchesSelector")];return(d3_selectMatches=function(n,s){return d3_selectMatcher.call(n,s)})(n,s)};"function"==typeof Sizzle&&(d3_select=function(s,n){return Sizzle(s,n)[0]||null},d3_selectMatches=(d3_selectAll=Sizzle).matchesSelector),d3.selection=function(){return d3.select(d3_document.documentElement)};var d3_selectionPrototype=d3.selection.prototype=[];function d3_selection_selector(selector){return"function"==typeof selector?selector:function(){return d3_select(selector,this)}}function d3_selection_selectorAll(selector){return"function"==typeof selector?selector:function(){return d3_selectAll(selector,this)}}d3_selectionPrototype.select=function(selector){var subgroup,subnode,group,node,subgroups=[];selector=d3_selection_selector(selector);for(var j=-1,m=this.length;++j<m;){subgroups.push(subgroup=[]),subgroup.parentNode=(group=this[j]).parentNode;for(var i=-1,n=group.length;++i<n;)(node=group[i])?(subgroup.push(subnode=selector.call(node,node.__data__,i,j)),subnode&&"__data__"in node&&(subnode.__data__=node.__data__)):subgroup.push(null)}return d3_selection(subgroups)},d3_selectionPrototype.selectAll=function(selector){var subgroup,node,subgroups=[];selector=d3_selection_selectorAll(selector);for(var j=-1,m=this.length;++j<m;)for(var group=this[j],i=-1,n=group.length;++i<n;)(node=group[i])&&(subgroups.push(subgroup=d3_array(selector.call(node,node.__data__,i,j))),subgroup.parentNode=node);return d3_selection(subgroups)};var d3_nsXhtml="http://www.w3.org/1999/xhtml",d3_nsPrefix={svg:"http://www.w3.org/2000/svg",xhtml:d3_nsXhtml,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function d3_selection_attr(name,value){return name=d3.ns.qualify(name),null==value?name.local?function(){this.removeAttributeNS(name.space,name.local)}:function(){this.removeAttribute(name)}:"function"==typeof value?name.local?function(){var x=value.apply(this,arguments);null==x?this.removeAttributeNS(name.space,name.local):this.setAttributeNS(name.space,name.local,x)}:function(){var x=value.apply(this,arguments);null==x?this.removeAttribute(name):this.setAttribute(name,x)}:name.local?function(){this.setAttributeNS(name.space,name.local,value)}:function(){this.setAttribute(name,value)}}function d3_collapse(s){return s.trim().replace(/\s+/g," ")}function d3_selection_classedRe(name){return new RegExp("(?:^|\\s+)"+d3.requote(name)+"(?:\\s+|$)","g")}function d3_selection_classes(name){return(name+"").trim().split(/^|\s+/)}function d3_selection_classed(name,value){var n=(name=d3_selection_classes(name).map(d3_selection_classedName)).length;return"function"==typeof value?function(){for(var i=-1,x=value.apply(this,arguments);++i<n;)name[i](this,x)}:function(){for(var i=-1;++i<n;)name[i](this,value)}}function d3_selection_classedName(name){var re=d3_selection_classedRe(name);return function(node,value){if(c=node.classList)return value?c.add(name):c.remove(name);var c=node.getAttribute("class")||"";value?(re.lastIndex=0,re.test(c)||node.setAttribute("class",d3_collapse(c+" "+name))):node.setAttribute("class",d3_collapse(c.replace(re," ")))}}function d3_selection_style(name,value,priority){return null==value?function(){this.style.removeProperty(name)}:"function"==typeof value?function(){var x=value.apply(this,arguments);null==x?this.style.removeProperty(name):this.style.setProperty(name,x,priority)}:function(){this.style.setProperty(name,value,priority)}}function d3_selection_property(name,value){return null==value?function(){delete this[name]}:"function"==typeof value?function(){var x=value.apply(this,arguments);null==x?delete this[name]:this[name]=x}:function(){this[name]=value}}function d3_selection_creator(name){return"function"==typeof name?name:(name=d3.ns.qualify(name)).local?function(){return this.ownerDocument.createElementNS(name.space,name.local)}:function(){var document=this.ownerDocument,namespace=this.namespaceURI;return namespace===d3_nsXhtml&&document.documentElement.namespaceURI===d3_nsXhtml?document.createElement(name):document.createElementNS(namespace,name)}}function d3_selectionRemove(){var parent=this.parentNode;parent&&parent.removeChild(this)}function d3_selection_filter(selector){return function(){return d3_selectMatches(this,selector)}}function d3_selection_each(groups,callback){for(var j=0,m=groups.length;j<m;j++)for(var node,group=groups[j],i=0,n=group.length;i<n;i++)(node=group[i])&&callback(node,i,j);return groups}function d3_selection_enter(selection){return d3_subclass(selection,d3_selection_enterPrototype),selection}d3.ns={prefix:d3_nsPrefix,qualify:function(name){var i=name.indexOf(":"),prefix=name;return 0<=i&&"xmlns"!==(prefix=name.slice(0,i))&&(name=name.slice(i+1)),d3_nsPrefix.hasOwnProperty(prefix)?{space:d3_nsPrefix[prefix],local:name}:name}},d3_selectionPrototype.attr=function(name,value){if(arguments.length<2){if("string"==typeof name){var node=this.node();return(name=d3.ns.qualify(name)).local?node.getAttributeNS(name.space,name.local):node.getAttribute(name)}for(value in name)this.each(d3_selection_attr(value,name[value]));return this}return this.each(d3_selection_attr(name,value))},d3_selectionPrototype.classed=function(name,value){if(arguments.length<2){if("string"==typeof name){var node=this.node(),n=(name=d3_selection_classes(name)).length,i=-1;if(value=node.classList){for(;++i<n;)if(!value.contains(name[i]))return!1}else for(value=node.getAttribute("class");++i<n;)if(!d3_selection_classedRe(name[i]).test(value))return!1;return!0}for(value in name)this.each(d3_selection_classed(value,name[value]));return this}return this.each(d3_selection_classed(name,value))},d3_selectionPrototype.style=function(name,value,priority){var node=arguments.length;if(node<3){if("string"!=typeof name){for(priority in node<2&&(value=""),name)this.each(d3_selection_style(priority,name[priority],value));return this}if(node<2){node=this.node();return d3_window(node).getComputedStyle(node,null).getPropertyValue(name)}priority=""}return this.each(d3_selection_style(name,value,priority))},d3_selectionPrototype.property=function(name,value){if(arguments.length<2){if("string"==typeof name)return this.node()[name];for(value in name)this.each(d3_selection_property(value,name[value]));return this}return this.each(d3_selection_property(name,value))},d3_selectionPrototype.text=function(value){return arguments.length?this.each("function"==typeof value?function(){var v=value.apply(this,arguments);this.textContent=null==v?"":v}:null==value?function(){this.textContent=""}:function(){this.textContent=value}):this.node().textContent},d3_selectionPrototype.html=function(value){return arguments.length?this.each("function"==typeof value?function(){var v=value.apply(this,arguments);this.innerHTML=null==v?"":v}:null==value?function(){this.innerHTML=""}:function(){this.innerHTML=value}):this.node().innerHTML},d3_selectionPrototype.append=function(name){return name=d3_selection_creator(name),this.select(function(){return this.appendChild(name.apply(this,arguments))})},d3_selectionPrototype.insert=function(name,before){return name=d3_selection_creator(name),before=d3_selection_selector(before),this.select(function(){return this.insertBefore(name.apply(this,arguments),before.apply(this,arguments)||null)})},d3_selectionPrototype.remove=function(){return this.each(d3_selectionRemove)},d3_selectionPrototype.data=function(value,key){var group,node,i=-1,n=this.length;if(!arguments.length){for(value=new Array(n=(group=this[0]).length);++i<n;)(node=group[i])&&(value[i]=node.__data__);return value}function bind(group,groupData){var node,nodeData,n=group.length,m=groupData.length,n0=Math.min(n,m),updateNodes=new Array(m),enterNodes=new Array(m),exitNodes=new Array(n);if(key){for(var keyValue,nodeByKeyValue=new d3_Map,keyValues=new Array(n),i=-1;++i<n;)(node=group[i])&&(nodeByKeyValue.has(keyValue=key.call(node,node.__data__,i))?exitNodes[i]=node:nodeByKeyValue.set(keyValue,node),keyValues[i]=keyValue);for(i=-1;++i<m;)(node=nodeByKeyValue.get(keyValue=key.call(groupData,nodeData=groupData[i],i)))?!0!==node&&((updateNodes[i]=node).__data__=nodeData):enterNodes[i]={__data__:nodeData},nodeByKeyValue.set(keyValue,!0);for(i=-1;++i<n;)i in keyValues&&!0!==nodeByKeyValue.get(keyValues[i])&&(exitNodes[i]=group[i])}else{for(i=-1;++i<n0;)node=group[i],nodeData=groupData[i],node?(node.__data__=nodeData,updateNodes[i]=node):enterNodes[i]={__data__:nodeData};for(;i<m;++i)enterNodes[i]={__data__:groupData[i]};for(;i<n;++i)exitNodes[i]=group[i]}enterNodes.update=updateNodes,enterNodes.parentNode=updateNodes.parentNode=exitNodes.parentNode=group.parentNode,enter.push(enterNodes),update.push(updateNodes),exit.push(exitNodes)}var enter=d3_selection_enter([]),update=d3_selection([]),exit=d3_selection([]);if("function"==typeof value)for(;++i<n;)bind(group=this[i],value.call(group,group.parentNode.__data__,i));else for(;++i<n;)bind(group=this[i],value);return update.enter=function(){return enter},update.exit=function(){return exit},update},d3_selectionPrototype.datum=function(value){return arguments.length?this.property("__data__",value):this.property("__data__")},d3_selectionPrototype.filter=function(filter){var subgroup,group,node,subgroups=[];"function"!=typeof filter&&(filter=d3_selection_filter(filter));for(var j=0,m=this.length;j<m;j++){subgroups.push(subgroup=[]),subgroup.parentNode=(group=this[j]).parentNode;for(var i=0,n=group.length;i<n;i++)(node=group[i])&&filter.call(node,node.__data__,i,j)&&subgroup.push(node)}return d3_selection(subgroups)},d3_selectionPrototype.order=function(){for(var j=-1,m=this.length;++j<m;)for(var node,group=this[j],i=group.length-1,next=group[i];0<=--i;)(node=group[i])&&(next&&next!==node.nextSibling&&next.parentNode.insertBefore(node,next),next=node);return this},d3_selectionPrototype.sort=function(comparator){comparator=function(comparator){arguments.length||(comparator=d3_ascending);return function(a,b){return a&&b?comparator(a.__data__,b.__data__):!a-!b}}.apply(this,arguments);for(var j=-1,m=this.length;++j<m;)this[j].sort(comparator);return this.order()},d3_selectionPrototype.each=function(callback){return d3_selection_each(this,function(node,i,j){callback.call(node,node.__data__,i,j)})},d3_selectionPrototype.call=function(callback){var args=d3_array(arguments);return callback.apply(args[0]=this,args),this},d3_selectionPrototype.empty=function(){return!this.node()},d3_selectionPrototype.node=function(){for(var j=0,m=this.length;j<m;j++)for(var group=this[j],i=0,n=group.length;i<n;i++){var node=group[i];if(node)return node}return null},d3_selectionPrototype.size=function(){var n=0;return d3_selection_each(this,function(){++n}),n};var d3_selection_enterPrototype=[];function d3_selection_on(type,listener,capture){var name="__on"+type,i=type.indexOf("."),wrap=d3_selection_onListener;0<i&&(type=type.slice(0,i));var filter=d3_selection_onFilters.get(type);function onRemove(){var l=this[name];l&&(this.removeEventListener(type,l,l.$),delete this[name])}return filter&&(type=filter,wrap=d3_selection_onFilter),i?listener?function(){var l=wrap(listener,d3_array(arguments));onRemove.call(this),this.addEventListener(type,this[name]=l,l.$=capture),l._=listener}:onRemove:listener?d3_noop:function(){var match,name,l,re=new RegExp("^__on([^.]+)"+d3.requote(type)+"$");for(name in this)(match=name.match(re))&&(l=this[name],this.removeEventListener(match[1],l,l.$),delete this[name])}}d3.selection.enter=d3_selection_enter,(d3.selection.enter.prototype=d3_selection_enterPrototype).append=d3_selectionPrototype.append,d3_selection_enterPrototype.empty=d3_selectionPrototype.empty,d3_selection_enterPrototype.node=d3_selectionPrototype.node,d3_selection_enterPrototype.call=d3_selectionPrototype.call,d3_selection_enterPrototype.size=d3_selectionPrototype.size,d3_selection_enterPrototype.select=function(selector){for(var subgroup,subnode,upgroup,group,node,subgroups=[],j=-1,m=this.length;++j<m;){upgroup=(group=this[j]).update,subgroups.push(subgroup=[]),subgroup.parentNode=group.parentNode;for(var i=-1,n=group.length;++i<n;)(node=group[i])?(subgroup.push(upgroup[i]=subnode=selector.call(group.parentNode,node.__data__,i,j)),subnode.__data__=node.__data__):subgroup.push(null)}return d3_selection(subgroups)},d3_selection_enterPrototype.insert=function(name,before){var enter,i0,j0;return arguments.length<2&&(enter=this,before=function(d,i,j){var node,group=enter[j].update,n=group.length;for(j!=j0&&(j0=j,i0=0),i0<=i&&(i0=i+1);!(node=group[i0])&&++i0<n;);return node}),d3_selectionPrototype.insert.call(this,name,before)},d3.select=function(node){var group;return"string"==typeof node?(group=[d3_select(node,d3_document)]).parentNode=d3_document.documentElement:(group=[node]).parentNode=d3_documentElement(node),d3_selection([group])},d3.selectAll=function(nodes){var group;return"string"==typeof nodes?(group=d3_array(d3_selectAll(nodes,d3_document))).parentNode=d3_document.documentElement:(group=d3_array(nodes)).parentNode=null,d3_selection([group])},d3_selectionPrototype.on=function(type,listener,capture){var n=arguments.length;if(n<3){if("string"!=typeof type){for(capture in n<2&&(listener=!1),type)this.each(d3_selection_on(capture,type[capture],listener));return this}if(n<2)return(n=this.node()["__on"+type])&&n._;capture=!1}return this.each(d3_selection_on(type,listener,capture))};var d3_selection_onFilters=d3.map({mouseenter:"mouseover",mouseleave:"mouseout"});function d3_selection_onListener(listener,argumentz){return function(e){var o=d3.event;d3.event=e,argumentz[0]=this.__data__;try{listener.apply(this,argumentz)}finally{d3.event=o}}}function d3_selection_onFilter(listener,argumentz){var l=d3_selection_onListener(listener,argumentz);return function(e){var related=e.relatedTarget;related&&(related===this||8&related.compareDocumentPosition(this))||l.call(this,e)}}d3_document&&d3_selection_onFilters.forEach(function(k){"on"+k in d3_document&&d3_selection_onFilters.remove(k)});var d3_event_dragSelect,d3_event_dragId=0;function d3_event_dragSuppress(node){var style,select,name=".dragsuppress-"+ ++d3_event_dragId,click="click"+name,w=d3.select(d3_window(node)).on("touchmove"+name,d3_eventPreventDefault).on("dragstart"+name,d3_eventPreventDefault).on("selectstart"+name,d3_eventPreventDefault);return(d3_event_dragSelect=null==d3_event_dragSelect?!("onselectstart"in node)&&d3_vendorSymbol(node.style,"userSelect"):d3_event_dragSelect)&&(style=d3_documentElement(node).style,select=style[d3_event_dragSelect],style[d3_event_dragSelect]="none"),function(suppressClick){var off;w.on(name,null),d3_event_dragSelect&&(style[d3_event_dragSelect]=select),suppressClick&&(off=function(){w.on(click,null)},w.on(click,function(){d3_eventPreventDefault(),off()},!0),setTimeout(off,0))}}d3.mouse=function(container){return d3_mousePoint(container,d3_eventSource())};var d3_mouse_bug44083=this.navigator&&/WebKit/.test(this.navigator.userAgent)?-1:0;function d3_mousePoint(container,e){if(e.changedTouches&&(e=e.changedTouches[0]),(svg=container.ownerSVGElement||container).createSVGPoint){var svg,ctm,rect=svg.createSVGPoint();return d3_mouse_bug44083<0&&(((ctm=d3_window(container)).scrollX||ctm.scrollY)&&(ctm=(svg=d3.select("body").append("svg").style({position:"absolute",top:0,left:0,margin:0,padding:0,border:"none"},"important"))[0][0].getScreenCTM(),d3_mouse_bug44083=!(ctm.f||ctm.e),svg.remove())),d3_mouse_bug44083?(rect.x=e.pageX,rect.y=e.pageY):(rect.x=e.clientX,rect.y=e.clientY),[(rect=rect.matrixTransform(container.getScreenCTM().inverse())).x,rect.y]}rect=container.getBoundingClientRect();return[e.clientX-rect.left-container.clientLeft,e.clientY-rect.top-container.clientTop]}function d3_behavior_dragTouchId(){return d3.event.changedTouches[0].identifier}d3.touch=function(container,touches,identifier){if(arguments.length<3&&(identifier=touches,touches=d3_eventSource().changedTouches),touches)for(var touch,i=0,n=touches.length;i<n;++i)if((touch=touches[i]).identifier===identifier)return d3_mousePoint(container,touch)},d3.behavior.drag=function(){var event=d3_eventDispatch(drag,"drag","dragstart","dragend"),origin=null,mousedown=dragstart(d3_noop,d3.mouse,d3_window,"mousemove","mouseup"),touchstart=dragstart(d3_behavior_dragTouchId,d3.touch,d3_identity,"touchmove","touchend");function drag(){this.on("mousedown.drag",mousedown).on("touchstart.drag",touchstart)}function dragstart(id,position,subject,move,end){return function(){var dragOffset,target=d3.event.target.correspondingElement||d3.event.target,parent=this.parentNode,dispatch=event.of(this,arguments),dragged=0,dragId=id(),dragName=".drag"+(null==dragId?"":"-"+dragId),dragSubject=d3.select(subject(target)).on(move+dragName,function(){var dx,dy,position1=position(parent,dragId);position1&&(dx=position1[0]-position0[0],dy=position1[1]-position0[1],dragged|=dx|dy,dispatch({type:"drag",x:(position0=position1)[0]+dragOffset[0],y:position1[1]+dragOffset[1],dx:dx,dy:dy}))}).on(end+dragName,function(){position(parent,dragId)&&(dragSubject.on(move+dragName,null).on(end+dragName,null),dragRestore(dragged),dispatch({type:"dragend"}))}),dragRestore=d3_event_dragSuppress(target),position0=position(parent,dragId);dragOffset=origin?[(dragOffset=origin.apply(this,arguments)).x-position0[0],dragOffset.y-position0[1]]:[0,0],dispatch({type:"dragstart"})}}return drag.origin=function(x){return arguments.length?(origin=x,drag):origin},d3.rebind(drag,event,"on")},d3.touches=function(container,touches){return(touches=arguments.length<2?d3_eventSource().touches:touches)?d3_array(touches).map(function(touch){var point=d3_mousePoint(container,touch);return point.identifier=touch.identifier,point}):[]};var ε=1e-6,ε2=ε*ε,π=Math.PI,τ=2*π,τε=τ-ε,halfπ=π/2,d3_radians=π/180,d3_degrees=180/π;function d3_sgn(x){return 0<x?1:x<0?-1:0}function d3_cross2d(a,b,c){return(b[0]-a[0])*(c[1]-a[1])-(b[1]-a[1])*(c[0]-a[0])}function d3_acos(x){return 1<x?0:x<-1?π:Math.acos(x)}function d3_asin(x){return 1<x?halfπ:x<-1?-halfπ:Math.asin(x)}function d3_cosh(x){return((x=Math.exp(x))+1/x)/2}function d3_haversin(x){return(x=Math.sin(x/2))*x}var ρ=Math.SQRT2;d3.interpolateZoom=function(b0,w1){var d1,r0,S,i,ux0=b0[0],uy0=b0[1],w0=b0[2],d2=w1[0],b0=w1[1],w1=w1[2],dx=d2-ux0,dy=b0-uy0,d2=dx*dx+dy*dy;return(i=d2<ε2?(S=Math.log(w1/w0)/ρ,function(t){return[ux0+t*dx,uy0+t*dy,w0*Math.exp(ρ*t*S)]}):(d1=Math.sqrt(d2),b0=(w1*w1-w0*w0+4*d2)/(2*w0*2*d1),i=(w1*w1-w0*w0-4*d2)/(2*w1*2*d1),r0=Math.log(Math.sqrt(b0*b0+1)-b0),S=(Math.log(Math.sqrt(i*i+1)-i)-r0)/ρ,function(u){var s=u*S,coshr0=d3_cosh(r0),u=w0/(2*d1)*(coshr0*(u=ρ*s+r0,((u=Math.exp(2*u))-1)/(u+1))-function(x){return((x=Math.exp(x))-1/x)/2}(r0));return[ux0+u*dx,uy0+u*dy,w0*coshr0/d3_cosh(ρ*s+r0)]})).duration=1e3*S,i},d3.behavior.zoom=function(){var translate0,center0,center,mousewheelTimer,touchtime,x0,x1,y0,y1,view={x:0,y:0,k:1},size=[960,500],scaleExtent=d3_behavior_zoomInfinity,duration=250,zooming=0,mousedown="mousedown.zoom",mousemove="mousemove.zoom",mouseup="mouseup.zoom",touchstart="touchstart.zoom",event=d3_eventDispatch(zoom,"zoomstart","zoom","zoomend");function zoom(g){g.on(mousedown,mousedowned).on(d3_behavior_zoomWheel+".zoom",mousewheeled).on("dblclick.zoom",dblclicked).on(touchstart,touchstarted)}function location(p){return[(p[0]-view.x)/view.k,(p[1]-view.y)/view.k]}function scaleTo(s){view.k=Math.max(scaleExtent[0],Math.min(scaleExtent[1],s))}function translateTo(p,l){l=function(l){return[l[0]*view.k+view.x,l[1]*view.k+view.y]}(l),view.x+=p[0]-l[0],view.y+=p[1]-l[1]}function zoomTo(that,p,l,k){that.__chart__={x:view.x,y:view.y,k:view.k},scaleTo(Math.pow(2,k)),translateTo(center0=p,l),that=d3.select(that),(that=0<duration?that.transition().duration(duration):that).call(zoom.event)}function rescale(){x1&&x1.domain(x0.range().map(function(x){return(x-view.x)/view.k}).map(x0.invert)),y1&&y1.domain(y0.range().map(function(y){return(y-view.y)/view.k}).map(y0.invert))}function zoomstarted(dispatch){zooming++||dispatch({type:"zoomstart"})}function zoomed(dispatch){rescale(),dispatch({type:"zoom",scale:view.k,translate:[view.x,view.y]})}function zoomended(dispatch){--zooming||(dispatch({type:"zoomend"}),center0=null)}function mousedowned(){var that=this,dispatch=event.of(that,arguments),dragged=0,subject=d3.select(d3_window(that)).on(mousemove,function(){dragged=1,translateTo(d3.mouse(that),location0),zoomed(dispatch)}).on(mouseup,function(){subject.on(mousemove,null).on(mouseup,null),dragRestore(dragged),zoomended(dispatch)}),location0=location(d3.mouse(that)),dragRestore=d3_event_dragSuppress(that);d3_selection_interrupt.call(that),zoomstarted(dispatch)}function touchstarted(){var scale0,that=this,dispatch=event.of(that,arguments),locations0={},distance0=0,zoomName=".zoom-"+d3.event.changedTouches[0].identifier,touchmove="touchmove"+zoomName,touchend="touchend"+zoomName,targets=[],subject=d3.select(that),dragRestore=d3_event_dragSuppress(that);function relocate(){var touches=d3.touches(that);return scale0=view.k,touches.forEach(function(t){t.identifier in locations0&&(locations0[t.identifier]=location(t))}),touches}function started(){var dy=d3.event.target;d3.select(dy).on(touchmove,moved).on(touchend,ended),targets.push(dy);for(var changed=d3.event.changedTouches,i=0,n=changed.length;i<n;++i)locations0[changed[i].identifier]=null;var p,dx=relocate(),dy=Date.now();1===dx.length?(dy-touchtime<500&&(p=dx[0],zoomTo(that,p,locations0[p.identifier],Math.floor(Math.log(view.k)/Math.LN2)+1),d3_eventPreventDefault()),touchtime=dy):1<dx.length&&(p=dx[0],dy=dx[1],dx=p[0]-dy[0],dy=p[1]-dy[1],distance0=dx*dx+dy*dy)}function moved(){var p1,l1,touches=d3.touches(that);d3_selection_interrupt.call(that);for(var scale1,p0,l0,i=0,n=touches.length;i<n;++i,l1=null)if(p1=touches[i],l1=locations0[p1.identifier]){if(l0)break;p0=p1,l0=l1}l1&&(scale1=(scale1=p1[0]-p0[0])*scale1+(scale1=p1[1]-p0[1])*scale1,scale1=distance0&&Math.sqrt(scale1/distance0),p0=[(p0[0]+p1[0])/2,(p0[1]+p1[1])/2],l0=[(l0[0]+l1[0])/2,(l0[1]+l1[1])/2],scaleTo(scale1*scale0)),touchtime=null,translateTo(p0,l0),zoomed(dispatch)}function ended(){if(d3.event.touches.length){for(var identifier,changed=d3.event.changedTouches,i=0,n=changed.length;i<n;++i)delete locations0[changed[i].identifier];for(identifier in locations0)return void relocate()}d3.selectAll(targets).on(zoomName,null),subject.on(mousedown,mousedowned).on(touchstart,touchstarted),dragRestore(),zoomended(dispatch)}started(),zoomstarted(dispatch),subject.on(mousedown,null).on(touchstart,started)}function mousewheeled(){var dispatch=event.of(this,arguments);mousewheelTimer?clearTimeout(mousewheelTimer):(d3_selection_interrupt.call(this),translate0=location(center0=center||d3.mouse(this)),zoomstarted(dispatch)),mousewheelTimer=setTimeout(function(){mousewheelTimer=null,zoomended(dispatch)},50),d3_eventPreventDefault(),scaleTo(Math.pow(2,.002*d3_behavior_zoomDelta())*view.k),translateTo(center0,translate0),zoomed(dispatch)}function dblclicked(){var p=d3.mouse(this),k=Math.log(view.k)/Math.LN2;zoomTo(this,p,location(p),d3.event.shiftKey?Math.ceil(k)-1:Math.floor(k)+1)}return d3_behavior_zoomWheel=d3_behavior_zoomWheel||("onwheel"in d3_document?(d3_behavior_zoomDelta=function(){return-d3.event.deltaY*(d3.event.deltaMode?120:1)},"wheel"):"onmousewheel"in d3_document?(d3_behavior_zoomDelta=function(){return d3.event.wheelDelta},"mousewheel"):(d3_behavior_zoomDelta=function(){return-d3.event.detail},"MozMousePixelScroll")),zoom.event=function(g){g.each(function(){var dispatch=event.of(this,arguments),view1=view;d3_transitionInheritId?d3.select(this).transition().each("start.zoom",function(){view=this.__chart__||{x:0,y:0,k:1},zoomstarted(dispatch)}).tween("zoom:zoom",function(){var dx=size[0],dy=size[1],cx=center0?center0[0]:dx/2,cy=center0?center0[1]:dy/2,i=d3.interpolateZoom([(cx-view.x)/view.k,(cy-view.y)/view.k,dx/view.k],[(cx-view1.x)/view1.k,(cy-view1.y)/view1.k,dx/view1.k]);return function(k){var l=i(k),k=dx/l[2];this.__chart__=view={x:cx-l[0]*k,y:cy-l[1]*k,k:k},zoomed(dispatch)}}).each("interrupt.zoom",function(){zoomended(dispatch)}).each("end.zoom",function(){zoomended(dispatch)}):(this.__chart__=view,zoomstarted(dispatch),zoomed(dispatch),zoomended(dispatch))})},zoom.translate=function(_){return arguments.length?(view={x:+_[0],y:+_[1],k:view.k},rescale(),zoom):[view.x,view.y]},zoom.scale=function(_){return arguments.length?(view={x:view.x,y:view.y,k:null},scaleTo(+_),rescale(),zoom):view.k},zoom.scaleExtent=function(_){return arguments.length?(scaleExtent=null==_?d3_behavior_zoomInfinity:[+_[0],+_[1]],zoom):scaleExtent},zoom.center=function(_){return arguments.length?(center=_&&[+_[0],+_[1]],zoom):center},zoom.size=function(_){return arguments.length?(size=_&&[+_[0],+_[1]],zoom):size},zoom.duration=function(_){return arguments.length?(duration=+_,zoom):duration},zoom.x=function(z){return arguments.length?(x0=(x1=z).copy(),view={x:0,y:0,k:1},zoom):x1},zoom.y=function(z){return arguments.length?(y0=(y1=z).copy(),view={x:0,y:0,k:1},zoom):y1},d3.rebind(zoom,event,"on")};var d3_behavior_zoomDelta,d3_behavior_zoomWheel,d3_behavior_zoomInfinity=[0,1/0];function d3_color(){}function d3_hsl(h,s,l){return this instanceof d3_hsl?(this.h=+h,this.s=+s,void(this.l=+l)):arguments.length<2?h instanceof d3_hsl?new d3_hsl(h.h,h.s,h.l):d3_rgb_parse(""+h,d3_rgb_hsl,d3_hsl):new d3_hsl(h,s,l)}(d3.color=d3_color).prototype.toString=function(){return this.rgb()+""};d3_time_formatUtc=(d3.hsl=d3_hsl).prototype=new d3_color;function d3_hsl_rgb(h,s,l){var m1,m2;function vv(h){return Math.round(255*function(h){return 360<h?h-=360:h<0&&(h+=360),h<60?m1+(m2-m1)*h/60:h<180?m2:h<240?m1+(m2-m1)*(240-h)/60:m1}(h))}return h=isNaN(h)?0:(h%=360)<0?h+360:h,s=isNaN(s)||s<0?0:1<s?1:s,m1=2*(l=l<0?0:1<l?1:l)-(m2=l<=.5?l*(1+s):l+s-l*s),new d3_rgb(vv(h+120),vv(h),vv(h-120))}function d3_hcl(h,c,l){return this instanceof d3_hcl?(this.h=+h,this.c=+c,void(this.l=+l)):arguments.length<2?h instanceof d3_hcl?new d3_hcl(h.h,h.c,h.l):d3_lab_hcl((h instanceof d3_lab?h:h=d3_rgb_lab((h=d3.rgb(h)).r,h.g,h.b)).l,h.a,h.b):new d3_hcl(h,c,l)}d3_time_formatUtc.brighter=function(k){return k=Math.pow(.7,arguments.length?k:1),new d3_hsl(this.h,this.s,this.l/k)},d3_time_formatUtc.darker=function(k){return k=Math.pow(.7,arguments.length?k:1),new d3_hsl(this.h,this.s,k*this.l)},d3_time_formatUtc.rgb=function(){return d3_hsl_rgb(this.h,this.s,this.l)};d3_time_formatIso=(d3.hcl=d3_hcl).prototype=new d3_color;function d3_hcl_lab(h,c,l){return isNaN(h)&&(h=0),isNaN(c)&&(c=0),new d3_lab(l,Math.cos(h*=d3_radians)*c,Math.sin(h)*c)}function d3_lab(l,a,b){return this instanceof d3_lab?(this.l=+l,this.a=+a,void(this.b=+b)):arguments.length<2?l instanceof d3_lab?new d3_lab(l.l,l.a,l.b):l instanceof d3_hcl?d3_hcl_lab(l.h,l.c,l.l):d3_rgb_lab((l=d3_rgb(l)).r,l.g,l.b):new d3_lab(l,a,b)}d3_time_formatIso.brighter=function(k){return new d3_hcl(this.h,this.c,Math.min(100,this.l+d3_lab_K*(arguments.length?k:1)))},d3_time_formatIso.darker=function(k){return new d3_hcl(this.h,this.c,Math.max(0,this.l-d3_lab_K*(arguments.length?k:1)))},d3_time_formatIso.rgb=function(){return d3_hcl_lab(this.h,this.c,this.l).rgb()},d3.lab=d3_lab;var d3_lab_K=18,d3_lab_X=.95047,d3_lab_Y=1,d3_lab_Z=1.08883,d3_time_format=d3_lab.prototype=new d3_color;function d3_lab_rgb(y,x,z){y=(y+16)/116,z=y-z/200;return new d3_rgb(d3_xyz_rgb(3.2404542*(x=d3_lab_xyz(x=y+x/500)*d3_lab_X)-1.5371385*(y=d3_lab_xyz(y)*d3_lab_Y)-.4985314*(z=d3_lab_xyz(z)*d3_lab_Z)),d3_xyz_rgb(-.969266*x+1.8760108*y+.041556*z),d3_xyz_rgb(.0556434*x-.2040259*y+1.0572252*z))}function d3_lab_hcl(l,a,b){return 0<l?new d3_hcl(Math.atan2(b,a)*d3_degrees,Math.sqrt(a*a+b*b),l):new d3_hcl(NaN,NaN,l)}function d3_lab_xyz(x){return.206893034<x?x*x*x:(x-4/29)/7.787037}function d3_xyz_lab(x){return.008856<x?Math.pow(x,1/3):7.787037*x+4/29}function d3_xyz_rgb(r){return Math.round(255*(r<=.00304?12.92*r:1.055*Math.pow(r,1/2.4)-.055))}function d3_rgb(r,g,b){return this instanceof d3_rgb?(this.r=~~r,this.g=~~g,void(this.b=~~b)):arguments.length<2?r instanceof d3_rgb?new d3_rgb(r.r,r.g,r.b):d3_rgb_parse(""+r,d3_rgb,d3_hsl_rgb):new d3_rgb(r,g,b)}function d3_rgbNumber(value){return new d3_rgb(value>>16,value>>8&255,255&value)}function d3_rgbString(value){return d3_rgbNumber(value)+""}d3_time_format.brighter=function(k){return new d3_lab(Math.min(100,this.l+d3_lab_K*(arguments.length?k:1)),this.a,this.b)},d3_time_format.darker=function(k){return new d3_lab(Math.max(0,this.l-d3_lab_K*(arguments.length?k:1)),this.a,this.b)},d3_time_format.rgb=function(){return d3_lab_rgb(this.l,this.a,this.b)};d3_time_formatUtc=(d3.rgb=d3_rgb).prototype=new d3_color;function d3_rgb_hex(v){return v<16?"0"+Math.max(0,v).toString(16):Math.min(255,v).toString(16)}function d3_rgb_parse(format,rgb,hsl){var m2,r=0,g=0,b=0,color=/([a-z]+)\((.*)\)/.exec(format=format.toLowerCase());if(color)switch(m2=color[2].split(","),color[1]){case"hsl":return hsl(parseFloat(m2[0]),parseFloat(m2[1])/100,parseFloat(m2[2])/100);case"rgb":return rgb(d3_rgb_parseNumber(m2[0]),d3_rgb_parseNumber(m2[1]),d3_rgb_parseNumber(m2[2]))}return(color=d3_rgb_names.get(format))?rgb(color.r,color.g,color.b):(null==format||"#"!==format.charAt(0)||isNaN(color=parseInt(format.slice(1),16))||(4===format.length?(r=(3840&color)>>4,r|=r>>4,g=240&color,g|=g>>4,b=15&color,b|=b<<4):7===format.length&&(r=(16711680&color)>>16,g=(65280&color)>>8,b=255&color)),rgb(r,g,b))}function d3_rgb_hsl(r,g,b){var h,s,min=Math.min(r/=255,g/=255,b/=255),max=Math.max(r,g,b),d=max-min,l=(max+min)/2;return d?(s=l<.5?d/(max+min):d/(2-max-min),h=r==max?(g-b)/d+(g<b?6:0):g==max?(b-r)/d+2:(r-g)/d+4,h*=60):(h=NaN,s=0<l&&l<1?0:h),new d3_hsl(h,s,l)}function d3_rgb_lab(r,g,b){var x=d3_xyz_lab((.4124564*(r=d3_rgb_xyz(r))+.3575761*(g=d3_rgb_xyz(g))+.1804375*(b=d3_rgb_xyz(b)))/d3_lab_X),y=d3_xyz_lab((.2126729*r+.7151522*g+.072175*b)/d3_lab_Y);return d3_lab(116*y-16,500*(x-y),200*(y-d3_xyz_lab((.0193339*r+.119192*g+.9503041*b)/d3_lab_Z)))}function d3_rgb_xyz(r){return(r/=255)<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function d3_rgb_parseNumber(c){var f=parseFloat(c);return"%"===c.charAt(c.length-1)?Math.round(2.55*f):f}d3_time_formatUtc.brighter=function(k){k=Math.pow(.7,arguments.length?k:1);var r=this.r,g=this.g,b=this.b,i=30;return r||g||b?(r&&r<i&&(r=i),g&&g<i&&(g=i),b&&b<i&&(b=i),new d3_rgb(Math.min(255,r/k),Math.min(255,g/k),Math.min(255,b/k))):new d3_rgb(i,i,i)},d3_time_formatUtc.darker=function(k){return new d3_rgb((k=Math.pow(.7,arguments.length?k:1))*this.r,k*this.g,k*this.b)},d3_time_formatUtc.hsl=function(){return d3_rgb_hsl(this.r,this.g,this.b)},d3_time_formatUtc.toString=function(){return"#"+d3_rgb_hex(this.r)+d3_rgb_hex(this.g)+d3_rgb_hex(this.b)};var d3_rgb_names=d3.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});function d3_functor(v){return"function"==typeof v?v:function(){return v}}function d3_xhrType(response){return function(url,mimeType,callback){return 2===arguments.length&&"function"==typeof mimeType&&(callback=mimeType,mimeType=null),d3_xhr(url,mimeType,response,callback)}}function d3_xhr(url,mimeType,response,callback){var xhr={},dispatch=d3.dispatch("beforesend","progress","load","error"),headers={},request=new XMLHttpRequest,responseType=null;function respond(){var result,status=request.status;if(!status&&function(request){var type=request.responseType;return type&&"text"!==type?request.response:request.responseText}(request)||200<=status&&status<300||304===status){try{result=response.call(xhr,request)}catch(e){return void dispatch.error.call(xhr,e)}dispatch.load.call(xhr,result)}else dispatch.error.call(xhr,request)}return"onload"in(request=this.XDomainRequest&&!("withCredentials"in request)&&/^(http(s)?:)?\/\//.test(url)?new XDomainRequest:request)?request.onload=request.onerror=respond:request.onreadystatechange=function(){3<request.readyState&&respond()},request.onprogress=function(event){var o=d3.event;d3.event=event;try{dispatch.progress.call(xhr,request)}finally{d3.event=o}},xhr.header=function(name,value){return name=(name+"").toLowerCase(),arguments.length<2?headers[name]:(null==value?delete headers[name]:headers[name]=value+"",xhr)},xhr.mimeType=function(value){return arguments.length?(mimeType=null==value?null:value+"",xhr):mimeType},xhr.responseType=function(value){return arguments.length?(responseType=value,xhr):responseType},xhr.response=function(value){return response=value,xhr},["get","post"].forEach(function(method){xhr[method]=function(){return xhr.send.apply(xhr,[method].concat(d3_array(arguments)))}}),xhr.send=function(method,data,callback){if(2===arguments.length&&"function"==typeof data&&(callback=data,data=null),request.open(method,url,!0),null==mimeType||"accept"in headers||(headers.accept=mimeType+",*/*"),request.setRequestHeader)for(var name in headers)request.setRequestHeader(name,headers[name]);return null!=mimeType&&request.overrideMimeType&&request.overrideMimeType(mimeType),null!=responseType&&(request.responseType=responseType),null!=callback&&xhr.on("error",callback).on("load",function(request){callback(null,request)}),dispatch.beforesend.call(xhr,request),request.send(null==data?null:data),xhr},xhr.abort=function(){return request.abort(),xhr},d3.rebind(xhr,dispatch,"on"),null==callback?xhr:xhr.get(function(callback){return 1===callback.length?function(error,request){callback(null==error?request:null)}:callback}(callback))}d3_rgb_names.forEach(function(key,value){d3_rgb_names.set(key,d3_rgbNumber(value))}),d3.functor=d3_functor,d3.xhr=d3_xhrType(d3_identity),d3.dsv=function(delimiter,mimeType){var reFormat=new RegExp('["'+delimiter+"\n]"),delimiterCode=delimiter.charCodeAt(0);function dsv(url,row,callback){arguments.length<3&&(callback=row,row=null);var xhr=d3_xhr(url,mimeType,null==row?response:typedResponse(row),callback);return xhr.row=function(_){return arguments.length?xhr.response(null==(row=_)?response:typedResponse(_)):row},xhr}function response(request){return dsv.parse(request.responseText)}function typedResponse(f){return function(request){return dsv.parse(request.responseText,f)}}function formatRow(row){return row.map(formatValue).join(delimiter)}function formatValue(text){return reFormat.test(text)?'"'+text.replace(/\"/g,'""')+'"':text}return dsv.parse=function(text,f){var o;return dsv.parseRows(text,function(row,i){if(o)return o(row,i-1);var a=new Function("d","return {"+row.map(function(name,i){return JSON.stringify(name)+": d["+i+"]"}).join(",")+"}");o=f?function(row,i){return f(a(row),i)}:a})},dsv.parseRows=function(text,f){var t,eol,EOL={},EOF={},rows=[],N=text.length,I=0,n=0;function token(){if(N<=I)return EOF;if(eol)return eol=!1,EOL;var j=I;if(34===text.charCodeAt(j)){for(var i=j;i++<N;)if(34===text.charCodeAt(i)){if(34!==text.charCodeAt(i+1))break;++i}return I=i+2,13===(c=text.charCodeAt(i+1))?(eol=!0,10===text.charCodeAt(i+2)&&++I):10===c&&(eol=!0),text.slice(j+1,i).replace(/""/g,'"')}for(;I<N;){var c,k=1;if(10===(c=text.charCodeAt(I++)))eol=!0;else if(13===c)eol=!0,10===text.charCodeAt(I)&&(++I,++k);else if(c!==delimiterCode)continue;return text.slice(j,I-k)}return text.slice(j)}for(;(t=token())!==EOF;){for(var a=[];t!==EOL&&t!==EOF;)a.push(t),t=token();f&&null==(a=f(a,n++))||rows.push(a)}return rows},dsv.format=function(rows){if(Array.isArray(rows[0]))return dsv.formatRows(rows);var fieldSet=new d3_Set,fields=[];return rows.forEach(function(row){for(var field in row)fieldSet.has(field)||fields.push(fieldSet.add(field))}),[fields.map(formatValue).join(delimiter)].concat(rows.map(function(row){return fields.map(function(field){return formatValue(row[field])}).join(delimiter)})).join("\n")},dsv.formatRows=function(rows){return rows.map(formatRow).join("\n")},dsv},d3.csv=d3.dsv(",","text/csv"),d3.tsv=d3.dsv("\t","text/tab-separated-values");var d3_timer_queueHead,d3_timer_queueTail,d3_timer_interval,d3_timer_timeout,d3_timer_frame=this[d3_vendorSymbol(this,"requestAnimationFrame")]||function(callback){setTimeout(callback,17)};function d3_timer(callback,delay,then){var timer=arguments.length;timer<2&&(delay=0);timer={c:callback,t:(then=timer<3?Date.now():then)+delay,n:null};return d3_timer_queueTail?d3_timer_queueTail.n=timer:d3_timer_queueHead=timer,d3_timer_queueTail=timer,d3_timer_interval||(d3_timer_timeout=clearTimeout(d3_timer_timeout),d3_timer_interval=1,d3_timer_frame(d3_timer_step)),timer}function d3_timer_step(){var delay=d3_timer_mark(),delay=d3_timer_sweep()-delay;24<delay?(isFinite(delay)&&(clearTimeout(d3_timer_timeout),d3_timer_timeout=setTimeout(d3_timer_step,delay)),d3_timer_interval=0):(d3_timer_interval=1,d3_timer_frame(d3_timer_step))}function d3_timer_mark(){for(var now=Date.now(),timer=d3_timer_queueHead;timer;)now>=timer.t&&timer.c(now-timer.t)&&(timer.c=null),timer=timer.n;return now}function d3_timer_sweep(){for(var t0,t1=d3_timer_queueHead,time=1/0;t1;)t1=t1.c?(t1.t<time&&(time=t1.t),(t0=t1).n):t0?t0.n=t1.n:d3_timer_queueHead=t1.n;return d3_timer_queueTail=t0,time}function d3_format_precision(x,p){return p-(x?Math.ceil(Math.log(x)/Math.LN10):1)}d3.timer=function(){d3_timer.apply(this,arguments)},d3.timer.flush=function(){d3_timer_mark(),d3_timer_sweep()},d3.round=function(x,n){return n?Math.round(x*(n=Math.pow(10,n)))/n:Math.round(x)};var d3_formatPrefixes=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"].map(function(d,i){var k=Math.pow(10,3*abs(8-i));return{scale:8<i?function(d){return d/k}:function(d){return d*k},symbol:d}});d3.formatPrefix=function(value,precision){var i=0;return(value=+value)&&(value<0&&(value*=-1),precision&&(value=d3.round(value,d3_format_precision(value,precision))),i=1+Math.floor(1e-12+Math.log(value)/Math.LN10),i=Math.max(-24,Math.min(24,3*Math.floor((i-1)/3)))),d3_formatPrefixes[8+i/3]};var d3_format_re=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i,d3_format_types=d3.map({b:function(x){return x.toString(2)},c:function(x){return String.fromCharCode(x)},o:function(x){return x.toString(8)},x:function(x){return x.toString(16)},X:function(x){return x.toString(16).toUpperCase()},g:function(x,p){return x.toPrecision(p)},e:function(x,p){return x.toExponential(p)},f:function(x,p){return x.toFixed(p)},r:function(x,p){return(x=d3.round(x,d3_format_precision(x,p))).toFixed(Math.max(0,Math.min(20,d3_format_precision(x*(1+1e-15),p))))}});function d3_format_typeDefault(x){return x+""}var d3_time=d3.time={},d3_date=Date;function d3_date_utc(){this._=new Date(1<arguments.length?Date.UTC.apply(this,arguments):arguments[0])}d3_date_utc.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){d3_time_prototype.setUTCDate.apply(this._,arguments)},setDay:function(){d3_time_prototype.setUTCDay.apply(this._,arguments)},setFullYear:function(){d3_time_prototype.setUTCFullYear.apply(this._,arguments)},setHours:function(){d3_time_prototype.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){d3_time_prototype.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){d3_time_prototype.setUTCMinutes.apply(this._,arguments)},setMonth:function(){d3_time_prototype.setUTCMonth.apply(this._,arguments)},setSeconds:function(){d3_time_prototype.setUTCSeconds.apply(this._,arguments)},setTime:function(){d3_time_prototype.setTime.apply(this._,arguments)}};var d3_time_prototype=Date.prototype;function d3_time_interval(local,step,number){function round(date){var d0=local(date),d1=offset(d0,1);return date-d0<d1-date?d0:d1}function ceil(date){return step(date=local(new d3_date(date-1)),1),date}function offset(date,k){return step(date=new d3_date(+date),k),date}function range(t0,t1,dt){var time=ceil(t0),times=[];if(1<dt)for(;time<t1;)number(time)%dt||times.push(new Date(+time)),step(time,1);else for(;time<t1;)times.push(new Date(+time)),step(time,1);return times}(local.floor=local).round=round,local.ceil=ceil,local.offset=offset,local.range=range;var utc=local.utc=d3_time_interval_utc(local);return(utc.floor=utc).round=d3_time_interval_utc(round),utc.ceil=d3_time_interval_utc(ceil),utc.offset=d3_time_interval_utc(offset),utc.range=function(t0,t1,dt){try{var utc=new(d3_date=d3_date_utc);return utc._=t0,range(utc,t1,dt)}finally{d3_date=Date}},local}function d3_time_interval_utc(method){return function(date,k){try{var utc=new(d3_date=d3_date_utc);return utc._=date,method(utc,k)._}finally{d3_date=Date}}}function d3_locale_timeFormat(locale){var locale_dateTime=locale.dateTime,locale_date=locale.date,locale_time=locale.time,locale_periods=locale.periods,locale_days=locale.days,locale_shortDays=locale.shortDays,locale_months=locale.months,locale_shortMonths=locale.shortMonths;function d3_time_format(template){var n=template.length;function format(date){for(var c,p,f,string=[],i=-1,j=0;++i<n;)37===template.charCodeAt(i)&&(string.push(template.slice(j,i)),null!=(p=d3_time_formatPads[c=template.charAt(++i)])&&(c=template.charAt(++i)),(f=d3_time_formats[c])&&(c=f(date,null==p?"e"===c?" ":"0":p)),string.push(c),j=i+1);return string.push(template.slice(j,i)),string.join("")}return format.parse=function(date){var d={y:1900,m:0,d:1,H:0,M:0,S:0,L:0,Z:null};if(d3_time_parse(d,template,date,0)!=date.length)return null;"p"in d&&(d.H=d.H%12+12*d.p);var localZ=null!=d.Z&&d3_date!==d3_date_utc,date=new(localZ?d3_date_utc:d3_date);return"j"in d?date.setFullYear(d.y,0,d.j):"W"in d||"U"in d?("w"in d||(d.w="W"in d?1:0),date.setFullYear(d.y,0,1),date.setFullYear(d.y,0,"W"in d?(d.w+6)%7+7*d.W-(date.getDay()+5)%7:d.w+7*d.U-(date.getDay()+6)%7)):date.setFullYear(d.y,d.m,d.d),date.setHours(d.H+(d.Z/100|0),d.M+d.Z%100,d.S,d.L),localZ?date._:date},format.toString=function(){return template},format}function d3_time_parse(date,template,string,j){for(var c,p,i=0,n=template.length,m=string.length;i<n;){if(m<=j)return-1;if(37===(c=template.charCodeAt(i++))){if(p=template.charAt(i++),!(p=d3_time_parsers[p in d3_time_formatPads?template.charAt(i++):p])||(j=p(date,string,j))<0)return-1}else if(c!=string.charCodeAt(j++))return-1}return j}d3_time_format.utc=function(template){var local=d3_time_format(template);function format(date){try{var utc=new(d3_date=d3_date_utc);return utc._=date,local(utc)}finally{d3_date=Date}}return format.parse=function(string){try{d3_date=d3_date_utc;var date=local.parse(string);return date&&date._}finally{d3_date=Date}},format.toString=local.toString,format},d3_time_format.multi=d3_time_format.utc.multi=d3_time_formatMulti;var d3_time_periodLookup=d3.map(),d3_time_dayRe=d3_time_formatRe(locale_days),d3_time_dayLookup=d3_time_formatLookup(locale_days),d3_time_dayAbbrevRe=d3_time_formatRe(locale_shortDays),d3_time_dayAbbrevLookup=d3_time_formatLookup(locale_shortDays),d3_time_monthRe=d3_time_formatRe(locale_months),d3_time_monthLookup=d3_time_formatLookup(locale_months),d3_time_monthAbbrevRe=d3_time_formatRe(locale_shortMonths),d3_time_monthAbbrevLookup=d3_time_formatLookup(locale_shortMonths);locale_periods.forEach(function(p,i){d3_time_periodLookup.set(p.toLowerCase(),i)});var d3_time_formats={a:function(d){return locale_shortDays[d.getDay()]},A:function(d){return locale_days[d.getDay()]},b:function(d){return locale_shortMonths[d.getMonth()]},B:function(d){return locale_months[d.getMonth()]},c:d3_time_format(locale_dateTime),d:function(d,p){return d3_time_formatPad(d.getDate(),p,2)},e:function(d,p){return d3_time_formatPad(d.getDate(),p,2)},H:function(d,p){return d3_time_formatPad(d.getHours(),p,2)},I:function(d,p){return d3_time_formatPad(d.getHours()%12||12,p,2)},j:function(d,p){return d3_time_formatPad(1+d3_time.dayOfYear(d),p,3)},L:function(d,p){return d3_time_formatPad(d.getMilliseconds(),p,3)},m:function(d,p){return d3_time_formatPad(d.getMonth()+1,p,2)},M:function(d,p){return d3_time_formatPad(d.getMinutes(),p,2)},p:function(d){return locale_periods[+(12<=d.getHours())]},S:function(d,p){return d3_time_formatPad(d.getSeconds(),p,2)},U:function(d,p){return d3_time_formatPad(d3_time.sundayOfYear(d),p,2)},w:function(d){return d.getDay()},W:function(d,p){return d3_time_formatPad(d3_time.mondayOfYear(d),p,2)},x:d3_time_format(locale_date),X:d3_time_format(locale_time),y:function(d,p){return d3_time_formatPad(d.getFullYear()%100,p,2)},Y:function(d,p){return d3_time_formatPad(d.getFullYear()%1e4,p,4)},Z:d3_time_zone,"%":function(){return"%"}},d3_time_parsers={a:function(date,n,i){d3_time_dayAbbrevRe.lastIndex=0;n=d3_time_dayAbbrevRe.exec(n.slice(i));return n?(date.w=d3_time_dayAbbrevLookup.get(n[0].toLowerCase()),i+n[0].length):-1},A:function(date,n,i){d3_time_dayRe.lastIndex=0;n=d3_time_dayRe.exec(n.slice(i));return n?(date.w=d3_time_dayLookup.get(n[0].toLowerCase()),i+n[0].length):-1},b:function(date,n,i){d3_time_monthAbbrevRe.lastIndex=0;n=d3_time_monthAbbrevRe.exec(n.slice(i));return n?(date.m=d3_time_monthAbbrevLookup.get(n[0].toLowerCase()),i+n[0].length):-1},B:function(date,n,i){d3_time_monthRe.lastIndex=0;n=d3_time_monthRe.exec(n.slice(i));return n?(date.m=d3_time_monthLookup.get(n[0].toLowerCase()),i+n[0].length):-1},c:function(date,string,i){return d3_time_parse(date,d3_time_formats.c.toString(),string,i)},d:d3_time_parseDay,e:d3_time_parseDay,H:d3_time_parseHour24,I:d3_time_parseHour24,j:d3_time_parseDayOfYear,L:d3_time_parseMilliseconds,m:d3_time_parseMonthNumber,M:d3_time_parseMinutes,p:function(date,n,i){n=d3_time_periodLookup.get(n.slice(i,i+=2).toLowerCase());return null==n?-1:(date.p=n,i)},S:d3_time_parseSeconds,U:d3_time_parseWeekNumberSunday,w:d3_time_parseWeekdayNumber,W:d3_time_parseWeekNumberMonday,x:function(date,string,i){return d3_time_parse(date,d3_time_formats.x.toString(),string,i)},X:function(date,string,i){return d3_time_parse(date,d3_time_formats.X.toString(),string,i)},y:d3_time_parseYear,Y:d3_time_parseFullYear,Z:d3_time_parseZone,"%":d3_time_parseLiteralPercent};return d3_time_format}d3_time.year=d3_time_interval(function(date){return(date=d3_time.day(date)).setMonth(0,1),date},function(date,offset){date.setFullYear(date.getFullYear()+offset)},function(date){return date.getFullYear()}),d3_time.years=d3_time.year.range,d3_time.years.utc=d3_time.year.utc.range,d3_time.day=d3_time_interval(function(date){var day=new d3_date(2e3,0);return day.setFullYear(date.getFullYear(),date.getMonth(),date.getDate()),day},function(date,offset){date.setDate(date.getDate()+offset)},function(date){return date.getDate()-1}),d3_time.days=d3_time.day.range,d3_time.days.utc=d3_time.day.utc.range,d3_time.dayOfYear=function(date){var year=d3_time.year(date);return Math.floor((date-year-6e4*(date.getTimezoneOffset()-year.getTimezoneOffset()))/864e5)},["sunday","monday","tuesday","wednesday","thursday","friday","saturday"].forEach(function(day,i){i=7-i;var interval=d3_time[day]=d3_time_interval(function(date){return(date=d3_time.day(date)).setDate(date.getDate()-(date.getDay()+i)%7),date},function(date,offset){date.setDate(date.getDate()+7*Math.floor(offset))},function(date){var day=d3_time.year(date).getDay();return Math.floor((d3_time.dayOfYear(date)+(day+i)%7)/7)-(day!==i)});d3_time[day+"s"]=interval.range,d3_time[day+"s"].utc=interval.utc.range,d3_time[day+"OfYear"]=function(date){var day=d3_time.year(date).getDay();return Math.floor((d3_time.dayOfYear(date)+(day+i)%7)/7)}}),d3_time.week=d3_time.sunday,d3_time.weeks=d3_time.sunday.range,d3_time.weeks.utc=d3_time.sunday.utc.range,d3_time.weekOfYear=d3_time.sundayOfYear;var d3_time_formatPads={"-":"",_:" ",0:"0"},d3_time_numberRe=/^\s*\d+/,d3_time_percentRe=/^%/;function d3_time_formatPad(length,fill,width){var sign=length<0?"-":"",string=(sign?-length:length)+"",length=string.length;return sign+(length<width?new Array(width-length+1).join(fill)+string:string)}function d3_time_formatRe(names){return new RegExp("^(?:"+names.map(d3.requote).join("|")+")","i")}function d3_time_formatLookup(names){for(var map=new d3_Map,i=-1,n=names.length;++i<n;)map.set(names[i].toLowerCase(),i);return map}function d3_time_parseWeekdayNumber(date,n,i){d3_time_numberRe.lastIndex=0;n=d3_time_numberRe.exec(n.slice(i,i+1));return n?(date.w=+n[0],i+n[0].length):-1}function d3_time_parseWeekNumberSunday(date,n,i){d3_time_numberRe.lastIndex=0;n=d3_time_numberRe.exec(n.slice(i));return n?(date.U=+n[0],i+n[0].length):-1}function d3_time_parseWeekNumberMonday(date,n,i){d3_time_numberRe.lastIndex=0;n=d3_time_numberRe.exec(n.slice(i));return n?(date.W=+n[0],i+n[0].length):-1}function d3_time_parseFullYear(date,n,i){d3_time_numberRe.lastIndex=0;n=d3_time_numberRe.exec(n.slice(i,i+4));return n?(date.y=+n[0],i+n[0].length):-1}function d3_time_parseYear(d,n,i){d3_time_numberRe.lastIndex=0;n=d3_time_numberRe.exec(n.slice(i,i+2));return n?(d.y=(d=+n[0])+(68<d?1900:2e3),i+n[0].length):-1}function d3_time_parseZone(date,string,i){return/^[+-]\d{4}$/.test(string=string.slice(i,i+5))?(date.Z=-string,i+5):-1}function d3_time_parseMonthNumber(date,n,i){d3_time_numberRe.lastIndex=0;n=d3_time_numberRe.exec(n.slice(i,i+2));return n?(date.m=n[0]-1,i+n[0].length):-1}function d3_time_parseDay(date,n,i){d3_time_numberRe.lastIndex=0;n=d3_time_numberRe.exec(n.slice(i,i+2));return n?(date.d=+n[0],i+n[0].length):-1}function d3_time_parseDayOfYear(date,n,i){d3_time_numberRe.lastIndex=0;n=d3_time_numberRe.exec(n.slice(i,i+3));return n?(date.j=+n[0],i+n[0].length):-1}function d3_time_parseHour24(date,n,i){d3_time_numberRe.lastIndex=0;n=d3_time_numberRe.exec(n.slice(i,i+2));return n?(date.H=+n[0],i+n[0].length):-1}function d3_time_parseMinutes(date,n,i){d3_time_numberRe.lastIndex=0;n=d3_time_numberRe.exec(n.slice(i,i+2));return n?(date.M=+n[0],i+n[0].length):-1}function d3_time_parseSeconds(date,n,i){d3_time_numberRe.lastIndex=0;n=d3_time_numberRe.exec(n.slice(i,i+2));return n?(date.S=+n[0],i+n[0].length):-1}function d3_time_parseMilliseconds(date,n,i){d3_time_numberRe.lastIndex=0;n=d3_time_numberRe.exec(n.slice(i,i+3));return n?(date.L=+n[0],i+n[0].length):-1}function d3_time_zone(zh){var zm=zh.getTimezoneOffset(),zs=0<zm?"-":"+",zh=abs(zm)/60|0,zm=abs(zm)%60;return zs+d3_time_formatPad(zh,"0",2)+d3_time_formatPad(zm,"0",2)}function d3_time_parseLiteralPercent(date,n,i){d3_time_percentRe.lastIndex=0;n=d3_time_percentRe.exec(n.slice(i,i+1));return n?i+n[0].length:-1}function d3_time_formatMulti(formats){for(var n=formats.length,i=-1;++i<n;)formats[i][0]=this(formats[i][0]);return function(date){for(var i=0,f=formats[i];!f[1](date);)f=formats[++i];return f[0](date)}}d3.locale=function(locale){return{numberFormat:function(locale){var locale_decimal=locale.decimal,locale_thousands=locale.thousands,locale_grouping=locale.grouping,locale_currency=locale.currency,formatGroup=locale_grouping&&locale_thousands?function(value,width){for(var i=value.length,t=[],j=0,g=locale_grouping[0],length=0;0<i&&0<g&&(width<length+g+1&&(g=Math.max(1,width-length)),t.push(value.substring(i-=g,i+g)),!((length+=g+1)>width));)g=locale_grouping[j=(j+1)%locale_grouping.length];return t.reverse().join(locale_thousands)}:d3_identity;return function(match){var match=d3_format_re.exec(match),fill=match[1]||" ",align=match[2]||">",sign=match[3]||"-",symbol=match[4]||"",zfill=match[5],width=+match[6],comma=match[7],precision=match[8],type=match[9],scale=1,prefix="",suffix="",integer=!1,exponent=!0,precision=precision&&+precision.substring(1);switch((zfill||"0"===fill&&"="===align)&&(zfill=fill="0",align="="),type){case"n":comma=!0,type="g";break;case"%":scale=100,suffix="%",type="f";break;case"p":scale=100,suffix="%",type="r";break;case"b":case"o":case"x":case"X":"#"===symbol&&(prefix="0"+type.toLowerCase());case"c":exponent=!1;case"d":integer=!0,precision=0;break;case"s":scale=-1,type="r"}"$"===symbol&&(prefix=locale_currency[0],suffix=locale_currency[1]),"r"!=type||precision||(type="g"),null!=precision&&("g"==type?precision=Math.max(1,Math.min(21,precision)):"e"!=type&&"f"!=type||(precision=Math.max(0,Math.min(20,precision))));var type=d3_format_types.get(type)||d3_format_typeDefault,zcomma=zfill&&comma;return function(value){var fullSuffix=suffix;if(integer&&value%1)return"";var negative=value<0||0===value&&1/value<0?(value=-value,"-"):"-"===sign?"":sign;scale<0?(value=(after=d3.formatPrefix(value,precision)).scale(value),fullSuffix=after.symbol+suffix):value*=scale;var before,after,padding=(value=type(value,precision)).lastIndexOf(".");after=padding<0?(length=exponent?value.lastIndexOf("e"):-1)<0?(before=value,""):(before=value.substring(0,length),value.substring(length)):(before=value.substring(0,padding),locale_decimal+value.substring(padding+1)),!zfill&&comma&&(before=formatGroup(before,1/0));var length=prefix.length+before.length+after.length+(zcomma?0:negative.length),padding=length<width?new Array(length=width-length+1).join(fill):"";return zcomma&&(before=formatGroup(padding+before,padding.length?width-after.length:1/0)),negative+=prefix,value=before+after,("<"===align?negative+value+padding:">"===align?padding+negative+value:"^"===align?padding.substring(0,length>>=1)+negative+value+padding.substring(length):negative+(zcomma?value:padding+value))+fullSuffix}}}(locale),timeFormat:d3_locale_timeFormat(locale)}};d3_time_formatIso=d3.locale({decimal:".",thousands:",",grouping:[3],currency:["$",""],dateTime:"%a %b %e %X %Y",date:"%m/%d/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function d3_adder(){}d3.format=d3_time_formatIso.numberFormat,d3.geo={},d3_adder.prototype={s:0,t:0,add:function(y){d3_adderSum(y,this.t,d3_adderTemp),d3_adderSum(d3_adderTemp.s,this.s,this),this.s?this.t+=d3_adderTemp.t:this.s=d3_adderTemp.t},reset:function(){this.s=this.t=0},valueOf:function(){return this.s}};var d3_adderTemp=new d3_adder;function d3_adderSum(a,b,o){var x=o.s=a+b,bv=x-a;o.t=a-(x-bv)+(b-bv)}function d3_geo_streamGeometry(geometry,listener){geometry&&d3_geo_streamGeometryType.hasOwnProperty(geometry.type)&&d3_geo_streamGeometryType[geometry.type](geometry,listener)}d3.geo.stream=function(object,listener){object&&d3_geo_streamObjectType.hasOwnProperty(object.type)?d3_geo_streamObjectType[object.type](object,listener):d3_geo_streamGeometry(object,listener)};var d3_geo_streamObjectType={Feature:function(feature,listener){d3_geo_streamGeometry(feature.geometry,listener)},FeatureCollection:function(object,listener){for(var features=object.features,i=-1,n=features.length;++i<n;)d3_geo_streamGeometry(features[i].geometry,listener)}},d3_geo_streamGeometryType={Sphere:function(object,listener){listener.sphere()},Point:function(object,listener){object=object.coordinates,listener.point(object[0],object[1],object[2])},MultiPoint:function(object,listener){for(var coordinates=object.coordinates,i=-1,n=coordinates.length;++i<n;)object=coordinates[i],listener.point(object[0],object[1],object[2])},LineString:function(object,listener){d3_geo_streamLine(object.coordinates,listener,0)},MultiLineString:function(object,listener){for(var coordinates=object.coordinates,i=-1,n=coordinates.length;++i<n;)d3_geo_streamLine(coordinates[i],listener,0)},Polygon:function(object,listener){d3_geo_streamPolygon(object.coordinates,listener)},MultiPolygon:function(object,listener){for(var coordinates=object.coordinates,i=-1,n=coordinates.length;++i<n;)d3_geo_streamPolygon(coordinates[i],listener)},GeometryCollection:function(object,listener){for(var geometries=object.geometries,i=-1,n=geometries.length;++i<n;)d3_geo_streamGeometry(geometries[i],listener)}};function d3_geo_streamLine(coordinates,listener,closed){var coordinate,i=-1,n=coordinates.length-closed;for(listener.lineStart();++i<n;)coordinate=coordinates[i],listener.point(coordinate[0],coordinate[1],coordinate[2]);listener.lineEnd()}function d3_geo_streamPolygon(coordinates,listener){var i=-1,n=coordinates.length;for(listener.polygonStart();++i<n;)d3_geo_streamLine(coordinates[i],listener,1);listener.polygonEnd()}d3.geo.area=function(object){return d3_geo_areaSum=0,d3.geo.stream(object,d3_geo_area),d3_geo_areaSum};var d3_geo_areaSum,λ0,φ0,λ1,φ1,λ_,λ__,φ__,p0,dλSum,ranges,range,bound,d3_geo_centroidW0,d3_geo_centroidW1,d3_geo_centroidX0,d3_geo_centroidY0,d3_geo_centroidZ0,d3_geo_centroidX1,d3_geo_centroidY1,d3_geo_centroidZ1,d3_geo_centroidX2,d3_geo_centroidY2,d3_geo_centroidZ2,d3_geo_areaRingSum=new d3_adder,d3_geo_area={sphere:function(){d3_geo_areaSum+=4*π},point:d3_noop,lineStart:d3_noop,lineEnd:d3_noop,polygonStart:function(){d3_geo_areaRingSum.reset(),d3_geo_area.lineStart=d3_geo_areaRingStart},polygonEnd:function(){var area=2*d3_geo_areaRingSum;d3_geo_areaSum+=area<0?4*π+area:area,d3_geo_area.lineStart=d3_geo_area.lineEnd=d3_geo_area.point=d3_noop}};function d3_geo_areaRingStart(){var λ00,φ00,λ0,cosφ0,sinφ0;function nextPoint(λ,u){u=u*d3_radians/2+π/4;var k=(λ*=d3_radians)-λ0,sdλ=0<=k?1:-1,v=sdλ*k,cosφ=Math.cos(u),sinφ=Math.sin(u),k=sinφ0*sinφ,u=cosφ0*cosφ+k*Math.cos(v),v=k*sdλ*Math.sin(v);d3_geo_areaRingSum.add(Math.atan2(v,u)),λ0=λ,cosφ0=cosφ,sinφ0=sinφ}d3_geo_area.point=function(λ,φ){d3_geo_area.point=nextPoint,λ0=(λ00=λ)*d3_radians,cosφ0=Math.cos(φ=(φ00=φ)*d3_radians/2+π/4),sinφ0=Math.sin(φ)},d3_geo_area.lineEnd=function(){nextPoint(λ00,φ00)}}function d3_geo_cartesian(cosφ){var λ=cosφ[0],φ=cosφ[1],cosφ=Math.cos(φ);return[cosφ*Math.cos(λ),cosφ*Math.sin(λ),Math.sin(φ)]}function d3_geo_cartesianDot(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]}function d3_geo_cartesianCross(a,b){return[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]]}function d3_geo_cartesianAdd(a,b){a[0]+=b[0],a[1]+=b[1],a[2]+=b[2]}function d3_geo_cartesianScale(vector,k){return[vector[0]*k,vector[1]*k,vector[2]*k]}function d3_geo_cartesianNormalize(d){var l=Math.sqrt(d[0]*d[0]+d[1]*d[1]+d[2]*d[2]);d[0]/=l,d[1]/=l,d[2]/=l}function d3_geo_spherical(cartesian){return[Math.atan2(cartesian[1],cartesian[0]),d3_asin(cartesian[2])]}function d3_geo_sphericalEqual(a,b){return abs(a[0]-b[0])<ε&&abs(a[1]-b[1])<ε}function point(λ,φ){ranges.push(range=[λ0=λ,λ1=λ]),φ<φ0&&(φ0=φ),φ1<φ&&(φ1=φ)}function linePoint(λ,φ){var inflection,s,λi,antimeridian,φi,p=d3_geo_cartesian([λ*d3_radians,φ*d3_radians]);p0?(λi=d3_geo_cartesianCross(p0,p),d3_geo_cartesianNormalize(inflection=d3_geo_cartesianCross([λi[1],-λi[0],0],λi)),inflection=d3_geo_spherical(inflection),antimeridian=λ-λ_,λi=inflection[0]*d3_degrees*(s=0<antimeridian?1:-1),(antimeridian=180<abs(antimeridian))^(s*λ_<λi&&λi<s*λ)?(φi=inflection[1]*d3_degrees,φ1<φi&&(φ1=φi)):antimeridian^(s*λ_<(λi=(λi+360)%360-180)&&λi<s*λ)?(φi=-inflection[1]*d3_degrees)<φ0&&(φ0=φi):(φ<φ0&&(φ0=φ),φ1<φ&&(φ1=φ)),antimeridian?λ<λ_?angle(λ0,λ)>angle(λ0,λ1)&&(λ1=λ):angle(λ,λ1)>angle(λ0,λ1)&&(λ0=λ):λ0<=λ1?(λ<λ0&&(λ0=λ),λ1<λ&&(λ1=λ)):λ_<λ?angle(λ0,λ)>angle(λ0,λ1)&&(λ1=λ):angle(λ,λ1)>angle(λ0,λ1)&&(λ0=λ)):point(λ,φ),p0=p,λ_=λ}function lineStart(){bound.point=linePoint}function lineEnd(){range[0]=λ0,range[1]=λ1,bound.point=point,p0=null}function ringPoint(λ,φ){var dλ;p0?dλSum+=180<abs(dλ=λ-λ_)?dλ+(0<dλ?360:-360):dλ:(λ__=λ,φ__=φ),d3_geo_area.point(λ,φ),linePoint(λ,φ)}function ringStart(){d3_geo_area.lineStart()}function ringEnd(){ringPoint(λ__,φ__),d3_geo_area.lineEnd(),abs(dλSum)>ε&&(λ0=-(λ1=180)),range[0]=λ0,range[1]=λ1,p0=null}function angle(λ0,λ1){return(λ1-=λ0)<0?λ1+360:λ1}function compareRanges(a,b){return a[0]-b[0]}function withinRange(x,range){return range[0]<=range[1]?range[0]<=x&&x<=range[1]:x<range[0]||range[1]<x}d3.geo.bounds=(bound={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){bound.point=ringPoint,bound.lineStart=ringStart,bound.lineEnd=ringEnd,dλSum=0,d3_geo_area.polygonStart()},polygonEnd:function(){d3_geo_area.polygonEnd(),bound.point=point,bound.lineStart=lineStart,bound.lineEnd=lineEnd,d3_geo_areaRingSum<0?(λ0=-(λ1=180),φ0=-(φ1=90)):ε<dλSum?φ1=90:dλSum<-ε&&(φ0=-90),range[0]=λ0,range[1]=λ1}},function(feature){if(φ1=λ1=-(λ0=φ0=1/0),ranges=[],d3.geo.stream(feature,bound),n=ranges.length){ranges.sort(compareRanges);for(var i=1,merged=[a=ranges[0]];i<n;++i)withinRange((b=ranges[i])[0],a)||withinRange(b[1],a)?(angle(a[0],b[1])>angle(a[0],a[1])&&(a[1]=b[1]),angle(b[0],a[1])>angle(a[0],a[1])&&(a[0]=b[0])):merged.push(a=b);for(var dλ,n,b,best=-1/0,i=0,a=merged[n=merged.length-1];i<=n;a=b,++i)b=merged[i],(dλ=angle(a[1],b[0]))>best&&(best=dλ,λ0=b[0],λ1=a[1])}return ranges=range=null,λ0===1/0||φ0===1/0?[[NaN,NaN],[NaN,NaN]]:[[λ0,φ0],[λ1,φ1]]}),d3.geo.centroid=function(m){d3_geo_centroidW0=d3_geo_centroidW1=d3_geo_centroidX0=d3_geo_centroidY0=d3_geo_centroidZ0=d3_geo_centroidX1=d3_geo_centroidY1=d3_geo_centroidZ1=d3_geo_centroidX2=d3_geo_centroidY2=d3_geo_centroidZ2=0,d3.geo.stream(m,d3_geo_centroid);var x=d3_geo_centroidX2,y=d3_geo_centroidY2,z=d3_geo_centroidZ2,m=x*x+y*y+z*z;return m<ε2&&(x=d3_geo_centroidX1,y=d3_geo_centroidY1,z=d3_geo_centroidZ1,d3_geo_centroidW1<ε&&(x=d3_geo_centroidX0,y=d3_geo_centroidY0,z=d3_geo_centroidZ0),(m=x*x+y*y+z*z)<ε2)?[NaN,NaN]:[Math.atan2(y,x)*d3_degrees,d3_asin(z/Math.sqrt(m))*d3_degrees]};var d3_geo_centroid={sphere:d3_noop,point:d3_geo_centroidPoint,lineStart:d3_geo_centroidLineStart,lineEnd:d3_geo_centroidLineEnd,polygonStart:function(){d3_geo_centroid.lineStart=d3_geo_centroidRingStart},polygonEnd:function(){d3_geo_centroid.lineStart=d3_geo_centroidLineStart}};function d3_geo_centroidPoint(λ,φ){λ*=d3_radians;var cosφ=Math.cos(φ*=d3_radians);d3_geo_centroidPointXYZ(cosφ*Math.cos(λ),cosφ*Math.sin(λ),Math.sin(φ))}function d3_geo_centroidPointXYZ(x,y,z){d3_geo_centroidX0+=(x-d3_geo_centroidX0)/++d3_geo_centroidW0,d3_geo_centroidY0+=(y-d3_geo_centroidY0)/d3_geo_centroidW0,d3_geo_centroidZ0+=(z-d3_geo_centroidZ0)/d3_geo_centroidW0}function d3_geo_centroidLineStart(){var x0,y0,z0;function nextPoint(z,w){z*=d3_radians;var y=Math.cos(w*=d3_radians),x=y*Math.cos(z),y=y*Math.sin(z),z=Math.sin(w),w=Math.atan2(Math.sqrt((w=y0*z-z0*y)*w+(w=z0*x-x0*z)*w+(w=x0*y-y0*x)*w),x0*x+y0*y+z0*z);d3_geo_centroidW1+=w,d3_geo_centroidX1+=w*(x0+(x0=x)),d3_geo_centroidY1+=w*(y0+(y0=y)),d3_geo_centroidZ1+=w*(z0+(z0=z)),d3_geo_centroidPointXYZ(x0,y0,z0)}d3_geo_centroid.point=function(λ,φ){λ*=d3_radians;var cosφ=Math.cos(φ*=d3_radians);x0=cosφ*Math.cos(λ),y0=cosφ*Math.sin(λ),z0=Math.sin(φ),d3_geo_centroid.point=nextPoint,d3_geo_centroidPointXYZ(x0,y0,z0)}}function d3_geo_centroidLineEnd(){d3_geo_centroid.point=d3_geo_centroidPoint}function d3_geo_centroidRingStart(){var λ00,φ00,x0,y0,z0;function nextPoint(w,v){w*=d3_radians;var m=Math.cos(v*=d3_radians),x=m*Math.cos(w),y=m*Math.sin(w),z=Math.sin(v),cx=y0*z-z0*y,cy=z0*x-x0*z,cz=x0*y-y0*x,m=Math.sqrt(cx*cx+cy*cy+cz*cz),w=x0*x+y0*y+z0*z,v=m&&-d3_acos(w)/m,w=Math.atan2(m,w);d3_geo_centroidX2+=v*cx,d3_geo_centroidY2+=v*cy,d3_geo_centroidZ2+=v*cz,d3_geo_centroidW1+=w,d3_geo_centroidX1+=w*(x0+(x0=x)),d3_geo_centroidY1+=w*(y0+(y0=y)),d3_geo_centroidZ1+=w*(z0+(z0=z)),d3_geo_centroidPointXYZ(x0,y0,z0)}d3_geo_centroid.point=function(λ,φ){λ00=λ,φ00=φ,d3_geo_centroid.point=nextPoint,λ*=d3_radians;var cosφ=Math.cos(φ*=d3_radians);x0=cosφ*Math.cos(λ),y0=cosφ*Math.sin(λ),z0=Math.sin(φ),d3_geo_centroidPointXYZ(x0,y0,z0)},d3_geo_centroid.lineEnd=function(){nextPoint(λ00,φ00),d3_geo_centroid.lineEnd=d3_geo_centroidLineEnd,d3_geo_centroid.point=d3_geo_centroidPoint}}function d3_geo_compose(a,b){function compose(x,y){return x=a(x,y),b(x[0],x[1])}return a.invert&&b.invert&&(compose.invert=function(x,y){return(x=b.invert(x,y))&&a.invert(x[0],x[1])}),compose}function d3_true(){return!0}function d3_geo_clipPolygon(segments,compare,clipStartInside,interpolate,listener){var subject=[],clip=[];if(segments.forEach(function(segment){if(!((n=segment.length-1)<=0)){var n,p0=segment[0],p1=segment[n];if(d3_geo_sphericalEqual(p0,p1)){listener.lineStart();for(var i=0;i<n;++i)listener.point((p0=segment[i])[0],p0[1]);listener.lineEnd()}else{var a=new d3_geo_clipPolygonIntersection(p0,segment,null,!0),b=new d3_geo_clipPolygonIntersection(p0,null,a,!1);a.o=b,subject.push(a),clip.push(b),a=new d3_geo_clipPolygonIntersection(p1,segment,null,!1),b=new d3_geo_clipPolygonIntersection(p1,null,a,!0),a.o=b,subject.push(a),clip.push(b)}}}),clip.sort(compare),d3_geo_clipPolygonLinkCircular(subject),d3_geo_clipPolygonLinkCircular(clip),subject.length){for(var i=0,entry=clipStartInside,n=clip.length;i<n;++i)clip[i].e=entry=!entry;for(var point,start=subject[0];;){for(var current=start,isSubject=!0;current.v;)if((current=current.n)===start)return;points=current.z,listener.lineStart();do{if(current.v=current.o.v=!0,current.e){if(isSubject)for(i=0,n=points.length;i<n;++i)listener.point((point=points[i])[0],point[1]);else interpolate(current.x,current.n.x,1,listener);current=current.n}else{if(isSubject)for(var points,i=(points=current.p.z).length-1;0<=i;--i)listener.point((point=points[i])[0],point[1]);else interpolate(current.x,current.p.x,-1,listener);current=current.p}}while(points=(current=current.o).z,isSubject=!isSubject,!current.v);listener.lineEnd()}}}function d3_geo_clipPolygonLinkCircular(array){if(n=array.length){for(var n,b,i=0,a=array[0];++i<n;)a.n=b=array[i],b.p=a,a=b;a.n=b=array[0],b.p=a}}function d3_geo_clipPolygonIntersection(point,points,other,entry){this.x=point,this.z=points,this.o=other,this.e=entry,this.v=!1,this.n=this.p=null}function d3_geo_clip(pointVisible,clipLine,interpolate,clipStart){return function(rotate,listener){var segments,line=clipLine(listener),rotatedClipStart=rotate.invert(clipStart[0],clipStart[1]),clip={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){clip.point=pointRing,clip.lineStart=ringStart,clip.lineEnd=ringEnd,segments=[],polygon=[]},polygonEnd:function(){clip.point=point,clip.lineStart=lineStart,clip.lineEnd=lineEnd,segments=d3.merge(segments);var clipStartInside=function(point,polygon){var meridian=point[0],parallel=point[1],meridianNormal=[Math.sin(meridian),-Math.cos(meridian),0],polarAngle=0,winding=0;d3_geo_areaRingSum.reset();for(var i=0,n=polygon.length;i<n;++i){var ring=polygon[i],m=ring.length;if(m)for(var point0=ring[0],λ0=point0[0],φ0=point0[1]/2+π/4,sinφ0=Math.sin(φ0),cosφ0=Math.cos(φ0),j=1;;){var λ=(point=ring[j=j===m?0:j])[0],k=point[1]/2+π/4,sinφ=Math.sin(k),cosφ=Math.cos(k),dλ=λ-λ0,φarc=0<=dλ?1:-1,arc=φarc*dλ,antimeridian=π<arc,k=sinφ0*sinφ;if(d3_geo_areaRingSum.add(Math.atan2(k*φarc*Math.sin(arc),cosφ0*cosφ+k*Math.cos(arc))),polarAngle+=antimeridian?dλ+φarc*τ:dλ,antimeridian^meridian<=λ0^meridian<=λ&&(d3_geo_cartesianNormalize(arc=d3_geo_cartesianCross(d3_geo_cartesian(point0),d3_geo_cartesian(point))),d3_geo_cartesianNormalize(φarc=d3_geo_cartesianCross(meridianNormal,arc)),((φarc=(antimeridian^0<=dλ?-1:1)*d3_asin(φarc[2]))<parallel||parallel===φarc&&(arc[0]||arc[1]))&&(winding+=antimeridian^0<=dλ?1:-1)),!j++)break;λ0=λ,sinφ0=sinφ,cosφ0=cosφ,point0=point}}return(polarAngle<-ε||polarAngle<ε&&d3_geo_areaRingSum<-ε)^1&winding}(rotatedClipStart,polygon);segments.length?(polygonStarted||(listener.polygonStart(),polygonStarted=!0),d3_geo_clipPolygon(segments,d3_geo_clipSort,clipStartInside,interpolate,listener)):clipStartInside&&(polygonStarted||(listener.polygonStart(),polygonStarted=!0),listener.lineStart(),interpolate(null,null,1,listener),listener.lineEnd()),polygonStarted&&(listener.polygonEnd(),polygonStarted=!1),segments=polygon=null},sphere:function(){listener.polygonStart(),listener.lineStart(),interpolate(null,null,1,listener),listener.lineEnd(),listener.polygonEnd()}};function point(λ,φ){var point=rotate(λ,φ);pointVisible(λ=point[0],φ=point[1])&&listener.point(λ,φ)}function pointLine(λ,point){point=rotate(λ,point);line.point(point[0],point[1])}function lineStart(){clip.point=pointLine,line.lineStart()}function lineEnd(){clip.point=point,line.lineEnd()}var polygon,ring,buffer=d3_geo_clipBufferListener(),ringListener=clipLine(buffer),polygonStarted=!1;function pointRing(λ,point){ring.push([λ,point]);point=rotate(λ,point);ringListener.point(point[0],point[1])}function ringStart(){ringListener.lineStart(),ring=[]}function ringEnd(){pointRing(ring[0][0],ring[0][1]),ringListener.lineEnd();var clean=ringListener.clean(),ringSegments=buffer.buffer(),n=ringSegments.length;if(ring.pop(),polygon.push(ring),ring=null,n)if(1&clean){var segment,point,i=-1;if(0<(n=(segment=ringSegments[0]).length-1)){for(polygonStarted||(listener.polygonStart(),polygonStarted=!0),listener.lineStart();++i<n;)listener.point((point=segment[i])[0],point[1]);listener.lineEnd()}}else 1<n&&2&clean&&ringSegments.push(ringSegments.pop().concat(ringSegments.shift())),segments.push(ringSegments.filter(d3_geo_clipSegmentLength1))}return clip}}function d3_geo_clipSegmentLength1(segment){return 1<segment.length}function d3_geo_clipBufferListener(){var line,lines=[];return{lineStart:function(){lines.push(line=[])},point:function(λ,φ){line.push([λ,φ])},lineEnd:d3_noop,buffer:function(){var buffer=lines;return lines=[],line=null,buffer},rejoin:function(){1<lines.length&&lines.push(lines.pop().concat(lines.shift()))}}}function d3_geo_clipSort(a,b){return((a=a.x)[0]<0?a[1]-halfπ-ε:halfπ-a[1])-((b=b.x)[0]<0?b[1]-halfπ-ε:halfπ-b[1])}var d3_geo_clipAntimeridian=d3_geo_clip(d3_true,function(listener){var clean,λ0=NaN,φ0=NaN,sλ0=NaN;return{lineStart:function(){listener.lineStart(),clean=1},point:function(λ1,φ1){var sλ1=0<λ1?π:-π,dλ=abs(λ1-λ0);abs(dλ-π)<ε?(listener.point(λ0,φ0=0<(φ0+φ1)/2?halfπ:-halfπ),listener.point(sλ0,φ0),listener.lineEnd(),listener.lineStart(),listener.point(sλ1,φ0),listener.point(λ1,φ0),clean=0):sλ0!==sλ1&&π<=dλ&&(abs(λ0-sλ0)<ε&&(λ0-=sλ0*ε),abs(λ1-sλ1)<ε&&(λ1-=sλ1*ε),φ0=function(λ0,φ0,cosφ0,φ1){var cosφ1,sinλ0_λ1=Math.sin(λ0-cosφ0);return abs(sinλ0_λ1)>ε?Math.atan((Math.sin(φ0)*(cosφ1=Math.cos(φ1))*Math.sin(cosφ0)-Math.sin(φ1)*(cosφ0=Math.cos(φ0))*Math.sin(λ0))/(cosφ0*cosφ1*sinλ0_λ1)):(φ0+φ1)/2}(λ0,φ0,λ1,φ1),listener.point(sλ0,φ0),listener.lineEnd(),listener.lineStart(),listener.point(sλ1,φ0),clean=0),listener.point(λ0=λ1,φ0=φ1),sλ0=sλ1},lineEnd:function(){listener.lineEnd(),λ0=φ0=NaN},clean:function(){return 2-clean}}},function(s,to,direction,listener){var φ;null==s?(φ=direction*halfπ,listener.point(-π,φ),listener.point(0,φ),listener.point(π,φ),listener.point(π,0),listener.point(π,-φ),listener.point(0,-φ),listener.point(-π,-φ),listener.point(-π,0),listener.point(-π,φ)):abs(s[0]-to[0])>ε?(s=s[0]<to[0]?π:-π,φ=direction*s/2,listener.point(-s,φ),listener.point(0,φ),listener.point(s,φ)):listener.point(to[0],to[1])},[-π,-π/2]);function d3_geo_clipCircle(radius){var cr=Math.cos(radius),smallRadius=0<cr,notHemisphere=abs(cr)>ε;return d3_geo_clip(visible,function(listener){var point0,c0,v0,v00,clean;return{lineStart:function(){v00=v0=!1,clean=1},point:function(λ,c){var point2,t,point1=[λ,c],v=visible(λ,c),c=smallRadius?v?0:code(λ,c):v?code(λ+(λ<0?π:-π),c):0;!point0&&(v00=v0=v)&&listener.lineStart(),v!==v0&&(point2=intersect(point0,point1),(d3_geo_sphericalEqual(point0,point2)||d3_geo_sphericalEqual(point1,point2))&&(point1[0]+=ε,point1[1]+=ε,v=visible(point1[0],point1[1]))),v!==v0?(clean=0,v?(listener.lineStart(),point2=intersect(point1,point0),listener.point(point2[0],point2[1])):(point2=intersect(point0,point1),listener.point(point2[0],point2[1]),listener.lineEnd()),point0=point2):notHemisphere&&point0&&smallRadius^v&&(c&c0||!(t=intersect(point1,point0,!0))||(clean=0,smallRadius?(listener.lineStart(),listener.point(t[0][0],t[0][1]),listener.point(t[1][0],t[1][1]),listener.lineEnd()):(listener.point(t[1][0],t[1][1]),listener.lineEnd(),listener.lineStart(),listener.point(t[0][0],t[0][1])))),!v||point0&&d3_geo_sphericalEqual(point0,point1)||listener.point(point1[0],point1[1]),point0=point1,v0=v,c0=c},lineEnd:function(){v0&&listener.lineEnd(),point0=null},clean:function(){return clean|(v00&&v0)<<1}}},d3_geo_circleInterpolate(radius,6*d3_radians),smallRadius?[0,-radius]:[-π,radius-π]);function visible(λ,φ){return Math.cos(λ)*Math.cos(φ)>cr}function intersect(δλ,polar,φ1){var q1=[1,0,0],t=d3_geo_cartesianCross(d3_geo_cartesian(δλ),d3_geo_cartesian(polar)),φ0=d3_geo_cartesianDot(t,t),q=t[0],λ0=φ0-q*q;if(!λ0)return!φ1&&δλ;var λ1=d3_geo_cartesianCross(q1,t),A=d3_geo_cartesianScale(q1,cr*φ0/λ0);d3_geo_cartesianAdd(A,d3_geo_cartesianScale(t,-cr*q/λ0));var u=λ1,w=d3_geo_cartesianDot(A,u),q1=d3_geo_cartesianDot(u,u),φ0=w*w-q1*(d3_geo_cartesianDot(A,A)-1);if(!(φ0<0)){t=Math.sqrt(φ0),q=d3_geo_cartesianScale(u,(-w-t)/q1);if(d3_geo_cartesianAdd(q,A),q=d3_geo_spherical(q),!φ1)return q;var z,λ0=δλ[0],λ1=polar[0],φ0=δλ[1],φ1=polar[1];λ1<λ0&&(z=λ0,λ0=λ1,λ1=z);δλ=λ1-λ0,polar=abs(δλ-π)<ε;if(!polar&&φ1<φ0&&(z=φ0,φ0=φ1,φ1=z),polar||δλ<ε?polar?0<φ0+φ1^q[1]<(abs(q[0]-λ0)<ε?φ0:φ1):φ0<=q[1]&&q[1]<=φ1:π<δλ^(λ0<=q[0]&&q[0]<=λ1)){q1=d3_geo_cartesianScale(u,(-w+t)/q1);return d3_geo_cartesianAdd(q1,A),[q,d3_geo_spherical(q1)]}}}function code(λ,φ){var r=smallRadius?radius:π-radius,code=0;return λ<-r?code|=1:r<λ&&(code|=2),φ<-r?code|=4:r<φ&&(code|=8),code}}function d3_geom_clipLine(x0,y0,x1,y1){return function(line){var dy=line.a,r=line.b,ax=dy.x,ay=dy.y,t0=0,t1=1,dx=r.x-ax,dy=r.y-ay,r=x0-ax;if(dx||!(0<r)){if(r/=dx,dx<0){if(r<t0)return;r<t1&&(t1=r)}else if(0<dx){if(t1<r)return;t0<r&&(t0=r)}if(r=x1-ax,dx||!(r<0)){if(r/=dx,dx<0){if(t1<r)return;t0<r&&(t0=r)}else if(0<dx){if(r<t0)return;r<t1&&(t1=r)}if(r=y0-ay,dy||!(0<r)){if(r/=dy,dy<0){if(r<t0)return;r<t1&&(t1=r)}else if(0<dy){if(t1<r)return;t0<r&&(t0=r)}if(r=y1-ay,dy||!(r<0)){if(r/=dy,dy<0){if(t1<r)return;t0<r&&(t0=r)}else if(0<dy){if(r<t0)return;r<t1&&(t1=r)}return 0<t0&&(line.a={x:ax+t0*dx,y:ay+t0*dy}),t1<1&&(line.b={x:ax+t1*dx,y:ay+t1*dy}),line}}}}}}var d3_geo_clipExtentMAX=1e9;function d3_geo_clipExtent(x0,y0,x1,y1){return function(listener){var segments,polygon,ring,x__,y__,v__,x_,y_,v_,first,clean,listener_=listener,bufferListener=d3_geo_clipBufferListener(),clipLine=d3_geom_clipLine(x0,y0,x1,y1),clip={point:point,lineStart:function(){clip.point=linePoint,polygon&&polygon.push(ring=[]);first=!0,v_=!1,x_=y_=NaN},lineEnd:function(){segments&&(linePoint(x__,y__),v__&&v_&&bufferListener.rejoin(),segments.push(bufferListener.buffer()));clip.point=point,v_&&listener.lineEnd()},polygonStart:function(){listener=bufferListener,segments=[],polygon=[],clean=!0},polygonEnd:function(){listener=listener_,segments=d3.merge(segments);var clipStartInside=function(p){for(var wn=0,n=polygon.length,y=p[1],i=0;i<n;++i)for(var b,j=1,v=polygon[i],m=v.length,a=v[0];j<m;++j)b=v[j],a[1]<=y?b[1]>y&&0<d3_cross2d(a,b,p)&&++wn:b[1]<=y&&d3_cross2d(a,b,p)<0&&--wn,a=b;return 0!==wn}([x0,y1]),inside=clean&&clipStartInside,visible=segments.length;(inside||visible)&&(listener.polygonStart(),inside&&(listener.lineStart(),interpolate(null,null,1,listener),listener.lineEnd()),visible&&d3_geo_clipPolygon(segments,compare,clipStartInside,interpolate,listener),listener.polygonEnd()),segments=polygon=ring=null}};function interpolate(from,to,direction,listener){var a=0,a1=0;if(null==from||(a=corner(from,direction))!==(a1=corner(to,direction))||comparePoints(from,to)<0^0<direction)for(;listener.point(0===a||3===a?x0:x1,1<a?y1:y0),(a=(a+direction+4)%4)!==a1;);else listener.point(to[0],to[1])}function pointVisible(x,y){return x0<=x&&x<=x1&&y0<=y&&y<=y1}function point(x,y){pointVisible(x,y)&&listener.point(x,y)}function linePoint(x,y){var l,v=pointVisible(x=Math.max(-d3_geo_clipExtentMAX,Math.min(d3_geo_clipExtentMAX,x)),y=Math.max(-d3_geo_clipExtentMAX,Math.min(d3_geo_clipExtentMAX,y)));polygon&&ring.push([x,y]),first?(x__=x,y__=y,first=!1,(v__=v)&&(listener.lineStart(),listener.point(x,y))):v&&v_?listener.point(x,y):clipLine(l={a:{x:x_,y:y_},b:{x:x,y:y}})?(v_||(listener.lineStart(),listener.point(l.a.x,l.a.y)),listener.point(l.b.x,l.b.y),v||listener.lineEnd(),clean=!1):v&&(listener.lineStart(),listener.point(x,y),clean=!1),x_=x,y_=y,v_=v}return clip};function corner(p,direction){return abs(p[0]-x0)<ε?0<direction?0:3:abs(p[0]-x1)<ε?0<direction?2:1:abs(p[1]-y0)<ε?0<direction?1:0:0<direction?3:2}function compare(a,b){return comparePoints(a.x,b.x)}function comparePoints(a,b){var ca=corner(a,1),cb=corner(b,1);return ca!==cb?ca-cb:0===ca?b[1]-a[1]:1===ca?a[0]-b[0]:2===ca?a[1]-b[1]:b[0]-a[0]}}function d3_geo_conic(p){var φ0=0,φ1=π/3,m=d3_geo_projectionMutator(p),p=m(φ0,φ1);return p.parallels=function(_){return arguments.length?m(φ0=_[0]*π/180,φ1=_[1]*π/180):[φ0/π*180,φ1/π*180]},p}function d3_geo_conicEqualArea(sinφ0,φ1){var sinφ0=Math.sin(sinφ0),n=(sinφ0+Math.sin(φ1))/2,C=1+sinφ0*(2*n-sinφ0),ρ0=Math.sqrt(C)/n;function forward(λ,ρ){ρ=Math.sqrt(C-2*n*Math.sin(ρ))/n;return[ρ*Math.sin(λ*=n),ρ0-ρ*Math.cos(λ)]}return forward.invert=function(x,ρ0_y){ρ0_y=ρ0-ρ0_y;return[Math.atan2(x,ρ0_y)/n,d3_asin((C-(x*x+ρ0_y*ρ0_y)*n*n)/(2*n))]},forward}d3.geo.clipExtent=function(){var x0,y0,x1,y1,stream,clip,clipExtent={stream:function(output){return stream&&(stream.valid=!1),(stream=clip(output)).valid=!0,stream},extent:function(_){return arguments.length?(clip=d3_geo_clipExtent(x0=+_[0][0],y0=+_[0][1],x1=+_[1][0],y1=+_[1][1]),stream&&(stream.valid=!1,stream=null),clipExtent):[[x0,y0],[x1,y1]]}};return clipExtent.extent([[0,0],[960,500]])},(d3.geo.conicEqualArea=function(){return d3_geo_conic(d3_geo_conicEqualArea)}).raw=d3_geo_conicEqualArea,d3.geo.albers=function(){return d3.geo.conicEqualArea().rotate([96,0]).center([-.6,38.7]).parallels([29.5,45.5]).scale(1070)},d3.geo.albersUsa=function(){var point,lower48Point,alaskaPoint,hawaiiPoint,lower48=d3.geo.albers(),alaska=d3.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),hawaii=d3.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),pointStream={point:function(x,y){point=[x,y]}};function albersUsa(y){var x=y[0],y=y[1];return point=null,lower48Point(x,y),point||(alaskaPoint(x,y),point)||hawaiiPoint(x,y),point}return albersUsa.invert=function(coordinates){var y=lower48.scale(),t=lower48.translate(),x=(coordinates[0]-t[0])/y,y=(coordinates[1]-t[1])/y;return(.12<=y&&y<.234&&-.425<=x&&x<-.214?alaska:.166<=y&&y<.234&&-.214<=x&&x<-.115?hawaii:lower48).invert(coordinates)},albersUsa.stream=function(stream){var lower48Stream=lower48.stream(stream),alaskaStream=alaska.stream(stream),hawaiiStream=hawaii.stream(stream);return{point:function(x,y){lower48Stream.point(x,y),alaskaStream.point(x,y),hawaiiStream.point(x,y)},sphere:function(){lower48Stream.sphere(),alaskaStream.sphere(),hawaiiStream.sphere()},lineStart:function(){lower48Stream.lineStart(),alaskaStream.lineStart(),hawaiiStream.lineStart()},lineEnd:function(){lower48Stream.lineEnd(),alaskaStream.lineEnd(),hawaiiStream.lineEnd()},polygonStart:function(){lower48Stream.polygonStart(),alaskaStream.polygonStart(),hawaiiStream.polygonStart()},polygonEnd:function(){lower48Stream.polygonEnd(),alaskaStream.polygonEnd(),hawaiiStream.polygonEnd()}}},albersUsa.precision=function(_){return arguments.length?(lower48.precision(_),alaska.precision(_),hawaii.precision(_),albersUsa):lower48.precision()},albersUsa.scale=function(_){return arguments.length?(lower48.scale(_),alaska.scale(.35*_),hawaii.scale(_),albersUsa.translate(lower48.translate())):lower48.scale()},albersUsa.translate=function(_){if(!arguments.length)return lower48.translate();var k=lower48.scale(),x=+_[0],y=+_[1];return lower48Point=lower48.translate(_).clipExtent([[x-.455*k,y-.238*k],[x+.455*k,y+.238*k]]).stream(pointStream).point,alaskaPoint=alaska.translate([x-.307*k,y+.201*k]).clipExtent([[x-.425*k+ε,y+.12*k+ε],[x-.214*k-ε,y+.234*k-ε]]).stream(pointStream).point,hawaiiPoint=hawaii.translate([x-.205*k,y+.212*k]).clipExtent([[x-.214*k+ε,y+.166*k+ε],[x-.115*k-ε,y+.234*k-ε]]).stream(pointStream).point,albersUsa},albersUsa.scale(1070)};var d3_geo_pathAreaSum,d3_geo_pathAreaPolygon,d3_geo_pathBoundsX0,d3_geo_pathBoundsY0,d3_geo_pathBoundsX1,d3_geo_pathBoundsY1,d3_geo_pathArea={point:d3_noop,lineStart:d3_noop,lineEnd:d3_noop,polygonStart:function(){d3_geo_pathAreaPolygon=0,d3_geo_pathArea.lineStart=d3_geo_pathAreaRingStart},polygonEnd:function(){d3_geo_pathArea.lineStart=d3_geo_pathArea.lineEnd=d3_geo_pathArea.point=d3_noop,d3_geo_pathAreaSum+=abs(d3_geo_pathAreaPolygon/2)}};function d3_geo_pathAreaRingStart(){var x00,y00,x0,y0;function nextPoint(x,y){d3_geo_pathAreaPolygon+=y0*x-x0*y,x0=x,y0=y}d3_geo_pathArea.point=function(x,y){d3_geo_pathArea.point=nextPoint,x00=x0=x,y00=y0=y},d3_geo_pathArea.lineEnd=function(){nextPoint(x00,y00)}}var d3_geo_pathBounds={point:function(x,y){x<d3_geo_pathBoundsX0&&(d3_geo_pathBoundsX0=x);d3_geo_pathBoundsX1<x&&(d3_geo_pathBoundsX1=x);y<d3_geo_pathBoundsY0&&(d3_geo_pathBoundsY0=y);d3_geo_pathBoundsY1<y&&(d3_geo_pathBoundsY1=y)},lineStart:d3_noop,lineEnd:d3_noop,polygonStart:d3_noop,polygonEnd:d3_noop};function d3_geo_pathBuffer(){var pointCircle=d3_geo_pathBufferCircle(4.5),buffer=[],stream={point:point,lineStart:function(){stream.point=pointLineStart},lineEnd:lineEnd,polygonStart:function(){stream.lineEnd=lineEndPolygon},polygonEnd:function(){stream.lineEnd=lineEnd,stream.point=point},pointRadius:function(_){return pointCircle=d3_geo_pathBufferCircle(_),stream},result:function(){if(buffer.length){var result=buffer.join("");return buffer=[],result}}};function point(x,y){buffer.push("M",x,",",y,pointCircle)}function pointLineStart(x,y){buffer.push("M",x,",",y),stream.point=pointLine}function pointLine(x,y){buffer.push("L",x,",",y)}function lineEnd(){stream.point=point}function lineEndPolygon(){buffer.push("Z")}return stream}function d3_geo_pathBufferCircle(radius){return"m0,"+radius+"a"+radius+","+radius+" 0 1,1 0,"+-2*radius+"a"+radius+","+radius+" 0 1,1 0,"+2*radius+"z"}var d3_geo_lengthSum,d3_geo_pathCentroid={point:d3_geo_pathCentroidPoint,lineStart:d3_geo_pathCentroidLineStart,lineEnd:d3_geo_pathCentroidLineEnd,polygonStart:function(){d3_geo_pathCentroid.lineStart=d3_geo_pathCentroidRingStart},polygonEnd:function(){d3_geo_pathCentroid.point=d3_geo_pathCentroidPoint,d3_geo_pathCentroid.lineStart=d3_geo_pathCentroidLineStart,d3_geo_pathCentroid.lineEnd=d3_geo_pathCentroidLineEnd}};function d3_geo_pathCentroidPoint(x,y){d3_geo_centroidX0+=x,d3_geo_centroidY0+=y,++d3_geo_centroidZ0}function d3_geo_pathCentroidLineStart(){var x0,y0;function nextPoint(x,y){var dx=x-x0,z=y-y0,z=Math.sqrt(dx*dx+z*z);d3_geo_centroidX1+=z*(x0+x)/2,d3_geo_centroidY1+=z*(y0+y)/2,d3_geo_centroidZ1+=z,d3_geo_pathCentroidPoint(x0=x,y0=y)}d3_geo_pathCentroid.point=function(x,y){d3_geo_pathCentroid.point=nextPoint,d3_geo_pathCentroidPoint(x0=x,y0=y)}}function d3_geo_pathCentroidLineEnd(){d3_geo_pathCentroid.point=d3_geo_pathCentroidPoint}function d3_geo_pathCentroidRingStart(){var x00,y00,x0,y0;function nextPoint(x,y){var dx=x-x0,z=y-y0,z=Math.sqrt(dx*dx+z*z);d3_geo_centroidX1+=z*(x0+x)/2,d3_geo_centroidY1+=z*(y0+y)/2,d3_geo_centroidZ1+=z,d3_geo_centroidX2+=(z=y0*x-x0*y)*(x0+x),d3_geo_centroidY2+=z*(y0+y),d3_geo_centroidZ2+=3*z,d3_geo_pathCentroidPoint(x0=x,y0=y)}d3_geo_pathCentroid.point=function(x,y){d3_geo_pathCentroid.point=nextPoint,d3_geo_pathCentroidPoint(x00=x0=x,y00=y0=y)},d3_geo_pathCentroid.lineEnd=function(){nextPoint(x00,y00)}}function d3_geo_pathContext(context){var pointRadius=4.5,stream={point:point,lineStart:function(){stream.point=pointLineStart},lineEnd:lineEnd,polygonStart:function(){stream.lineEnd=lineEndPolygon},polygonEnd:function(){stream.lineEnd=lineEnd,stream.point=point},pointRadius:function(_){return pointRadius=_,stream},result:d3_noop};function point(x,y){context.moveTo(x+pointRadius,y),context.arc(x,y,pointRadius,0,τ)}function pointLineStart(x,y){context.moveTo(x,y),stream.point=pointLine}function pointLine(x,y){context.lineTo(x,y)}function lineEnd(){stream.point=point}function lineEndPolygon(){context.closePath()}return stream}function d3_geo_resample(project){var δ2=.5,cosMinDistance=Math.cos(30*d3_radians),maxDepth=16;function resample(stream){return(maxDepth?resampleRecursive:resampleNone)(stream)}function resampleNone(stream){return d3_geo_transformPoint(stream,function(x,y){x=project(x,y),stream.point(x[0],x[1])})}function resampleRecursive(stream){var λ00,x00,y00,a00,b00,c00,λ0,x0,y0,a0,b0,c0,resample={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){stream.polygonStart(),resample.lineStart=ringStart},polygonEnd:function(){stream.polygonEnd(),resample.lineStart=lineStart}};function point(x,y){x=project(x,y),stream.point(x[0],x[1])}function lineStart(){x0=NaN,resample.point=linePoint,stream.lineStart()}function linePoint(λ,p){var c=d3_geo_cartesian([λ,p]),p=project(λ,p);resampleLineTo(x0,y0,λ0,a0,b0,c0,x0=p[0],y0=p[1],λ0=λ,a0=c[0],b0=c[1],c0=c[2],maxDepth,stream),stream.point(x0,y0)}function lineEnd(){resample.point=point,stream.lineEnd()}function ringStart(){lineStart(),resample.point=ringPoint,resample.lineEnd=ringEnd}function ringPoint(λ,φ){linePoint(λ00=λ,φ),x00=x0,y00=y0,a00=a0,b00=b0,c00=c0,resample.point=linePoint}function ringEnd(){resampleLineTo(x0,y0,λ0,a0,b0,c0,x00,y00,λ00,a00,b00,c00,maxDepth,stream),resample.lineEnd=lineEnd,lineEnd()}return resample}function resampleLineTo(x0,y0,λ0,a0,b0,c0,x1,y1,λ1,a1,b1,c1,depth,stream){var a,b,c,m,λ2,x2,y2,dx2,dy2,dz,dx=x1-x0,dy=y1-y0,d2=dx*dx+dy*dy;4*δ2<d2&&depth--&&(a=a0+a1,b=b0+b1,c=c0+c1,m=Math.sqrt(a*a+b*b+c*c),dy2=Math.asin(c/=m),λ2=abs(abs(c)-1)<ε||abs(λ0-λ1)<ε?(λ0+λ1)/2:Math.atan2(b,a),x2=(dz=project(λ2,dy2))[0],y2=dz[1],(δ2<(dz=dy*(dx2=x2-x0)-dx*(dy2=y2-y0))*dz/d2||.3<abs((dx*dx2+dy*dy2)/d2-.5)||a0*a1+b0*b1+c0*c1<cosMinDistance)&&(resampleLineTo(x0,y0,λ0,a0,b0,c0,x2,y2,λ2,a/=m,b/=m,c,depth,stream),stream.point(x2,y2),resampleLineTo(x2,y2,λ2,a,b,c,x1,y1,λ1,a1,b1,c1,depth,stream)))}return resample.precision=function(_){return arguments.length?(maxDepth=0<(δ2=_*_)&&16,resample):Math.sqrt(δ2)},resample}function d3_geo_transform(stream){this.stream=stream}function d3_geo_transformPoint(stream,point){return{point:point,sphere:function(){stream.sphere()},lineStart:function(){stream.lineStart()},lineEnd:function(){stream.lineEnd()},polygonStart:function(){stream.polygonStart()},polygonEnd:function(){stream.polygonEnd()}}}function d3_geo_projection(project){return d3_geo_projectionMutator(function(){return project})()}function d3_geo_projectionMutator(projectAt){var project,rotate,projectRotate,δx,δy,stream,projectResample=d3_geo_resample(function(x,y){return[(x=project(x,y))[0]*k+δx,δy-x[1]*k]}),k=150,x=480,y=250,λ=0,φ=0,δλ=0,δφ=0,δγ=0,preclip=d3_geo_clipAntimeridian,postclip=d3_identity,clipAngle=null,clipExtent=null;function projection(point){return[(point=projectRotate(point[0]*d3_radians,point[1]*d3_radians))[0]*k+δx,δy-point[1]*k]}function invert(point){return(point=projectRotate.invert((point[0]-δx)/k,(δy-point[1])/k))&&[point[0]*d3_degrees,point[1]*d3_degrees]}function reset(){projectRotate=d3_geo_compose(rotate=d3_geo_rotation(δλ,δφ,δγ),project);var center=project(λ,φ);return δx=x-center[0]*k,δy=y+center[1]*k,invalidate()}function invalidate(){return stream&&(stream.valid=!1,stream=null),projection}return projection.stream=function(output){return stream&&(stream.valid=!1),(stream=d3_geo_projectionRadians(preclip(rotate,projectResample(postclip(output))))).valid=!0,stream},projection.clipAngle=function(_){return arguments.length?(preclip=null==_?(clipAngle=_,d3_geo_clipAntimeridian):d3_geo_clipCircle((clipAngle=+_)*d3_radians),invalidate()):clipAngle},projection.clipExtent=function(_){return arguments.length?(postclip=(clipExtent=_)?d3_geo_clipExtent(_[0][0],_[0][1],_[1][0],_[1][1]):d3_identity,invalidate()):clipExtent},projection.scale=function(_){return arguments.length?(k=+_,reset()):k},projection.translate=function(_){return arguments.length?(x=+_[0],y=+_[1],reset()):[x,y]},projection.center=function(_){return arguments.length?(λ=_[0]%360*d3_radians,φ=_[1]%360*d3_radians,reset()):[λ*d3_degrees,φ*d3_degrees]},projection.rotate=function(_){return arguments.length?(δλ=_[0]%360*d3_radians,δφ=_[1]%360*d3_radians,δγ=2<_.length?_[2]%360*d3_radians:0,reset()):[δλ*d3_degrees,δφ*d3_degrees,δγ*d3_degrees]},d3.rebind(projection,projectResample,"precision"),function(){return project=projectAt.apply(this,arguments),projection.invert=project.invert&&invert,reset()}}function d3_geo_projectionRadians(stream){return d3_geo_transformPoint(stream,function(x,y){stream.point(x*d3_radians,y*d3_radians)})}function d3_geo_equirectangular(λ,φ){return[λ,φ]}function d3_geo_identityRotation(λ,φ){return[π<λ?λ-τ:λ<-π?λ+τ:λ,φ]}function d3_geo_rotation(δλ,δφ,δγ){return δλ?δφ||δγ?d3_geo_compose(d3_geo_rotationλ(δλ),d3_geo_rotationφγ(δφ,δγ)):d3_geo_rotationλ(δλ):δφ||δγ?d3_geo_rotationφγ(δφ,δγ):d3_geo_identityRotation}function d3_geo_forwardRotationλ(δλ){return function(λ,φ){return[π<(λ+=δλ)?λ-τ:λ<-π?λ+τ:λ,φ]}}function d3_geo_rotationλ(δλ){var rotation=d3_geo_forwardRotationλ(δλ);return rotation.invert=d3_geo_forwardRotationλ(-δλ),rotation}function d3_geo_rotationφγ(δφ,δγ){var cosδφ=Math.cos(δφ),sinδφ=Math.sin(δφ),cosδγ=Math.cos(δγ),sinδγ=Math.sin(δγ);function rotation(y,k){var z=Math.cos(k),x=Math.cos(y)*z,y=Math.sin(y)*z,z=Math.sin(k),k=z*cosδφ+x*sinδφ;return[Math.atan2(y*cosδγ-k*sinδγ,x*cosδφ-z*sinδφ),d3_asin(k*cosδγ+y*sinδγ)]}return rotation.invert=function(y,k){var z=Math.cos(k),x=Math.cos(y)*z,y=Math.sin(y)*z,z=Math.sin(k),k=z*cosδγ-y*sinδγ;return[Math.atan2(y*cosδγ+z*sinδγ,x*cosδφ+k*sinδφ),d3_asin(k*cosδφ-x*sinδφ)]},rotation}function d3_geo_circleInterpolate(radius,precision){var cr=Math.cos(radius),sr=Math.sin(radius);return function(from,to,direction,listener){var step=direction*precision;null!=from?(from=d3_geo_circleAngle(cr,from),to=d3_geo_circleAngle(cr,to),(0<direction?from<to:to<from)&&(from+=direction*τ)):(from=radius+direction*τ,to=radius-.5*step);for(var point,t=from;0<direction?to<t:t<to;t-=step)listener.point((point=d3_geo_spherical([cr,-sr*Math.cos(t),-sr*Math.sin(t)]))[0],point[1])}}function d3_geo_circleAngle(angle,a){a=d3_geo_cartesian(a);a[0]-=angle,d3_geo_cartesianNormalize(a);angle=d3_acos(-a[1]);return((-a[2]<0?-angle:angle)+2*Math.PI-ε)%(2*Math.PI)}function d3_geo_graticuleX(y0,y1,dy){var y=d3.range(y0,y1-ε,dy).concat(y1);return function(x){return y.map(function(y){return[x,y]})}}function d3_geo_graticuleY(x0,x1,dx){var x=d3.range(x0,x1-ε,dx).concat(x1);return function(y){return x.map(function(x){return[x,y]})}}function d3_source(d){return d.source}function d3_target(d){return d.target}d3.geo.path=function(){var projection,context,projectStream,contextStream,cacheStream,pointRadius=4.5;function path(object){return object&&("function"==typeof pointRadius&&contextStream.pointRadius(+pointRadius.apply(this,arguments)),cacheStream&&cacheStream.valid||(cacheStream=projectStream(contextStream)),d3.geo.stream(object,cacheStream)),contextStream.result()}function reset(){return cacheStream=null,path}return path.area=function(object){return d3_geo_pathAreaSum=0,d3.geo.stream(object,projectStream(d3_geo_pathArea)),d3_geo_pathAreaSum},path.centroid=function(object){return d3_geo_centroidX0=d3_geo_centroidY0=d3_geo_centroidZ0=d3_geo_centroidX1=d3_geo_centroidY1=d3_geo_centroidZ1=d3_geo_centroidX2=d3_geo_centroidY2=d3_geo_centroidZ2=0,d3.geo.stream(object,projectStream(d3_geo_pathCentroid)),d3_geo_centroidZ2?[d3_geo_centroidX2/d3_geo_centroidZ2,d3_geo_centroidY2/d3_geo_centroidZ2]:d3_geo_centroidZ1?[d3_geo_centroidX1/d3_geo_centroidZ1,d3_geo_centroidY1/d3_geo_centroidZ1]:d3_geo_centroidZ0?[d3_geo_centroidX0/d3_geo_centroidZ0,d3_geo_centroidY0/d3_geo_centroidZ0]:[NaN,NaN]},path.bounds=function(object){return d3_geo_pathBoundsX1=d3_geo_pathBoundsY1=-(d3_geo_pathBoundsX0=d3_geo_pathBoundsY0=1/0),d3.geo.stream(object,projectStream(d3_geo_pathBounds)),[[d3_geo_pathBoundsX0,d3_geo_pathBoundsY0],[d3_geo_pathBoundsX1,d3_geo_pathBoundsY1]]},path.projection=function(_){return arguments.length?(projectStream=(projection=_)?_.stream||(project=_,resample=d3_geo_resample(function(x,y){return project([x*d3_degrees,y*d3_degrees])}),function(stream){return d3_geo_projectionRadians(resample(stream))}):d3_identity,reset()):projection;var project,resample},path.context=function(_){return arguments.length?(contextStream=null==(context=_)?new d3_geo_pathBuffer:new d3_geo_pathContext(_),"function"!=typeof pointRadius&&contextStream.pointRadius(pointRadius),reset()):context},path.pointRadius=function(_){return arguments.length?(pointRadius="function"==typeof _?_:(contextStream.pointRadius(+_),+_),path):pointRadius},path.projection(d3.geo.albersUsa()).context(null)},d3.geo.transform=function(methods){return{stream:function(stream){var k,transform=new d3_geo_transform(stream);for(k in methods)transform[k]=methods[k];return transform}}},d3_geo_transform.prototype={point:function(x,y){this.stream.point(x,y)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},d3.geo.projection=d3_geo_projection,d3.geo.projectionMutator=d3_geo_projectionMutator,(d3.geo.equirectangular=function(){return d3_geo_projection(d3_geo_equirectangular)}).raw=d3_geo_equirectangular.invert=d3_geo_equirectangular,d3.geo.rotation=function(rotate){function forward(coordinates){return(coordinates=rotate(coordinates[0]*d3_radians,coordinates[1]*d3_radians))[0]*=d3_degrees,coordinates[1]*=d3_degrees,coordinates}return rotate=d3_geo_rotation(rotate[0]%360*d3_radians,rotate[1]*d3_radians,2<rotate.length?rotate[2]*d3_radians:0),forward.invert=function(coordinates){return(coordinates=rotate.invert(coordinates[0]*d3_radians,coordinates[1]*d3_radians))[0]*=d3_degrees,coordinates[1]*=d3_degrees,coordinates},forward},d3_geo_identityRotation.invert=d3_geo_equirectangular,d3.geo.circle=function(){var angle,interpolate,origin=[0,0],precision=6;function circle(){var center="function"==typeof origin?origin.apply(this,arguments):origin,rotate=d3_geo_rotation(-center[0]*d3_radians,-center[1]*d3_radians,0).invert,ring=[];return interpolate(null,null,1,{point:function(x,y){ring.push(x=rotate(x,y)),x[0]*=d3_degrees,x[1]*=d3_degrees}}),{type:"Polygon",coordinates:[ring]}}return circle.origin=function(x){return arguments.length?(origin=x,circle):origin},circle.angle=function(x){return arguments.length?(interpolate=d3_geo_circleInterpolate((angle=+x)*d3_radians,precision*d3_radians),circle):angle},circle.precision=function(_){return arguments.length?(interpolate=d3_geo_circleInterpolate(angle*d3_radians,(precision=+_)*d3_radians),circle):precision},circle.angle(90)},d3.geo.distance=function(cosΔλ,sinφ0){var cosφ0=(sinφ0[0]-cosΔλ[0])*d3_radians,sinφ1=cosΔλ[1]*d3_radians,cosφ1=sinφ0[1]*d3_radians,t=Math.sin(cosφ0),cosΔλ=Math.cos(cosφ0),sinφ0=Math.sin(sinφ1),cosφ0=Math.cos(sinφ1),sinφ1=Math.sin(cosφ1),cosφ1=Math.cos(cosφ1);return Math.atan2(Math.sqrt((t=cosφ1*t)*t+(t=cosφ0*sinφ1-sinφ0*cosφ1*cosΔλ)*t),sinφ0*sinφ1+cosφ0*cosφ1*cosΔλ)},d3.geo.graticule=function(){var x1,x0,X1,X0,y1,y0,Y1,Y0,x,y,X,Y,dx=10,dy=dx,DX=90,DY=360,precision=2.5;function graticule(){return{type:"MultiLineString",coordinates:lines()}}function lines(){return d3.range(Math.ceil(X0/DX)*DX,X1,DX).map(X).concat(d3.range(Math.ceil(Y0/DY)*DY,Y1,DY).map(Y)).concat(d3.range(Math.ceil(x0/dx)*dx,x1,dx).filter(function(x){return abs(x%DX)>ε}).map(x)).concat(d3.range(Math.ceil(y0/dy)*dy,y1,dy).filter(function(y){return abs(y%DY)>ε}).map(y))}return graticule.lines=function(){return lines().map(function(coordinates){return{type:"LineString",coordinates:coordinates}})},graticule.outline=function(){return{type:"Polygon",coordinates:[X(X0).concat(Y(Y1).slice(1),X(X1).reverse().slice(1),Y(Y0).reverse().slice(1))]}},graticule.extent=function(_){return arguments.length?graticule.majorExtent(_).minorExtent(_):graticule.minorExtent()},graticule.majorExtent=function(_){return arguments.length?(X0=+_[0][0],X1=+_[1][0],Y0=+_[0][1],Y1=+_[1][1],X1<X0&&(_=X0,X0=X1,X1=_),Y1<Y0&&(_=Y0,Y0=Y1,Y1=_),graticule.precision(precision)):[[X0,Y0],[X1,Y1]]},graticule.minorExtent=function(_){return arguments.length?(x0=+_[0][0],x1=+_[1][0],y0=+_[0][1],y1=+_[1][1],x1<x0&&(_=x0,x0=x1,x1=_),y1<y0&&(_=y0,y0=y1,y1=_),graticule.precision(precision)):[[x0,y0],[x1,y1]]},graticule.step=function(_){return arguments.length?graticule.majorStep(_).minorStep(_):graticule.minorStep()},graticule.majorStep=function(_){return arguments.length?(DX=+_[0],DY=+_[1],graticule):[DX,DY]},graticule.minorStep=function(_){return arguments.length?(dx=+_[0],dy=+_[1],graticule):[dx,dy]},graticule.precision=function(_){return arguments.length?(precision=+_,x=d3_geo_graticuleX(y0,y1,90),y=d3_geo_graticuleY(x0,x1,precision),X=d3_geo_graticuleX(Y0,Y1,90),Y=d3_geo_graticuleY(X0,X1,precision),graticule):precision},graticule.majorExtent([[-180,-90+ε],[180,90-ε]]).minorExtent([[-180,-80-ε],[180,80+ε]])},d3.geo.greatArc=function(){var source_,target_,source=d3_source,target=d3_target;function greatArc(){return{type:"LineString",coordinates:[source_||source.apply(this,arguments),target_||target.apply(this,arguments)]}}return greatArc.distance=function(){return d3.geo.distance(source_||source.apply(this,arguments),target_||target.apply(this,arguments))},greatArc.source=function(_){return arguments.length?(source_="function"==typeof(source=_)?null:_,greatArc):source},greatArc.target=function(_){return arguments.length?(target_="function"==typeof(target=_)?null:_,greatArc):target},greatArc.precision=function(){return arguments.length?greatArc:0},greatArc},d3.geo.interpolate=function(cy0,cy1){return x0=cy0[0]*d3_radians,y0=cy0[1]*d3_radians,interpolate=cy1[0]*d3_radians,y1=cy1[1]*d3_radians,cy0=Math.cos(y0),sy0=Math.sin(y0),cy1=Math.cos(y1),sy1=Math.sin(y1),kx0=cy0*Math.cos(x0),ky0=cy0*Math.sin(x0),kx1=cy1*Math.cos(interpolate),ky1=cy1*Math.sin(interpolate),d=2*Math.asin(Math.sqrt(d3_haversin(y1-y0)+cy0*cy1*d3_haversin(interpolate-x0))),k=1/Math.sin(d),(interpolate=d?function(y){var z=Math.sin(y*=d)*k,A=Math.sin(d-y)*k,x=A*kx0+z*kx1,y=A*ky0+z*ky1,z=A*sy0+z*sy1;return[Math.atan2(y,x)*d3_degrees,Math.atan2(z,Math.sqrt(x*x+y*y))*d3_degrees]}:function(){return[x0*d3_degrees,y0*d3_degrees]}).distance=d,interpolate;var x0,y0,interpolate,y1,sy0,sy1,kx0,ky0,kx1,ky1,d,k},d3.geo.length=function(object){return d3_geo_lengthSum=0,d3.geo.stream(object,d3_geo_length),d3_geo_lengthSum};var d3_geo_length={sphere:d3_noop,point:d3_noop,lineStart:function(){var λ0,sinφ0,cosφ0;function nextPoint(λ,cosΔλ){var sinφ=Math.sin(cosΔλ*=d3_radians),cosφ=Math.cos(cosΔλ),t=abs((λ*=d3_radians)-λ0),cosΔλ=Math.cos(t);d3_geo_lengthSum+=Math.atan2(Math.sqrt((t=cosφ*Math.sin(t))*t+(t=cosφ0*sinφ-sinφ0*cosφ*cosΔλ)*t),sinφ0*sinφ+cosφ0*cosφ*cosΔλ),λ0=λ,sinφ0=sinφ,cosφ0=cosφ}d3_geo_length.point=function(λ,φ){λ0=λ*d3_radians,sinφ0=Math.sin(φ*=d3_radians),cosφ0=Math.cos(φ),d3_geo_length.point=nextPoint},d3_geo_length.lineEnd=function(){d3_geo_length.point=d3_geo_length.lineEnd=d3_noop}},lineEnd:d3_noop,polygonStart:d3_noop,polygonEnd:d3_noop};function d3_geo_azimuthal(scale,angle){function azimuthal(λ,φ){var k=Math.cos(λ),cosφ=Math.cos(φ),k=scale(k*cosφ);return[k*cosφ*Math.sin(λ),k*Math.sin(φ)]}return azimuthal.invert=function(x,y){var ρ=Math.sqrt(x*x+y*y),cosc=angle(ρ),sinc=Math.sin(cosc),cosc=Math.cos(cosc);return[Math.atan2(x*sinc,ρ*cosc),Math.asin(ρ&&y*sinc/ρ)]},azimuthal}var d3_geo_azimuthalEqualArea=d3_geo_azimuthal(function(cosλcosφ){return Math.sqrt(2/(1+cosλcosφ))},function(ρ){return 2*Math.asin(ρ/2)});(d3.geo.azimuthalEqualArea=function(){return d3_geo_projection(d3_geo_azimuthalEqualArea)}).raw=d3_geo_azimuthalEqualArea;var d3_geo_azimuthalEquidistant=d3_geo_azimuthal(function(c){c=Math.acos(c);return c&&c/Math.sin(c)},d3_identity);function d3_geo_conicConformal(φ0,φ1){function t(φ){return Math.tan(π/4+φ/2)}var cosφ0=Math.cos(φ0),n=φ0===φ1?Math.sin(φ0):Math.log(cosφ0/Math.cos(φ1))/Math.log(t(φ1)/t(φ0)),F=cosφ0*Math.pow(t(φ0),n)/n;return n?(forward.invert=function(x,ρ){var ρ0_y=F-ρ,ρ=d3_sgn(n)*Math.sqrt(x*x+ρ0_y*ρ0_y);return[Math.atan2(x,ρ0_y)/n,2*Math.atan(Math.pow(F/ρ,1/n))-halfπ]},forward):d3_geo_mercator;function forward(λ,ρ){0<F?ρ<-halfπ+ε&&(ρ=-halfπ+ε):halfπ-ε<ρ&&(ρ=halfπ-ε);ρ=F/Math.pow(t(ρ),n);return[ρ*Math.sin(n*λ),F-ρ*Math.cos(n*λ)]}}function d3_geo_conicEquidistant(φ0,φ1){var cosφ0=Math.cos(φ0),n=φ0===φ1?Math.sin(φ0):(cosφ0-Math.cos(φ1))/(φ1-φ0),G=cosφ0/n+φ0;return abs(n)<ε?d3_geo_equirectangular:(forward.invert=function(x,ρ0_y){ρ0_y=G-ρ0_y;return[Math.atan2(x,ρ0_y)/n,G-d3_sgn(n)*Math.sqrt(x*x+ρ0_y*ρ0_y)]},forward);function forward(λ,ρ){ρ=G-ρ;return[ρ*Math.sin(n*λ),G-ρ*Math.cos(n*λ)]}}(d3.geo.azimuthalEquidistant=function(){return d3_geo_projection(d3_geo_azimuthalEquidistant)}).raw=d3_geo_azimuthalEquidistant,(d3.geo.conicConformal=function(){return d3_geo_conic(d3_geo_conicConformal)}).raw=d3_geo_conicConformal,(d3.geo.conicEquidistant=function(){return d3_geo_conic(d3_geo_conicEquidistant)}).raw=d3_geo_conicEquidistant;var d3_geo_gnomonic=d3_geo_azimuthal(function(cosλcosφ){return 1/cosλcosφ},Math.atan);function d3_geo_mercator(λ,φ){return[λ,Math.log(Math.tan(π/4+φ/2))]}function d3_geo_mercatorProjection(project){var clipAuto,m=d3_geo_projection(project),scale=m.scale,translate=m.translate,clipExtent=m.clipExtent;return m.scale=function(){var v=scale.apply(m,arguments);return v===m?clipAuto?m.clipExtent(null):m:v},m.translate=function(){var v=translate.apply(m,arguments);return v===m?clipAuto?m.clipExtent(null):m:v},m.clipExtent=function(_){var k,t,v=clipExtent.apply(m,arguments);return v===m?(clipAuto=null==_)&&(k=π*scale(),t=translate(),clipExtent([[t[0]-k,t[1]-k],[t[0]+k,t[1]+k]])):clipAuto&&(v=null),v},m.clipExtent(null)}(d3.geo.gnomonic=function(){return d3_geo_projection(d3_geo_gnomonic)}).raw=d3_geo_gnomonic,d3_geo_mercator.invert=function(x,y){return[x,2*Math.atan(Math.exp(y))-halfπ]},(d3.geo.mercator=function(){return d3_geo_mercatorProjection(d3_geo_mercator)}).raw=d3_geo_mercator;var d3_geo_orthographic=d3_geo_azimuthal(function(){return 1},Math.asin);(d3.geo.orthographic=function(){return d3_geo_projection(d3_geo_orthographic)}).raw=d3_geo_orthographic;var d3_geo_stereographic=d3_geo_azimuthal(function(cosλcosφ){return 1/(1+cosλcosφ)},function(ρ){return 2*Math.atan(ρ)});function d3_geo_transverseMercator(λ,φ){return[Math.log(Math.tan(π/4+φ/2)),-λ]}function d3_geom_pointX(d){return d[0]}function d3_geom_pointY(d){return d[1]}function d3_geom_hullUpper(points){for(var n=points.length,hull=[0,1],hs=2,i=2;i<n;i++){for(;1<hs&&d3_cross2d(points[hull[hs-2]],points[hull[hs-1]],points[i])<=0;)--hs;hull[hs++]=i}return hull.slice(0,hs)}function d3_geom_hullOrder(a,b){return a[0]-b[0]||a[1]-b[1]}(d3.geo.stereographic=function(){return d3_geo_projection(d3_geo_stereographic)}).raw=d3_geo_stereographic,d3_geo_transverseMercator.invert=function(x,y){return[-y,2*Math.atan(Math.exp(x))-halfπ]},(d3.geo.transverseMercator=function(){var projection=d3_geo_mercatorProjection(d3_geo_transverseMercator),center=projection.center,rotate=projection.rotate;return projection.center=function(_){return _?center([-_[1],_[0]]):[(_=center())[1],-_[0]]},projection.rotate=function(_){return _?rotate([_[0],_[1],2<_.length?_[2]+90:90]):[(_=rotate())[0],_[1],_[2]-90]},rotate([0,0,90])}).raw=d3_geo_transverseMercator,d3.geom={},d3.geom.hull=function(vertices){var x=d3_geom_pointX,y=d3_geom_pointY;return arguments.length?hull(vertices):(hull.x=function(_){return arguments.length?(x=_,hull):x},hull.y=function(_){return arguments.length?(y=_,hull):y},hull);function hull(data){if(data.length<3)return[];for(var fx=d3_functor(x),fy=d3_functor(y),n=data.length,points=[],flippedPoints=[],i=0;i<n;i++)points.push([+fx.call(this,data[i],i),+fy.call(this,data[i],i),i]);for(points.sort(d3_geom_hullOrder),i=0;i<n;i++)flippedPoints.push([points[i][0],-points[i][1]]);var upper=d3_geom_hullUpper(points),lower=d3_geom_hullUpper(flippedPoints),skipLeft=lower[0]===upper[0],skipRight=lower[lower.length-1]===upper[upper.length-1],polygon=[];for(i=upper.length-1;0<=i;--i)polygon.push(data[points[upper[i]][2]]);for(i=+skipLeft;i<lower.length-skipRight;++i)polygon.push(data[points[lower[i]][2]]);return polygon}},d3.geom.polygon=function(coordinates){return d3_subclass(coordinates,d3_geom_polygonPrototype),coordinates};var d3_geom_polygonPrototype=d3.geom.polygon.prototype=[];function d3_geom_polygonInside(p,a,b){return(b[0]-a[0])*(p[1]-a[1])<(b[1]-a[1])*(p[0]-a[0])}function d3_geom_polygonIntersect(y1,y21,y3,y43){var x1=y1[0],x3=y3[0],x21=y21[0]-x1,ua=y43[0]-x3,y1=y1[1],y3=y3[1],y21=y21[1]-y1,y43=y43[1]-y3,ua=(ua*(y1-y3)-y43*(x1-x3))/(y43*x21-ua*y21);return[x1+ua*x21,y1+ua*y21]}function d3_geom_polygonClosed(b){var a=b[0],b=b[b.length-1];return!(a[0]-b[0]||a[1]-b[1])}d3_geom_polygonPrototype.area=function(){for(var a,i=-1,n=this.length,b=this[n-1],area=0;++i<n;)a=b,b=this[i],area+=a[1]*b[0]-a[0]*b[1];return.5*area},d3_geom_polygonPrototype.centroid=function(k){var a,c,i=-1,n=this.length,x=0,y=0,b=this[n-1];for(arguments.length||(k=-1/(6*this.area()));++i<n;)a=b,b=this[i],c=a[0]*b[1]-b[0]*a[1],x+=(a[0]+b[0])*c,y+=(a[1]+b[1])*c;return[x*k,y*k]},d3_geom_polygonPrototype.clip=function(subject){for(var input,j,m,b,c,d,closed=d3_geom_polygonClosed(subject),i=-1,n=this.length-d3_geom_polygonClosed(this),a=this[n-1];++i<n;){for(input=subject.slice(),subject.length=0,b=this[i],c=input[(m=input.length-closed)-1],j=-1;++j<m;)d3_geom_polygonInside(d=input[j],a,b)?(d3_geom_polygonInside(c,a,b)||subject.push(d3_geom_polygonIntersect(c,d,a,b)),subject.push(d)):d3_geom_polygonInside(c,a,b)&&subject.push(d3_geom_polygonIntersect(c,d,a,b)),c=d;closed&&subject.push(subject[0]),a=b}return subject};var d3_geom_voronoiEdges,d3_geom_voronoiCells,d3_geom_voronoiBeaches,d3_geom_voronoiFirstCircle,d3_geom_voronoiCircles,d3_geom_voronoiBeachPool=[],d3_geom_voronoiCirclePool=[];function d3_geom_voronoiBeach(){d3_geom_voronoiRedBlackNode(this),this.edge=this.site=this.circle=null}function d3_geom_voronoiCreateBeach(site){var beach=d3_geom_voronoiBeachPool.pop()||new d3_geom_voronoiBeach;return beach.site=site,beach}function d3_geom_voronoiDetachBeach(beach){d3_geom_voronoiDetachCircle(beach),d3_geom_voronoiBeaches.remove(beach),d3_geom_voronoiBeachPool.push(beach),d3_geom_voronoiRedBlackNode(beach)}function d3_geom_voronoiAddBeach(site){for(var lArc,rArc,dxl,dxr,x=site.x,directrix=site.y,node=d3_geom_voronoiBeaches._;node;)if(dxl=d3_geom_voronoiLeftBreakPoint(node,directrix)-x,ε<dxl)node=node.L;else{if(dxr=x-function(site,directrix){var rArc=site.N;if(rArc)return d3_geom_voronoiLeftBreakPoint(rArc,directrix);site=site.site;return site.y===directrix?site.x:1/0}(node,directrix),!(ε<dxr)){-ε<dxl?(lArc=node.P,rArc=node):-ε<dxr?rArc=(lArc=node).N:lArc=rArc=node;break}if(!node.R){lArc=node;break}node=node.R}var lSite,ax,bx,rSite,cx,cy,d,hb,hc,vertex,newArc=d3_geom_voronoiCreateBeach(site);if(d3_geom_voronoiBeaches.insert(lArc,newArc),lArc||rArc){if(lArc===rArc)return d3_geom_voronoiDetachCircle(lArc),rArc=d3_geom_voronoiCreateBeach(lArc.site),d3_geom_voronoiBeaches.insert(newArc,rArc),newArc.edge=rArc.edge=d3_geom_voronoiCreateEdge(lArc.site,newArc.site),d3_geom_voronoiAttachCircle(lArc),void d3_geom_voronoiAttachCircle(rArc);rArc?(d3_geom_voronoiDetachCircle(lArc),d3_geom_voronoiDetachCircle(rArc),ax=(lSite=lArc.site).x,vertex=lSite.y,bx=site.x-ax,d=site.y-vertex,cx=(rSite=rArc.site).x-ax,cy=rSite.y-vertex,d3_geom_voronoiSetEdgeEnd(rArc.edge,lSite,rSite,vertex={x:(cy*(hb=bx*bx+d*d)-d*(hc=cx*cx+cy*cy))/(d=2*(bx*cy-d*cx))+ax,y:(bx*hc-cx*hb)/d+vertex}),newArc.edge=d3_geom_voronoiCreateEdge(lSite,site,null,vertex),rArc.edge=d3_geom_voronoiCreateEdge(site,rSite,null,vertex),d3_geom_voronoiAttachCircle(lArc),d3_geom_voronoiAttachCircle(rArc)):newArc.edge=d3_geom_voronoiCreateEdge(lArc.site,newArc.site)}}function d3_geom_voronoiLeftBreakPoint(plby2,b){var aby2=plby2.site,rfocx=aby2.x,rfocy=aby2.y,pby2=rfocy-b;if(!pby2)return rfocx;var hl=plby2.P;if(!hl)return-1/0;var lfocx=(aby2=hl.site).x,lfocy=aby2.y,plby2=lfocy-b;if(!plby2)return lfocx;hl=lfocx-rfocx,aby2=1/pby2-1/plby2,b=hl/plby2;return aby2?(-b+Math.sqrt(b*b-2*aby2*(hl*hl/(-2*plby2)-lfocy+plby2/2+rfocy-pby2/2)))/aby2+rfocx:(rfocx+lfocx)/2}function d3_geom_voronoiCell(site){this.site=site,this.edges=[]}function d3_geom_voronoiCloseCells(extent){for(var x2,x3,y3,cell,iHalfEdge,halfEdges,nHalfEdges,y2,end,x0=extent[0][0],x1=extent[1][0],y0=extent[0][1],y1=extent[1][1],cells=d3_geom_voronoiCells,iCell=cells.length;iCell--;)if((cell=cells[iCell])&&cell.prepare())for(nHalfEdges=(halfEdges=cell.edges).length,iHalfEdge=0;iHalfEdge<nHalfEdges;)x3=(end=halfEdges[iHalfEdge].end()).x,y3=end.y,x2=(y2=halfEdges[++iHalfEdge%nHalfEdges].start()).x,y2=y2.y,(abs(x3-x2)>ε||abs(y3-y2)>ε)&&(halfEdges.splice(iHalfEdge,0,new d3_geom_voronoiHalfEdge(function(edge,va,vb){edge=new d3_geom_voronoiEdge(edge,null);return edge.a=va,edge.b=vb,d3_geom_voronoiEdges.push(edge),edge}(cell.site,end,abs(x3-x0)<ε&&ε<y1-y3?{x:x0,y:abs(x2-x0)<ε?y2:y1}:abs(y3-y1)<ε&&ε<x1-x3?{x:abs(y2-y1)<ε?x2:x1,y:y1}:abs(x3-x1)<ε&&ε<y3-y0?{x:x1,y:abs(x2-x1)<ε?y2:y0}:abs(y3-y0)<ε&&ε<x3-x0?{x:abs(y2-y0)<ε?x2:x0,y:y0}:null),cell.site,null)),++nHalfEdges)}function d3_geom_voronoiHalfEdgeOrder(a,b){return b.angle-a.angle}function d3_geom_voronoiCircle(){d3_geom_voronoiRedBlackNode(this),this.x=this.y=this.arc=this.site=this.cy=null}function d3_geom_voronoiAttachCircle(arc){var cy=arc.P,y=arc.N;if(cy&&y){var ha=cy.site,cSite=arc.site,hc=y.site;if(ha!==hc){var bx=cSite.x,by=cSite.y,ax=ha.x-bx,x=ha.y-by,cx=hc.x-bx,y=2*(ax*(cy=hc.y-by)-x*cx);if(!(-ε2<=y)){var ha=ax*ax+x*x,hc=cx*cx+cy*cy,x=(cy*ha-x*hc)/y,y=(ax*hc-cx*ha)/y,cy=y+by,circle=d3_geom_voronoiCirclePool.pop()||new d3_geom_voronoiCircle;circle.arc=arc,circle.site=cSite,circle.x=x+bx,circle.y=cy+Math.sqrt(x*x+y*y),circle.cy=cy,arc.circle=circle;for(var before=null,node=d3_geom_voronoiCircles._;node;)if(circle.y<node.y||circle.y===node.y&&circle.x<=node.x){if(!node.L){before=node.P;break}node=node.L}else{if(!node.R){before=node;break}node=node.R}d3_geom_voronoiCircles.insert(before,circle),before||(d3_geom_voronoiFirstCircle=circle)}}}}function d3_geom_voronoiDetachCircle(arc){var circle=arc.circle;circle&&(circle.P||(d3_geom_voronoiFirstCircle=circle.N),d3_geom_voronoiCircles.remove(circle),d3_geom_voronoiCirclePool.push(circle),d3_geom_voronoiRedBlackNode(circle),arc.circle=null)}function d3_geom_voronoiClipEdges(extent){for(var e,edges=d3_geom_voronoiEdges,clip=d3_geom_clipLine(extent[0][0],extent[0][1],extent[1][0],extent[1][1]),i=edges.length;i--;)(function(edge,ry){var vb=edge.b;if(vb)return!0;var va=edge.a,x0=ry[0][0],x1=ry[1][0],y0=ry[0][1],y1=ry[1][1],fb=edge.l,fm=edge.r,lx=fb.x,ly=fb.y,rx=fm.x,ry=fm.y,fb=(lx+rx)/2,fm=(ly+ry)/2;if(ry===ly){if(fb<x0||x1<=fb)return;if(rx<lx){if(va){if(va.y>=y1)return}else va={x:fb,y:y0};vb={x:fb,y:y1}}else{if(va){if(va.y<y0)return}else va={x:fb,y:y1};vb={x:fb,y:y0}}}else if(fb=fm-(fm=(lx-rx)/(ry-ly))*fb,fm<-1||1<fm)if(rx<lx){if(va){if(va.y>=y1)return}else va={x:(y0-fb)/fm,y:y0};vb={x:(y1-fb)/fm,y:y1}}else{if(va){if(va.y<y0)return}else va={x:(y1-fb)/fm,y:y1};vb={x:(y0-fb)/fm,y:y0}}else if(ly<ry){if(va){if(va.x>=x1)return}else va={x:x0,y:fm*x0+fb};vb={x:x1,y:fm*x1+fb}}else{if(va){if(va.x<x0)return}else va={x:x1,y:fm*x1+fb};vb={x:x0,y:fm*x0+fb}}return edge.a=va,edge.b=vb,!0})(e=edges[i],extent)&&clip(e)&&!(abs(e.a.x-e.b.x)<ε&&abs(e.a.y-e.b.y)<ε)||(e.a=e.b=null,edges.splice(i,1))}function d3_geom_voronoiEdge(lSite,rSite){this.l=lSite,this.r=rSite,this.a=this.b=null}function d3_geom_voronoiCreateEdge(lSite,rSite,va,vb){var edge=new d3_geom_voronoiEdge(lSite,rSite);return d3_geom_voronoiEdges.push(edge),va&&d3_geom_voronoiSetEdgeEnd(edge,lSite,rSite,va),vb&&d3_geom_voronoiSetEdgeEnd(edge,rSite,lSite,vb),d3_geom_voronoiCells[lSite.i].edges.push(new d3_geom_voronoiHalfEdge(edge,lSite,rSite)),d3_geom_voronoiCells[rSite.i].edges.push(new d3_geom_voronoiHalfEdge(edge,rSite,lSite)),edge}function d3_geom_voronoiSetEdgeEnd(edge,lSite,rSite,vertex){edge.a||edge.b?edge.l===rSite?edge.b=vertex:edge.a=vertex:(edge.a=vertex,edge.l=lSite,edge.r=rSite)}function d3_geom_voronoiHalfEdge(edge,lSite,rSite){var va=edge.a,vb=edge.b;this.edge=edge,this.site=lSite,this.angle=rSite?Math.atan2(rSite.y-lSite.y,rSite.x-lSite.x):edge.l===lSite?Math.atan2(vb.x-va.x,va.y-vb.y):Math.atan2(va.x-vb.x,vb.y-va.y)}function d3_geom_voronoiRedBlackTree(){this._=null}function d3_geom_voronoiRedBlackNode(node){node.U=node.C=node.L=node.R=node.P=node.N=null}function d3_geom_voronoiRedBlackRotateLeft(tree,parent){var p=parent,q=parent.R,parent=p.U;parent?parent.L===p?parent.L=q:parent.R=q:tree._=q,q.U=parent,p.U=q,p.R=q.L,p.R&&(p.R.U=p),q.L=p}function d3_geom_voronoiRedBlackRotateRight(tree,parent){var p=parent,q=parent.L,parent=p.U;parent?parent.L===p?parent.L=q:parent.R=q:tree._=q,q.U=parent,p.U=q,p.L=q.R,p.L&&(p.L.U=p),q.R=p}function d3_geom_voronoiRedBlackFirst(node){for(;node.L;)node=node.L;return node}function d3_geom_voronoi(sites,diagram){var x0,y0,circle,site=sites.sort(d3_geom_voronoiVertexOrder).pop();for(d3_geom_voronoiEdges=[],d3_geom_voronoiCells=new Array(sites.length),d3_geom_voronoiBeaches=new d3_geom_voronoiRedBlackTree,d3_geom_voronoiCircles=new d3_geom_voronoiRedBlackTree;;)if(circle=d3_geom_voronoiFirstCircle,site&&(!circle||site.y<circle.y||site.y===circle.y&&site.x<circle.x))site.x===x0&&site.y===y0||(d3_geom_voronoiCells[site.i]=new d3_geom_voronoiCell(site),d3_geom_voronoiAddBeach(site),x0=site.x,y0=site.y),site=sites.pop();else{if(!circle)break;!function(beach){var circle=beach.circle,x=circle.x,y=circle.cy,vertex={x:x,y:y},previous=beach.P,next=beach.N,disappearing=[beach];d3_geom_voronoiDetachBeach(beach);for(var lArc=previous;lArc.circle&&abs(x-lArc.circle.x)<ε&&abs(y-lArc.circle.cy)<ε;)previous=lArc.P,disappearing.unshift(lArc),d3_geom_voronoiDetachBeach(lArc),lArc=previous;disappearing.unshift(lArc),d3_geom_voronoiDetachCircle(lArc);for(var rArc=next;rArc.circle&&abs(x-rArc.circle.x)<ε&&abs(y-rArc.circle.cy)<ε;)next=rArc.N,disappearing.push(rArc),d3_geom_voronoiDetachBeach(rArc),rArc=next;disappearing.push(rArc),d3_geom_voronoiDetachCircle(rArc);for(var nArcs=disappearing.length,iArc=1;iArc<nArcs;++iArc)rArc=disappearing[iArc],lArc=disappearing[iArc-1],d3_geom_voronoiSetEdgeEnd(rArc.edge,lArc.site,rArc.site,vertex);lArc=disappearing[0],(rArc=disappearing[nArcs-1]).edge=d3_geom_voronoiCreateEdge(lArc.site,rArc.site,null,vertex),d3_geom_voronoiAttachCircle(lArc),d3_geom_voronoiAttachCircle(rArc)}(circle.arc)}diagram&&(d3_geom_voronoiClipEdges(diagram),d3_geom_voronoiCloseCells(diagram));diagram={cells:d3_geom_voronoiCells,edges:d3_geom_voronoiEdges};return d3_geom_voronoiBeaches=d3_geom_voronoiCircles=d3_geom_voronoiEdges=d3_geom_voronoiCells=null,diagram}function d3_geom_voronoiVertexOrder(a,b){return b.y-a.y||b.x-a.x}d3_geom_voronoiCell.prototype.prepare=function(){for(var edge,halfEdges=this.edges,iHalfEdge=halfEdges.length;iHalfEdge--;)(edge=halfEdges[iHalfEdge].edge).b&&edge.a||halfEdges.splice(iHalfEdge,1);return halfEdges.sort(d3_geom_voronoiHalfEdgeOrder),halfEdges.length},d3_geom_voronoiHalfEdge.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a}},d3_geom_voronoiRedBlackTree.prototype={insert:function(after,node){var parent,grandpa,uncle;if(after){if(node.P=after,node.N=after.N,after.N&&(after.N.P=node),after.N=node,after.R){for(after=after.R;after.L;)after=after.L;after.L=node}else after.R=node;parent=after}else parent=this._?(after=d3_geom_voronoiRedBlackFirst(this._),node.P=null,(node.N=after).P=after.L=node,after):(node.P=node.N=null,this._=node,null);for(node.L=node.R=null,node.U=parent,node.C=!0,after=node;parent&&parent.C;)parent===(grandpa=parent.U).L?(uncle=grandpa.R)&&uncle.C?(parent.C=uncle.C=!1,grandpa.C=!0,after=grandpa):(after===parent.R&&(d3_geom_voronoiRedBlackRotateLeft(this,parent),parent=(after=parent).U),parent.C=!1,grandpa.C=!0,d3_geom_voronoiRedBlackRotateRight(this,grandpa)):(uncle=grandpa.L)&&uncle.C?(parent.C=uncle.C=!1,grandpa.C=!0,after=grandpa):(after===parent.L&&(d3_geom_voronoiRedBlackRotateRight(this,parent),parent=(after=parent).U),parent.C=!1,grandpa.C=!0,d3_geom_voronoiRedBlackRotateLeft(this,grandpa)),parent=after.U;this._.C=!1},remove:function(node){node.N&&(node.N.P=node.P),node.P&&(node.P.N=node.N),node.N=node.P=null;var sibling,red,parent=node.U,left=node.L,right=node.R,next=left?right?d3_geom_voronoiRedBlackFirst(right):left:right;if(parent?parent.L===node?parent.L=next:parent.R=next:this._=next,left&&right?(red=next.C,next.C=node.C,((next.L=left).U=next)!==right?(parent=next.U,next.U=node.U,node=next.R,parent.L=node,(next.R=right).U=next):(next.U=parent,node=(parent=next).R)):(red=node.C,node=next),node&&(node.U=parent),!red)if(node&&node.C)node.C=!1;else{do{if(node===this._)break;if(node===parent.L){if((sibling=parent.R).C&&(sibling.C=!1,parent.C=!0,d3_geom_voronoiRedBlackRotateLeft(this,parent),sibling=parent.R),sibling.L&&sibling.L.C||sibling.R&&sibling.R.C){sibling.R&&sibling.R.C||(sibling.L.C=!1,sibling.C=!0,d3_geom_voronoiRedBlackRotateRight(this,sibling),sibling=parent.R),sibling.C=parent.C,parent.C=sibling.R.C=!1,d3_geom_voronoiRedBlackRotateLeft(this,parent),node=this._;break}}else if((sibling=parent.L).C&&(sibling.C=!1,parent.C=!0,d3_geom_voronoiRedBlackRotateRight(this,parent),sibling=parent.L),sibling.L&&sibling.L.C||sibling.R&&sibling.R.C){sibling.L&&sibling.L.C||(sibling.R.C=!1,sibling.C=!0,d3_geom_voronoiRedBlackRotateLeft(this,sibling),sibling=parent.L),sibling.C=parent.C,parent.C=sibling.L.C=!1,d3_geom_voronoiRedBlackRotateRight(this,parent),node=this._;break}}while(sibling.C=!0,parent=(node=parent).U,!node.C);node&&(node.C=!1)}}},d3.geom.voronoi=function(points){var x=d3_geom_pointX,y=d3_geom_pointY,fx=x,fy=y,clipExtent=d3_geom_voronoiClipExtent;return points?voronoi(points):(voronoi.links=function(data){return d3_geom_voronoi(sites(data)).edges.filter(function(edge){return edge.l&&edge.r}).map(function(edge){return{source:data[edge.l.i],target:data[edge.r.i]}})},voronoi.triangles=function(data){var triangles=[];return d3_geom_voronoi(sites(data)).cells.forEach(function(cell,i){for(var s0,c,site=cell.site,edges=cell.edges.sort(d3_geom_voronoiHalfEdgeOrder),j=-1,m=edges.length,e1=edges[m-1].edge,s1=e1.l===site?e1.r:e1.l;++j<m;)s0=s1,s1=(e1=edges[j].edge).l===site?e1.r:e1.l,i<s0.i&&i<s1.i&&(c=s1,(site.x-c.x)*(s0.y-site.y)-(site.x-s0.x)*(c.y-site.y)<0)&&triangles.push([data[i],data[s0.i],data[s1.i]])}),triangles},voronoi.x=function(_){return arguments.length?(fx=d3_functor(x=_),voronoi):x},voronoi.y=function(_){return arguments.length?(fy=d3_functor(y=_),voronoi):y},voronoi.clipExtent=function(_){return arguments.length?(clipExtent=null==_?d3_geom_voronoiClipExtent:_,voronoi):clipExtent===d3_geom_voronoiClipExtent?null:clipExtent},voronoi.size=function(_){return arguments.length?voronoi.clipExtent(_&&[[0,0],_]):clipExtent===d3_geom_voronoiClipExtent?null:clipExtent&&clipExtent[1]},voronoi);function voronoi(data){var polygons=new Array(data.length),x0=clipExtent[0][0],y0=clipExtent[0][1],x1=clipExtent[1][0],y1=clipExtent[1][1];return d3_geom_voronoi(sites(data),clipExtent).cells.forEach(function(site,i){var edges=site.edges,site=site.site;(polygons[i]=edges.length?edges.map(function(s){s=s.start();return[s.x,s.y]}):site.x>=x0&&site.x<=x1&&site.y>=y0&&site.y<=y1?[[x0,y1],[x1,y1],[x1,y0],[x0,y0]]:[]).point=data[i]}),polygons}function sites(data){return data.map(function(d,i){return{x:Math.round(fx(d,i)/ε)*ε,y:Math.round(fy(d,i)/ε)*ε,i:i}})}};var d3_geom_voronoiClipExtent=[[-1e6,-1e6],[1e6,1e6]];function d3_geom_quadtreeCompatX(d){return d.x}function d3_geom_quadtreeCompatY(d){return d.y}function d3_geom_quadtreeNode(){return{leaf:!0,nodes:[],point:null,x:null,y:null}}function d3_interpolateRgb(a,b){a=d3.rgb(a),b=d3.rgb(b);var ar=a.r,ag=a.g,ab=a.b,br=b.r-ar,bg=b.g-ag,bb=b.b-ab;return function(t){return"#"+d3_rgb_hex(Math.round(ar+br*t))+d3_rgb_hex(Math.round(ag+bg*t))+d3_rgb_hex(Math.round(ab+bb*t))}}function d3_interpolateObject(a,b){var k,i={},c={};for(k in a)k in b?i[k]=d3_interpolate(a[k],b[k]):c[k]=a[k];for(k in b)k in a||(c[k]=b[k]);return function(t){for(k in i)c[k]=i[k](t);return c}}function d3_interpolateNumber(a,b){return a=+a,b=+b,function(t){return a*(1-t)+b*t}}function d3_interpolateString(a,b){var am,bm,bs,bi=d3_interpolate_numberA.lastIndex=d3_interpolate_numberB.lastIndex=0,i=-1,s=[],q=[];for(a+="",b+="";(am=d3_interpolate_numberA.exec(a))&&(bm=d3_interpolate_numberB.exec(b));)(bs=bm.index)>bi&&(bs=b.slice(bi,bs),s[i]?s[i]+=bs:s[++i]=bs),(am=am[0])===(bm=bm[0])?s[i]?s[i]+=bm:s[++i]=bm:(s[++i]=null,q.push({i:i,x:d3_interpolateNumber(am,bm)})),bi=d3_interpolate_numberB.lastIndex;return bi<b.length&&(bs=b.slice(bi),s[i]?s[i]+=bs:s[++i]=bs),s.length<2?q[0]?(b=q[0].x,function(t){return b(t)+""}):function(){return b}:(b=q.length,function(t){for(var o,i=0;i<b;++i)s[(o=q[i]).i]=o.x(t);return s.join("")})}d3.geom.delaunay=function(vertices){return d3.geom.voronoi().triangles(vertices)},d3.geom.quadtree=function(points,x1,y1,x2,y2){var compat,x=d3_geom_pointX,y=d3_geom_pointY;return(compat=arguments.length)?(x=d3_geom_quadtreeCompatX,y=d3_geom_quadtreeCompatY,3===compat&&(y2=y1,x2=x1,y1=x1=0),quadtree(points)):(quadtree.x=function(_){return arguments.length?(x=_,quadtree):x},quadtree.y=function(_){return arguments.length?(y=_,quadtree):y},quadtree.extent=function(_){return arguments.length?(null==_?x1=y1=x2=y2=null:(x1=+_[0][0],y1=+_[0][1],x2=+_[1][0],y2=+_[1][1]),quadtree):null==x1?null:[[x1,y1],[x2,y2]]},quadtree.size=function(_){return arguments.length?(null==_?x1=y1=x2=y2=null:(x1=y1=0,x2=+_[0],y2=+_[1]),quadtree):null==x1?null:[x2-x1,y2-y1]},quadtree);function quadtree(data){var d,xs,ys,i,n,x1_,y1_,x2_,y2_,fx=d3_functor(x),fy=d3_functor(y);if(null!=x1)x1_=x1,y1_=y1,x2_=x2,y2_=y2;else if(x2_=y2_=-(x1_=y1_=1/0),xs=[],ys=[],n=data.length,compat)for(i=0;i<n;++i)(d=data[i]).x<x1_&&(x1_=d.x),d.y<y1_&&(y1_=d.y),d.x>x2_&&(x2_=d.x),d.y>y2_&&(y2_=d.y),xs.push(d.x),ys.push(d.y);else for(i=0;i<n;++i){var x_=+fx(d=data[i],i),y_=+fy(d,i);x_<x1_&&(x1_=x_),y_<y1_&&(y1_=y_),x2_<x_&&(x2_=x_),y2_<y_&&(y2_=y_),xs.push(x_),ys.push(y_)}var dx=x2_-x1_,dy=y2_-y1_;function insert(n,d,x,y,x1,y1,x2,y2){var nx,ny,nPoint;isNaN(x)||isNaN(y)||(n.leaf?(nx=n.x,ny=n.y,null!=nx?(abs(nx-x)+abs(ny-y)<.01||(nPoint=n.point,n.x=n.y=n.point=null,insertChild(n,nPoint,nx,ny,x1,y1,x2,y2)),insertChild(n,d,x,y,x1,y1,x2,y2)):(n.x=x,n.y=y,n.point=d)):insertChild(n,d,x,y,x1,y1,x2,y2))}function insertChild(n,d,x,y,x1,y1,x2,y2){var xm=.5*(x1+x2),ym=.5*(y1+y2),right=xm<=x,below=ym<=y,i=below<<1|right;n.leaf=!1,right?x1=xm:x2=xm,below?y1=ym:y2=ym,insert(n=n.nodes[i]||(n.nodes[i]=d3_geom_quadtreeNode()),d,x,y,x1,y1,x2,y2)}dy<dx?y2_=y1_+dx:x2_=x1_+dy;var root=d3_geom_quadtreeNode();if(root.add=function(d){insert(root,d,+fx(d,++i),+fy(d,i),x1_,y1_,x2_,y2_)},root.visit=function(f){!function d3_geom_quadtreeVisit(f,children,x1,y1,x2,y2){{var sx,sy;f(children,x1,y1,x2,y2)||(sx=.5*(x1+x2),sy=.5*(y1+y2),(children=children.nodes)[0]&&d3_geom_quadtreeVisit(f,children[0],x1,y1,sx,sy),children[1]&&d3_geom_quadtreeVisit(f,children[1],sx,y1,x2,sy),children[2]&&d3_geom_quadtreeVisit(f,children[2],x1,sy,sx,y2),children[3]&&d3_geom_quadtreeVisit(f,children[3],sx,sy,x2,y2))}}(f,root,x1_,y1_,x2_,y2_)},root.find=function(point){return function(root,x,y,x0,y0,x3,y3){var closestPoint,minDistance2=1/0;return function find(node,x1,y1,x2,y2){if(!(x3<x1||y3<y1||x2<x0||y2<y0)){var point,distance;!(point=node.point)||(distance=(distance=x-node.x)*distance+(distance=y-node.y)*distance)<minDistance2&&(distance=Math.sqrt(minDistance2=distance),x0=x-distance,y0=y-distance,x3=x+distance,y3=y+distance,closestPoint=point);for(var children=node.nodes,xm=.5*(x1+x2),ym=.5*(y1+y2),i=(ym<=y)<<1|xm<=x,j=i+4;i<j;++i)if(node=children[3&i])switch(3&i){case 0:find(node,x1,y1,xm,ym);break;case 1:find(node,xm,y1,x2,ym);break;case 2:find(node,x1,ym,xm,y2);break;case 3:find(node,xm,ym,x2,y2)}}}(root,x0,y0,x3,y3),closestPoint}(root,point[0],point[1],x1_,y1_,x2_,y2_)},i=-1,null==x1){for(;++i<n;)insert(root,data[i],xs[i],ys[i],x1_,y1_,x2_,y2_);--i}else data.forEach(root.add);return xs=ys=data=d=null,root}},d3.interpolateRgb=d3_interpolateRgb,d3.interpolateObject=d3_interpolateObject,d3.interpolateNumber=d3_interpolateNumber,d3.interpolateString=d3_interpolateString;var d3_interpolate_numberA=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,d3_interpolate_numberB=new RegExp(d3_interpolate_numberA.source,"g");function d3_interpolate(a,b){for(var f,i=d3.interpolators.length;0<=--i&&!(f=d3.interpolators[i](a,b)););return f}function d3_interpolateArray(a,b){for(var x=[],c=[],na=a.length,nb=b.length,n0=Math.min(a.length,b.length),i=0;i<n0;++i)x.push(d3_interpolate(a[i],b[i]));for(;i<na;++i)c[i]=a[i];for(;i<nb;++i)c[i]=b[i];return function(t){for(i=0;i<n0;++i)c[i]=x[i](t);return c}}d3.interpolate=d3_interpolate,d3.interpolators=[function(a,b){var t=typeof b;return("string"==t?d3_rgb_names.has(b.toLowerCase())||/^(#|rgb\(|hsl\()/i.test(b)?d3_interpolateRgb:d3_interpolateString:b instanceof d3_color?d3_interpolateRgb:Array.isArray(b)?d3_interpolateArray:"object"==t&&isNaN(b)?d3_interpolateObject:d3_interpolateNumber)(a,b)}],d3.interpolateArray=d3_interpolateArray;function d3_ease_default(){return d3_identity}var d3_ease=d3.map({linear:d3_ease_default,poly:function(e){return function(t){return Math.pow(t,e)}},quad:function(){return d3_ease_quad},cubic:function(){return d3_ease_cubic},sin:function(){return d3_ease_sin},exp:function(){return d3_ease_exp},circle:function(){return d3_ease_circle},elastic:function(a,p){var s;arguments.length<2&&(p=.45);s=arguments.length?p/τ*Math.asin(1/a):(a=1,p/4);return function(t){return 1+a*Math.pow(2,-10*t)*Math.sin((t-s)*τ/p)}},back:function(s){s=s||1.70158;return function(t){return t*t*((s+1)*t-s)}},bounce:function(){return d3_ease_bounce}}),d3_ease_mode=d3.map({in:d3_identity,out:d3_ease_reverse,"in-out":d3_ease_reflect,"out-in":function(f){return d3_ease_reflect(d3_ease_reverse(f))}});function d3_ease_reverse(f){return function(t){return 1-f(1-t)}}function d3_ease_reflect(f){return function(t){return.5*(t<.5?f(2*t):2-f(2-2*t))}}function d3_ease_quad(t){return t*t}function d3_ease_cubic(t){return t*t*t}function d3_ease_cubicInOut(t){if(t<=0)return 0;if(1<=t)return 1;var t2=t*t,t3=t2*t;return 4*(t<.5?t3:3*(t-t2)+t3-.75)}function d3_ease_sin(t){return 1-Math.cos(t*halfπ)}function d3_ease_exp(t){return Math.pow(2,10*(t-1))}function d3_ease_circle(t){return 1-Math.sqrt(1-t*t)}function d3_ease_bounce(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}function d3_interpolateRound(a,b){return b-=a,function(t){return Math.round(a+b*t)}}function d3_transform(m){var ky,b,k,r0=[m.a,m.b],r1=[m.c,m.d],kx=d3_transformNormalize(r0),kz=d3_transformDot(r0,r1),ky=d3_transformNormalize(((ky=r1)[0]+=(k=-kz)*(b=r0)[0],ky[1]+=k*b[1],ky))||0;r0[0]*r1[1]<r1[0]*r0[1]&&(r0[0]*=-1,r0[1]*=-1,kx*=-1,kz*=-1),this.rotate=(kx?Math.atan2(r0[1],r0[0]):Math.atan2(-r1[0],r1[1]))*d3_degrees,this.translate=[m.e,m.f],this.scale=[kx,ky],this.skew=ky?Math.atan2(kz,ky)*d3_degrees:0}function d3_transformDot(a,b){return a[0]*b[0]+a[1]*b[1]}function d3_transformNormalize(a){var k=Math.sqrt(d3_transformDot(a,a));return k&&(a[0]/=k,a[1]/=k),k}d3.ease=function(name){var f,m=name.indexOf("-"),t=0<=m?name.slice(0,m):name,m=0<=m?name.slice(m+1):"in",t=d3_ease.get(t)||d3_ease_default,m=d3_ease_mode.get(m)||d3_identity;return f=m(t.apply(null,d3_arraySlice.call(arguments,1))),function(t){return t<=0?0:1<=t?1:f(t)}},d3.interpolateHcl=function(a,b){a=d3.hcl(a),b=d3.hcl(b);var ah=a.h,ac=a.c,al=a.l,bh=b.h-ah,bc=b.c-ac,bl=b.l-al;isNaN(bc)&&(bc=0,ac=isNaN(ac)?b.c:ac);isNaN(bh)?(bh=0,ah=isNaN(ah)?b.h:ah):180<bh?bh-=360:bh<-180&&(bh+=360);return function(t){return d3_hcl_lab(ah+bh*t,ac+bc*t,al+bl*t)+""}},d3.interpolateHsl=function(a,b){a=d3.hsl(a),b=d3.hsl(b);var ah=a.h,as=a.s,al=a.l,bh=b.h-ah,bs=b.s-as,bl=b.l-al;isNaN(bs)&&(bs=0,as=isNaN(as)?b.s:as);isNaN(bh)?(bh=0,ah=isNaN(ah)?b.h:ah):180<bh?bh-=360:bh<-180&&(bh+=360);return function(t){return d3_hsl_rgb(ah+bh*t,as+bs*t,al+bl*t)+""}},d3.interpolateLab=function(a,b){a=d3.lab(a),b=d3.lab(b);var al=a.l,aa=a.a,ab=a.b,bl=b.l-al,ba=b.a-aa,bb=b.b-ab;return function(t){return d3_lab_rgb(al+bl*t,aa+ba*t,ab+bb*t)+""}},d3.interpolateRound=d3_interpolateRound,d3.transform=function(string){var g=d3_document.createElementNS(d3.ns.prefix.svg,"g");return(d3.transform=function(string){var t;return null!=string&&(g.setAttribute("transform",string),t=g.transform.baseVal.consolidate()),new d3_transform(t?t.matrix:d3_transformIdentity)})(string)},d3_transform.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};var d3_transformIdentity={a:1,b:0,c:0,d:1,e:0,f:0};function d3_interpolateTransformPop(s){return s.length?s.pop()+",":""}function d3_interpolateTransform(a,b){var s=[],q=[];return a=d3.transform(a),b=d3.transform(b),function(ta,tb,s,q){var i;ta[0]!==tb[0]||ta[1]!==tb[1]?(i=s.push("translate(",null,",",null,")"),q.push({i:i-4,x:d3_interpolateNumber(ta[0],tb[0])},{i:i-2,x:d3_interpolateNumber(ta[1],tb[1])})):(tb[0]||tb[1])&&s.push("translate("+tb+")")}(a.translate,b.translate,s,q),function(ra,rb,s,q){ra!==rb?(180<ra-rb?rb+=360:180<rb-ra&&(ra+=360),q.push({i:s.push(d3_interpolateTransformPop(s)+"rotate(",null,")")-2,x:d3_interpolateNumber(ra,rb)})):rb&&s.push(d3_interpolateTransformPop(s)+"rotate("+rb+")")}(a.rotate,b.rotate,s,q),function(wa,wb,s,q){wa!==wb?q.push({i:s.push(d3_interpolateTransformPop(s)+"skewX(",null,")")-2,x:d3_interpolateNumber(wa,wb)}):wb&&s.push(d3_interpolateTransformPop(s)+"skewX("+wb+")")}(a.skew,b.skew,s,q),function(ka,kb,s,q){var i;ka[0]!==kb[0]||ka[1]!==kb[1]?(i=s.push(d3_interpolateTransformPop(s)+"scale(",null,",",null,")"),q.push({i:i-4,x:d3_interpolateNumber(ka[0],kb[0])},{i:i-2,x:d3_interpolateNumber(ka[1],kb[1])})):1===kb[0]&&1===kb[1]||s.push(d3_interpolateTransformPop(s)+"scale("+kb+")")}(a.scale,b.scale,s,q),a=b=null,function(t){for(var o,i=-1,n=q.length;++i<n;)s[(o=q[i]).i]=o.x(t);return s.join("")}}function d3_uninterpolateNumber(a,b){return b=(b-=a=+a)||1/b,function(x){return(x-a)/b}}function d3_uninterpolateClamp(a,b){return b=(b-=a=+a)||1/b,function(x){return Math.max(0,Math.min(1,(x-a)/b))}}function d3_layout_bundleAncestors(node){for(var ancestors=[],parent=node.parent;null!=parent;)ancestors.push(node),parent=(node=parent).parent;return ancestors.push(node),ancestors}function d3_layout_forceDragstart(d){d.fixed|=2}function d3_layout_forceDragend(d){d.fixed&=-7}function d3_layout_forceMouseover(d){d.fixed|=4,d.px=d.x,d.py=d.y}function d3_layout_forceMouseout(d){d.fixed&=-5}d3.interpolateTransform=d3_interpolateTransform,d3.layout={},d3.layout.bundle=function(){return function(links){for(var paths=[],i=-1,n=links.length;++i<n;)paths.push(function(link){var start=link.source,end=link.target,lca=function(a,b){if(a===b)return a;var aNodes=d3_layout_bundleAncestors(a),bNodes=d3_layout_bundleAncestors(b),aNode=aNodes.pop(),bNode=bNodes.pop(),sharedNode=null;for(;aNode===bNode;)sharedNode=aNode,aNode=aNodes.pop(),bNode=bNodes.pop();return sharedNode}(start,end),points=[start];for(;start!==lca;)start=start.parent,points.push(start);var k=points.length;for(;end!==lca;)points.splice(k,0,end),end=end.parent;return points}(links[i]));return paths}},d3.layout.chord=function(){var chords,groups,matrix,n,sortGroups,sortSubgroups,sortChords,chord={},padding=0;function relayout(){var k,x,x0,i,j,subgroups={},groupSums=[],groupIndex=d3.range(n),subgroupIndex=[];for(chords=[],groups=[],k=0,i=-1;++i<n;){for(x=0,j=-1;++j<n;)x+=matrix[i][j];groupSums.push(x),subgroupIndex.push(d3.range(n)),k+=x}for(sortGroups&&groupIndex.sort(function(a,b){return sortGroups(groupSums[a],groupSums[b])}),sortSubgroups&&subgroupIndex.forEach(function(d,i){d.sort(function(a,b){return sortSubgroups(matrix[i][a],matrix[i][b])})}),k=(τ-padding*n)/k,x=0,i=-1;++i<n;){for(x0=x,j=-1;++j<n;){var di=groupIndex[i],dj=subgroupIndex[di][j],v=matrix[di][dj],a0=x,a1=x+=v*k;subgroups[di+"-"+dj]={index:di,subindex:dj,startAngle:a0,endAngle:a1,value:v}}groups[di]={index:di,startAngle:x0,endAngle:x,value:groupSums[di]},x+=padding}for(i=-1;++i<n;)for(j=i-1;++j<n;){var source=subgroups[i+"-"+j],target=subgroups[j+"-"+i];(source.value||target.value)&&chords.push(source.value<target.value?{source:target,target:source}:{source:source,target:target})}sortChords&&resort()}function resort(){chords.sort(function(a,b){return sortChords((a.source.value+a.target.value)/2,(b.source.value+b.target.value)/2)})}return chord.matrix=function(x){return arguments.length?(n=(matrix=x)&&matrix.length,chords=groups=null,chord):matrix},chord.padding=function(x){return arguments.length?(padding=x,chords=groups=null,chord):padding},chord.sortGroups=function(x){return arguments.length?(sortGroups=x,chords=groups=null,chord):sortGroups},chord.sortSubgroups=function(x){return arguments.length?(sortSubgroups=x,chords=null,chord):sortSubgroups},chord.sortChords=function(x){return arguments.length?(sortChords=x,chords&&resort(),chord):sortChords},chord.chords=function(){return chords||relayout(),chords},chord.groups=function(){return groups||relayout(),groups},chord},d3.layout.force=function(){var timer,drag,alpha,distances,strengths,charges,force={},event=d3.dispatch("start","tick","end"),size=[1,1],friction=.9,linkDistance=d3_layout_forceLinkDistance,linkStrength=d3_layout_forceLinkStrength,charge=-30,chargeDistance2=d3_layout_forceChargeDistance2,gravity=.1,theta2=.64,nodes=[],links=[];function dragmove(d){d.px=d3.event.x,d.py=d3.event.y,force.resume()}return force.tick=function(){if((alpha*=.99)<.005)return timer=null,event.end({type:"end",alpha:alpha=0}),!0;for(var q,o,s,t,l,k,x,y,n=nodes.length,m=links.length,i=0;i<m;++i)s=(o=links[i]).source,(l=(x=(t=o.target).x-s.x)*x+(y=t.y-s.y)*y)&&(x*=l=alpha*strengths[i]*((l=Math.sqrt(l))-distances[i])/l,y*=l,t.x-=x*(k=s.weight+t.weight?s.weight/(s.weight+t.weight):.5),t.y-=y*k,s.x+=x*(k=1-k),s.y+=y*k);if((k=alpha*gravity)&&(x=size[0]/2,y=size[1]/2,i=-1,k))for(;++i<n;)(o=nodes[i]).x+=(x-o.x)*k,o.y+=(y-o.y)*k;if(charge)for(!function d3_layout_forceAccumulate(quad,alpha,charges){var cx=0,cy=0;quad.charge=0;if(!quad.leaf)for(var c,nodes=quad.nodes,n=nodes.length,i=-1;++i<n;)null!=(c=nodes[i])&&(d3_layout_forceAccumulate(c,alpha,charges),quad.charge+=c.charge,cx+=c.charge*c.cx,cy+=c.charge*c.cy);{var k;quad.point&&(quad.leaf||(quad.point.x+=Math.random()-.5,quad.point.y+=Math.random()-.5),k=alpha*charges[quad.point.index],quad.charge+=quad.pointCharge=k,cx+=k*quad.point.x,cy+=k*quad.point.y)}quad.cx=cx/quad.charge;quad.cy=cy/quad.charge}(q=d3.geom.quadtree(nodes),alpha,charges),i=-1;++i<n;)(o=nodes[i]).fixed||q.visit(function(node){return function(quad,dn,_,dw){if(quad.point!==node){var k,dx=quad.cx-node.x,dy=quad.cy-node.y,dw=dw-dn,dn=dx*dx+dy*dy;if(dw*dw/theta2<dn)return dn<chargeDistance2&&(k=quad.charge/dn,node.px-=dx*k,node.py-=dy*k),!0;quad.point&&dn&&dn<chargeDistance2&&(k=quad.pointCharge/dn,node.px-=dx*k,node.py-=dy*k)}return!quad.charge}}(o));for(i=-1;++i<n;)(o=nodes[i]).fixed?(o.x=o.px,o.y=o.py):(o.x-=(o.px-(o.px=o.x))*friction,o.y-=(o.py-(o.py=o.y))*friction);event.tick({type:"tick",alpha:alpha})},force.nodes=function(x){return arguments.length?(nodes=x,force):nodes},force.links=function(x){return arguments.length?(links=x,force):links},force.size=function(x){return arguments.length?(size=x,force):size},force.linkDistance=function(x){return arguments.length?(linkDistance="function"==typeof x?x:+x,force):linkDistance},force.distance=force.linkDistance,force.linkStrength=function(x){return arguments.length?(linkStrength="function"==typeof x?x:+x,force):linkStrength},force.friction=function(x){return arguments.length?(friction=+x,force):friction},force.charge=function(x){return arguments.length?(charge="function"==typeof x?x:+x,force):charge},force.chargeDistance=function(x){return arguments.length?(chargeDistance2=x*x,force):Math.sqrt(chargeDistance2)},force.gravity=function(x){return arguments.length?(gravity=+x,force):gravity},force.theta=function(x){return arguments.length?(theta2=x*x,force):Math.sqrt(theta2)},force.alpha=function(x){return arguments.length?(x=+x,alpha?0<x?alpha=x:(timer.c=null,timer.t=NaN,timer=null,event.end({type:"end",alpha:alpha=0})):0<x&&(event.start({type:"start",alpha:alpha=x}),timer=d3_timer(force.tick)),force):alpha},force.start=function(){for(var neighbors,o,n=nodes.length,m=links.length,w=size[0],h=size[1],i=0;i<n;++i)(o=nodes[i]).index=i,o.weight=0;for(i=0;i<m;++i)"number"==typeof(o=links[i]).source&&(o.source=nodes[o.source]),"number"==typeof o.target&&(o.target=nodes[o.target]),++o.source.weight,++o.target.weight;for(i=0;i<n;++i)o=nodes[i],isNaN(o.x)&&(o.x=position("x",w)),isNaN(o.y)&&(o.y=position("y",h)),isNaN(o.px)&&(o.px=o.x),isNaN(o.py)&&(o.py=o.y);if(distances=[],"function"==typeof linkDistance)for(i=0;i<m;++i)distances[i]=+linkDistance.call(this,links[i],i);else for(i=0;i<m;++i)distances[i]=linkDistance;if(strengths=[],"function"==typeof linkStrength)for(i=0;i<m;++i)strengths[i]=+linkStrength.call(this,links[i],i);else for(i=0;i<m;++i)strengths[i]=linkStrength;if(charges=[],"function"==typeof charge)for(i=0;i<n;++i)charges[i]=+charge.call(this,nodes[i],i);else for(i=0;i<n;++i)charges[i]=charge;function position(dimension,size){if(!neighbors){for(neighbors=new Array(n),j=0;j<n;++j)neighbors[j]=[];for(j=0;j<m;++j){var o=links[j];neighbors[o.source.index].push(o.target),neighbors[o.target.index].push(o.source)}}for(var x,candidates=neighbors[i],j=-1,l=candidates.length;++j<l;)if(!isNaN(x=candidates[j][dimension]))return x;return Math.random()*size}return force.resume()},force.resume=function(){return force.alpha(.1)},force.stop=function(){return force.alpha(0)},force.drag=function(){if(drag=drag||d3.behavior.drag().origin(d3_identity).on("dragstart.force",d3_layout_forceDragstart).on("drag.force",dragmove).on("dragend.force",d3_layout_forceDragend),!arguments.length)return drag;this.on("mouseover.force",d3_layout_forceMouseover).on("mouseout.force",d3_layout_forceMouseout).call(drag)},d3.rebind(force,event,"on")};var d3_layout_forceLinkDistance=20,d3_layout_forceLinkStrength=1,d3_layout_forceChargeDistance2=1/0;function d3_layout_hierarchyRebind(object,hierarchy){return d3.rebind(object,hierarchy,"sort","children","value"),(object.nodes=object).links=d3_layout_hierarchyLinks,object}function d3_layout_hierarchyVisitBefore(node,callback){for(var n,children,nodes=[node];null!=(node=nodes.pop());)if(callback(node),(children=node.children)&&(n=children.length))for(;0<=--n;)nodes.push(children[n])}function d3_layout_hierarchyVisitAfter(node,callback){for(var nodes=[node],nodes2=[];null!=(node=nodes.pop());)if(nodes2.push(node),(children=node.children)&&(n=children.length))for(var n,children,i=-1;++i<n;)nodes.push(children[i]);for(;null!=(node=nodes2.pop());)callback(node)}function d3_layout_hierarchyChildren(d){return d.children}function d3_layout_hierarchyValue(d){return d.value}function d3_layout_hierarchySort(a,b){return b.value-a.value}function d3_layout_hierarchyLinks(nodes){return d3.merge(nodes.map(function(parent){return(parent.children||[]).map(function(child){return{source:parent,target:child}})}))}d3.layout.hierarchy=function(){var sort=d3_layout_hierarchySort,children=d3_layout_hierarchyChildren,value=d3_layout_hierarchyValue;function hierarchy(root){var node,n,childs,child,stack=[root],nodes=[];for(root.depth=0;null!=(node=stack.pop());)if(nodes.push(node),(childs=children.call(hierarchy,node,node.depth))&&(n=childs.length)){for(;0<=--n;)stack.push(child=childs[n]),child.parent=node,child.depth=node.depth+1;value&&(node.value=0),node.children=childs}else value&&(node.value=+value.call(hierarchy,node,node.depth)||0),delete node.children;return d3_layout_hierarchyVisitAfter(root,function(node){var childs,parent;sort&&(childs=node.children)&&childs.sort(sort),value&&(parent=node.parent)&&(parent.value+=node.value)}),nodes}return hierarchy.sort=function(x){return arguments.length?(sort=x,hierarchy):sort},hierarchy.children=function(x){return arguments.length?(children=x,hierarchy):children},hierarchy.value=function(x){return arguments.length?(value=x,hierarchy):value},hierarchy.revalue=function(root){return value&&(d3_layout_hierarchyVisitBefore(root,function(node){node.children&&(node.value=0)}),d3_layout_hierarchyVisitAfter(root,function(node){var parent;node.children||(node.value=+value.call(hierarchy,node,node.depth)||0),(parent=node.parent)&&(parent.value+=node.value)})),root},hierarchy},d3.layout.partition=function(){var hierarchy=d3.layout.hierarchy(),size=[1,1];function partition(d,nodes){nodes=hierarchy.call(this,d,nodes);return function position(node,x,dx,dy){var children=node.children;if(node.x=x,node.y=node.depth*dy,node.dx=dx,node.dy=dy,children&&(n=children.length)){var n,d,i=-1;for(dx=node.value?dx/node.value:0;++i<n;)position(d=children[i],x,d=d.value*dx,dy),x+=d}}(nodes[0],0,size[0],size[1]/function depth(node){var children=node.children,d=0;if(children&&(n=children.length))for(var n,i=-1;++i<n;)d=Math.max(d,depth(children[i]));return 1+d}(nodes[0])),nodes}return partition.size=function(x){return arguments.length?(size=x,partition):size},d3_layout_hierarchyRebind(partition,hierarchy)},d3.layout.pie=function(){var value=Number,sort=d3_layout_pieSortByValue,startAngle=0,endAngle=τ,padAngle=0;function pie(data){var v,index=data.length,values=data.map(function(d,i){return+value.call(pie,d,i)}),a=+("function"==typeof startAngle?startAngle.apply(this,arguments):startAngle),da=("function"==typeof endAngle?endAngle.apply(this,arguments):endAngle)-a,p=Math.min(Math.abs(da)/index,+("function"==typeof padAngle?padAngle.apply(this,arguments):padAngle)),pa=p*(da<0?-1:1),sum=d3.sum(values),k=sum?(da-index*pa)/sum:0,index=d3.range(index),arcs=[];return null!=sort&&index.sort(sort===d3_layout_pieSortByValue?function(i,j){return values[j]-values[i]}:function(i,j){return sort(data[i],data[j])}),index.forEach(function(i){arcs[i]={data:data[i],value:v=values[i],startAngle:a,endAngle:a+=v*k+pa,padAngle:p}}),arcs}return pie.value=function(_){return arguments.length?(value=_,pie):value},pie.sort=function(_){return arguments.length?(sort=_,pie):sort},pie.startAngle=function(_){return arguments.length?(startAngle=_,pie):startAngle},pie.endAngle=function(_){return arguments.length?(endAngle=_,pie):endAngle},pie.padAngle=function(_){return arguments.length?(padAngle=_,pie):padAngle},pie};var d3_layout_pieSortByValue={};function d3_layout_stackX(d){return d.x}function d3_layout_stackY(d){return d.y}function d3_layout_stackOut(d,y0,y){d.y0=y0,d.y=y}d3.layout.stack=function(){var values=d3_identity,order=d3_layout_stackOrderDefault,offset=d3_layout_stackOffsetZero,out=d3_layout_stackOut,x=d3_layout_stackX,y=d3_layout_stackY;function stack(data,index){if(!(n=data.length))return data;for(var n,i,o,points=(series=data.map(function(d,i){return values.call(stack,d,i)})).map(function(d){return d.map(function(v,i){return[x.call(stack,v,i),y.call(stack,v,i)]})}),orders=order.call(stack,points,index),series=d3.permute(series,orders),points=d3.permute(points,orders),offsets=offset.call(stack,points,index),m=series[0].length,j=0;j<m;++j)for(out.call(stack,series[0][j],o=offsets[j],points[0][j][1]),i=1;i<n;++i)out.call(stack,series[i][j],o+=points[i-1][j][1],points[i][j][1]);return data}return stack.values=function(x){return arguments.length?(values=x,stack):values},stack.order=function(x){return arguments.length?(order="function"==typeof x?x:d3_layout_stackOrders.get(x)||d3_layout_stackOrderDefault,stack):order},stack.offset=function(x){return arguments.length?(offset="function"==typeof x?x:d3_layout_stackOffsets.get(x)||d3_layout_stackOffsetZero,stack):offset},stack.x=function(z){return arguments.length?(x=z,stack):x},stack.y=function(z){return arguments.length?(y=z,stack):y},stack.out=function(z){return arguments.length?(out=z,stack):out},stack};var d3_layout_stackOrders=d3.map({"inside-out":function(data){for(var j,n=data.length,max=data.map(d3_layout_stackMaxIndex),sums=data.map(d3_layout_stackReduceSum),index=d3.range(n).sort(function(a,b){return max[a]-max[b]}),top=0,bottom=0,tops=[],bottoms=[],i=0;i<n;++i)j=index[i],top<bottom?(top+=sums[j],tops.push(j)):(bottom+=sums[j],bottoms.push(j));return bottoms.reverse().concat(tops)},reverse:function(data){return d3.range(data.length).reverse()},default:d3_layout_stackOrderDefault}),d3_layout_stackOffsets=d3.map({silhouette:function(data){for(var i,o,n=data.length,m=data[0].length,sums=[],max=0,y0=[],j=0;j<m;++j){for(o=i=0;i<n;i++)o+=data[i][j][1];max<o&&(max=o),sums.push(o)}for(j=0;j<m;++j)y0[j]=(max-sums[j])/2;return y0},wiggle:function(data){var i,j,k,s1,s2,s3,dx,o,o0,n=data.length,x=data[0],m=x.length,y0=[];for(y0[0]=o=o0=0,j=1;j<m;++j){for(s1=i=0;i<n;++i)s1+=data[i][j][1];for(dx=x[j][s2=i=0]-x[j-1][0];i<n;++i){for(k=0,s3=(data[i][j][1]-data[i][j-1][1])/(2*dx);k<i;++k)s3+=(data[k][j][1]-data[k][j-1][1])/dx;s2+=s3*data[i][j][1]}y0[j]=o-=s1?s2/s1*dx:0,o<o0&&(o0=o)}for(j=0;j<m;++j)y0[j]-=o0;return y0},expand:function(data){for(var i,o,n=data.length,m=data[0].length,k=1/n,y0=[],j=0;j<m;++j){for(o=i=0;i<n;i++)o+=data[i][j][1];if(o)for(i=0;i<n;i++)data[i][j][1]/=o;else for(i=0;i<n;i++)data[i][j][1]=k}for(j=0;j<m;++j)y0[j]=0;return y0},zero:d3_layout_stackOffsetZero});function d3_layout_stackOrderDefault(data){return d3.range(data.length)}function d3_layout_stackOffsetZero(data){for(var j=-1,m=data[0].length,y0=[];++j<m;)y0[j]=0;return y0}function d3_layout_stackMaxIndex(array){for(var k,i=1,j=0,v=array[0][1],n=array.length;i<n;++i)(k=array[i][1])>v&&(j=i,v=k);return j}function d3_layout_stackReduceSum(d){return d.reduce(d3_layout_stackSum,0)}function d3_layout_stackSum(p,d){return p+d[1]}function d3_layout_histogramBinSturges(range,values){return d3_layout_histogramBinFixed(range,Math.ceil(Math.log(values.length)/Math.LN2+1))}function d3_layout_histogramBinFixed(range,n){for(var x=-1,b=+range[0],m=(range[1]-b)/n,f=[];++x<=n;)f[x]=m*x+b;return f}function d3_layout_histogramRange(values){return[d3.min(values),d3.max(values)]}function d3_layout_packSort(a,b){return a.value-b.value}function d3_layout_packInsert(a,b){var c=a._pack_next;(a._pack_next=b)._pack_prev=a,(b._pack_next=c)._pack_prev=b}function d3_layout_packSplice(a,b){(a._pack_next=b)._pack_prev=a}function d3_layout_packIntersects(a,dr){var dx=dr.x-a.x,dy=dr.y-a.y,dr=a.r+dr.r;return dx*dx+dy*dy<.999*dr*dr}function d3_layout_packSiblings(node){if((nodes=node.children)&&(n=nodes.length)){var nodes,a,b,c,k,n,xMin=1/0,xMax=-1/0,yMin=1/0,yMax=-1/0;if(nodes.forEach(d3_layout_packLink),(a=nodes[0]).x=-a.r,a.y=0,bound(a),1<n&&((b=nodes[1]).x=b.r,b.y=0,bound(b),2<n))for(d3_layout_packPlace(a,b,c=nodes[2]),bound(c),d3_layout_packInsert(a,c),a._pack_prev=c,d3_layout_packInsert(c,b),b=a._pack_next,i=3;i<n;i++){d3_layout_packPlace(a,b,c=nodes[i]);for(var isect=0,s1=1,s2=1,j=b._pack_next;j!==b;j=j._pack_next,s1++)if(d3_layout_packIntersects(j,c)){isect=1;break}if(1==isect)for(k=a._pack_prev;k!==j._pack_prev&&!d3_layout_packIntersects(k,c);k=k._pack_prev,s2++);isect?(s1<s2||s1==s2&&b.r<a.r?d3_layout_packSplice(a,b=j):d3_layout_packSplice(a=k,b),i--):(d3_layout_packInsert(a,c),bound(b=c))}for(var cx=(xMin+xMax)/2,cy=(yMin+yMax)/2,cr=0,i=0;i<n;i++)(c=nodes[i]).x-=cx,c.y-=cy,cr=Math.max(cr,c.r+Math.sqrt(c.x*c.x+c.y*c.y));node.r=cr,nodes.forEach(d3_layout_packUnlink)}function bound(node){xMin=Math.min(node.x-node.r,xMin),xMax=Math.max(node.x+node.r,xMax),yMin=Math.min(node.y-node.r,yMin),yMax=Math.max(node.y+node.r,yMax)}}function d3_layout_packLink(node){node._pack_next=node._pack_prev=node}function d3_layout_packUnlink(node){delete node._pack_next,delete node._pack_prev}function d3_layout_packPlace(a,x,c){var da,y,db=a.r+c.r,dx=x.x-a.x,dy=x.y-a.y;db&&(dx||dy)?(da=x.r+c.r,x=.5+((db*=db)-(da*=da))/(2*(y=dx*dx+dy*dy)),y=Math.sqrt(Math.max(0,2*da*(db+y)-(db-=y)*db-da*da))/(2*y),c.x=a.x+x*dx+y*dy,c.y=a.y+x*dy-y*dx):(c.x=a.x+db,c.y=a.y)}function d3_layout_treeSeparation(a,b){return a.parent==b.parent?1:2}function d3_layout_treeLeft(v){var children=v.children;return children.length?children[0]:v.t}function d3_layout_treeRight(v){var n,children=v.children;return(n=children.length)?children[n-1]:v.t}function d3_layout_treemapPadNull(node){return{x:node.x,y:node.y,dx:node.dx,dy:node.dy}}function d3_layout_treemapPad(node,dy){var x=node.x+dy[3],y=node.y+dy[0],dx=node.dx-dy[1]-dy[3],dy=node.dy-dy[0]-dy[2];return dx<0&&(x+=dx/2,dx=0),dy<0&&(y+=dy/2,dy=0),{x:x,y:y,dx:dx,dy:dy}}function d3_scaleExtent(stop){var start=stop[0],stop=stop[stop.length-1];return start<stop?[start,stop]:[stop,start]}function d3_scaleRange(scale){return scale.rangeExtent?scale.rangeExtent():d3_scaleExtent(scale.range())}function d3_scale_bilinear(domain,range,uninterpolate,interpolate){var u=uninterpolate(domain[0],domain[1]),i=interpolate(range[0],range[1]);return function(x){return i(u(x))}}function d3_scale_nice(domain,nice){var dx,i0=0,i1=domain.length-1,x0=domain[i0],x1=domain[i1];return x1<x0&&(dx=i0,i0=i1,i1=dx,dx=x0,x0=x1,x1=dx),domain[i0]=nice.floor(x0),domain[i1]=nice.ceil(x1),domain}function d3_scale_niceStep(step){return step?{floor:function(x){return Math.floor(x/step)*step},ceil:function(x){return Math.ceil(x/step)*step}}:d3_scale_niceIdentity}d3.layout.histogram=function(){var frequency=!0,valuer=Number,ranger=d3_layout_histogramRange,binner=d3_layout_histogramBinSturges;function histogram(data,i){for(var bin,x,bins=[],values=data.map(valuer,this),range=ranger.call(this,values,i),thresholds=binner.call(this,range,values,i),i=-1,n=values.length,m=thresholds.length-1,k=frequency?1:1/n;++i<m;)(bin=bins[i]=[]).dx=thresholds[i+1]-(bin.x=thresholds[i]),bin.y=0;if(0<m)for(i=-1;++i<n;)(x=values[i])>=range[0]&&x<=range[1]&&((bin=bins[d3.bisect(thresholds,x,1,m)-1]).y+=k,bin.push(data[i]));return bins}return histogram.value=function(x){return arguments.length?(valuer=x,histogram):valuer},histogram.range=function(x){return arguments.length?(ranger=d3_functor(x),histogram):ranger},histogram.bins=function(x){return arguments.length?(binner="number"==typeof x?function(range){return d3_layout_histogramBinFixed(range,x)}:d3_functor(x),histogram):binner},histogram.frequency=function(x){return arguments.length?(frequency=!!x,histogram):frequency},histogram},d3.layout.pack=function(){var radius,hierarchy=d3.layout.hierarchy().sort(d3_layout_packSort),padding=0,size=[1,1];function pack(w,h){var dr,nodes=hierarchy.call(this,w,h),root=nodes[0],w=size[0],h=size[1],r=null==radius?Math.sqrt:"function"==typeof radius?radius:function(){return radius};return root.x=root.y=0,d3_layout_hierarchyVisitAfter(root,function(d){d.r=+r(d.value)}),d3_layout_hierarchyVisitAfter(root,d3_layout_packSiblings),padding&&(dr=padding*(radius?1:Math.max(2*root.r/w,2*root.r/h))/2,d3_layout_hierarchyVisitAfter(root,function(d){d.r+=dr}),d3_layout_hierarchyVisitAfter(root,d3_layout_packSiblings),d3_layout_hierarchyVisitAfter(root,function(d){d.r-=dr})),function d3_layout_packTransform(node,x,y,k){var children=node.children;node.x=x+=k*node.x;node.y=y+=k*node.y;node.r*=k;if(children)for(var i=-1,n=children.length;++i<n;)d3_layout_packTransform(children[i],x,y,k)}(root,w/2,h/2,radius?1:1/Math.max(2*root.r/w,2*root.r/h)),nodes}return pack.size=function(_){return arguments.length?(size=_,pack):size},pack.radius=function(_){return arguments.length?(radius=null==_||"function"==typeof _?_:+_,pack):radius},pack.padding=function(_){return arguments.length?(padding=+_,pack):padding},d3_layout_hierarchyRebind(pack,hierarchy)},d3.layout.tree=function(){var hierarchy=d3.layout.hierarchy().sort(null).value(null),separation=d3_layout_treeSeparation,size=[1,1],nodeSize=null;function tree(root0,root1){var left,right,bottom,tx,kx,ky,nodes=hierarchy.call(this,root0,root1),root0=nodes[0],root1=function(root1){var node1,root1={A:null,children:[root1]},queue=[root1];for(;null!=(node1=queue.pop());)for(var child,children=node1.children,i=0,n=children.length;i<n;++i)queue.push((children[i]=child={_:children[i],parent:node1,children:(child=children[i].children)&&child.slice()||[],A:null,a:null,z:0,m:0,c:0,s:0,t:null,i:i}).a=child);return root1.children[0]}(root0);return d3_layout_hierarchyVisitAfter(root1,firstWalk),root1.parent.m=-root1.z,d3_layout_hierarchyVisitBefore(root1,secondWalk),nodeSize?d3_layout_hierarchyVisitBefore(root0,sizeNode):(d3_layout_hierarchyVisitBefore(bottom=right=left=root0,function(node){node.x<left.x&&(left=node),node.x>right.x&&(right=node),node.depth>bottom.depth&&(bottom=node)}),tx=separation(left,right)/2-left.x,kx=size[0]/(right.x+separation(right,left)/2+tx),ky=size[1]/(bottom.depth||1),d3_layout_hierarchyVisitBefore(root0,function(node){node.x=(node.x+tx)*kx,node.y=node.depth*ky})),nodes}function firstWalk(v){var midpoint=v.children,siblings=v.parent.children,w=v.i?siblings[v.i-1]:null;midpoint.length?(function(v){var w,shift=0,change=0,children=v.children,i=children.length;for(;0<=--i;)(w=children[i]).z+=shift,w.m+=shift,shift+=w.s+(change+=w.c)}(v),midpoint=(midpoint[0].z+midpoint[midpoint.length-1].z)/2,w?(v.z=w.z+separation(v._,w._),v.m=v.z-midpoint):v.z=midpoint):w&&(v.z=w.z+separation(v._,w._)),v.parent.A=function(v,w,ancestor){if(w){for(var shift,vip=v,vop=v,vim=w,vom=vip.parent.children[0],sip=vip.m,sop=vop.m,sim=vim.m,som=vom.m;vim=d3_layout_treeRight(vim),vip=d3_layout_treeLeft(vip),vim&&vip;)vom=d3_layout_treeLeft(vom),(vop=d3_layout_treeRight(vop)).a=v,0<(shift=vim.z+sim-vip.z-sip+separation(vim._,vip._))&&(function(wm,wp,shift){var change=shift/(wp.i-wm.i);wp.c-=change,wp.s+=shift,wm.c+=change,wp.z+=shift,wp.m+=shift}(function(vim,v,ancestor){return vim.a.parent===v.parent?vim.a:ancestor}(vim,v,ancestor),v,shift),sip+=shift,sop+=shift),sim+=vim.m,sip+=vip.m,som+=vom.m,sop+=vop.m;vim&&!d3_layout_treeRight(vop)&&(vop.t=vim,vop.m+=sim-sop),vip&&!d3_layout_treeLeft(vom)&&(vom.t=vip,vom.m+=sip-som,ancestor=v)}return ancestor}(v,w,v.parent.A||siblings[0])}function secondWalk(v){v._.x=v.z+v.parent.m,v.m+=v.parent.m}function sizeNode(node){node.x*=size[0],node.y=node.depth*size[1]}return tree.separation=function(x){return arguments.length?(separation=x,tree):separation},tree.size=function(x){return arguments.length?(nodeSize=null==(size=x)?sizeNode:null,tree):nodeSize?null:size},tree.nodeSize=function(x){return arguments.length?(nodeSize=null==(size=x)?null:sizeNode,tree):nodeSize?size:null},d3_layout_hierarchyRebind(tree,hierarchy)},d3.layout.cluster=function(){var hierarchy=d3.layout.hierarchy().sort(null).value(null),separation=d3_layout_treeSeparation,size=[1,1],nodeSize=!1;function cluster(left,right){var previousNode,nodes=hierarchy.call(this,left,right),root=nodes[0],x=0;d3_layout_hierarchyVisitAfter(root,function(node){var children=node.children;children&&children.length?(node.x=function(children){return children.reduce(function(x,child){return x+child.x},0)/children.length}(children),node.y=function(children){return 1+d3.max(children,function(child){return child.y})}(children)):(node.x=previousNode?x+=separation(node,previousNode):0,node.y=0,previousNode=node)});var left=function d3_layout_clusterLeft(node){var children=node.children;return children&&children.length?d3_layout_clusterLeft(children[0]):node}(root),right=function d3_layout_clusterRight(node){var n,children=node.children;return children&&(n=children.length)?d3_layout_clusterRight(children[n-1]):node}(root),x0=left.x-separation(left,right)/2,x1=right.x+separation(right,left)/2;return d3_layout_hierarchyVisitAfter(root,nodeSize?function(node){node.x=(node.x-root.x)*size[0],node.y=(root.y-node.y)*size[1]}:function(node){node.x=(node.x-x0)/(x1-x0)*size[0],node.y=(1-(root.y?node.y/root.y:1))*size[1]}),nodes}return cluster.separation=function(x){return arguments.length?(separation=x,cluster):separation},cluster.size=function(x){return arguments.length?(nodeSize=null==(size=x),cluster):nodeSize?null:size},cluster.nodeSize=function(x){return arguments.length?(nodeSize=null!=(size=x),cluster):nodeSize?size:null},d3_layout_hierarchyRebind(cluster,hierarchy)},d3.layout.treemap=function(){var stickies,hierarchy=d3.layout.hierarchy(),round=Math.round,size=[1,1],padding=null,pad=d3_layout_treemapPadNull,sticky=!1,mode="squarify",ratio=.5*(1+Math.sqrt(5));function scale(children,k){for(var child,area,i=-1,n=children.length;++i<n;)area=(child=children[i]).value*(k<0?0:k),child.area=isNaN(area)||area<=0?0:area}function squarify(node){var children=node.children;if(children&&children.length){var score,child,rect=pad(node),row=[],remaining=children.slice(),best=1/0,u="slice"===mode?rect.dx:"dice"===mode?rect.dy:"slice-dice"===mode?1&node.depth?rect.dy:rect.dx:Math.min(rect.dx,rect.dy);for(scale(remaining,rect.dx*rect.dy/node.value),row.area=0;0<(child=remaining.length);)row.push(child=remaining[child-1]),row.area+=child.area,best="squarify"!==mode||(score=function(row,u){var r,s=row.area,rmax=0,rmin=1/0,i=-1,n=row.length;for(;++i<n;)(r=row[i].area)&&(r<rmin&&(rmin=r),rmax<r&&(rmax=r));return u*=u,(s*=s)?Math.max(u*rmax*ratio/s,s/(u*rmin*ratio)):1/0}(row,u))<=best?(remaining.pop(),score):(row.area-=row.pop().area,position(row,u,rect,!1),u=Math.min(rect.dx,rect.dy),1/(row.length=row.area=0));row.length&&(position(row,u,rect,!0),row.length=row.area=0),children.forEach(squarify)}}function stickify(node){var children=node.children;if(children&&children.length){var child,rect=pad(node),remaining=children.slice(),row=[];for(scale(remaining,rect.dx*rect.dy/node.value),row.area=0;child=remaining.pop();)row.push(child),row.area+=child.area,null!=child.z&&(position(row,child.z?rect.dx:rect.dy,rect,!remaining.length),row.length=row.area=0);children.forEach(stickify)}}function position(row,u,rect,flush){var o,i=-1,n=row.length,x=rect.x,y=rect.y,v=u?round(row.area/u):0;if(u==rect.dx){for((flush||v>rect.dy)&&(v=rect.dy);++i<n;)(o=row[i]).x=x,o.y=y,o.dy=v,x+=o.dx=Math.min(rect.x+rect.dx-x,v?round(o.area/v):0);o.z=!0,o.dx+=rect.x+rect.dx-x,rect.y+=v,rect.dy-=v}else{for((flush||v>rect.dx)&&(v=rect.dx);++i<n;)(o=row[i]).x=x,o.y=y,o.dx=v,y+=o.dy=Math.min(rect.y+rect.dy-y,v?round(o.area/v):0);o.z=!1,o.dy+=rect.y+rect.dy-y,rect.x+=v,rect.dx-=v}}function treemap(root){var nodes=stickies||hierarchy(root),root=nodes[0];return root.x=root.y=0,root.value?(root.dx=size[0],root.dy=size[1]):root.dx=root.dy=0,stickies&&hierarchy.revalue(root),scale([root],root.dx*root.dy/root.value),(stickies?stickify:squarify)(root),sticky&&(stickies=nodes),nodes}return treemap.size=function(x){return arguments.length?(size=x,treemap):size},treemap.padding=function(x){return arguments.length?(pad=null==(padding=x)?d3_layout_treemapPadNull:"function"==(type=typeof x)?function(node){var p=x.call(treemap,node,node.depth);return null==p?d3_layout_treemapPadNull(node):d3_layout_treemapPad(node,"number"==typeof p?[p,p,p,p]:p)}:("number"==type&&(x=[x,x,x,x]),padConstant),treemap):padding;function padConstant(node){return d3_layout_treemapPad(node,x)}var type},treemap.round=function(x){return arguments.length?(round=x?Math.round:Number,treemap):round!=Number},treemap.sticky=function(x){return arguments.length?(sticky=x,stickies=null,treemap):sticky},treemap.ratio=function(x){return arguments.length?(ratio=x,treemap):ratio},treemap.mode=function(x){return arguments.length?(mode=x+"",treemap):mode},d3_layout_hierarchyRebind(treemap,hierarchy)},d3.random={normal:function(µ,σ){var n=arguments.length;return n<2&&(σ=1),n<1&&(µ=0),function(){for(var x,y,r;!(r=(x=2*Math.random()-1)*x+(y=2*Math.random()-1)*y)||1<r;);return µ+σ*x*Math.sqrt(-2*Math.log(r)/r)}},logNormal:function(){var random=d3.random.normal.apply(d3,arguments);return function(){return Math.exp(random())}},bates:function(m){var random=d3.random.irwinHall(m);return function(){return random()/m}},irwinHall:function(m){return function(){for(var s=0,j=0;j<m;j++)s+=Math.random();return s}}},d3.scale={};var d3_scale_niceIdentity={floor:d3_identity,ceil:d3_identity};function d3_scale_polylinear(domain,range,uninterpolate,interpolate){var u=[],i=[],j=0,k=Math.min(domain.length,range.length)-1;for(domain[k]<domain[0]&&(domain=domain.slice().reverse(),range=range.slice().reverse());++j<=k;)u.push(uninterpolate(domain[j-1],domain[j])),i.push(interpolate(range[j-1],range[j]));return function(x){var j=d3.bisect(domain,x,1,k)-1;return i[j](u[j](x))}}function d3_scale_linearRebind(scale,linear){return d3.rebind(scale,linear,"range","rangeRound","interpolate","clamp")}function d3_scale_linearNice(domain,m){return d3_scale_nice(domain,d3_scale_niceStep(d3_scale_linearTickRange(domain,m)[2])),d3_scale_nice(domain,d3_scale_niceStep(d3_scale_linearTickRange(domain,m)[2])),domain}function d3_scale_linearTickRange(step,m){null==m&&(m=10);var extent=d3_scaleExtent(step),err=extent[1]-extent[0],step=Math.pow(10,Math.floor(Math.log(err/m)/Math.LN10)),err=m/err*step;return err<=.15?step*=10:err<=.35?step*=5:err<=.75&&(step*=2),extent[0]=Math.ceil(extent[0]/step)*step,extent[1]=Math.floor(extent[1]/step)*step+.5*step,extent[2]=step,extent}function d3_scale_linearTicks(domain,m){return d3.range.apply(d3,d3_scale_linearTickRange(domain,m))}function d3_scale_linearTickFormat(range,match,format){range=d3_scale_linearTickRange(range,match);if(format){match=d3_format_re.exec(format);if(match.shift(),"s"===match[8]){var prefix=d3.formatPrefix(Math.max(abs(range[0]),abs(range[1])));return match[7]||(match[7]="."+d3_scale_linearPrecision(prefix.scale(range[2]))),match[8]="f",format=d3.format(match.join("")),function(d){return format(prefix.scale(d))+prefix.symbol}}match[7]||(match[7]="."+function(type,range){var p=d3_scale_linearPrecision(range[2]);return type in d3_scale_linearFormatSignificant?Math.abs(p-d3_scale_linearPrecision(Math.max(abs(range[0]),abs(range[1]))))+ +("e"!==type):p-2*("%"===type)}(match[8],range)),format=match.join("")}else format=",."+d3_scale_linearPrecision(range[2])+"f";return d3.format(format)}d3.scale.linear=function(){return function d3_scale_linear(domain,range,interpolate,clamp){var output,input;function rescale(){var linear=2<Math.min(domain.length,range.length)?d3_scale_polylinear:d3_scale_bilinear,uninterpolate=clamp?d3_uninterpolateClamp:d3_uninterpolateNumber;return output=linear(domain,range,uninterpolate,interpolate),input=linear(range,domain,uninterpolate,d3_interpolate),scale}function scale(x){return output(x)}scale.invert=function(y){return input(y)};scale.domain=function(x){return arguments.length?(domain=x.map(Number),rescale()):domain};scale.range=function(x){return arguments.length?(range=x,rescale()):range};scale.rangeRound=function(x){return scale.range(x).interpolate(d3_interpolateRound)};scale.clamp=function(x){return arguments.length?(clamp=x,rescale()):clamp};scale.interpolate=function(x){return arguments.length?(interpolate=x,rescale()):interpolate};scale.ticks=function(m){return d3_scale_linearTicks(domain,m)};scale.tickFormat=function(m,format){return d3_scale_linearTickFormat(domain,m,format)};scale.nice=function(m){return d3_scale_linearNice(domain,m),rescale()};scale.copy=function(){return d3_scale_linear(domain,range,interpolate,clamp)};return rescale()}([0,1],[0,1],d3_interpolate,!1)};var d3_scale_linearFormatSignificant={s:1,g:1,p:1,r:1,e:1};function d3_scale_linearPrecision(value){return-Math.floor(Math.log(value)/Math.LN10+.01)}d3.scale.log=function(){return function d3_scale_log(linear,base,positive,domain){function log(x){return(positive?Math.log(x<0?0:x):-Math.log(0<x?0:-x))/Math.log(base)}function pow(x){return positive?Math.pow(base,x):-Math.pow(base,-x)}function scale(x){return linear(log(x))}scale.invert=function(x){return pow(linear.invert(x))};scale.domain=function(x){return arguments.length?(positive=0<=x[0],linear.domain((domain=x.map(Number)).map(log)),scale):domain};scale.base=function(_){return arguments.length?(base=+_,linear.domain(domain.map(log)),scale):base};scale.nice=function(){var niced=d3_scale_nice(domain.map(log),positive?Math:d3_scale_logNiceNegative);return linear.domain(niced),domain=niced.map(pow),scale};scale.ticks=function(){var extent=d3_scaleExtent(domain),ticks=[],u=extent[0],v=extent[1],i=Math.floor(log(u)),j=Math.ceil(log(v)),n=base%1?2:base;if(isFinite(j-i)){if(positive){for(;i<j;i++)for(var k=1;k<n;k++)ticks.push(pow(i)*k);ticks.push(pow(i))}else for(ticks.push(pow(i));i++<j;)for(k=n-1;0<k;k--)ticks.push(pow(i)*k);for(i=0;ticks[i]<u;i++);for(j=ticks.length;ticks[j-1]>v;j--);ticks=ticks.slice(i,j)}return ticks};scale.tickFormat=function(n,format){if(!arguments.length)return d3_scale_logFormat;arguments.length<2?format=d3_scale_logFormat:"function"!=typeof format&&(format=d3.format(format));var k=Math.max(1,base*n/scale.ticks().length);return function(d){var i=d/pow(Math.round(log(d)));return i*base<base-.5&&(i*=base),i<=k?format(d):""}};scale.copy=function(){return d3_scale_log(linear.copy(),base,positive,domain)};return d3_scale_linearRebind(scale,linear)}(d3.scale.linear().domain([0,1]),10,!0,[1,10])};var d3_scale_logFormat=d3.format(".0e"),d3_scale_logNiceNegative={floor:function(x){return-Math.ceil(-x)},ceil:function(x){return-Math.floor(-x)}};function d3_scale_powPow(e){return function(x){return x<0?-Math.pow(-x,e):Math.pow(x,e)}}d3.scale.pow=function(){return function d3_scale_pow(linear,exponent,domain){var powp=d3_scale_powPow(exponent),powb=d3_scale_powPow(1/exponent);function scale(x){return linear(powp(x))}scale.invert=function(x){return powb(linear.invert(x))};scale.domain=function(x){return arguments.length?(linear.domain((domain=x.map(Number)).map(powp)),scale):domain};scale.ticks=function(m){return d3_scale_linearTicks(domain,m)};scale.tickFormat=function(m,format){return d3_scale_linearTickFormat(domain,m,format)};scale.nice=function(m){return scale.domain(d3_scale_linearNice(domain,m))};scale.exponent=function(x){return arguments.length?(powp=d3_scale_powPow(exponent=x),powb=d3_scale_powPow(1/exponent),linear.domain(domain.map(powp)),scale):exponent};scale.copy=function(){return d3_scale_pow(linear.copy(),exponent,domain)};return d3_scale_linearRebind(scale,linear)}(d3.scale.linear(),1,[0,1])},d3.scale.sqrt=function(){return d3.scale.pow().exponent(.5)},d3.scale.ordinal=function(){return function d3_scale_ordinal(domain,ranger){var index,range,rangeBand;function scale(x){return range[((index.get(x)||("range"===ranger.t?index.set(x,domain.push(x)):NaN))-1)%range.length]}function steps(start,step){return d3.range(domain.length).map(function(i){return start+step*i})}scale.domain=function(x){if(!arguments.length)return domain;domain=[],index=new d3_Map;for(var xi,i=-1,n=x.length;++i<n;)index.has(xi=x[i])||index.set(xi,domain.push(xi));return scale[ranger.t].apply(scale,ranger.a)};scale.range=function(x){return arguments.length?(range=x,rangeBand=0,ranger={t:"range",a:arguments},scale):range};scale.rangePoints=function(x,padding){arguments.length<2&&(padding=0);var start=x[0],step=x[1],step=domain.length<2?(start=(start+step)/2,0):(step-start)/(domain.length-1+padding);return range=steps(start+step*padding/2,step),rangeBand=0,ranger={t:"rangePoints",a:arguments},scale};scale.rangeRoundPoints=function(x,padding){arguments.length<2&&(padding=0);var start=x[0],stop=x[1],step=domain.length<2?(start=stop=Math.round((start+stop)/2),0):(stop-start)/(domain.length-1+padding)|0;return range=steps(start+Math.round(step*padding/2+(stop-start-(domain.length-1+padding)*step)/2),step),rangeBand=0,ranger={t:"rangeRoundPoints",a:arguments},scale};scale.rangeBands=function(x,padding,outerPadding){arguments.length<2&&(padding=0),arguments.length<3&&(outerPadding=padding);var reverse=x[1]<x[0],start=x[+reverse],step=x[1-reverse],step=(step-start)/(domain.length-padding+2*outerPadding);return range=steps(start+step*outerPadding,step),reverse&&range.reverse(),rangeBand=step*(1-padding),ranger={t:"rangeBands",a:arguments},scale};scale.rangeRoundBands=function(x,padding,outerPadding){arguments.length<2&&(padding=0),arguments.length<3&&(outerPadding=padding);var reverse=x[1]<x[0],start=x[+reverse],stop=x[1-reverse],step=Math.floor((stop-start)/(domain.length-padding+2*outerPadding));return range=steps(start+Math.round((stop-start-(domain.length-padding)*step)/2),step),reverse&&range.reverse(),rangeBand=Math.round(step*(1-padding)),ranger={t:"rangeRoundBands",a:arguments},scale};scale.rangeBand=function(){return rangeBand};scale.rangeExtent=function(){return d3_scaleExtent(ranger.a[0])};scale.copy=function(){return d3_scale_ordinal(domain,ranger)};return scale.domain(domain)}([],{t:"range",a:[[]]})},d3.scale.category10=function(){return d3.scale.ordinal().range(d3_category10)},d3.scale.category20=function(){return d3.scale.ordinal().range(d3_category20)},d3.scale.category20b=function(){return d3.scale.ordinal().range(d3_category20b)},d3.scale.category20c=function(){return d3.scale.ordinal().range(d3_category20c)};var d3_category10=[2062260,16744206,2924588,14034728,9725885,9197131,14907330,8355711,12369186,1556175].map(d3_rgbString),d3_category20=[2062260,11454440,16744206,16759672,2924588,10018698,14034728,16750742,9725885,12955861,9197131,12885140,14907330,16234194,8355711,13092807,12369186,14408589,1556175,10410725].map(d3_rgbString),d3_category20b=[3750777,5395619,7040719,10264286,6519097,9216594,11915115,13556636,9202993,12426809,15186514,15190932,8666169,11356490,14049643,15177372,8077683,10834324,13528509,14589654].map(d3_rgbString),d3_category20c=[3244733,7057110,10406625,13032431,15095053,16616764,16625259,16634018,3253076,7652470,10607003,13101504,7695281,10394312,12369372,14342891,6513507,9868950,12434877,14277081].map(d3_rgbString);function d3_zero(){return 0}d3.scale.quantile=function(){return function d3_scale_quantile(domain,range){var thresholds;function rescale(){var k=0,q=range.length;for(thresholds=[];++k<q;)thresholds[k-1]=d3.quantile(domain,k/q);return scale}function scale(x){if(!isNaN(x=+x))return range[d3.bisect(thresholds,x)]}scale.domain=function(x){return arguments.length?(domain=x.map(d3_number).filter(d3_numeric).sort(d3_ascending),rescale()):domain};scale.range=function(x){return arguments.length?(range=x,rescale()):range};scale.quantiles=function(){return thresholds};scale.invertExtent=function(y){return(y=range.indexOf(y))<0?[NaN,NaN]:[0<y?thresholds[y-1]:domain[0],y<thresholds.length?thresholds[y]:domain[domain.length-1]]};scale.copy=function(){return d3_scale_quantile(domain,range)};return rescale()}([],[])},d3.scale.quantize=function(){return function d3_scale_quantize(x0,x1,range){var kx,i;function scale(x){return range[Math.max(0,Math.min(i,Math.floor(kx*(x-x0))))]}function rescale(){return kx=range.length/(x1-x0),i=range.length-1,scale}scale.domain=function(x){return arguments.length?(x0=+x[0],x1=+x[x.length-1],rescale()):[x0,x1]};scale.range=function(x){return arguments.length?(range=x,rescale()):range};scale.invertExtent=function(y){return[y=(y=range.indexOf(y))<0?NaN:y/kx+x0,y+1/kx]};scale.copy=function(){return d3_scale_quantize(x0,x1,range)};return rescale()}(0,1,[0,1])},d3.scale.threshold=function(){return function d3_scale_threshold(domain,range){function scale(x){if(x<=x)return range[d3.bisect(domain,x)]}scale.domain=function(_){return arguments.length?(domain=_,scale):domain};scale.range=function(_){return arguments.length?(range=_,scale):range};scale.invertExtent=function(y){return y=range.indexOf(y),[domain[y-1],domain[y]]};scale.copy=function(){return d3_scale_threshold(domain,range)};return scale}([.5],[0,1])},d3.scale.identity=function(){return function d3_scale_identity(domain){function identity(x){return+x}identity.invert=identity;identity.domain=identity.range=function(x){return arguments.length?(domain=x.map(identity),identity):domain};identity.ticks=function(m){return d3_scale_linearTicks(domain,m)};identity.tickFormat=function(m,format){return d3_scale_linearTickFormat(domain,m,format)};identity.copy=function(){return d3_scale_identity(domain)};return identity}([0,1])},d3.svg={},d3.svg.arc=function(){var innerRadius=d3_svg_arcInnerRadius,outerRadius=d3_svg_arcOuterRadius,cornerRadius=d3_zero,padRadius=d3_svg_arcAuto,startAngle=d3_svg_arcStartAngle,endAngle=d3_svg_arcEndAngle,padAngle=d3_svg_arcPadAngle;function arc(){var r0=Math.max(0,+innerRadius.apply(this,arguments)),r1=Math.max(0,+outerRadius.apply(this,arguments)),lc=startAngle.apply(this,arguments)-halfπ,ax=endAngle.apply(this,arguments)-halfπ,bx=Math.abs(ax-lc),cw=ax<lc?0:1;if(r1<r0&&(rc=r1,r1=r0,r0=rc),τε<=bx)return circleSegment(r1,cw)+(r0?circleSegment(r0,1-cw):"")+"Z";var rc,rp,ap,y1,l1,x0,y0,x1,y3,l0,x2,y2,x3,ay,t30,t03,t21,rc0=0,cr=0,path=[];return(ap=(+padAngle.apply(this,arguments)||0)/2)&&(rp=padRadius===d3_svg_arcAuto?Math.sqrt(r0*r0+r1*r1):+padRadius.apply(this,arguments),cw||(cr*=-1),r1&&(cr=d3_asin(rp/r1*Math.sin(ap))),r0&&(rc0=d3_asin(rp/r0*Math.sin(ap)))),r1?(x0=r1*Math.cos(lc+cr),y0=r1*Math.sin(lc+cr),x1=r1*Math.cos(ax-cr),y1=r1*Math.sin(ax-cr),l1=Math.abs(ax-lc-2*cr)<=π?0:1,cr&&d3_svg_arcSweep(x0,y0,x1,y1)===cw^l1&&(t03=(lc+ax)/2,x0=r1*Math.cos(t03),y0=r1*Math.sin(t03),x1=y1=null)):x0=y0=0,r0?(x2=r0*Math.cos(ax-rc0),y2=r0*Math.sin(ax-rc0),x3=r0*Math.cos(lc+rc0),y3=r0*Math.sin(lc+rc0),l0=Math.abs(lc-ax+2*rc0)<=π?0:1,rc0&&d3_svg_arcSweep(x2,y2,x3,y3)===1-cw^l0&&(ay=(lc+ax)/2,x2=r0*Math.cos(ay),y2=r0*Math.sin(ay),x3=y3=null)):x2=y2=0,ε<bx&&.001<(rc=Math.min(Math.abs(r1-r0)/2,+cornerRadius.apply(this,arguments)))?(cr=r0<r1^cw?0:1,rc0=t03=rc,bx<π&&(ax=x0-(lc=null==x3?[x2,y2]:null==x1?[x0,y0]:d3_geom_polygonIntersect([x0,y0],[x3,y3],[x1,y1],[x2,y2]))[0],ay=y0-lc[1],bx=x1-lc[0],t30=y1-lc[1],t30=1/Math.sin(Math.acos((ax*bx+ay*t30)/(Math.sqrt(ax*ax+ay*ay)*Math.sqrt(bx*bx+t30*t30)))/2),lc=Math.sqrt(lc[0]*lc[0]+lc[1]*lc[1]),rc0=Math.min(rc,(r0-lc)/(t30-1)),t03=Math.min(rc,(r1-lc)/(1+t30))),null!=x1?(t30=d3_svg_arcCornerTangents(null==x3?[x2,y2]:[x3,y3],[x0,y0],r1,t03,cw),t21=d3_svg_arcCornerTangents([x1,y1],[x2,y2],r1,t03,cw),rc===t03?path.push("M",t30[0],"A",t03,",",t03," 0 0,",cr," ",t30[1],"A",r1,",",r1," 0 ",1-cw^d3_svg_arcSweep(t30[1][0],t30[1][1],t21[1][0],t21[1][1]),",",cw," ",t21[1],"A",t03,",",t03," 0 0,",cr," ",t21[0]):path.push("M",t30[0],"A",t03,",",t03," 0 1,",cr," ",t21[0])):path.push("M",x0,",",y0),null!=x3?(t03=d3_svg_arcCornerTangents([x0,y0],[x3,y3],r0,-rc0,cw),t21=d3_svg_arcCornerTangents([x2,y2],null==x1?[x0,y0]:[x1,y1],r0,-rc0,cw),rc===rc0?path.push("L",t21[0],"A",rc0,",",rc0," 0 0,",cr," ",t21[1],"A",r0,",",r0," 0 ",cw^d3_svg_arcSweep(t21[1][0],t21[1][1],t03[1][0],t03[1][1]),",",1-cw," ",t03[1],"A",rc0,",",rc0," 0 0,",cr," ",t03[0]):path.push("L",t21[0],"A",rc0,",",rc0," 0 0,",cr," ",t03[0])):path.push("L",x2,",",y2)):(path.push("M",x0,",",y0),null!=x1&&path.push("A",r1,",",r1," 0 ",l1,",",cw," ",x1,",",y1),path.push("L",x2,",",y2),null!=x3&&path.push("A",r0,",",r0," 0 ",l0,",",1-cw," ",x3,",",y3)),path.push("Z"),path.join("")}function circleSegment(r1,cw){return"M0,"+r1+"A"+r1+","+r1+" 0 1,"+cw+" 0,"+-r1+"A"+r1+","+r1+" 0 1,"+cw+" 0,"+r1}return arc.innerRadius=function(v){return arguments.length?(innerRadius=d3_functor(v),arc):innerRadius},arc.outerRadius=function(v){return arguments.length?(outerRadius=d3_functor(v),arc):outerRadius},arc.cornerRadius=function(v){return arguments.length?(cornerRadius=d3_functor(v),arc):cornerRadius},arc.padRadius=function(v){return arguments.length?(padRadius=v==d3_svg_arcAuto?d3_svg_arcAuto:d3_functor(v),arc):padRadius},arc.startAngle=function(v){return arguments.length?(startAngle=d3_functor(v),arc):startAngle},arc.endAngle=function(v){return arguments.length?(endAngle=d3_functor(v),arc):endAngle},arc.padAngle=function(v){return arguments.length?(padAngle=d3_functor(v),arc):padAngle},arc.centroid=function(){var r=(+innerRadius.apply(this,arguments)+ +outerRadius.apply(this,arguments))/2,a=(+startAngle.apply(this,arguments)+ +endAngle.apply(this,arguments))/2-halfπ;return[Math.cos(a)*r,Math.sin(a)*r]},arc};var d3_svg_arcAuto="auto";function d3_svg_arcInnerRadius(d){return d.innerRadius}function d3_svg_arcOuterRadius(d){return d.outerRadius}function d3_svg_arcStartAngle(d){return d.startAngle}function d3_svg_arcEndAngle(d){return d.endAngle}function d3_svg_arcPadAngle(d){return d&&d.padAngle}function d3_svg_arcSweep(x0,y0,x1,y1){return 0<(x0-x1)*y0-(y0-y1)*x0?0:1}function d3_svg_arcCornerTangents(dy0,r,r1,D,dx1){var cy1=dy0[0]-r[0],dy1=dy0[1]-r[1],dx=(dx1?D:-D)/Math.sqrt(cy1*cy1+dy1*dy1),ox=dx*dy1,oy=-dx*cy1,dx0=dy0[0]+ox,cx1=dy0[1]+oy,cy0=r[0]+ox,cx0=r[1]+oy,dx1=(dx0+cy0)/2,dy1=(cx1+cx0)/2,dx=cy0-dx0,cy1=cx0-cx1,dy0=dx*dx+cy1*cy1,r=r1-D,D=dx0*cx0-cy0*cx1,dx0=(cy1<0?-1:1)*Math.sqrt(Math.max(0,r*r*dy0-D*D)),cx0=(D*cy1-dx*dx0)/dy0,cy0=(-D*dx-cy1*dx0)/dy0,cx1=(D*cy1+dx*dx0)/dy0,cy1=(-D*dx+cy1*dx0)/dy0,dx0=cx0-dx1,dy0=cy0-dy1,dx1=cx1-dx1,dy1=cy1-dy1;return dx1*dx1+dy1*dy1<dx0*dx0+dy0*dy0&&(cx0=cx1,cy0=cy1),[[cx0-ox,cy0-oy],[cx0*r1/r,cy0*r1/r]]}function d3_svg_line(projection){var x=d3_geom_pointX,y=d3_geom_pointY,defined=d3_true,interpolate=d3_svg_lineLinear,interpolateKey=interpolate.key,tension=.7;function line(data){var d,segments=[],points=[],i=-1,n=data.length,fx=d3_functor(x),fy=d3_functor(y);function segment(){segments.push("M",interpolate(projection(points),tension))}for(;++i<n;)defined.call(this,d=data[i],i)?points.push([+fx.call(this,d,i),+fy.call(this,d,i)]):points.length&&(segment(),points=[]);return points.length&&segment(),segments.length?segments.join(""):null}return line.x=function(_){return arguments.length?(x=_,line):x},line.y=function(_){return arguments.length?(y=_,line):y},line.defined=function(_){return arguments.length?(defined=_,line):defined},line.interpolate=function(_){return arguments.length?(interpolateKey="function"==typeof _?interpolate=_:(interpolate=d3_svg_lineInterpolators.get(_)||d3_svg_lineLinear).key,line):interpolateKey},line.tension=function(_){return arguments.length?(tension=_,line):tension},line}d3.svg.line=function(){return d3_svg_line(d3_identity)};var d3_svg_lineInterpolators=d3.map({linear:d3_svg_lineLinear,"linear-closed":d3_svg_lineLinearClosed,step:function(points){var i=0,n=points.length,p=points[0],path=[p[0],",",p[1]];for(;++i<n;)path.push("H",(p[0]+(p=points[i])[0])/2,"V",p[1]);1<n&&path.push("H",p[0]);return path.join("")},"step-before":d3_svg_lineStepBefore,"step-after":d3_svg_lineStepAfter,basis:d3_svg_lineBasis,"basis-open":function(points){if(points.length<4)return d3_svg_lineLinear(points);var pi,path=[],i=-1,n=points.length,px=[0],py=[0];for(;++i<3;)pi=points[i],px.push(pi[0]),py.push(pi[1]);path.push(d3_svg_lineDot4(d3_svg_lineBasisBezier3,px)+","+d3_svg_lineDot4(d3_svg_lineBasisBezier3,py)),--i;for(;++i<n;)pi=points[i],px.shift(),px.push(pi[0]),py.shift(),py.push(pi[1]),d3_svg_lineBasisBezier(path,px,py);return path.join("")},"basis-closed":function(points){var path,pi,i=-1,n=points.length,m=n+4,px=[],py=[];for(;++i<4;)pi=points[i%n],px.push(pi[0]),py.push(pi[1]);path=[d3_svg_lineDot4(d3_svg_lineBasisBezier3,px),",",d3_svg_lineDot4(d3_svg_lineBasisBezier3,py)],--i;for(;++i<m;)pi=points[i%n],px.shift(),px.push(pi[0]),py.shift(),py.push(pi[1]),d3_svg_lineBasisBezier(path,px,py);return path.join("")},bundle:function(points,tension){var n=points.length-1;if(n)for(var p,t,x0=points[0][0],y0=points[0][1],dx=points[n][0]-x0,dy=points[n][1]-y0,i=-1;++i<=n;)p=points[i],t=i/n,p[0]=tension*p[0]+(1-tension)*(x0+t*dx),p[1]=tension*p[1]+(1-tension)*(y0+t*dy);return d3_svg_lineBasis(points)},cardinal:function(points,tension){return points.length<3?d3_svg_lineLinear(points):points[0]+d3_svg_lineHermite(points,d3_svg_lineCardinalTangents(points,tension))},"cardinal-open":function(points,tension){return points.length<4?d3_svg_lineLinear(points):points[1]+d3_svg_lineHermite(points.slice(1,-1),d3_svg_lineCardinalTangents(points,tension))},"cardinal-closed":function(points,tension){return points.length<3?points.join("L")+"Z":points[0]+d3_svg_lineHermite((points.push(points[0]),points),d3_svg_lineCardinalTangents([points[points.length-2]].concat(points,[points[1]]),tension))},monotone:function(points){return points.length<3?d3_svg_lineLinear(points):points[0]+d3_svg_lineHermite(points,function(points){var d,a,b,s,tangents=[],m=function(points){var i=0,j=points.length-1,m=[],p0=points[0],p1=points[1],d=m[0]=d3_svg_lineSlope(p0,p1);for(;++i<j;)m[i]=(d+(d=d3_svg_lineSlope(p0=p1,p1=points[i+1])))/2;return m[i]=d,m}(points),i=-1,j=points.length-1;for(;++i<j;)d=d3_svg_lineSlope(points[i],points[i+1]),abs(d)<ε?m[i]=m[i+1]=0:(a=m[i]/d,b=m[i+1]/d,9<(s=a*a+b*b)&&(s=3*d/Math.sqrt(s),m[i]=s*a,m[i+1]=s*b));i=-1;for(;++i<=j;)s=(points[Math.min(j,i+1)][0]-points[Math.max(0,i-1)][0])/(6*(1+m[i]*m[i])),tangents.push([s||0,m[i]*s||0]);return tangents}(points))}});function d3_svg_lineLinear(points){return 1<points.length?points.join("L"):points+"Z"}function d3_svg_lineLinearClosed(points){return points.join("L")+"Z"}function d3_svg_lineStepBefore(points){for(var i=0,n=points.length,p=points[0],path=[p[0],",",p[1]];++i<n;)path.push("V",(p=points[i])[1],"H",p[0]);return path.join("")}function d3_svg_lineStepAfter(points){for(var i=0,n=points.length,p=points[0],path=[p[0],",",p[1]];++i<n;)path.push("H",(p=points[i])[0],"V",p[1]);return path.join("")}function d3_svg_lineHermite(points,tangents){if(tangents.length<1||points.length!=tangents.length&&points.length!=tangents.length+2)return d3_svg_lineLinear(points);var lp=points.length!=tangents.length,path="",p0=points[0],p=points[1],t0=tangents[0],t=t0,pi=1;if(lp&&(path+="Q"+(p[0]-2*t0[0]/3)+","+(p[1]-2*t0[1]/3)+","+p[0]+","+p[1],p0=points[1],pi=2),1<tangents.length){t=tangents[1],p=points[pi],pi++,path+="C"+(p0[0]+t0[0])+","+(p0[1]+t0[1])+","+(p[0]-t[0])+","+(p[1]-t[1])+","+p[0]+","+p[1];for(var i=2;i<tangents.length;i++,pi++)p=points[pi],t=tangents[i],path+="S"+(p[0]-t[0])+","+(p[1]-t[1])+","+p[0]+","+p[1]}return lp&&(lp=points[pi],path+="Q"+(p[0]+2*t[0]/3)+","+(p[1]+2*t[1]/3)+","+lp[0]+","+lp[1]),path}function d3_svg_lineCardinalTangents(points,tension){for(var p0,tangents=[],a=(1-tension)/2,p1=points[0],p2=points[1],i=1,n=points.length;++i<n;)p0=p1,p1=p2,p2=points[i],tangents.push([a*(p2[0]-p0[0]),a*(p2[1]-p0[1])]);return tangents}function d3_svg_lineBasis(points){if(points.length<3)return d3_svg_lineLinear(points);var i=1,n=points.length,pi=points[0],x0=pi[0],y0=pi[1],px=[x0,x0,x0,(pi=points[1])[0]],py=[y0,y0,y0,pi[1]],path=[x0,",",y0,"L",d3_svg_lineDot4(d3_svg_lineBasisBezier3,px),",",d3_svg_lineDot4(d3_svg_lineBasisBezier3,py)];for(points.push(points[n-1]);++i<=n;)pi=points[i],px.shift(),px.push(pi[0]),py.shift(),py.push(pi[1]),d3_svg_lineBasisBezier(path,px,py);return points.pop(),path.push("L",pi),path.join("")}function d3_svg_lineDot4(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]}d3_svg_lineInterpolators.forEach(function(key,value){value.key=key,value.closed=/-closed$/.test(key)});var d3_svg_lineBasisBezier1=[0,2/3,1/3,0],d3_svg_lineBasisBezier2=[0,1/3,2/3,0],d3_svg_lineBasisBezier3=[0,1/6,2/3,1/6];function d3_svg_lineBasisBezier(path,x,y){path.push("C",d3_svg_lineDot4(d3_svg_lineBasisBezier1,x),",",d3_svg_lineDot4(d3_svg_lineBasisBezier1,y),",",d3_svg_lineDot4(d3_svg_lineBasisBezier2,x),",",d3_svg_lineDot4(d3_svg_lineBasisBezier2,y),",",d3_svg_lineDot4(d3_svg_lineBasisBezier3,x),",",d3_svg_lineDot4(d3_svg_lineBasisBezier3,y))}function d3_svg_lineSlope(p0,p1){return(p1[1]-p0[1])/(p1[0]-p0[0])}function d3_svg_lineRadial(points){for(var point,r,a,i=-1,n=points.length;++i<n;)r=(point=points[i])[0],a=point[1]-halfπ,point[0]=r*Math.cos(a),point[1]=r*Math.sin(a);return points}function d3_svg_area(projection){var x0=d3_geom_pointX,x1=d3_geom_pointX,y0=0,y1=d3_geom_pointY,defined=d3_true,interpolate=d3_svg_lineLinear,interpolateKey=interpolate.key,interpolateReverse=interpolate,L="L",tension=.7;function area(data){var d,x,y,segments=[],points0=[],points1=[],i=-1,n=data.length,fx0=d3_functor(x0),fy0=d3_functor(y0),fx1=x0===x1?function(){return x}:d3_functor(x1),fy1=y0===y1?function(){return y}:d3_functor(y1);function segment(){segments.push("M",interpolate(projection(points1),tension),L,interpolateReverse(projection(points0.reverse()),tension),"Z")}for(;++i<n;)defined.call(this,d=data[i],i)?(points0.push([x=+fx0.call(this,d,i),y=+fy0.call(this,d,i)]),points1.push([+fx1.call(this,d,i),+fy1.call(this,d,i)])):points0.length&&(segment(),points0=[],points1=[]);return points0.length&&segment(),segments.length?segments.join(""):null}return area.x=function(_){return arguments.length?(x0=x1=_,area):x1},area.x0=function(_){return arguments.length?(x0=_,area):x0},area.x1=function(_){return arguments.length?(x1=_,area):x1},area.y=function(_){return arguments.length?(y0=y1=_,area):y1},area.y0=function(_){return arguments.length?(y0=_,area):y0},area.y1=function(_){return arguments.length?(y1=_,area):y1},area.defined=function(_){return arguments.length?(defined=_,area):defined},area.interpolate=function(_){return arguments.length?(interpolateKey="function"==typeof _?interpolate=_:(interpolate=d3_svg_lineInterpolators.get(_)||d3_svg_lineLinear).key,interpolateReverse=interpolate.reverse||interpolate,L=interpolate.closed?"M":"L",area):interpolateKey},area.tension=function(_){return arguments.length?(tension=_,area):tension},area}function d3_svg_chordRadius(d){return d.radius}function d3_svg_diagonalProjection(d){return[d.x,d.y]}function d3_svg_symbolSize(){return 64}function d3_svg_symbolType(){return"circle"}function d3_svg_symbolCircle(r){r=Math.sqrt(r/π);return"M0,"+r+"A"+r+","+r+" 0 1,1 0,"+-r+"A"+r+","+r+" 0 1,1 0,"+r+"Z"}d3.svg.line.radial=function(){var line=d3_svg_line(d3_svg_lineRadial);return line.radius=line.x,delete line.x,line.angle=line.y,delete line.y,line},(d3_svg_lineStepBefore.reverse=d3_svg_lineStepAfter).reverse=d3_svg_lineStepBefore,d3.svg.area=function(){return d3_svg_area(d3_identity)},d3.svg.area.radial=function(){var area=d3_svg_area(d3_svg_lineRadial);return area.radius=area.x,delete area.x,area.innerRadius=area.x0,delete area.x0,area.outerRadius=area.x1,delete area.x1,area.angle=area.y,delete area.y,area.startAngle=area.y0,delete area.y0,area.endAngle=area.y1,delete area.y1,area},d3.svg.chord=function(){var source=d3_source,target=d3_target,radius=d3_svg_chordRadius,startAngle=d3_svg_arcStartAngle,endAngle=d3_svg_arcEndAngle;function chord(b,a){var s=subgroup(this,source,b,a),t=subgroup(this,target,b,a);return"M"+s.p0+arc(s.r,s.p1,s.a1-s.a0)+(b=t,(a=s).a0==b.a0&&a.a1==b.a1?curve(s.r,s.p1,s.r,s.p0):curve(s.r,s.p1,t.r,t.p0)+arc(t.r,t.p1,t.a1-t.a0)+curve(t.r,t.p1,s.r,s.p0))+"Z"}function subgroup(self,r,a0,a1){var subgroup=r.call(self,a0,a1),r=radius.call(self,subgroup,a1),a0=startAngle.call(self,subgroup,a1)-halfπ,a1=endAngle.call(self,subgroup,a1)-halfπ;return{r:r,a0:a0,a1:a1,p0:[r*Math.cos(a0),r*Math.sin(a0)],p1:[r*Math.cos(a1),r*Math.sin(a1)]}}function arc(r,p,a){return"A"+r+","+r+" 0 "+ +(π<a)+",1 "+p}function curve(r0,p0,r1,p1){return"Q 0,0 "+p1}return chord.radius=function(v){return arguments.length?(radius=d3_functor(v),chord):radius},chord.source=function(v){return arguments.length?(source=d3_functor(v),chord):source},chord.target=function(v){return arguments.length?(target=d3_functor(v),chord):target},chord.startAngle=function(v){return arguments.length?(startAngle=d3_functor(v),chord):startAngle},chord.endAngle=function(v){return arguments.length?(endAngle=d3_functor(v),chord):endAngle},chord},d3.svg.diagonal=function(){var source=d3_source,target=d3_target,projection=d3_svg_diagonalProjection;function diagonal(p,m){var p0=source.call(this,p,m),p=target.call(this,p,m),m=(p0.y+p.y)/2,p=[p0,{x:p0.x,y:m},{x:p.x,y:m},p];return"M"+(p=p.map(projection))[0]+"C"+p[1]+" "+p[2]+" "+p[3]}return diagonal.source=function(x){return arguments.length?(source=d3_functor(x),diagonal):source},diagonal.target=function(x){return arguments.length?(target=d3_functor(x),diagonal):target},diagonal.projection=function(x){return arguments.length?(projection=x,diagonal):projection},diagonal},d3.svg.diagonal.radial=function(){var diagonal=d3.svg.diagonal(),projection=d3_svg_diagonalProjection,projection_=diagonal.projection;return diagonal.projection=function(x){return arguments.length?projection_(function(projection){return function(){var a=projection.apply(this,arguments),r=a[0],a=a[1]-halfπ;return[r*Math.cos(a),r*Math.sin(a)]}}(projection=x)):projection},diagonal},d3.svg.symbol=function(){var type=d3_svg_symbolType,size=d3_svg_symbolSize;function symbol(d,i){return(d3_svg_symbols.get(type.call(this,d,i))||d3_svg_symbolCircle)(size.call(this,d,i))}return symbol.type=function(x){return arguments.length?(type=d3_functor(x),symbol):type},symbol.size=function(x){return arguments.length?(size=d3_functor(x),symbol):size},symbol};var d3_svg_symbols=d3.map({circle:d3_svg_symbolCircle,cross:function(r){r=Math.sqrt(r/5)/2;return"M"+-3*r+","+-r+"H"+-r+"V"+-3*r+"H"+r+"V"+-r+"H"+3*r+"V"+r+"H"+r+"V"+3*r+"H"+-r+"V"+r+"H"+-3*r+"Z"},diamond:function(rx){var ry=Math.sqrt(rx/(2*d3_svg_symbolTan30)),rx=ry*d3_svg_symbolTan30;return"M0,"+-ry+"L"+rx+",0 0,"+ry+" "+-rx+",0Z"},square:function(r){r=Math.sqrt(r)/2;return"M"+-r+","+-r+"L"+r+","+-r+" "+r+","+r+" "+-r+","+r+"Z"},"triangle-down":function(ry){var rx=Math.sqrt(ry/d3_svg_symbolSqrt3),ry=rx*d3_svg_symbolSqrt3/2;return"M0,"+ry+"L"+rx+","+-ry+" "+-rx+","+-ry+"Z"},"triangle-up":function(ry){var rx=Math.sqrt(ry/d3_svg_symbolSqrt3),ry=rx*d3_svg_symbolSqrt3/2;return"M0,"+-ry+"L"+rx+","+ry+" "+-rx+","+ry+"Z"}});d3.svg.symbolTypes=d3_svg_symbols.keys();var d3_svg_symbolSqrt3=Math.sqrt(3),d3_svg_symbolTan30=Math.tan(30*d3_radians);d3_selectionPrototype.transition=function(name){for(var subgroup,node,id=d3_transitionInheritId||++d3_transitionId,ns=d3_transitionNamespace(name),subgroups=[],transition=d3_transitionInherit||{time:Date.now(),ease:d3_ease_cubicInOut,delay:0,duration:250},j=-1,m=this.length;++j<m;){subgroups.push(subgroup=[]);for(var group=this[j],i=-1,n=group.length;++i<n;)(node=group[i])&&d3_transitionNode(node,i,ns,id,transition),subgroup.push(node)}return d3_transition(subgroups,ns,id)},d3_selectionPrototype.interrupt=function(name){return this.each(null==name?d3_selection_interrupt:d3_selection_interruptNS(d3_transitionNamespace(name)))};var d3_selection_interrupt=d3_selection_interruptNS("__transition__");function d3_selection_interruptNS(ns){return function(){var lock,activeId,active;(lock=this[ns])&&(active=lock[activeId=lock.active])&&(active.timer.c=null,active.timer.t=NaN,--lock.count?delete lock[activeId]:delete this[ns],lock.active+=.5,active.event&&active.event.interrupt.call(this,this.__data__,active.index))}}function d3_transition(groups,ns,id){return d3_subclass(groups,d3_transitionPrototype),groups.namespace=ns,groups.id=id,groups}var d3_transitionInheritId,d3_transitionInherit,d3_transitionPrototype=[],d3_transitionId=0;function d3_transition_tween(groups,name,value,tween){var id=groups.id,ns=groups.namespace;return d3_selection_each(groups,"function"==typeof value?function(node,i,j){node[ns][id].tween.set(name,tween(value.call(node,node.__data__,i,j)))}:(value=tween(value),function(node){node[ns][id].tween.set(name,value)}))}function d3_transition_text(b){return null==b&&(b=""),function(){this.textContent=b}}function d3_transitionNamespace(name){return null==name?"__transition__":"__transition_"+name+"__"}function d3_transitionNode(node,i,ns,id,inherit){var time,timer,duration,ease,tweens,lock=node[ns]||(node[ns]={active:0,count:0}),transition=lock[id];function start(elapsed){var cancelId,cancel,activeId=lock.active,active=lock[activeId];for(cancelId in active&&(active.timer.c=null,active.timer.t=NaN,--lock.count,delete lock[activeId],active.event&&active.event.interrupt.call(node,node.__data__,active.index)),lock)+cancelId<id&&((cancel=lock[cancelId]).timer.c=null,cancel.timer.t=NaN,--lock.count,delete lock[cancelId]);timer.c=tick,d3_timer(function(){return timer.c&&tick(elapsed||1)&&(timer.c=null,timer.t=NaN),1},0,time),lock.active=id,transition.event&&transition.event.start.call(node,node.__data__,i),tweens=[],transition.tween.forEach(function(key,value){(value=value.call(node,node.__data__,i))&&tweens.push(value)}),ease=transition.ease,duration=transition.duration}function tick(t){for(var t=t/duration,e=ease(t),n=tweens.length;0<n;)tweens[--n].call(node,e);if(1<=t)return transition.event&&transition.event.end.call(node,node.__data__,i),--lock.count?delete lock[id]:delete node[ns],1}transition||(time=inherit.time,timer=d3_timer(function(elapsed){var delay=transition.delay;if(timer.t=delay+time,delay<=elapsed)return start(elapsed-delay);timer.c=start},0,time),transition=lock[id]={tween:new d3_Map,time:time,timer:timer,delay:inherit.delay,duration:inherit.duration,ease:inherit.ease,index:i},inherit=null,++lock.count)}d3_transitionPrototype.call=d3_selectionPrototype.call,d3_transitionPrototype.empty=d3_selectionPrototype.empty,d3_transitionPrototype.node=d3_selectionPrototype.node,d3_transitionPrototype.size=d3_selectionPrototype.size,d3.transition=function(selection,name){return selection&&selection.transition?d3_transitionInheritId?selection.transition(name):selection:d3.selection().transition(selection)},(d3.transition.prototype=d3_transitionPrototype).select=function(selector){var subgroup,subnode,node,id=this.id,ns=this.namespace,subgroups=[];selector=d3_selection_selector(selector);for(var j=-1,m=this.length;++j<m;){subgroups.push(subgroup=[]);for(var group=this[j],i=-1,n=group.length;++i<n;)(node=group[i])&&(subnode=selector.call(node,node.__data__,i,j))?("__data__"in node&&(subnode.__data__=node.__data__),d3_transitionNode(subnode,i,ns,id,node[ns][id]),subgroup.push(subnode)):subgroup.push(null)}return d3_transition(subgroups,ns,id)},d3_transitionPrototype.selectAll=function(selector){var subgroup,subnodes,node,subnode,transition,id=this.id,ns=this.namespace,subgroups=[];selector=d3_selection_selectorAll(selector);for(var j=-1,m=this.length;++j<m;)for(var group=this[j],i=-1,n=group.length;++i<n;)if(node=group[i]){transition=node[ns][id],subnodes=selector.call(node,node.__data__,i,j),subgroups.push(subgroup=[]);for(var k=-1,o=subnodes.length;++k<o;)(subnode=subnodes[k])&&d3_transitionNode(subnode,k,ns,id,transition),subgroup.push(subnode)}return d3_transition(subgroups,ns,id)},d3_transitionPrototype.filter=function(filter){var subgroup,node,subgroups=[];"function"!=typeof filter&&(filter=d3_selection_filter(filter));for(var j=0,m=this.length;j<m;j++){subgroups.push(subgroup=[]);for(var group,i=0,n=(group=this[j]).length;i<n;i++)(node=group[i])&&filter.call(node,node.__data__,i,j)&&subgroup.push(node)}return d3_transition(subgroups,this.namespace,this.id)},d3_transitionPrototype.tween=function(name,tween){var id=this.id,ns=this.namespace;return arguments.length<2?this.node()[ns][id].tween.get(name):d3_selection_each(this,null==tween?function(node){node[ns][id].tween.remove(name)}:function(node){node[ns][id].tween.set(name,tween)})},d3_transitionPrototype.attr=function(nameNS,value){if(arguments.length<2){for(value in nameNS)this.attr(value,nameNS[value]);return this}var interpolate="transform"==nameNS?d3_interpolateTransform:d3_interpolate,name=d3.ns.qualify(nameNS);function attrNull(){this.removeAttribute(name)}function attrNullNS(){this.removeAttributeNS(name.space,name.local)}return d3_transition_tween(this,"attr."+nameNS,value,name.local?function(b){return null==b?attrNullNS:(b+="",function(){var i,a=this.getAttributeNS(name.space,name.local);return a!==b&&(i=interpolate(a,b),function(t){this.setAttributeNS(name.space,name.local,i(t))})})}:function(b){return null==b?attrNull:(b+="",function(){var i,a=this.getAttribute(name);return a!==b&&(i=interpolate(a,b),function(t){this.setAttribute(name,i(t))})})})},d3_transitionPrototype.attrTween=function(nameNS,tween){var name=d3.ns.qualify(nameNS);return this.tween("attr."+nameNS,name.local?function(d,i){var f=tween.call(this,d,i,this.getAttributeNS(name.space,name.local));return f&&function(t){this.setAttributeNS(name.space,name.local,f(t))}}:function(d,i){var f=tween.call(this,d,i,this.getAttribute(name));return f&&function(t){this.setAttribute(name,f(t))}})},d3_transitionPrototype.style=function(name,value,priority){var n=arguments.length;if(n<3){if("string"!=typeof name){for(priority in n<2&&(value=""),name)this.style(priority,name[priority],value);return this}priority=""}function styleNull(){this.style.removeProperty(name)}return d3_transition_tween(this,"style."+name,value,function(b){return null==b?styleNull:(b+="",function(){var i,a=d3_window(this).getComputedStyle(this,null).getPropertyValue(name);return a!==b&&(i=d3_interpolate(a,b),function(t){this.style.setProperty(name,i(t),priority)})})})},d3_transitionPrototype.styleTween=function(name,tween,priority){return arguments.length<3&&(priority=""),this.tween("style."+name,function(d,i){var f=tween.call(this,d,i,d3_window(this).getComputedStyle(this,null).getPropertyValue(name));return f&&function(t){this.style.setProperty(name,f(t),priority)}})},d3_transitionPrototype.text=function(value){return d3_transition_tween(this,"text",value,d3_transition_text)},d3_transitionPrototype.remove=function(){var ns=this.namespace;return this.each("end.transition",function(){var p;this[ns].count<2&&(p=this.parentNode)&&p.removeChild(this)})},d3_transitionPrototype.ease=function(value){var id=this.id,ns=this.namespace;return arguments.length<1?this.node()[ns][id].ease:("function"!=typeof value&&(value=d3.ease.apply(d3,arguments)),d3_selection_each(this,function(node){node[ns][id].ease=value}))},d3_transitionPrototype.delay=function(value){var id=this.id,ns=this.namespace;return arguments.length<1?this.node()[ns][id].delay:d3_selection_each(this,"function"==typeof value?function(node,i,j){node[ns][id].delay=+value.call(node,node.__data__,i,j)}:(value=+value,function(node){node[ns][id].delay=value}))},d3_transitionPrototype.duration=function(value){var id=this.id,ns=this.namespace;return arguments.length<1?this.node()[ns][id].duration:d3_selection_each(this,"function"==typeof value?function(node,i,j){node[ns][id].duration=Math.max(1,value.call(node,node.__data__,i,j))}:(value=Math.max(1,value),function(node){node[ns][id].duration=value}))},d3_transitionPrototype.each=function(type,listener){var id=this.id,ns=this.namespace;if(arguments.length<2){var inherit=d3_transitionInherit,inheritId=d3_transitionInheritId;try{d3_transitionInheritId=id,d3_selection_each(this,function(node,i,j){d3_transitionInherit=node[ns][id],type.call(node,node.__data__,i,j)})}finally{d3_transitionInherit=inherit,d3_transitionInheritId=inheritId}}else d3_selection_each(this,function(transition){transition=transition[ns][id];(transition.event||(transition.event=d3.dispatch("start","end","interrupt"))).on(type,listener)});return this},d3_transitionPrototype.transition=function(){for(var subgroup,node,transition,id0=this.id,id1=++d3_transitionId,ns=this.namespace,subgroups=[],j=0,m=this.length;j<m;j++){subgroups.push(subgroup=[]);for(var group,i=0,n=(group=this[j]).length;i<n;i++)(node=group[i])&&d3_transitionNode(node,i,ns,id1,{time:(transition=node[ns][id0]).time,ease:transition.ease,delay:transition.delay+transition.duration,duration:transition.duration}),subgroup.push(node)}return d3_transition(subgroups,ns,id1)},d3.svg.axis=function(){var tickFormat_,scale=d3.scale.linear(),orient=d3_svg_axisDefaultOrient,innerTickSize=6,outerTickSize=6,tickPadding=3,tickArguments_=[10],tickValues=null;function axis(g){g.each(function(){var tickTransform,text=d3.select(this),scale0=this.__chart__||scale,scale1=this.__chart__=scale.copy(),lineUpdate=null==tickValues?scale1.ticks?scale1.ticks.apply(scale1,tickArguments_):scale1.domain():tickValues,sign=null==tickFormat_?scale1.tickFormat?scale1.tickFormat.apply(scale1,tickArguments_):d3_identity:tickFormat_,textUpdate=text.selectAll(".tick").data(lineUpdate,scale1),tickEnter=textUpdate.enter().insert("g",".domain").attr("class","tick").style("opacity",ε),tickExit=d3.transition(textUpdate.exit()).style("opacity",ε).remove(),tickUpdate=d3.transition(textUpdate.order()).style("opacity",1),tickSpacing=Math.max(innerTickSize,0)+tickPadding,range=d3_scaleRange(scale1),textEnter=text.selectAll(".domain").data([0]),pathUpdate=(textEnter.enter().append("path").attr("class","domain"),d3.transition(textEnter));tickEnter.append("line"),tickEnter.append("text");var x1,x2,y1,y2,x,dx,lineEnter=tickEnter.select("line"),lineUpdate=tickUpdate.select("line"),text=textUpdate.select("text").text(sign),textEnter=tickEnter.select("text"),textUpdate=tickUpdate.select("text"),sign="top"===orient||"left"===orient?-1:1;"bottom"===orient||"top"===orient?(tickTransform=d3_svg_axisX,x1="x",y1="y",x2="x2",y2="y2",text.attr("dy",sign<0?"0em":".71em").style("text-anchor","middle"),pathUpdate.attr("d","M"+range[0]+","+sign*outerTickSize+"V0H"+range[1]+"V"+sign*outerTickSize)):(tickTransform=d3_svg_axisY,x1="y",y1="x",x2="y2",y2="x2",text.attr("dy",".32em").style("text-anchor",sign<0?"end":"start"),pathUpdate.attr("d","M"+sign*outerTickSize+","+range[0]+"H0V"+range[1]+"H"+sign*outerTickSize)),lineEnter.attr(y2,sign*innerTickSize),textEnter.attr(y1,sign*tickSpacing),lineUpdate.attr(x2,0).attr(y2,sign*innerTickSize),textUpdate.attr(x1,0).attr(y1,sign*tickSpacing),scale1.rangeBand?(dx=(x=scale1).rangeBand()/2,scale0=scale1=function(d){return x(d)+dx}):scale0.rangeBand?scale0=scale1:tickExit.call(tickTransform,scale1,scale0),tickEnter.call(tickTransform,scale0,scale1),tickUpdate.call(tickTransform,scale1,scale1)})}return axis.scale=function(x){return arguments.length?(scale=x,axis):scale},axis.orient=function(x){return arguments.length?(orient=x in d3_svg_axisOrients?x+"":d3_svg_axisDefaultOrient,axis):orient},axis.ticks=function(){return arguments.length?(tickArguments_=d3_array(arguments),axis):tickArguments_},axis.tickValues=function(x){return arguments.length?(tickValues=x,axis):tickValues},axis.tickFormat=function(x){return arguments.length?(tickFormat_=x,axis):tickFormat_},axis.tickSize=function(x){var n=arguments.length;return n?(innerTickSize=+x,outerTickSize=+arguments[n-1],axis):innerTickSize},axis.innerTickSize=function(x){return arguments.length?(innerTickSize=+x,axis):innerTickSize},axis.outerTickSize=function(x){return arguments.length?(outerTickSize=+x,axis):outerTickSize},axis.tickPadding=function(x){return arguments.length?(tickPadding=+x,axis):tickPadding},axis.tickSubdivide=function(){return arguments.length&&axis},axis};var d3_svg_axisDefaultOrient="bottom",d3_svg_axisOrients={top:1,right:1,bottom:1,left:1};function d3_svg_axisX(selection,x0,x1){selection.attr("transform",function(d){var v0=x0(d);return"translate("+(isFinite(v0)?v0:x1(d))+",0)"})}function d3_svg_axisY(selection,y0,y1){selection.attr("transform",function(d){var v0=y0(d);return"translate(0,"+(isFinite(v0)?v0:y1(d))+")"})}d3.svg.brush=function(){var xExtentDomain,yExtentDomain,event=d3_eventDispatch(brush,"brushstart","brush","brushend"),x=null,y=null,xExtent=[0,0],yExtent=[0,0],xClamp=!0,yClamp=!0,resizes=d3_svg_brushResizes[0];function brush(g){g.each(function(){var gUpdate=d3.select(this).style("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush",brushstart).on("touchstart.brush",brushstart),backgroundUpdate=gUpdate.selectAll(".background").data([0]);backgroundUpdate.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair"),gUpdate.selectAll(".extent").data([0]).enter().append("rect").attr("class","extent").style("cursor","move");var resize=gUpdate.selectAll(".resize").data(resizes,d3_identity);resize.exit().remove(),resize.enter().append("g").attr("class",function(d){return"resize "+d}).style("cursor",function(d){return d3_svg_brushCursor[d]}).append("rect").attr("x",function(d){return/[ew]$/.test(d)?-3:null}).attr("y",function(d){return/^[ns]/.test(d)?-3:null}).attr("width",6).attr("height",6).style("visibility","hidden"),resize.style("display",brush.empty()?"none":null);var range,gUpdate=d3.transition(gUpdate),backgroundUpdate=d3.transition(backgroundUpdate);x&&(range=d3_scaleRange(x),backgroundUpdate.attr("x",range[0]).attr("width",range[1]-range[0]),redrawX(gUpdate)),y&&(range=d3_scaleRange(y),backgroundUpdate.attr("y",range[0]).attr("height",range[1]-range[0]),redrawY(gUpdate)),redraw(gUpdate)})}function redraw(g){g.selectAll(".resize").attr("transform",function(d){return"translate("+xExtent[+/e$/.test(d)]+","+yExtent[+/^s/.test(d)]+")"})}function redrawX(g){g.select(".extent").attr("x",xExtent[0]),g.selectAll(".extent,.n>rect,.s>rect").attr("width",xExtent[1]-xExtent[0])}function redrawY(g){g.select(".extent").attr("y",yExtent[0]),g.selectAll(".extent,.e>rect,.w>rect").attr("height",yExtent[1]-yExtent[0])}function brushstart(){var center,ex,offset,target=this,eventTarget=d3.select(d3.event.target),event_=event.of(target,arguments),g=d3.select(target),ey=eventTarget.datum(),resizingX=!/^(n|s)$/.test(ey)&&x,resizingY=!/^(e|w)$/.test(ey)&&y,dragging=eventTarget.classed("extent"),dragRestore=d3_event_dragSuppress(target),origin=d3.mouse(target),w=d3.select(d3_window(target)).on("keydown.brush",function(){32==d3.event.keyCode&&(dragging||(center=null,origin[0]-=xExtent[1],origin[1]-=yExtent[1],dragging=2),d3_eventPreventDefault())}).on("keyup.brush",function(){32==d3.event.keyCode&&2==dragging&&(origin[0]+=xExtent[1],origin[1]+=yExtent[1],dragging=0,d3_eventPreventDefault())});function brushmove(){var point=d3.mouse(target),moved=!1;offset&&(point[0]+=offset[0],point[1]+=offset[1]),dragging||(d3.event.altKey?(center=center||[(xExtent[0]+xExtent[1])/2,(yExtent[0]+yExtent[1])/2],origin[0]=xExtent[+(point[0]<center[0])],origin[1]=yExtent[+(point[1]<center[1])]):center=null),resizingX&&move1(point,x,0)&&(redrawX(g),moved=!0),resizingY&&move1(point,y,1)&&(redrawY(g),moved=!0),moved&&(redraw(g),event_({type:"brush",mode:dragging?"move":"resize"}))}function move1(min,extent,i){var max,size=d3_scaleRange(extent),r0=size[0],r1=size[1],position=origin[i],extent=i?yExtent:xExtent,size=extent[1]-extent[0];return dragging&&(r0-=position,r1-=size+position),min=(i?yClamp:xClamp)?Math.max(r0,Math.min(r1,min[i])):min[i],dragging?max=(min+=position)+size:(position=center?Math.max(r0,Math.min(r1,2*center[i]-min)):position)<min?(max=min,min=position):max=position,(extent[0]!=min||extent[1]!=max)&&(i?yExtentDomain=null:xExtentDomain=null,extent[0]=min,extent[1]=max,1)}function brushend(){brushmove(),g.style("pointer-events","all").selectAll(".resize").style("display",brush.empty()?"none":null),d3.select("body").style("cursor",null),w.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null),dragRestore(),event_({type:"brushend"})}d3.event.changedTouches?w.on("touchmove.brush",brushmove).on("touchend.brush",brushend):w.on("mousemove.brush",brushmove).on("mouseup.brush",brushend),g.interrupt().selectAll("*").interrupt(),dragging?(origin[0]=xExtent[0]-origin[0],origin[1]=yExtent[0]-origin[1]):ey?(ex=+/w$/.test(ey),ey=+/^n/.test(ey),offset=[xExtent[1-ex]-origin[0],yExtent[1-ey]-origin[1]],origin[0]=xExtent[ex],origin[1]=yExtent[ey]):d3.event.altKey&&(center=origin.slice()),g.style("pointer-events","none").selectAll(".resize").style("display",null),d3.select("body").style("cursor",eventTarget.style("cursor")),event_({type:"brushstart"}),brushmove()}return brush.event=function(g){g.each(function(){var event_=event.of(this,arguments),extent1={x:xExtent,y:yExtent,i:xExtentDomain,j:yExtentDomain},extent0=this.__chart__||extent1;this.__chart__=extent1,d3_transitionInheritId?d3.select(this).transition().each("start.brush",function(){xExtentDomain=extent0.i,yExtentDomain=extent0.j,xExtent=extent0.x,yExtent=extent0.y,event_({type:"brushstart"})}).tween("brush:brush",function(){var xi=d3_interpolateArray(xExtent,extent1.x),yi=d3_interpolateArray(yExtent,extent1.y);return xExtentDomain=yExtentDomain=null,function(t){xExtent=extent1.x=xi(t),yExtent=extent1.y=yi(t),event_({type:"brush",mode:"resize"})}}).each("end.brush",function(){xExtentDomain=extent1.i,yExtentDomain=extent1.j,event_({type:"brush",mode:"resize"}),event_({type:"brushend"})}):(event_({type:"brushstart"}),event_({type:"brush",mode:"resize"}),event_({type:"brushend"}))})},brush.x=function(z){return arguments.length?(resizes=d3_svg_brushResizes[!(x=z)<<1|!y],brush):x},brush.y=function(z){return arguments.length?(resizes=d3_svg_brushResizes[!x<<1|!(y=z)],brush):y},brush.clamp=function(z){return arguments.length?(x&&y?(xClamp=!!z[0],yClamp=!!z[1]):x?xClamp=!!z:y&&(yClamp=!!z),brush):x&&y?[xClamp,yClamp]:x?xClamp:y?yClamp:null},brush.extent=function(z){var x0,x1,y0,y1,t;return arguments.length?(x&&(x0=z[0],x1=z[1],y&&(x0=x0[0],x1=x1[0]),xExtentDomain=[x0,x1],x.invert&&(x0=x(x0),x1=x(x1)),x1<x0&&(t=x0,x0=x1,x1=t),x0==xExtent[0]&&x1==xExtent[1]||(xExtent=[x0,x1])),y&&(y0=z[0],y1=z[1],x&&(y0=y0[1],y1=y1[1]),yExtentDomain=[y0,y1],y.invert&&(y0=y(y0),y1=y(y1)),y1<y0&&(t=y0,y0=y1,y1=t),y0==yExtent[0]&&y1==yExtent[1]||(yExtent=[y0,y1])),brush):(x&&(xExtentDomain?(x0=xExtentDomain[0],x1=xExtentDomain[1]):(x0=xExtent[0],x1=xExtent[1],x.invert&&(x0=x.invert(x0),x1=x.invert(x1)),x1<x0&&(t=x0,x0=x1,x1=t))),y&&(yExtentDomain?(y0=yExtentDomain[0],y1=yExtentDomain[1]):(y0=yExtent[0],y1=yExtent[1],y.invert&&(y0=y.invert(y0),y1=y.invert(y1)),y1<y0&&(t=y0,y0=y1,y1=t))),x&&y?[[x0,y0],[x1,y1]]:x?[x0,x1]:y&&[y0,y1])},brush.clear=function(){return brush.empty()||(xExtent=[0,0],yExtent=[0,0],xExtentDomain=yExtentDomain=null),brush},brush.empty=function(){return!!x&&xExtent[0]==xExtent[1]||!!y&&yExtent[0]==yExtent[1]},d3.rebind(brush,event,"on")};var d3_svg_brushCursor={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},d3_svg_brushResizes=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]],d3_time_format=d3_time.format=d3_time_formatIso.timeFormat,d3_time_formatUtc=d3_time_format.utc,d3_time_formatIso=d3_time_formatUtc("%Y-%m-%dT%H:%M:%S.%LZ");function d3_time_formatIsoNative(date){return date.toISOString()}function d3_time_scale(linear,methods,format){function scale(x){return linear(x)}function tickMethod(extent,count){var target=(extent[1]-extent[0])/count,i=d3.bisect(d3_time_scaleSteps,target);return i==d3_time_scaleSteps.length?[methods.year,d3_scale_linearTickRange(extent.map(function(d){return d/31536e6}),count)[2]]:i?methods[target/d3_time_scaleSteps[i-1]<d3_time_scaleSteps[i]/target?i-1:i]:[d3_time_scaleMilliseconds,d3_scale_linearTickRange(extent,count)[2]]}return scale.invert=function(x){return d3_time_scaleDate(linear.invert(x))},scale.domain=function(x){return arguments.length?(linear.domain(x),scale):linear.domain().map(d3_time_scaleDate)},scale.nice=function(interval,skip){var domain=scale.domain(),method=d3_scaleExtent(domain),method=null==interval?tickMethod(method,10):"number"==typeof interval&&tickMethod(method,interval);function skipped(date){return!isNaN(date)&&!interval.range(date,d3_time_scaleDate(+date+1),skip).length}return method&&(interval=method[0],skip=method[1]),scale.domain(d3_scale_nice(domain,1<skip?{floor:function(date){for(;skipped(date=interval.floor(date));)date=d3_time_scaleDate(date-1);return date},ceil:function(date){for(;skipped(date=interval.ceil(date));)date=d3_time_scaleDate(+date+1);return date}}:interval))},scale.ticks=function(interval,skip){var extent=d3_scaleExtent(scale.domain()),method=null==interval?tickMethod(extent,10):"number"==typeof interval?tickMethod(extent,interval):!interval.range&&[{range:interval},skip];return method&&(interval=method[0],skip=method[1]),interval.range(extent[0],d3_time_scaleDate(+extent[1]+1),skip<1?1:skip)},scale.tickFormat=function(){return format},scale.copy=function(){return d3_time_scale(linear.copy(),methods,format)},d3_scale_linearRebind(scale,linear)}function d3_time_scaleDate(t){return new Date(t)}d3_time_format.iso=Date.prototype.toISOString&&+new Date("2000-01-01T00:00:00.000Z")?d3_time_formatIsoNative:d3_time_formatIso,d3_time_formatIsoNative.parse=function(date){date=new Date(date);return isNaN(date)?null:date},d3_time_formatIsoNative.toString=d3_time_formatIso.toString,d3_time.second=d3_time_interval(function(date){return new d3_date(1e3*Math.floor(date/1e3))},function(date,offset){date.setTime(date.getTime()+1e3*Math.floor(offset))},function(date){return date.getSeconds()}),d3_time.seconds=d3_time.second.range,d3_time.seconds.utc=d3_time.second.utc.range,d3_time.minute=d3_time_interval(function(date){return new d3_date(6e4*Math.floor(date/6e4))},function(date,offset){date.setTime(date.getTime()+6e4*Math.floor(offset))},function(date){return date.getMinutes()}),d3_time.minutes=d3_time.minute.range,d3_time.minutes.utc=d3_time.minute.utc.range,d3_time.hour=d3_time_interval(function(date){var timezone=date.getTimezoneOffset()/60;return new d3_date(36e5*(Math.floor(date/36e5-timezone)+timezone))},function(date,offset){date.setTime(date.getTime()+36e5*Math.floor(offset))},function(date){return date.getHours()}),d3_time.hours=d3_time.hour.range,d3_time.hours.utc=d3_time.hour.utc.range,d3_time.month=d3_time_interval(function(date){return(date=d3_time.day(date)).setDate(1),date},function(date,offset){date.setMonth(date.getMonth()+offset)},function(date){return date.getMonth()}),d3_time.months=d3_time.month.range,d3_time.months.utc=d3_time.month.utc.range;var d3_time_scaleSteps=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6],d3_time_scaleLocalMethods=[[d3_time.second,1],[d3_time.second,5],[d3_time.second,15],[d3_time.second,30],[d3_time.minute,1],[d3_time.minute,5],[d3_time.minute,15],[d3_time.minute,30],[d3_time.hour,1],[d3_time.hour,3],[d3_time.hour,6],[d3_time.hour,12],[d3_time.day,1],[d3_time.day,2],[d3_time.week,1],[d3_time.month,1],[d3_time.month,3],[d3_time.year,1]],d3_time_scaleLocalFormat=d3_time_format.multi([[".%L",function(d){return d.getMilliseconds()}],[":%S",function(d){return d.getSeconds()}],["%I:%M",function(d){return d.getMinutes()}],["%I %p",function(d){return d.getHours()}],["%a %d",function(d){return d.getDay()&&1!=d.getDate()}],["%b %d",function(d){return 1!=d.getDate()}],["%B",function(d){return d.getMonth()}],["%Y",d3_true]]),d3_time_scaleMilliseconds={range:function(start,stop,step){return d3.range(Math.ceil(start/step)*step,+stop,step).map(d3_time_scaleDate)},floor:d3_identity,ceil:d3_identity};d3_time_scaleLocalMethods.year=d3_time.year,d3_time.scale=function(){return d3_time_scale(d3.scale.linear(),d3_time_scaleLocalMethods,d3_time_scaleLocalFormat)};var d3_time_scaleUtcMethods=d3_time_scaleLocalMethods.map(function(m){return[m[0].utc,m[1]]}),d3_time_scaleUtcFormat=d3_time_formatUtc.multi([[".%L",function(d){return d.getUTCMilliseconds()}],[":%S",function(d){return d.getUTCSeconds()}],["%I:%M",function(d){return d.getUTCMinutes()}],["%I %p",function(d){return d.getUTCHours()}],["%a %d",function(d){return d.getUTCDay()&&1!=d.getUTCDate()}],["%b %d",function(d){return 1!=d.getUTCDate()}],["%B",function(d){return d.getUTCMonth()}],["%Y",d3_true]]);function d3_json(request){return JSON.parse(request.responseText)}function d3_html(request){var range=d3_document.createRange();return range.selectNode(d3_document.body),range.createContextualFragment(request.responseText)}d3_time_scaleUtcMethods.year=d3_time.year.utc,d3_time.scale.utc=function(){return d3_time_scale(d3.scale.linear(),d3_time_scaleUtcMethods,d3_time_scaleUtcFormat)},d3.text=d3_xhrType(function(request){return request.responseText}),d3.json=function(url,callback){return d3_xhr(url,"application/json",d3_json,callback)},d3.html=function(url,callback){return d3_xhr(url,"text/html",d3_html,callback)},d3.xml=d3_xhrType(function(request){return request.responseXML}),"function"==typeof define&&define.amd?(this.d3=d3,define(d3)):"object"==typeof module&&module.exports?module.exports=d3:this.d3=d3}()},{}],2:[function(require,module,exports){!function(scope){"use strict";function WebMidi(){if(WebMidi.prototype._singleton)throw new Error("WebMidi is a singleton, it cannot be instantiated directly.");(WebMidi.prototype._singleton=this)._inputs=[],this._outputs=[],this._userHandlers={},this._stateChangeQueue=[],this._processingStateChange=!1,this._midiInterfaceEvents=["connected","disconnected"],this._nrpnBuffer=[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]],this._nrpnEventsEnabled=!0,this._nrpnTypes=["entry","increment","decrement"],this._notes=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],this._semitones={C:0,D:2,E:4,F:5,G:7,A:9,B:11},Object.defineProperties(this,{MIDI_SYSTEM_MESSAGES:{value:{sysex:240,timecode:241,songposition:242,songselect:243,tuningrequest:246,sysexend:247,clock:248,start:250,continue:251,stop:252,activesensing:254,reset:255,midimessage:0,unknownsystemmessage:-1},writable:!1,enumerable:!0,configurable:!1},MIDI_CHANNEL_MESSAGES:{value:{noteoff:8,noteon:9,keyaftertouch:10,controlchange:11,channelmode:11,nrpn:11,programchange:12,channelaftertouch:13,pitchbend:14},writable:!1,enumerable:!0,configurable:!1},MIDI_REGISTERED_PARAMETER:{value:{pitchbendrange:[0,0],channelfinetuning:[0,1],channelcoarsetuning:[0,2],tuningprogram:[0,3],tuningbank:[0,4],modulationrange:[0,5],azimuthangle:[61,0],elevationangle:[61,1],gain:[61,2],distanceratio:[61,3],maximumdistance:[61,4],maximumdistancegain:[61,5],referencedistanceratio:[61,6],panspreadangle:[61,7],rollangle:[61,8]},writable:!1,enumerable:!0,configurable:!1},MIDI_CONTROL_CHANGE_MESSAGES:{value:{bankselectcoarse:0,modulationwheelcoarse:1,breathcontrollercoarse:2,footcontrollercoarse:4,portamentotimecoarse:5,dataentrycoarse:6,volumecoarse:7,balancecoarse:8,pancoarse:10,expressioncoarse:11,effectcontrol1coarse:12,effectcontrol2coarse:13,generalpurposeslider1:16,generalpurposeslider2:17,generalpurposeslider3:18,generalpurposeslider4:19,bankselectfine:32,modulationwheelfine:33,breathcontrollerfine:34,footcontrollerfine:36,portamentotimefine:37,dataentryfine:38,volumefine:39,balancefine:40,panfine:42,expressionfine:43,effectcontrol1fine:44,effectcontrol2fine:45,holdpedal:64,portamento:65,sustenutopedal:66,softpedal:67,legatopedal:68,hold2pedal:69,soundvariation:70,resonance:71,soundreleasetime:72,soundattacktime:73,brightness:74,soundcontrol6:75,soundcontrol7:76,soundcontrol8:77,soundcontrol9:78,soundcontrol10:79,generalpurposebutton1:80,generalpurposebutton2:81,generalpurposebutton3:82,generalpurposebutton4:83,reverblevel:91,tremololevel:92,choruslevel:93,celestelevel:94,phaserlevel:95,databuttonincrement:96,databuttondecrement:97,nonregisteredparametercoarse:98,nonregisteredparameterfine:99,registeredparametercoarse:100,registeredparameterfine:101},writable:!1,enumerable:!0,configurable:!1},MIDI_NRPN_MESSAGES:{value:{entrymsb:6,entrylsb:38,increment:96,decrement:97,paramlsb:98,parammsb:99,nullactiveparameter:127},writable:!1,enumerable:!0,configurable:!1},MIDI_CHANNEL_MODE_MESSAGES:{value:{allsoundoff:120,resetallcontrollers:121,localcontrol:122,allnotesoff:123,omnimodeoff:124,omnimodeon:125,monomodeon:126,polymodeon:127},writable:!1,enumerable:!0,configurable:!1},octaveOffset:{value:0,writable:!0,enumerable:!0,configurable:!1}}),Object.defineProperties(this,{supported:{enumerable:!0,get:function(){return"requestMIDIAccess"in navigator}},enabled:{enumerable:!0,get:function(){return void 0!==this.interface}.bind(this)},inputs:{enumerable:!0,get:function(){return this._inputs}.bind(this)},outputs:{enumerable:!0,get:function(){return this._outputs}.bind(this)},sysexEnabled:{enumerable:!0,get:function(){return!(!this.interface||!this.interface.sysexEnabled)}.bind(this)},nrpnEventsEnabled:{enumerable:!0,get:function(){return!!this._nrpnEventsEnabled}.bind(this),set:function(enabled){return this._nrpnEventsEnabled=enabled,this._nrpnEventsEnabled}},nrpnTypes:{enumerable:!0,get:function(){return this._nrpnTypes}.bind(this)},time:{enumerable:!0,get:function(){return performance.now()}}})}var wm=new WebMidi;function Input(midiInput){var that=this;this._userHandlers={channel:{},system:{}},this._midiInput=midiInput,Object.defineProperties(this,{connection:{enumerable:!0,get:function(){return that._midiInput.connection}},id:{enumerable:!0,get:function(){return that._midiInput.id}},manufacturer:{enumerable:!0,get:function(){return that._midiInput.manufacturer}},name:{enumerable:!0,get:function(){return that._midiInput.name}},state:{enumerable:!0,get:function(){return that._midiInput.state}},type:{enumerable:!0,get:function(){return that._midiInput.type}}}),this._initializeUserHandlers(),this._midiInput.onmidimessage=this._onMidiMessage.bind(this)}function Output(midiOutput){var that=this;this._midiOutput=midiOutput,Object.defineProperties(this,{connection:{enumerable:!0,get:function(){return that._midiOutput.connection}},id:{enumerable:!0,get:function(){return that._midiOutput.id}},manufacturer:{enumerable:!0,get:function(){return that._midiOutput.manufacturer}},name:{enumerable:!0,get:function(){return that._midiOutput.name}},state:{enumerable:!0,get:function(){return that._midiOutput.state}},type:{enumerable:!0,get:function(){return that._midiOutput.type}}})}WebMidi.prototype.enable=function(callback,sysex){this.enabled||(this.supported?navigator.requestMIDIAccess({sysex:sysex}).then(function(midiAccess){var promiseTimeout,events=[],promises=[];this.interface=midiAccess,this._resetInterfaceUserHandlers(),this.interface.onstatechange=function(e){events.push(e)};for(var inputs=midiAccess.inputs.values(),input=inputs.next();input&&!input.done;input=inputs.next())promises.push(input.value.open());for(var outputs=midiAccess.outputs.values(),output=outputs.next();output&&!output.done;output=outputs.next())promises.push(output.value.open());function onPortsOpen(){clearTimeout(promiseTimeout),this._updateInputsAndOutputs(),this.interface.onstatechange=this._onInterfaceStateChange.bind(this),"function"==typeof callback&&callback.call(this),events.forEach(function(event){this._onInterfaceStateChange(event)}.bind(this))}promiseTimeout=setTimeout(onPortsOpen.bind(this),200),Promise&&Promise.all(promises).catch(function(err){}).then(onPortsOpen.bind(this))}.bind(this),function(err){"function"==typeof callback&&callback.call(this,err)}.bind(this)):"function"==typeof callback&&callback(new Error("The Web MIDI API is not supported by your browser.")))},WebMidi.prototype.disable=function(){if(!this.supported)throw new Error("The Web MIDI API is not supported by your browser.");this.enabled&&(this.removeListener(),this.inputs.forEach(function(input){input.removeListener()})),this.interface&&(this.interface.onstatechange=void 0),this.interface=void 0,this._inputs=[],this._outputs=[],this._nrpnEventsEnabled=!0,this._resetInterfaceUserHandlers()},WebMidi.prototype.addListener=function(type,listener){if(!this.enabled)throw new Error("WebMidi must be enabled before adding event listeners.");if("function"!=typeof listener)throw new TypeError("The 'listener' parameter must be a function.");if(!(0<=this._midiInterfaceEvents.indexOf(type)))throw new TypeError("The specified event type is not supported.");return this._userHandlers[type].push(listener),this},WebMidi.prototype.hasListener=function(type,listener){if(!this.enabled)throw new Error("WebMidi must be enabled before checking event listeners.");if("function"!=typeof listener)throw new TypeError("The 'listener' parameter must be a function.");if(!(0<=this._midiInterfaceEvents.indexOf(type)))throw new TypeError("The specified event type is not supported.");for(var o=0;o<this._userHandlers[type].length;o++)if(this._userHandlers[type][o]===listener)return!0;return!1},WebMidi.prototype.removeListener=function(type,listener){if(!this.enabled)throw new Error("WebMidi must be enabled before removing event listeners.");if(void 0!==listener&&"function"!=typeof listener)throw new TypeError("The 'listener' parameter must be a function.");if(0<=this._midiInterfaceEvents.indexOf(type))if(listener)for(var o=0;o<this._userHandlers[type].length;o++)this._userHandlers[type][o]===listener&&this._userHandlers[type].splice(o,1);else this._userHandlers[type]=[];else{if(void 0!==type)throw new TypeError("The specified event type is not supported.");this._resetInterfaceUserHandlers()}return this},WebMidi.prototype.toMIDIChannels=function(channel){var channels;if("all"===channel||void 0===channel)channels=["all"];else{if("none"===channel)return[];channels=Array.isArray(channel)?channel:[channel]}return(channels=-1<channels.indexOf("all")?[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]:channels).map(function(ch){return parseInt(ch)}).filter(function(ch){return 1<=ch&&ch<=16})},WebMidi.prototype.getInputById=function(id){if(!this.enabled)throw new Error("WebMidi is not enabled.");id=String(id);for(var i=0;i<this.inputs.length;i++)if(this.inputs[i].id===id)return this.inputs[i];return!1},WebMidi.prototype.getOutputById=function(id){if(!this.enabled)throw new Error("WebMidi is not enabled.");id=String(id);for(var i=0;i<this.outputs.length;i++)if(this.outputs[i].id===id)return this.outputs[i];return!1},WebMidi.prototype.getInputByName=function(name){if(!this.enabled)throw new Error("WebMidi is not enabled.");for(var i=0;i<this.inputs.length;i++)if(~this.inputs[i].name.indexOf(name))return this.inputs[i];return!1},WebMidi.prototype.getOctave=function(number){if(null!=number&&0<=number&&number<=127)return Math.floor(Math.floor(number)/12-1)+Math.floor(wm.octaveOffset)},WebMidi.prototype.getOutputByName=function(name){if(!this.enabled)throw new Error("WebMidi is not enabled.");for(var i=0;i<this.outputs.length;i++)if(~this.outputs[i].name.indexOf(name))return this.outputs[i];return!1},WebMidi.prototype.guessNoteNumber=function(input){var output=!1;if(input&&input.toFixed&&0<=input&&input<=127?output=Math.round(input):0<=parseInt(input)&&parseInt(input)<=127?output=parseInt(input):("string"==typeof input||input instanceof String)&&(output=this.noteNameToNumber(input)),!1===output)throw new Error("Invalid input value ("+input+").");return output},WebMidi.prototype.noteNameToNumber=function(result){var matches=(result="string"!=typeof result?"":result).match(/([CDEFGAB])(#{0,2}|b{0,2})(-?\d+)/i);if(!matches)throw new RangeError("Invalid note name.");result=wm._semitones[matches[1].toUpperCase()],result=12*(parseInt(matches[3])+1-Math.floor(wm.octaveOffset))+result;if(-1<matches[2].toLowerCase().indexOf("b")?result-=matches[2].length:-1<matches[2].toLowerCase().indexOf("#")&&(result+=matches[2].length),result<0||127<result)throw new RangeError("Invalid note name or note outside valid range.");return result},WebMidi.prototype._updateInputsAndOutputs=function(){this._updateInputs(),this._updateOutputs()},WebMidi.prototype._updateInputs=function(){for(var i=0;i<this._inputs.length;i++){for(var remove=!0,updated=this.interface.inputs.values(),input=updated.next();input&&!input.done;input=updated.next())if(this._inputs[i]._midiInput===input.value){remove=!1;break}remove&&this._inputs.splice(i,1)}this.interface&&this.interface.inputs.forEach(function(nInput){for(var add=!0,j=0;j<this._inputs.length;j++)this._inputs[j]._midiInput===nInput&&(add=!1);add&&this._inputs.push(new Input(nInput))}.bind(this))},WebMidi.prototype._updateOutputs=function(){for(var i=0;i<this._outputs.length;i++){for(var remove=!0,updated=this.interface.outputs.values(),output=updated.next();output&&!output.done;output=updated.next())if(this._outputs[i]._midiOutput===output.value){remove=!1;break}remove&&this._outputs.splice(i,1)}this.interface&&this.interface.outputs.forEach(function(nOutput){for(var add=!0,j=0;j<this._outputs.length;j++)this._outputs[j]._midiOutput===nOutput&&(add=!1);add&&this._outputs.push(new Output(nOutput))}.bind(this))},WebMidi.prototype._onInterfaceStateChange=function(e){this._updateInputsAndOutputs();var event={timestamp:e.timeStamp,type:e.port.state};this.interface&&"connected"===e.port.state?"output"===e.port.type?event.port=this.getOutputById(e.port.id):"input"===e.port.type&&(event.port=this.getInputById(e.port.id)):event.port={connection:"closed",id:e.port.id,manufacturer:e.port.manufacturer,name:e.port.name,state:e.port.state,type:e.port.type},this._userHandlers[e.port.state].forEach(function(handler){handler(event)})},WebMidi.prototype._resetInterfaceUserHandlers=function(){for(var i=0;i<this._midiInterfaceEvents.length;i++)this._userHandlers[this._midiInterfaceEvents[i]]=[]},Input.prototype.on=Input.prototype.addListener=function(type,channel,listener){var that=this;if(void 0===channel&&(channel="all"),(channel=!Array.isArray(channel)?[channel]:channel).forEach(function(item){if("all"!==item&&!(1<=item&&item<=16))throw new RangeError("The 'channel' parameter is invalid.")}),"function"!=typeof listener)throw new TypeError("The 'listener' parameter must be a function.");if(void 0!==wm.MIDI_SYSTEM_MESSAGES[type])this._userHandlers.system[type]||(this._userHandlers.system[type]=[]),this._userHandlers.system[type].push(listener);else{if(void 0===wm.MIDI_CHANNEL_MESSAGES[type])throw new TypeError("The specified event type is not supported.");if(-1<channel.indexOf("all")){channel=[];for(var j=1;j<=16;j++)channel.push(j)}this._userHandlers.channel[type]||(this._userHandlers.channel[type]=[]),channel.forEach(function(ch){that._userHandlers.channel[type][ch]||(that._userHandlers.channel[type][ch]=[]),that._userHandlers.channel[type][ch].push(listener)})}return this},Input.prototype.hasListener=function(type,channel,listener){var that=this;if("function"!=typeof listener)throw new TypeError("The 'listener' parameter must be a function.");if((channel=void 0===channel?"all":channel).constructor!==Array&&(channel=[channel]),void 0!==wm.MIDI_SYSTEM_MESSAGES[type]){for(var o=0;o<this._userHandlers.system[type].length;o++)if(this._userHandlers.system[type][o]===listener)return!0}else if(void 0!==wm.MIDI_CHANNEL_MESSAGES[type]){if(-1<channel.indexOf("all")){channel=[];for(var j=1;j<=16;j++)channel.push(j)}return!!this._userHandlers.channel[type]&&channel.every(function(listeners){listeners=that._userHandlers.channel[type][listeners];return listeners&&-1<listeners.indexOf(listener)})}return!1},Input.prototype.removeListener=function(type,channel,listener){var that=this;if(void 0!==listener&&"function"!=typeof listener)throw new TypeError("The 'listener' parameter must be a function.");if((channel=void 0===channel?"all":channel).constructor!==Array&&(channel=[channel]),void 0!==wm.MIDI_SYSTEM_MESSAGES[type])if(void 0===listener)this._userHandlers.system[type]=[];else for(var o=0;o<this._userHandlers.system[type].length;o++)this._userHandlers.system[type][o]===listener&&this._userHandlers.system[type].splice(o,1);else if(void 0!==wm.MIDI_CHANNEL_MESSAGES[type]){if(-1<channel.indexOf("all")){channel=[];for(var j=1;j<=16;j++)channel.push(j)}if(!this._userHandlers.channel[type])return this;channel.forEach(function(chNum){var listeners=that._userHandlers.channel[type][chNum];if(listeners)if(void 0===listener)that._userHandlers.channel[type][chNum]=[];else for(var l=0;l<listeners.length;l++)listeners[l]===listener&&listeners.splice(l,1)})}else{if(void 0!==type)throw new TypeError("The specified event type is not supported.");this._initializeUserHandlers()}return this},Input.prototype._initializeUserHandlers=function(){for(var prop1 in wm.MIDI_CHANNEL_MESSAGES)Object.prototype.hasOwnProperty.call(wm.MIDI_CHANNEL_MESSAGES,prop1)&&(this._userHandlers.channel[prop1]={});for(var prop2 in wm.MIDI_SYSTEM_MESSAGES)Object.prototype.hasOwnProperty.call(wm.MIDI_SYSTEM_MESSAGES,prop2)&&(this._userHandlers.system[prop2]=[])},Input.prototype._onMidiMessage=function(e){var event;0<this._userHandlers.system.midimessage.length&&(event={target:this,data:e.data,timestamp:e.timeStamp,type:"midimessage"},this._userHandlers.system.midimessage.forEach(function(callback){callback(event)})),e.data[0]<240?(this._parseChannelEvent(e),this._parseNrpnEvent(e)):e.data[0]<=255&&this._parseSystemEvent(e)},Input.prototype._parseNrpnEvent=function(ccEvent){var command=ccEvent.data[0]>>4,channelBufferIndex=15&ccEvent.data[0];if(1<ccEvent.data.length&&(nrpnNumber=ccEvent.data[1],nrpnValue=2<ccEvent.data.length?ccEvent.data[2]:void 0),wm.nrpnEventsEnabled&&command===wm.MIDI_CHANNEL_MESSAGES.controlchange&&(nrpnNumber>=wm.MIDI_NRPN_MESSAGES.increment&&nrpnNumber<=wm.MIDI_NRPN_MESSAGES.parammsb||nrpnNumber===wm.MIDI_NRPN_MESSAGES.entrymsb||nrpnNumber===wm.MIDI_NRPN_MESSAGES.entrylsb)){ccEvent={target:this,type:"controlchange",data:ccEvent.data,timestamp:ccEvent.timeStamp,channel:1+channelBufferIndex,controller:{number:nrpnNumber,name:this.getCcNameByNumber(nrpnNumber)},value:nrpnValue};if(ccEvent.controller.number===wm.MIDI_NRPN_MESSAGES.parammsb&&ccEvent.value!=wm.MIDI_NRPN_MESSAGES.nullactiveparameter)wm._nrpnBuffer[channelBufferIndex]=[],wm._nrpnBuffer[channelBufferIndex][0]=ccEvent;else if(1===wm._nrpnBuffer[channelBufferIndex].length&&ccEvent.controller.number===wm.MIDI_NRPN_MESSAGES.paramlsb)wm._nrpnBuffer[channelBufferIndex].push(ccEvent);else if(2!==wm._nrpnBuffer[channelBufferIndex].length||ccEvent.controller.number!==wm.MIDI_NRPN_MESSAGES.increment&&ccEvent.controller.number!==wm.MIDI_NRPN_MESSAGES.decrement&&ccEvent.controller.number!==wm.MIDI_NRPN_MESSAGES.entrymsb)if(3===wm._nrpnBuffer[channelBufferIndex].length&&wm._nrpnBuffer[channelBufferIndex][2].number===wm.MIDI_NRPN_MESSAGES.entrymsb&&ccEvent.controller.number===wm.MIDI_NRPN_MESSAGES.entrylsb)wm._nrpnBuffer[channelBufferIndex].push(ccEvent);else if(3<=wm._nrpnBuffer[channelBufferIndex].length&&wm._nrpnBuffer[channelBufferIndex].length<=4&&ccEvent.controller.number===wm.MIDI_NRPN_MESSAGES.parammsb&&ccEvent.value===wm.MIDI_NRPN_MESSAGES.nullactiveparameter)wm._nrpnBuffer[channelBufferIndex].push(ccEvent);else if(4<=wm._nrpnBuffer[channelBufferIndex].length&&wm._nrpnBuffer[channelBufferIndex].length<=5&&ccEvent.controller.number===wm.MIDI_NRPN_MESSAGES.paramlsb&&ccEvent.value===wm.MIDI_NRPN_MESSAGES.nullactiveparameter){wm._nrpnBuffer[channelBufferIndex].push(ccEvent);var rawData=[];wm._nrpnBuffer[channelBufferIndex].forEach(function(ev){rawData.push(ev.data)});var nrpnNumber=wm._nrpnBuffer[channelBufferIndex][0].value<<7|wm._nrpnBuffer[channelBufferIndex][1].value,nrpnValue=wm._nrpnBuffer[channelBufferIndex][2].value;6===wm._nrpnBuffer[channelBufferIndex].length&&(nrpnValue=wm._nrpnBuffer[channelBufferIndex][2].value<<7|wm._nrpnBuffer[channelBufferIndex][3].value);var nrpnControllerType="";switch(wm._nrpnBuffer[channelBufferIndex][2].controller.number){case wm.MIDI_NRPN_MESSAGES.entrymsb:nrpnControllerType=wm._nrpnTypes[0];break;case wm.MIDI_NRPN_MESSAGES.increment:nrpnControllerType=wm._nrpnTypes[1];break;case wm.MIDI_NRPN_MESSAGES.decrement:nrpnControllerType=wm._nrpnTypes[2];break;default:throw new Error("The NPRN type was unidentifiable.")}var nrpnEvent={timestamp:ccEvent.timestamp,channel:ccEvent.channel,type:"nrpn",data:rawData,controller:{number:nrpnNumber,type:nrpnControllerType,name:"Non-Registered Parameter "+nrpnNumber},value:nrpnValue};wm._nrpnBuffer[channelBufferIndex]=[],this._userHandlers.channel[nrpnEvent.type]&&this._userHandlers.channel[nrpnEvent.type][nrpnEvent.channel]&&this._userHandlers.channel[nrpnEvent.type][nrpnEvent.channel].forEach(function(callback){callback(nrpnEvent)})}else wm._nrpnBuffer[channelBufferIndex]=[];else wm._nrpnBuffer[channelBufferIndex].push(ccEvent)}},Input.prototype._parseChannelEvent=function(e){var data1,data2,command=e.data[0]>>4,channel=1+(15&e.data[0]);1<e.data.length&&(data1=e.data[1],data2=2<e.data.length?e.data[2]:void 0);var event={target:this,data:e.data,timestamp:e.timeStamp,channel:channel};command===wm.MIDI_CHANNEL_MESSAGES.noteoff||command===wm.MIDI_CHANNEL_MESSAGES.noteon&&0===data2?(event.type="noteoff",event.note={number:data1,name:wm._notes[data1%12],octave:wm.getOctave(data1)},event.velocity=data2/127,event.rawVelocity=data2):command===wm.MIDI_CHANNEL_MESSAGES.noteon?(event.type="noteon",event.note={number:data1,name:wm._notes[data1%12],octave:wm.getOctave(data1)},event.velocity=data2/127,event.rawVelocity=data2):command===wm.MIDI_CHANNEL_MESSAGES.keyaftertouch?(event.type="keyaftertouch",event.note={number:data1,name:wm._notes[data1%12],octave:wm.getOctave(data1)},event.value=data2/127):command===wm.MIDI_CHANNEL_MESSAGES.controlchange&&0<=data1&&data1<=119?(event.type="controlchange",event.controller={number:data1,name:this.getCcNameByNumber(data1)},event.value=data2):command===wm.MIDI_CHANNEL_MESSAGES.channelmode&&120<=data1&&data1<=127?(event.type="channelmode",event.controller={number:data1,name:this.getChannelModeByNumber(data1)},event.value=data2):command===wm.MIDI_CHANNEL_MESSAGES.programchange?(event.type="programchange",event.value=data1):command===wm.MIDI_CHANNEL_MESSAGES.channelaftertouch?(event.type="channelaftertouch",event.value=data1/127):command===wm.MIDI_CHANNEL_MESSAGES.pitchbend?(event.type="pitchbend",event.value=((data2<<7)+data1-8192)/8192):event.type="unknownchannelmessage",this._userHandlers.channel[event.type]&&this._userHandlers.channel[event.type][channel]&&this._userHandlers.channel[event.type][channel].forEach(function(callback){callback(event)})},Input.prototype.getCcNameByNumber=function(number){if(!(0<=(number=Math.floor(number))&&number<=119))throw new RangeError("The control change number must be between 0 and 119.");for(var cc in wm.MIDI_CONTROL_CHANGE_MESSAGES)if(Object.prototype.hasOwnProperty.call(wm.MIDI_CONTROL_CHANGE_MESSAGES,cc)&&number===wm.MIDI_CONTROL_CHANGE_MESSAGES[cc])return cc},Input.prototype.getChannelModeByNumber=function(number){if(!(120<=(number=Math.floor(number))&&status<=127))throw new RangeError("The control change number must be between 120 and 127.");for(var cm in wm.MIDI_CHANNEL_MODE_MESSAGES)if(Object.prototype.hasOwnProperty.call(wm.MIDI_CHANNEL_MODE_MESSAGES,cm)&&number===wm.MIDI_CHANNEL_MODE_MESSAGES[cm])return cm},Input.prototype._parseSystemEvent=function(e){var command=e.data[0],event={target:this,data:e.data,timestamp:e.timeStamp};command===wm.MIDI_SYSTEM_MESSAGES.sysex?event.type="sysex":command===wm.MIDI_SYSTEM_MESSAGES.timecode?event.type="timecode":command===wm.MIDI_SYSTEM_MESSAGES.songposition?event.type="songposition":command===wm.MIDI_SYSTEM_MESSAGES.songselect?(event.type="songselect",event.song=e.data[1]):command===wm.MIDI_SYSTEM_MESSAGES.tuningrequest?event.type="tuningrequest":command===wm.MIDI_SYSTEM_MESSAGES.clock?event.type="clock":command===wm.MIDI_SYSTEM_MESSAGES.start?event.type="start":command===wm.MIDI_SYSTEM_MESSAGES.continue?event.type="continue":command===wm.MIDI_SYSTEM_MESSAGES.stop?event.type="stop":command===wm.MIDI_SYSTEM_MESSAGES.activesensing?event.type="activesensing":command===wm.MIDI_SYSTEM_MESSAGES.reset?event.type="reset":event.type="unknownsystemmessage",this._userHandlers.system[event.type]&&this._userHandlers.system[event.type].forEach(function(callback){callback(event)})},Output.prototype.send=function(status,data,timestamp){if(!(128<=status&&status<=255))throw new RangeError("The status byte must be an integer between 128 (0x80) and 255 (0xFF).");void 0===data&&(data=[]),Array.isArray(data)||(data=[data]);var message=[];return data.forEach(function(parsed){parsed=Math.floor(parsed);if(!(0<=parsed&&parsed<=255))throw new RangeError("Data bytes must be integers between 0 (0x00) and 255 (0xFF).");message.push(parsed)}),this._midiOutput.send([status].concat(message),parseFloat(timestamp)||0),this},Output.prototype.sendSysex=function(manufacturer,data,options){if(!wm.sysexEnabled)throw new Error("Sysex message support must first be activated.");return options=options||{},manufacturer=[].concat(manufacturer),data.forEach(function(item){if(item<0||127<item)throw new RangeError("The data bytes of a sysex message must be integers between 0 (0x00) and 127 (0x7F).")}),data=manufacturer.concat(data,wm.MIDI_SYSTEM_MESSAGES.sysexend),this.send(wm.MIDI_SYSTEM_MESSAGES.sysex,data,this._parseTimeParameter(options.time)),this},Output.prototype.sendTimecodeQuarterFrame=function(value,options){return this.send(wm.MIDI_SYSTEM_MESSAGES.timecode,value,this._parseTimeParameter((options=options||{}).time)),this},Output.prototype.sendSongPosition=function(value,options){options=options||{};var msb=(value=Math.floor(value)||0)>>7&127;return this.send(wm.MIDI_SYSTEM_MESSAGES.songposition,[msb,127&value],this._parseTimeParameter(options.time)),this},Output.prototype.sendSongSelect=function(value,options){if(options=options||{},!(0<=(value=Math.floor(value))&&value<=127))throw new RangeError("The song number must be between 0 and 127.");return this.send(wm.MIDI_SYSTEM_MESSAGES.songselect,[value],this._parseTimeParameter(options.time)),this},Output.prototype.sendTuningRequest=function(options){return this.send(wm.MIDI_SYSTEM_MESSAGES.tuningrequest,void 0,this._parseTimeParameter((options=options||{}).time)),this},Output.prototype.sendClock=function(options){return this.send(wm.MIDI_SYSTEM_MESSAGES.clock,void 0,this._parseTimeParameter((options=options||{}).time)),this},Output.prototype.sendStart=function(options){return this.send(wm.MIDI_SYSTEM_MESSAGES.start,void 0,this._parseTimeParameter((options=options||{}).time)),this},Output.prototype.sendContinue=function(options){return this.send(wm.MIDI_SYSTEM_MESSAGES.continue,void 0,this._parseTimeParameter((options=options||{}).time)),this},Output.prototype.sendStop=function(options){return this.send(wm.MIDI_SYSTEM_MESSAGES.stop,void 0,this._parseTimeParameter((options=options||{}).time)),this},Output.prototype.sendActiveSensing=function(options){return this.send(wm.MIDI_SYSTEM_MESSAGES.activesensing,[],this._parseTimeParameter((options=options||{}).time)),this},Output.prototype.sendReset=function(options){return this.send(wm.MIDI_SYSTEM_MESSAGES.reset,void 0,this._parseTimeParameter((options=options||{}).time)),this},Output.prototype.stopNote=function(note,channel,options){if("all"===note)return this.sendChannelMode("allnotesoff",0,channel,options);var nVelocity=64;return(options=options||{}).rawVelocity?!isNaN(options.velocity)&&0<=options.velocity&&options.velocity<=127&&(nVelocity=options.velocity):!isNaN(options.velocity)&&0<=options.velocity&&options.velocity<=1&&(nVelocity=127*options.velocity),this._convertNoteToArray(note).forEach(function(item){wm.toMIDIChannels(channel).forEach(function(ch){this.send((wm.MIDI_CHANNEL_MESSAGES.noteoff<<4)+(ch-1),[item,Math.round(nVelocity)],this._parseTimeParameter(options.time))}.bind(this))}.bind(this)),this},Output.prototype.playNote=function(note,channel,options){var time,nRelease,nVelocity=64;return(options=options||{}).rawVelocity?!isNaN(options.velocity)&&0<=options.velocity&&options.velocity<=127&&(nVelocity=options.velocity):!isNaN(options.velocity)&&0<=options.velocity&&options.velocity<=1&&(nVelocity=127*options.velocity),time=this._parseTimeParameter(options.time),this._convertNoteToArray(note).forEach(function(item){wm.toMIDIChannels(channel).forEach(function(ch){this.send((wm.MIDI_CHANNEL_MESSAGES.noteon<<4)+(ch-1),[item,Math.round(nVelocity)],time)}.bind(this))}.bind(this)),isNaN(options.duration)||(options.duration<=0&&(options.duration=0),nRelease=64,options.rawVelocity?!isNaN(options.release)&&0<=options.release&&options.release<=127&&(nRelease=options.release):!isNaN(options.release)&&0<=options.release&&options.release<=1&&(nRelease=127*options.release),this._convertNoteToArray(note).forEach(function(item){wm.toMIDIChannels(channel).forEach(function(ch){this.send((wm.MIDI_CHANNEL_MESSAGES.noteoff<<4)+(ch-1),[item,Math.round(nRelease)],(time||wm.time)+options.duration)}.bind(this))}.bind(this))),this},Output.prototype.sendKeyAftertouch=function(note,channel,pressure,options){var that=this;if(options=options||{},channel<1||16<channel)throw new RangeError("The channel must be between 1 and 16.");(isNaN(pressure)||pressure<0||1<pressure)&&(pressure=.5);var nPressure=Math.round(127*pressure);return this._convertNoteToArray(note).forEach(function(item){wm.toMIDIChannels(channel).forEach(function(ch){that.send((wm.MIDI_CHANNEL_MESSAGES.keyaftertouch<<4)+(ch-1),[item,nPressure],that._parseTimeParameter(options.time))})}),this},Output.prototype.sendControlChange=function(controller,value,channel,options){if(options=options||{},"string"==typeof controller){if(void 0===(controller=wm.MIDI_CONTROL_CHANGE_MESSAGES[controller]))throw new TypeError("Invalid controller name.")}else if(!(0<=(controller=Math.floor(controller))&&controller<=119))throw new RangeError("Controller numbers must be between 0 and 119.");if(!(0<=(value=Math.floor(value)||0)&&value<=127))throw new RangeError("Controller value must be between 0 and 127.");return wm.toMIDIChannels(channel).forEach(function(ch){this.send((wm.MIDI_CHANNEL_MESSAGES.controlchange<<4)+(ch-1),[controller,value],this._parseTimeParameter(options.time))}.bind(this)),this},Output.prototype._selectRegisteredParameter=function(parameter,channel,time){var that=this;if(parameter[0]=Math.floor(parameter[0]),!(0<=parameter[0]&&parameter[0]<=127))throw new RangeError("The control65 value must be between 0 and 127");if(parameter[1]=Math.floor(parameter[1]),!(0<=parameter[1]&&parameter[1]<=127))throw new RangeError("The control64 value must be between 0 and 127");return wm.toMIDIChannels(channel).forEach(function(){that.sendControlChange(101,parameter[0],channel,{time:time}),that.sendControlChange(100,parameter[1],channel,{time:time})}),this},Output.prototype._selectNonRegisteredParameter=function(parameter,channel,time){var that=this;if(parameter[0]=Math.floor(parameter[0]),!(0<=parameter[0]&&parameter[0]<=127))throw new RangeError("The control63 value must be between 0 and 127");if(parameter[1]=Math.floor(parameter[1]),!(0<=parameter[1]&&parameter[1]<=127))throw new RangeError("The control62 value must be between 0 and 127");return wm.toMIDIChannels(channel).forEach(function(){that.sendControlChange(99,parameter[0],channel,{time:time}),that.sendControlChange(98,parameter[1],channel,{time:time})}),this},Output.prototype._setCurrentRegisteredParameter=function(data,channel,time){var that=this;if((data=[].concat(data))[0]=Math.floor(data[0]),!(0<=data[0]&&data[0]<=127))throw new RangeError("The msb value must be between 0 and 127");return wm.toMIDIChannels(channel).forEach(function(){that.sendControlChange(6,data[0],channel,{time:time})}),data[1]=Math.floor(data[1]),0<=data[1]&&data[1]<=127&&wm.toMIDIChannels(channel).forEach(function(){that.sendControlChange(38,data[1],channel,{time:time})}),this},Output.prototype._deselectRegisteredParameter=function(channel,time){var that=this;return wm.toMIDIChannels(channel).forEach(function(){that.sendControlChange(101,127,channel,{time:time}),that.sendControlChange(100,127,channel,{time:time})}),this},Output.prototype.setRegisteredParameter=function(parameter,data,channel,options){var that=this;if(options=options||{},!Array.isArray(parameter)){if(!wm.MIDI_REGISTERED_PARAMETER[parameter])throw new Error("The specified parameter is not available.");parameter=wm.MIDI_REGISTERED_PARAMETER[parameter]}return wm.toMIDIChannels(channel).forEach(function(){that._selectRegisteredParameter(parameter,channel,options.time),that._setCurrentRegisteredParameter(data,channel,options.time),that._deselectRegisteredParameter(channel,options.time)}),this},Output.prototype.setNonRegisteredParameter=function(parameter,data,channel,options){var that=this;if(options=options||{},!(0<=parameter[0]&&parameter[0]<=127&&0<=parameter[1]&&parameter[1]<=127))throw new Error("Position 0 and 1 of the 2-position parameter array must both be between 0 and 127.");return data=[].concat(data),wm.toMIDIChannels(channel).forEach(function(){that._selectNonRegisteredParameter(parameter,channel,options.time),that._setCurrentRegisteredParameter(data,channel,options.time),that._deselectRegisteredParameter(channel,options.time)}),this},Output.prototype.incrementRegisteredParameter=function(parameter,channel,options){var that=this;if(options=options||{},!Array.isArray(parameter)){if(!wm.MIDI_REGISTERED_PARAMETER[parameter])throw new Error("The specified parameter is not available.");parameter=wm.MIDI_REGISTERED_PARAMETER[parameter]}return wm.toMIDIChannels(channel).forEach(function(){that._selectRegisteredParameter(parameter,channel,options.time),that.sendControlChange(96,0,channel,{time:options.time}),that._deselectRegisteredParameter(channel,options.time)}),this},Output.prototype.decrementRegisteredParameter=function(parameter,channel,options){if(options=options||{},!Array.isArray(parameter)){if(!wm.MIDI_REGISTERED_PARAMETER[parameter])throw new TypeError("The specified parameter is not available.");parameter=wm.MIDI_REGISTERED_PARAMETER[parameter]}return wm.toMIDIChannels(channel).forEach(function(){this._selectRegisteredParameter(parameter,channel,options.time),this.sendControlChange(97,0,channel,{time:options.time}),this._deselectRegisteredParameter(channel,options.time)}.bind(this)),this},Output.prototype.setPitchBendRange=function(semitones,cents,channel,options){var that=this;if(options=options||{},!(0<=(semitones=Math.floor(semitones)||0)&&semitones<=127))throw new RangeError("The semitones value must be between 0 and 127");if(!(0<=(cents=Math.floor(cents)||0)&&cents<=127))throw new RangeError("The cents value must be between 0 and 127");return wm.toMIDIChannels(channel).forEach(function(){that.setRegisteredParameter("pitchbendrange",[semitones,cents],channel,{time:options.time})}),this},Output.prototype.setModulationRange=function(semitones,cents,channel,options){var that=this;if(options=options||{},!(0<=(semitones=Math.floor(semitones)||0)&&semitones<=127))throw new RangeError("The semitones value must be between 0 and 127");if(!(0<=(cents=Math.floor(cents)||0)&&cents<=127))throw new RangeError("The cents value must be between 0 and 127");return wm.toMIDIChannels(channel).forEach(function(){that.setRegisteredParameter("modulationrange",[semitones,cents],channel,{time:options.time})}),this},Output.prototype.setMasterTuning=function(fine,channel,options){var that=this;if(options=options||{},(fine=parseFloat(fine)||0)<=-65||64<=fine)throw new RangeError("The value must be a decimal number larger than -65 and smaller than 64.");var coarse=Math.floor(fine)+64,fine=fine-Math.floor(fine),msb=(fine=Math.round((1+fine)/2*16383))>>7&127,lsb=127&fine;return wm.toMIDIChannels(channel).forEach(function(){that.setRegisteredParameter("channelcoarsetuning",coarse,channel,{time:options.time}),that.setRegisteredParameter("channelfinetuning",[msb,lsb],channel,{time:options.time})}),this},Output.prototype.setTuningProgram=function(value,channel,options){var that=this;if(options=options||{},!(0<=(value=Math.floor(value))&&value<=127))throw new RangeError("The program value must be between 0 and 127");return wm.toMIDIChannels(channel).forEach(function(){that.setRegisteredParameter("tuningprogram",value,channel,{time:options.time})}),this},Output.prototype.setTuningBank=function(value,channel,options){var that=this;if(options=options||{},!(0<=(value=Math.floor(value)||0)&&value<=127))throw new RangeError("The bank value must be between 0 and 127");return wm.toMIDIChannels(channel).forEach(function(){that.setRegisteredParameter("tuningbank",value,channel,{time:options.time})}),this},Output.prototype.sendChannelMode=function(command,value,channel,options){if(options=options||{},"string"==typeof command){if(!(command=wm.MIDI_CHANNEL_MODE_MESSAGES[command]))throw new TypeError("Invalid channel mode message name.")}else if(!(120<=(command=Math.floor(command))&&command<=127))throw new RangeError("Channel mode numerical identifiers must be between 120 and 127.");if((value=Math.floor(value)||0)<0||127<value)throw new RangeError("Value must be an integer between 0 and 127.");return wm.toMIDIChannels(channel).forEach(function(ch){this.send((wm.MIDI_CHANNEL_MESSAGES.channelmode<<4)+(ch-1),[command,value],this._parseTimeParameter(options.time))}.bind(this)),this},Output.prototype.sendProgramChange=function(program,channel,options){var that=this;if(options=options||{},program=Math.floor(program),isNaN(program)||program<0||127<program)throw new RangeError("Program numbers must be between 0 and 127.");return wm.toMIDIChannels(channel).forEach(function(ch){that.send((wm.MIDI_CHANNEL_MESSAGES.programchange<<4)+(ch-1),[program],that._parseTimeParameter(options.time))}),this},Output.prototype.sendChannelAftertouch=function(pressure,channel,options){var that=this;options=options||{},pressure=parseFloat(pressure),(isNaN(pressure)||pressure<0||1<pressure)&&(pressure=.5);var nPressure=Math.round(127*pressure);return wm.toMIDIChannels(channel).forEach(function(ch){that.send((wm.MIDI_CHANNEL_MESSAGES.channelaftertouch<<4)+(ch-1),[nPressure],that._parseTimeParameter(options.time))}),this},Output.prototype.sendPitchBend=function(nLevel,channel,options){var that=this;if(options=options||{},isNaN(nLevel)||nLevel<-1||1<nLevel)throw new RangeError("Pitch bend value must be between -1 and 1.");var nLevel=Math.round((nLevel+1)/2*16383),msb=nLevel>>7&127,lsb=127&nLevel;return wm.toMIDIChannels(channel).forEach(function(ch){that.send((wm.MIDI_CHANNEL_MESSAGES.pitchbend<<4)+(ch-1),[lsb,msb],that._parseTimeParameter(options.time))}),this},Output.prototype._parseTimeParameter=function(time){var value,parsed=parseFloat(time);return"string"==typeof time&&"+"===time.substring(0,1)?parsed&&0<parsed&&(value=wm.time+parsed):parsed>wm.time&&(value=parsed),value},Output.prototype._convertNoteToArray=function(note){var notes=[];return(note=!Array.isArray(note)?[note]:note).forEach(function(item){notes.push(wm.guessNoteNumber(item))}),notes},"function"==typeof define&&"object"==typeof define.amd?define([],function(){return wm}):void 0!==module&&module.exports?module.exports=wm:scope.WebMidi||(scope.WebMidi=wm)}(this)},{}],3:[function(require,module,exports){module.exports={name:"deep-playground-prototype",version:"1.2.1",description:"",private:!0,scripts:{clean:"rimraf dist",start:"yarn serve-watch",prep:"copyfiles analytics.js dist && concat node_modules/material-design-lite/material.min.js node_modules/seedrandom/seedrandom.min.js > dist/lib.js","build-css":"concat node_modules/material-design-lite/material.min.css styles.css > dist/bundle.css","watch-css":"concat node_modules/material-design-lite/material.min.css styles.css -o dist/bundle.css","build-html":"copyfiles index.html dist","watch-html":"concat index.html -o dist/index.html","build-js":"browserify src/playground/playground.ts -p [tsify] | uglifyjs -c > dist/bundle.js","watch-js":"watchify src/playground/playground.ts -p [tsify] -v --debug -o dist/bundle.js",build:"yarn prep && yarn build-js && yarn build-css && yarn build-html",watch:'yarn prep && concurrently "yarn watch-js" "yarn watch-css" "yarn watch-html"',serve:"npx serve dist/","serve-watch":'concurrently "npx serve dist/" "yarn watch"',"build:archive":"./bin/archive-release.sh"},devDependencies:{"@bamdadsabbagh/eslint-config":"^1.18.0","@types/d3":"^3.5.34",concat:"^1.0.3",concurrently:"6.3.0",copyfiles:"2.4.1",rimraf:"3.0.2",serve:"^12.0.1",tsify:"^5.0.4",typescript:"^4.4.4","uglify-js":"^3.14.2",watchify:"^4.0.0"},dependencies:{d3:"^3.5.16","material-design-lite":"^1.3.0",seedrandom:"^3.0.5",webmidi:"^2.5.3"}}},{}],4:[function(packageJson,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P=P||Promise)(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):((value=result.value)instanceof P?value:new P(function(resolve){resolve(value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.app=void 0;const midi_1=packageJson("./midi/midi"),ui_1=packageJson("./ui/ui");packageJson=packageJson("../../package.json");exports.app=Object.create(null),exports.app.isInitialized=!1,exports.app.version=packageJson.version,exports.app.init=function(){return __awaiter(this,void 0,void 0,function*(){if(this.isInitialized)throw new Error("app is already initialized");yield ui_1.ui.init(),yield midi_1.midi.init(),this.isInitialized=!0,console.log(exports.app)})}},{"../../package.json":3,"./midi/midi":14,"./ui/ui":29}],5:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P=P||Promise)(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):((value=result.value)instanceof P?value:new P(function(resolve){resolve(value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.controllerDevice=void 0;var device_prototype_1=require("./device/device.prototype");const range_map_1=require("../utils/range-map"),playground_facade_1=require("../facades/playground.facade"),neuron_card_ui_1=require("../ui/neuron-card.ui"),network_state_1=require("../state/network.state"),mappings_state_1=require("../state/mappings.state"),mappings_ui_1=require("../ui/mappings.ui"),playground_ui_1=require("../ui/playground.ui");exports.controllerDevice=Object.create(device_prototype_1.devicePrototype),exports.controllerDevice.init=function(device){return __awaiter(this,void 0,void 0,function*(){this.isInitialized&&this.removeListeners(),this.isInitialized=!1,this.device=device,this.settings=device.settings,yield this.runBootSequence(),this.drawLights(),this.updateMode(),this.isInitialized=!0})},exports.controllerDevice.drawLights=function(){if(this.isInitialized){let color;color=this.isDefaultMode?this.settings.colors.amber:this.isSingleMode?this.settings.colors.black:this.settings.colors.red,this.playNotes({firstNote:this.settings.lights.first,lastNote:this.settings.lights.last,color:color})}},exports.controllerDevice.updateMode=function(){this.removeListeners(),this.isDefaultMode?this.setDefaultMode():this.isSingleMode?this.setSingleMode():this.setMultipleMode()},exports.controllerDevice.setDefaultMode=function(){this.attachButtonsDefault(),this.attachControlsDefault()},exports.controllerDevice.setSingleMode=function(){var selectedNode=playground_facade_1.playgroundFacade.selectedNodes[0];this.attachControlsToNeuron(selectedNode)},exports.controllerDevice.setMultipleMode=function(){const selectedNodes=playground_facade_1.playgroundFacade["selectedNodes"];selectedNodes.forEach(n=>this.attachControlsToNeuron(n))},exports.controllerDevice.onSelectionEvent=function(){this.isInitialized&&(this.drawLights(),setTimeout(()=>{this.updateMode()},this.settings.time.wait))},exports.controllerDevice.attachButtonsDefault=function(){this.addNoteListener("on",learningParameter=>{if(this.isDefaultMode){var note=parseInt(learningParameter.note.number),{isLearning,learningParameter}=mappings_state_1.mappingsState;isLearning&&learningParameter&&mappings_ui_1.mappingsUi.learn({parameter:learningParameter,control:note,type:"button"});const mappedParameters=mappings_state_1.mappingsState.getParametersByControl(note);mappedParameters.forEach(parameter=>{playground_ui_1.playgroundUi.updateParameter(parameter,1)}),this.playNote({note:note,color:this.settings.colors.green,duration:this.settings.time.defaultDuration})}})},exports.controllerDevice.attachControlsDefault=function(){this.addControlListener(e=>{var note=parseInt(e.controller.number),{isLearning,learningParameter}=mappings_state_1.mappingsState;const parameters=mappings_state_1.mappingsState.getParametersByControl(note);parameters.forEach(parameter=>{playground_ui_1.playgroundUi.updateParameter(parameter,e.value)}),isLearning&&learningParameter&&mappings_ui_1.mappingsUi.learn({parameter:learningParameter,control:note,type:"range"}),this.playNote({note:this.settings.outputByInput[note],duration:this.settings.time.defaultDuration,color:this.settings.colors.red})})},exports.controllerDevice.attachControlsToNeuron=function(neuron){var neuron=network_state_1.networkState.getNeuron(neuron)["neuron"];const links=neuron.inputLinks;links.forEach((link,index)=>{link.hasSnapped=!1,this.playNote({note:this.settings.rows.firstButtons[index],color:this.settings.colors.red})}),this.addControlListener(e=>{const inputNote=e.controller.number;var source=this.settings.rows.faders[0],lastFader=this.settings.rows.faders[7];if(inputNote>=source&&inputNote<=lastFader){const index=inputNote-source;source=null===(source=null===links||void 0===links?void 0:links[index])||void 0===source?void 0:source.source;if(void 0!==source){const value=parseFloat((0,range_map_1.rangeMap)(e.value,0,127,-1,1).toFixed(2));value.toFixed(1)===links[index].weight.toFixed(1)&&(links[index].hasSnapped=!0,links[index].snapTimer&&clearTimeout(links[index].snapTimer),links[index].snapTimer=setTimeout(()=>{links[index].hasSnapped=!1,this.playNote({note:this.settings.outputByInput[inputNote],color:this.settings.colors.red})},800)),links[index].hasSnapped&&source.isEnabled?(network_state_1.networkState.setWeight(index,value),neuron_card_ui_1.neuronCardUi.updateWeight(index,value),this.playNote({note:this.settings.outputByInput[inputNote],color:this.settings.colors.green})):this.playNote({note:this.settings.outputByInput[inputNote],color:this.settings.colors.red})}}})},Object.defineProperty(exports.controllerDevice,"isDefaultMode",{get(){return 0===playground_facade_1.playgroundFacade.selectedNodes.length}}),Object.defineProperty(exports.controllerDevice,"isSingleMode",{get(){return 1===playground_facade_1.playgroundFacade.selectedNodes.length}}),Object.defineProperty(exports.controllerDevice,"isMultipleMode",{get(){return 1<playground_facade_1.playgroundFacade.selectedNodes.length}})},{"../facades/playground.facade":13,"../state/mappings.state":16,"../state/network.state":17,"../ui/mappings.ui":23,"../ui/neuron-card.ui":25,"../ui/playground.ui":27,"../utils/range-map":31,"./device/device.prototype":6}],6:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P=P||Promise)(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):((value=result.value)instanceof P?value:new P(function(resolve){resolve(value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.devicePrototype=void 0,exports.devicePrototype=Object.create(null),exports.devicePrototype.isInitialized=!1,exports.devicePrototype.device=null,exports.devicePrototype.settings=null,exports.devicePrototype.network=null,exports.devicePrototype.blinkingNotes={},exports.devicePrototype.runBootSequence=function(){return __awaiter(this,void 0,void 0,function*(){return new Promise(resolve=>{this.removeListeners();const{color,sysex}=this.settings.bootSequence;var manufacturer,data;sysex&&({manufacturer,data}=sysex,void 0!==manufacturer&&void 0!==data&&this.device.output.sendSysex(manufacturer,data)),setTimeout(()=>{this.playNotes({firstNote:this.settings.lights.first,lastNote:this.settings.lights.last,color:color,duration:this.settings.time.defaultDuration})},this.settings.time.deviceReady),setTimeout(()=>{resolve()},this.settings.time.deviceReady+this.settings.time.defaultDuration+this.settings.time.wait)})})},exports.devicePrototype.playNote=function({note,color,duration=36e5}){this.device.output.playNote(note,this.settings.channels.output,{duration:duration,rawVelocity:!0,velocity:color})},exports.devicePrototype.playNotes=function({firstNote,lastNote,color,duration=36e5}){for(let i=firstNote;i<=lastNote;++i)this.playNote({note:i,duration:duration,color:color})},exports.devicePrototype.clearBlinkingNote=function(note){var _a;"number"==typeof(null===(_a=this.blinkingNotes)||void 0===_a?void 0:_a[note])&&(clearTimeout(this.blinkingNotes[note]),this.blinkingNotes[note]=null)},exports.devicePrototype.blinkNote=function({note,color,interval=800}){this.clearBlinkingNote(note),this.blinkingNotes[note]=setInterval(()=>{this.playNote({note:note,color:color,duration:interval/2})},interval)},exports.devicePrototype.playOrBlinkNote=function({note,color,interval=800,duration=36e5}){var _b;void 0===(null===(_b=this.blinkingNotes)||void 0===_b?void 0:_b[note])?(this.blinkingNotes[note]=null,this.playNote({note:note,color:color,duration:duration})):null===(null===(_b=this.blinkingNotes)||void 0===_b?void 0:_b[note])?this.blinkNote({note:note,color:color,interval:interval}):(this.clearBlinkingNote(note),setTimeout(()=>{this.playNote({note:note,color:color,duration:duration})},interval/2))},exports.devicePrototype.removeListeners=function(){this.device.input.removeListener()},exports.devicePrototype.addNoteListener=function(noteState="on",listener){if("on"!==noteState&&"off"!==noteState)throw new Error('note should be either "on" or "off"');this.device.input.addListener(`note${noteState}`,this.settings.channels.input,e=>listener(e))},exports.devicePrototype.removeNoteListeners=function(noteState){if("on"!==noteState&&"off"!==noteState)throw new Error('note should be either "on" or "off"');this.device.input.removeListener(`note${noteState}`)},exports.devicePrototype.addControlListener=function(listener,isToggle=!1){this.device.input.addListener("controlchange",this.settings.channels.input,e=>{isToggle&&127!==e.value||listener(e)})},exports.devicePrototype.removeControlListeners=function(){this.device.input.removeListener("controlchange")}},{}],7:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DeviceCategory=void 0,function(DeviceCategory){DeviceCategory.select="Selector",DeviceCategory.control="Controller"}(exports.DeviceCategory||(exports.DeviceCategory={}))},{}],8:[function(novation_launch_control_xl_1,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.knownDevices=void 0;var novation_launchpad_x_1=novation_launch_control_xl_1("./novation-launchpad-x"),novation_launch_control_xl_1=novation_launch_control_xl_1("./novation-launch-control-xl");exports.knownDevices=[novation_launchpad_x_1.novationLaunchpadX,novation_launch_control_xl_1.novationLaunchControlXl]},{"./novation-launch-control-xl":9,"./novation-launchpad-x":10}],9:[function(device_types_1,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.novationLaunchControlXl=void 0;device_types_1=device_types_1("../device/device.types");exports.novationLaunchControlXl={category:device_types_1.DeviceCategory.control,manufacturer:"Focusrite A.E. Ltd",name:"Launch Control XL",channels:{input:"all",output:"all"},lights:{first:1,last:127},colors:{off:12,black:12,red:15,amber:63,yellow:62,green:60},time:{wait:200,deviceReady:2e3,defaultDuration:500},get bootSequence(){return{color:this.colors.red}},rows:{firstPots:[13,14,15,16,17,18,19,20],secondPots:[29,30,31,32,33,34,35,36],thirdPots:[49,50,51,52,53,54,55,56],faders:[77,78,79,80,81,82,83,84],firstButtons:[41,42,43,44,57,58,59,60],secondButtons:[73,74,75,76,89,90,91,92]},outputByInput:{13:13,14:29,15:45,16:61,17:77,18:93,19:109,20:125,29:14,30:30,31:46,32:62,33:78,34:94,35:110,36:126,49:15,50:31,51:47,52:63,53:79,54:95,55:111,56:127,77:41,78:42,79:43,80:44,81:57,82:58,83:59,84:60}}},{"../device/device.types":7}],10:[function(device_types_1,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.novationLaunchpadX=void 0;device_types_1=device_types_1("../device/device.types");exports.novationLaunchpadX={category:device_types_1.DeviceCategory.select,manufacturer:"Focusrite - Novation",name:"Launchpad X",channels:{input:"all",output:1},lights:{first:11,last:99},grid:[[81,71,61,51,41,31,21,11],[82,72,62,52,42,32,22,12],[83,73,63,53,43,33,23,13],[84,74,64,54,44,34,24,14],[85,75,65,55,45,35,25,15],[86,76,66,56,46,36,26,16],[87,77,67,57,47,37,27,17],[88,78,68,58,48,38,28,18]],functionKeys:{firstRow:[91,92,93,94,95,96,97,98],lastColumn:[89,79,69,59,49,39,29,19]},colors:{black:0,silver:2,gray:1,white:3,maroon:83,red:5,purple:81,fuchsia:53,olive:15,lime:21,green:23,yellow:13,navy:47,blue:67,teal:35,turquoise:38,aqua:37},get colorByState(){return{inputOn:this.colors.yellow,inputOff:this.colors.gray,neuronOn:this.colors.lime,neuronOff:this.colors.gray,neuronSelected:this.colors.aqua,outputWeightOn:this.colors.fuchsia,outputWeightOff:this.colors.gray,playbackOn:this.colors.lime,playbackOff:this.colors.red,layer:this.colors.blue}},time:{wait:200,deviceReady:2e3,defaultDuration:500,longClick:400},get bootSequence(){return{color:this.colors.red,sysex:{manufacturer:0,data:[32,41,2,12,14,1]}}}}},{"../device/device.types":7}],11:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P=P||Promise)(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):((value=result.value)instanceof P?value:new P(function(resolve){resolve(value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.selectorDevice=void 0;var device_prototype_1=require("./device/device.prototype");const playground_facade_1=require("../facades/playground.facade"),network_state_1=require("../state/network.state"),network_ui_1=require("../ui/network.ui");exports.selectorDevice=Object.create(device_prototype_1.devicePrototype),exports.selectorDevice.grid=null,exports.selectorDevice.init=function(device){return __awaiter(this,void 0,void 0,function*(){this.isInitialized&&this.removeListeners(),this.isInitialized=!1,this.device=device,this.settings=device.settings,this.grid=this.settings.grid,yield this.runBootSequence(),this.drawGrid(),this.attachEvents(),this.isInitialized=!0})},exports.selectorDevice.drawGrid=function(){this.drawInputs(),this.drawNeurons(),this.drawOutputWeights()},exports.selectorDevice.attachEvents=function(){this.removeListeners(),this.attachInputs(),this.attachNeurons(),this.attachOutputWeights(),this.attachNavigation(),this.attachLayers()},exports.selectorDevice.drawInputs=function(){for(let i=0;i<network_state_1.networkState.inputs.length;++i)this.playNote({note:this.grid[0][i],color:this.settings.colorByState.inputOn})},exports.selectorDevice.attachInputs=function(){this.addNoteListener("on",id=>{id=this.getGridFlatIndex(id.note.number);0<=id&&id<=6&&(id=network_state_1.networkState.getInputByIndex(id)["id"],network_ui_1.networkUi.toggleInput(id,!0))})},exports.selectorDevice.setInputLight=function(note,isEnabled){this.isInitialized&&(note=this.grid[0][{x:1,y:2,xSquared:3,ySquared:4,xTimesY:5,sinX:6,sinY:7}[note]-1],this.playNote({note:note,color:isEnabled?this.settings.colorByState.inputOn:this.settings.colorByState.inputOff}))},exports.selectorDevice.drawNeurons=function(){var neuronsLength=network_state_1.networkState.neurons.flat().length;for(let i=1;i<=neuronsLength;++i){var{neuronIndex:isEnabled,layerIndex:note}=network_state_1.networkState.getNeuronAndLayerIndexes(i),note=this.grid[note-1+1][isEnabled-1],isEnabled=network_state_1.networkState.getNeuron(isEnabled)["isEnabled"];this.playNote({note:note,color:isEnabled?this.settings.colorByState.neuronOn:this.settings.colorByState.neuronOff})}},exports.selectorDevice.attachNeurons=function(){this.addNoteListener("on",isEnabled=>{var flatIndex=this.getGridFlatIndex(isEnabled.note.number);if(8<=flatIndex&&flatIndex<=55){const nodeIndex=this.getGridFlatIndex(isEnabled.note.number)-8+1;var isEnabled=network_state_1.networkState.getNeuron(nodeIndex)["isEnabled"];isEnabled&&(-1===playground_facade_1.playgroundFacade.selectedNodes.indexOf(nodeIndex)?network_ui_1.networkUi.toggleNodeSelection(nodeIndex,!0):network_ui_1.networkUi.toggleNodeSelection(nodeIndex,!1));let clickTimer=setTimeout(()=>{clearTimeout(clickTimer),clickTimer=null,network_ui_1.networkUi.toggleNodeSelection(nodeIndex,!1),network_ui_1.networkUi.toggleNeuron(nodeIndex)},this.settings.time.longClick);this.addNoteListener("off",()=>{null!==clickTimer&&(clearTimeout(clickTimer),clickTimer=null,this.removeNoteListeners("off"))})}})},exports.selectorDevice.setNeuronLight=function(note){if(this.isInitialized){var layerIndex=note["index"],isSelected=note.isSelected||null,isDisabled=note.isDisabled||null,{neuronIndex:note,layerIndex}=network_state_1.networkState.getNeuronAndLayerIndexes(layerIndex),note=this.grid[layerIndex][note-1];let color;color=isSelected?this.settings.colorByState.neuronSelected:isDisabled?this.settings.colorByState.neuronOff:this.settings.colorByState.neuronOn,this.playNote({note:note,color:color})}},exports.selectorDevice.drawOutputWeights=function(){var outputWeights=network_state_1.networkState.output.inputLinks;for(let i=0;i<outputWeights.length;++i){var note=this.grid[this.grid.length-1][i],isEnabled=!outputWeights[i].isDead&&0!==outputWeights[i].weight;this.playNote({note:note,color:isEnabled?this.settings.colorByState.outputWeightOn:this.settings.colorByState.outputWeightOff})}},exports.selectorDevice.attachOutputWeights=function(){this.addNoteListener("on",e=>{var weights,isEnabled=this.getGridFlatIndex(e.note.number);56<=isEnabled&&isEnabled<=63&&(weights=network_state_1.networkState.output.inputLinks,isEnabled=isEnabled-56,network_state_1.networkState.toggleOutput(isEnabled),isEnabled=!weights[isEnabled].isDead&&0!==weights[isEnabled].weight,this.playNote({note:e.note.number,color:isEnabled?this.settings.colorByState.outputWeightOn:this.settings.colorByState.outputWeightOff}))})},exports.selectorDevice.getGridFlatIndex=function(note){return this.grid.flat().indexOf(note)},exports.selectorDevice.attachNavigation=function(){const playbackPad=this.settings.functionKeys.lastColumn[this.settings.functionKeys.lastColumn.length-1];this.playNote({note:playbackPad,color:playground_facade_1.playgroundFacade.isPlaying?this.settings.colorByState.playbackOn:this.settings.colorByState.playbackOff}),this.addControlListener(isPlaying=>{var inputNote=isPlaying.controller.number;inputNote===playbackPad&&(isPlaying=playground_facade_1.playgroundFacade.togglePlayback(),this.playNote({note:inputNote,color:isPlaying?this.settings.colorByState.playbackOn:this.settings.colorByState.playbackOff}))},!0)},exports.selectorDevice.attachLayers=function(){const layerPads=this.settings.functionKeys.firstRow.slice(1,-1);layerPads.forEach(pad=>{this.playOrBlinkNote({note:pad,color:this.settings.colorByState.layer})}),this.addControlListener(inputNote=>{inputNote=inputNote.controller.number;layerPads.includes(inputNote)&&this.playOrBlinkNote({note:inputNote,color:this.settings.colorByState.layer})},!0)},exports.selectorDevice.updateLightPlayback=function(){var isPlaying=playground_facade_1.playgroundFacade.isPlaying,playbackPad=this.settings.functionKeys.lastColumn[this.settings.functionKeys.lastColumn.length-1];this.playNote({note:playbackPad,color:isPlaying?this.settings.colorByState.playbackOn:this.settings.colorByState.playbackOff})}},{"../facades/playground.facade":13,"../state/network.state":17,"../ui/network.ui":24,"./device/device.prototype":6}],12:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getKnownDeviceInfo=void 0;const device_types_1=require("../device/device.types"),devices_state_1=require("../../state/devices.state");exports.getKnownDeviceInfo=function(manufacturer,name){var device=devices_state_1.devicesState.knownDevices.filter(d=>d.manufacturer===manufacturer).filter(d=>name.includes(d.name))[0];return device?{isKnown:!0,isController:device.category===device_types_1.DeviceCategory.control,isSelector:device.category===device_types_1.DeviceCategory.select,settings:device}:{isKnown:!1}}},{"../../state/devices.state":15,"../device/device.types":7}],13:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.playgroundFacade=void 0;const playground_1=require("../../playground/playground");exports.playgroundFacade=Object.create(null),Object.defineProperty(exports.playgroundFacade,"network",{get(){return playground_1.network}}),Object.defineProperty(exports.playgroundFacade,"selectedNodes",{get(){return playground_1.selectedNodes}}),Object.defineProperty(exports.playgroundFacade,"selectNode",{get(){return playground_1.addToSelectedNodes}}),Object.defineProperty(exports.playgroundFacade,"unselectNode",{get(){return playground_1.removeFromSelectedNodes}}),exports.playgroundFacade.updateUI=function(){!0!==this.isPlaying&&(0,playground_1.updateUI)()},Object.defineProperty(exports.playgroundFacade,"isPlaying",{get(){return playground_1.player.getIsPlaying()}}),exports.playgroundFacade.togglePlayback=function(){return playground_1.player.playOrPause(),this.isPlaying}},{"../../playground/playground":38}],14:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P=P||Promise)(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):((value=result.value)instanceof P?value:new P(function(resolve){resolve(value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.midi=void 0;var WebMidi=require("webmidi");const get_known_device_info_1=require("../devices/utils/get-known-device-info"),devices_state_1=require("../state/devices.state"),devices_ui_1=require("../ui/devices.ui");exports.midi=Object.create(null),exports.midi.isInitialized=!1,exports.midi.service=WebMidi,exports.midi.sysexEnabled=!0,exports.midi.ports=null,exports.midi.inputs=null,exports.midi.outputs=null,exports.midi.init=function(){return __awaiter(this,void 0,void 0,function*(){if(this.isInitialized)throw new Error("midi is already initialized");yield this.enableService(),this.isInitialized=!0})},exports.midi.enableService=function(){return new Promise(resolve=>{this.service.enable(error=>{if(error)throw new Error("WebMidi could not be loaded"+error);this.inputs=this.service.inputs,this.outputs=this.service.outputs,this.service.addListener("connected",()=>this.handleConnectedEvent()),this.service.addListener("disconnected",()=>this.handleDisconnectedEvent()),resolve(null)},this.sysexEnabled)})},exports.midi.handleConnectedEvent=function(){this.inputs.forEach(input=>this.handleConnectedPort(input)),this.outputs.forEach(output=>this.handleConnectedPort(output)),this.setPorts(),devices_state_1.devicesState.init(this.ports),devices_ui_1.devicesUi.render()},exports.midi.handleDisconnectedEvent=function(){this.inputs.forEach(input=>this.handleDisconnectedPort(input)),this.outputs.forEach(output=>this.handleDisconnectedPort(output)),this.setPorts(),devices_state_1.devicesState.init(this.ports),devices_ui_1.devicesUi.render()},exports.midi.handleConnectedPort=function(port){var{manufacturer:isSelector,name:settings}=port,{isKnown,isController,isSelector,settings}=(0,get_known_device_info_1.getKnownDeviceInfo)(isSelector,settings);port.isPicked=!1,isKnown?(port.isKnown=!0,port.isController=port.isController||isController,port.isSelector=port.isSelector||isSelector,port.settings=port.settings||settings):port.isKnown=!1},exports.midi.handleDisconnectedPort=function(port){setTimeout(()=>{port.isPicked&&"open"!==port.connection&&devices_state_1.devicesState.unpickDevice(port)},100)},exports.midi.setPorts=function(){var knownOutputs=this.inputs.filter(input=>input.isKnown);const knownInputsByName=this.sortPortsByName(knownOutputs);knownOutputs=this.outputs.filter(output=>output.isKnown);const knownOutputsByName=this.sortPortsByName(knownOutputs);this.ports=Object.keys(knownInputsByName).reduce((acc,name)=>{var knownInput=(null===(isController=knownInputsByName[name])||void 0===isController?void 0:isController[0])||null,knownOutput=(null===(isSelector=knownOutputsByName[name])||void 0===isSelector?void 0:isSelector[0])||null,isController=knownInput.isController||!1,isSelector=knownInput.isSelector||!1;return knownInput&&knownOutput&&(acc[name]={isController:isController,isSelector:isSelector,input:knownInput,output:knownOutput}),acc},{})},exports.midi.sortPortsByName=function(ports){return ports.reduce((acc,inputOrOutput)=>{var name=inputOrOutput.name;return acc[name]||(acc[name]=[]),acc[name].push(inputOrOutput),acc},{})}},{"../devices/utils/get-known-device-info":12,"../state/devices.state":15,"../ui/devices.ui":22,webmidi:2}],15:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.devicesState=void 0;var Errors,known_devices_1=require("../devices/known-devices/known-devices");const devices_ui_1=require("../ui/devices.ui"),controller_device_1=require("../devices/controller.device"),selector_device_1=require("../devices/selector.device");(Errors=Errors||{}).PickNotFound="Picked device could not be found",exports.devicesState=Object.create(null),exports.devicesState.devices=null,exports.devicesState.controllers=null,exports.devicesState.selectors=null,exports.devicesState.knownDevices=known_devices_1.knownDevices,exports.devicesState.pickedSelector=null,exports.devicesState.pickedController=null,exports.devicesState.init=function(ports){this.devices=ports,this.sortDevices()},exports.devicesState.sortDevices=function(){this.setControllers(),this.setSelectors(),devices_ui_1.devicesUi.render()},exports.devicesState.setControllers=function(){this.controllers=this.filterDevicesByProperty("isController")},exports.devicesState.setSelectors=function(){this.selectors=this.filterDevicesByProperty("isSelector")},exports.devicesState.pickDevice=function(name,devices){var deviceName=Object.keys(this.devices).filter(n=>n===name)[0];if(void 0===deviceName)throw new Error(Errors.PickNotFound);const device=devices[deviceName];return device.isPicked=!0,device.input.isPicked=!0,device.output.isPicked=!0,device},exports.devicesState.pickController=function(controller){controller=this.pickDevice(controller,this.controllers);this.pickedController=controller,controller_device_1.controllerDevice.init(controller)},exports.devicesState.pickSelector=function(selector){selector=this.pickDevice(selector,this.selectors);this.pickedSelector=selector,selector_device_1.selectorDevice.init(selector)},exports.devicesState.filterDevicesByProperty=function(property){return Object.keys(this.devices).reduce((acc,name)=>{const device=this.devices[name];var settings=device.input.settings||device.output.settings||null;return device[property]&&(device.name=name,device.settings=settings,acc[name]=device),acc},{})},exports.devicesState.getCounts=function(){return{controllers:Object.keys(this.controllers).length,selectors:Object.keys(this.selectors).length}},exports.devicesState.getSelectors=function(){return this.selectors},exports.devicesState.getControllers=function(){return this.controllers},exports.devicesState.unpickDevice=function(port){port.isSelector?(this.pickedSelector.isPicked=!1,this.pickedSelector.input.isPicked=!1,this.pickedSelector.output.isPicked=!1,this.pickedSelector=null):port.isController&&(this.pickedController.isPicked=!1,this.pickedController.input.isPicked=!1,this.pickedController.output.isPicked=!1,this.pickedController=null)}},{"../devices/controller.device":5,"../devices/known-devices/known-devices":8,"../devices/selector.device":11,"../ui/devices.ui":22}],16:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.mappingsState=void 0,exports.mappingsState=Object.create(null),exports.mappingsState.isLearning=!1,exports.mappingsState.learningParameter=null,exports.mappingsState.controlByParameter={},exports.mappingsState.parametersByControl={},exports.mappingsState.state={get state(){return{isLearning:this.isLearning,learningParameter:this.learningParameter,controlByParameter:this.controlByParameter,parametersByControl:this.parametersByControl}}},exports.mappingsState.enableLearningMode=function(learningParameter){this.isLearning=!0,this.learningParameter=learningParameter},exports.mappingsState.disableLearningMode=function(){this.isLearning=!1,this.learningParameter=null},exports.mappingsState.setParameterMaps=function({parameter,control,type}){this.controlByParameter[parameter]={control:control,type:type},void 0===this.parametersByControl[control]?this.parametersByControl[control]=[parameter]:this.parametersByControl[control].push(parameter),this.disableLearningMode()},exports.mappingsState.unsetParameterMaps=function(parameter){var index=this.controlByParameter[parameter]["control"];const parameters=this.getParametersByControl(index);1===parameters.length?delete this.parametersByControl[index]:-1!==(index=parameters.indexOf(parameter))&&parameters.splice(index,1),delete this.controlByParameter[parameter]},exports.mappingsState.isMapped=function(parameter){return void 0!==this.controlByParameter[parameter]},exports.mappingsState.getParametersByControl=function(control){return this.parametersByControl[control]||[]}},{}],17:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.networkState=void 0;const playground_facade_1=require("../facades/playground.facade");exports.networkState=Object.create(null),Object.defineProperty(exports.networkState,"nodes",{get(){return playground_facade_1.playgroundFacade.network}}),Object.defineProperty(exports.networkState,"inputs",{get(){return this.nodes[0]}}),Object.defineProperty(exports.networkState,"neurons",{get(){return this.nodes.slice(1,-1)}}),Object.defineProperty(exports.networkState,"output",{get(){return this.nodes[this.nodes.length-1][0]}}),exports.networkState.getNeuronAndLayerIndexes=function(nodeIndex){if("number"!=typeof nodeIndex)throw new Error("nodeIndex is not a number");var layerIndex=Math.trunc((nodeIndex-1)/8)+1;let neuronIndex;return neuronIndex=nodeIndex%8==0?8:nodeIndex%8,{neuronIndex:neuronIndex,layerIndex:layerIndex}},exports.networkState.getNeuron=function(neuron){var{neuronIndex:isEnabled,layerIndex:neuron}=this.getNeuronAndLayerIndexes(neuron),neuron=this.neurons[neuron-1][isEnabled-1],isEnabled=neuron["isEnabled"];return{neuron:neuron,isEnabled:isEnabled}},exports.networkState.toggleOutput=function(outputIndex){const inputLink=this.output.inputLinks[outputIndex];return inputLink.source.isEnabled&&inputLink.source.isEnabled?(inputLink.isDead=!inputLink.isDead,void(inputLink.weight=inputLink.isDead?0:Math.random()-.5)):(inputLink.isDead=!0,void(inputLink.weight=0))},exports.networkState.toggleNeuron=function(nodeIndex){const{neuron,isEnabled}=this.getNeuron(nodeIndex);neuron.isEnabled=!isEnabled,neuron.inputLinks.forEach(link=>{!1!==link.source.isEnabled&&(neuron.isEnabled?(link.isDead=!1,link.weight=link.savedWeight||Math.random()-.5):(link.isDead=!0,link.savedWeight=link.weight,link.weight=0))}),neuron.outputs.forEach(link=>{!1!==link.dest.isEnabled&&(neuron.isEnabled?(link.isDead=!1,link.weight=link.savedWeight||Math.random()-.5):(link.isDead=!0,link.savedWeight=link.weight,link.weight=0))})},exports.networkState.getInputByIndex=function(index){return this.inputs[index]},exports.networkState.toggleInput=function(slug){const input=this.inputs.filter(input=>input.id===slug)[0];return input.isEnabled=!input.isEnabled,input.outputs.forEach(outputLink=>outputLink.dest.isEnabled?(outputLink.isDead=!input.isEnabled,void(outputLink.weight=input.isEnabled?Math.random()-.5:0)):(outputLink.isDead=!0,void(outputLink.weight=0))),input},exports.networkState.setWeight=function(weightIndex,value){let targetNeuronOrNeurons;const selectedNodes=playground_facade_1.playgroundFacade["selectedNodes"];0!==selectedNodes.length&&(targetNeuronOrNeurons=1===selectedNodes.length?[this.getNeuron(selectedNodes[0])]:selectedNodes.map(nodeIndex=>this.getNeuron(nodeIndex)),targetNeuronOrNeurons.forEach(({neuron})=>{var _b;void 0!==(null===(_b=null===(_b=neuron.inputLinks)||void 0===_b?void 0:_b[weightIndex])||void 0===_b?void 0:_b.weight)&&(neuron.inputLinks[weightIndex].weight=value)}))}},{"../facades/playground.facade":13}],18:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.buttonsUi=void 0;const devices_ui_1=require("./devices.ui"),mappings_ui_1=require("./mappings.ui");exports.buttonsUi=Object.create(null),exports.buttonsUi.nodeSelectors={node:"#buttons",settings:".settings",devices:".devices",mappings:".mappings",reset:".reset"},exports.buttonsUi.init=function(){this.node=document.querySelector(this.nodeSelectors.node),this.settings=this.node.querySelector(this.nodeSelectors.settings),this.devices=this.node.querySelector(this.nodeSelectors.devices),this.mappings=this.node.querySelector(this.nodeSelectors.mappings),this.reset=this.node.querySelector(this.nodeSelectors.reset),this.settings.onclick=()=>console.log("settings"),this.devices.onclick=()=>mappings_ui_1.mappingsUi.show(),this.mappings.onclick=()=>devices_ui_1.devicesUi.show(),this.reset.onclick=()=>console.log("reset")}},{"./devices.ui":22,"./mappings.ui":23}],19:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.IconMaterialComponent=void 0,exports.IconMaterialComponent=function(slug,marginTop){const element=document.createElement("i");return element.classList.add("material-icons"),element.innerText=slug,void 0!==marginTop&&(element.style.marginTop=marginTop),element}},{}],20:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MappingChipComponent=void 0;const icon_material_component_1=require("./icon.material.component"),mappings_state_1=require("../../state/mappings.state"),mappings_ui_1=require("../mappings.ui");exports.MappingChipComponent=class{constructor({name,icon,content,isLearned}){this.name=name,this.node=this.createNode(),this.icon=this.createIcon(icon),this.content=this.createContent(content),this.action=this.createAction(isLearned),this.node.appendChild(this.icon),this.node.appendChild(this.content),this.node.appendChild(this.action)}getNode(){return this.node}createNode(){const node=document.createElement("span");return node.classList.add("mdl-chip"),node.classList.add("mdl-chip--contact"),node.classList.add("mdl-chip--deletable"),node}createIcon(slug){const span=document.createElement("span");return span.classList.add("mdl-chip__contact"),"button"===slug?(span.appendChild((0,icon_material_component_1.IconMaterialComponent)("touch_app","3px")),span.style.background="rgba(0,255,0,.4)"):"range"===slug?(span.appendChild((0,icon_material_component_1.IconMaterialComponent)("swipe","3px")),span.style.background="rgba(0,0,255,.4)"):span.appendChild((0,icon_material_component_1.IconMaterialComponent)("hourglass_empty","3px")),span}createContent(contentText){const content=document.createElement("span");return content.classList.add("mdl-chip__text"),content.style.userSelect="none",content.innerHTML=contentText||"N/A",content}createAction(isLearned){const action=document.createElement("a");return action.classList.add("mdl-chip__action"),!0===isLearned?(action.appendChild((0,icon_material_component_1.IconMaterialComponent)("cancel")),action.onclick=()=>mappings_ui_1.mappingsUi.unlearn(this.name)):(action.appendChild((0,icon_material_component_1.IconMaterialComponent)("school")),action.onclick=()=>mappings_state_1.mappingsState.enableLearningMode(this.name)),action}updateContent(newContent){newContent=this.createContent(newContent);this.node.replaceChild(newContent,this.content),this.content=newContent}updateIcon(newIcon){newIcon=this.createIcon(newIcon);this.node.replaceChild(newIcon,this.icon),this.icon=newIcon}updateAction(newAction){newAction=this.createAction(newAction);this.node.replaceChild(newAction,this.action),this.action=newAction}update({icon,content,isLearned}){this.updateIcon(icon),this.updateContent(content),this.updateAction(isLearned)}reset(){this.updateIcon(),this.updateContent(),this.updateAction()}}},{"../../state/mappings.state":16,"../mappings.ui":23,"./icon.material.component":19}],21:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SnackbarComponent=void 0,exports.SnackbarComponent=function(){const snackbar=document.createElement("div");snackbar.classList.add("mdl-js-snackbar"),snackbar.classList.add("mdl-snackbar");const message=document.createElement("div");message.classList.add("mdl-snackbar__text"),snackbar.appendChild(message);const action=document.createElement("button");return action.classList.add("mdl-snackbar__action"),action.type="button",snackbar.appendChild(action),snackbar}},{}],22:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.devicesUi=void 0;var dialog_prototype_1=require("./prototypes/dialog.prototype");const devices_state_1=require("../state/devices.state");exports.devicesUi=Object.create(dialog_prototype_1.dialogPrototype),exports.devicesUi.nodeSelectors={node:"#devices",closeButton:".close-button",contentNode:".mdl-dialog__content",noSelector:".no-selector",noController:".no-controller",selectorOptions:"[title=selectors-options]",controllerOptions:"[title=controllers-options]"},exports.devicesUi.init=function(){this.node=document.querySelector(this.nodeSelectors.node),this.content=this.node.querySelector(this.nodeSelectors.contentNode),this.closeButton=this.node.querySelector(this.nodeSelectors.closeButton),this.noSelector=this.node.querySelector(this.nodeSelectors.noSelector),this.noController=this.node.querySelector(this.nodeSelectors.noController),this.selectorOptions=this.node.querySelector(this.nodeSelectors.selectorOptions),this.controllerOptions=this.node.querySelector(this.nodeSelectors.controllerOptions),this.attachEvents(this.closeButton),this.render()},exports.devicesUi.shouldRender=function(){var{selectors,controllers}=devices_state_1.devicesState;return selectors||controllers?{selectors:0!==Object.keys(selectors).length,controllers:0!==Object.keys(controllers).length}:{selectors:!1,controllers:!1}},exports.devicesUi.render=function(){var shouldRender=this.shouldRender();this.noSelector.style.display=shouldRender.selectors?"none":null,this.selectorOptions.style.display=shouldRender.selectors?null:"none",this.renderOptions("selector"),this.noController.style.display=shouldRender.controllers?"none":null,this.controllerOptions.style.display=shouldRender.controllers?null:"none",this.renderOptions("controller")},exports.devicesUi.renderOptions=function(target){let targetNode,options,pickedDevice;if("selector"===target)targetNode=this.selectorOptions,options=devices_state_1.devicesState.selectors,pickedDevice=devices_state_1.devicesState.pickedSelector;else{if("controller"!==target)throw new Error("target node is undefined while render options");targetNode=this.controllerOptions,options=devices_state_1.devicesState.controllers,pickedDevice=devices_state_1.devicesState.pickedController}if(Array.from(targetNode).forEach(option=>{targetNode.removeChild(option)}),options){const none=document.createElement("option");none.innerText="Select port",none.disabled=!0,none.selected=null===pickedDevice,targetNode.appendChild(none),Object.keys(options).forEach(optionName=>{const option=document.createElement("option");option.value=optionName,option.innerText=optionName,option.selected=optionName===(null===pickedDevice||void 0===pickedDevice?void 0:pickedDevice.name),targetNode.appendChild(option)})}"selector"===target?targetNode.onchange=e=>devices_state_1.devicesState.pickSelector(e.target.value):"controller"===target&&(targetNode.onchange=e=>devices_state_1.devicesState.pickController(e.target.value))}},{"../state/devices.state":15,"./prototypes/dialog.prototype":28}],23:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.mappingsUi=void 0;var dialog_prototype_1=require("./prototypes/dialog.prototype");const mappings_state_1=require("../state/mappings.state"),notifications_ui_1=require("./notifications.ui"),mapping_chip_component_1=require("./components/mapping-chip.component");exports.mappingsUi=Object.create(dialog_prototype_1.dialogPrototype),exports.mappingsUi.nodeSelectors={node:"#mappings",closeButton:".close-button",content:".mdl-dialog__content",tableContent:".table-content"},exports.mappingsUi.parameterQueries={playPauseButton:document.getElementById("play-pause-button"),learningRate:document.getElementById("learningRate"),activation:document.getElementById("activations"),regularizations:document.getElementById("regularizations"),regularizationRate:document.getElementById("regularRate"),problemType:document.getElementById("problem"),addLayers:document.getElementById("add-layers"),removeLayers:document.getElementById("remove-layers"),ratioOfTrainingToTest:document.getElementById("percTrainData"),noise:document.getElementById("noise"),batchSize:document.getElementById("batchSize"),showTestData:document.getElementById("show-test-data").parentNode,discretize:document.getElementById("discretize").parentNode},exports.mappingsUi.chips={},exports.mappingsUi.init=function(){this.node=document.querySelector(this.nodeSelectors.node),this.closeButton=this.node.querySelector(this.nodeSelectors.closeButton),this.content=this.node.querySelector(this.nodeSelectors.content),this.tableContent=this.node.querySelector(this.nodeSelectors.tableContent),this.buildTableContent(),this.attachEvents(this.closeButton)},exports.mappingsUi.buildTableContent=function(){Object.keys(this.parameterQueries).forEach(parameterName=>{this.tableContent.appendChild(this.createContentRow(parameterName))})},exports.mappingsUi.createContentCell=function(){const cell=document.createElement("td");return cell.classList.add("mdl-data-table__cell--non-numeric"),cell},exports.mappingsUi.createContentRow=function(parameterName){const row=document.createElement("tr"),parameterElement=this.createContentCell();parameterElement.innerText=parameterName;const chip=new mapping_chip_component_1.MappingChipComponent({name:parameterName});this.chips[parameterName]=chip;const mappingElement=this.createContentCell();return mappingElement.appendChild(chip.getNode()),row.appendChild(parameterElement),row.appendChild(mappingElement),row},exports.mappingsUi.learn=function({parameter,control,type}){mappings_state_1.mappingsState.isMapped(parameter)?mappings_state_1.mappingsState.disableLearningMode():(mappings_state_1.mappingsState.setParameterMaps({parameter:parameter,control:control,type:type}),this.chips[parameter].update({icon:type,content:control,isLearned:!0}),notifications_ui_1.notificationsUi.notify(`Learn: control ${control} for ${parameter} (${type})`))},exports.mappingsUi.unlearn=function(parameter){mappings_state_1.mappingsState.isMapped(parameter)&&(mappings_state_1.mappingsState.unsetParameterMaps(parameter),this.chips[parameter].reset(),notifications_ui_1.notificationsUi.notify(`${parameter} unlearned`))}},{"../state/mappings.state":16,"./components/mapping-chip.component":20,"./notifications.ui":26,"./prototypes/dialog.prototype":28}],24:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.networkUi=void 0;const d3=require("d3"),network_state_1=require("../state/network.state"),selector_device_1=require("../devices/selector.device"),playground_facade_1=require("../facades/playground.facade"),neuron_card_ui_1=require("./neuron-card.ui"),controller_device_1=require("../devices/controller.device");exports.networkUi=Object.create(null),exports.networkUi.toggleNeuron=function(index){var nextEnabled=network_state_1.networkState.getNeuron(index)["isEnabled"],nextEnabled=!nextEnabled;const canvas=d3.select(`#canvas-${index}`);canvas.classed("disabled",!nextEnabled),!1==nextEnabled&&this.toggleNodeSelection(index,!1),network_state_1.networkState.toggleNeuron(index),selector_device_1.selectorDevice.setNeuronLight({index:index,isDisabled:!nextEnabled}),playground_facade_1.playgroundFacade.updateUI()},exports.networkUi.toggleInput=function(slug,render=!1){var input=network_state_1.networkState.toggleInput(slug);if(render){const canvas=d3.select(`#canvas-${slug}`);canvas.classed("disabled",!input.isEnabled)}playground_facade_1.playgroundFacade.updateUI(),!0===selector_device_1.selectorDevice.isInitialized&&selector_device_1.selectorDevice.setInputLight(input.id,input.isEnabled)},exports.networkUi.toggleNodeSelection=function(nodeIndex,isSelected){if("number"!=typeof nodeIndex)throw new Error("nodeId is not a number");isSelected?playground_facade_1.playgroundFacade.selectNode(nodeIndex):playground_facade_1.playgroundFacade.unselectNode(nodeIndex);const canvas=d3.select(`#canvas-${nodeIndex}`);canvas.classed("selected",isSelected),neuron_card_ui_1.neuronCardUi.updateCard(nodeIndex),selector_device_1.selectorDevice.setNeuronLight({index:nodeIndex,isSelected:isSelected}),controller_device_1.controllerDevice.onSelectionEvent()}},{"../devices/controller.device":5,"../devices/selector.device":11,"../facades/playground.facade":13,"../state/network.state":17,"./neuron-card.ui":25,d3:1}],25:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.neuronCardUi=void 0;const d3=require("d3"),playground_facade_1=require("../facades/playground.facade"),network_state_1=require("../state/network.state");exports.neuronCardUi=Object.create(null),exports.neuronCardUi.weightSelector=".neuron-card__weight",exports.neuronCardUi.weights=null,exports.neuronCardUi.cardSelector="#neuron-card",exports.neuronCardUi.card=null,exports.neuronCardUi.init=function(){this.fetchWeights(),this.fetchCard(),this.attachEvents()},exports.neuronCardUi.fetchCard=function(){this.card=d3.select("#neuron-card")},exports.neuronCardUi.fetchWeights=function(){this.weights=document.querySelectorAll(this.weightSelector)},exports.neuronCardUi.updateCard=function(nodeIndex){const selectedNodes=playground_facade_1.playgroundFacade["selectedNodes"];if(0!==selectedNodes.length){this.card.style("display","flex");const nodeTitle=this.card.select(".node"),inputs=this.card.selectAll("input")[0];nodeTitle.text(1===selectedNodes.length?`Node: ${selectedNodes[0]}`:`Nodes: ${selectedNodes.sort((a,b)=>a-b).join(", ")}`);const neuron=network_state_1.networkState.getNeuron(nodeIndex)["neuron"],biasInput=inputs[0];biasInput.placeholder="ø or multi.",biasInput.value=1===selectedNodes.length?neuron.bias.toPrecision(2):null;const inputLinks=neuron["inputLinks"];inputs.slice(1).forEach((input,k)=>void 0===inputLinks[k]?(input.value=null,input.placeholder="ø or multi.",void(input.disabled=!0)):(input.disabled=!1,1<selectedNodes.length?(input.value=null,void(input.placeholder="ø or multi.")):void(input.value=inputLinks[k].weight.toPrecision(2))))}else this.card.style("display","none")},exports.neuronCardUi.updateWeight=function(index,weight){this.weights[index].value=weight.toPrecision(2)},exports.neuronCardUi.attachEvents=function(){this.weights&&this.weights.forEach((weight,index)=>{weight.onchange=value=>{value=parseFloat(value.target.value);network_state_1.networkState.setWeight(index,value),playground_facade_1.playgroundFacade.updateUI()}})}},{"../facades/playground.facade":13,"../state/network.state":17,d3:1}],26:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P=P||Promise)(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):((value=result.value)instanceof P?value:new P(function(resolve){resolve(value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.notificationsUi=void 0;const snackbar_component_1=require("./components/snackbar.component");exports.notificationsUi=Object.create(null),exports.notificationsUi.snackbar=null,exports.notificationsUi.init=function(){return __awaiter(this,void 0,void 0,function*(){this.snackbar=(0,snackbar_component_1.SnackbarComponent)(),document.body.appendChild(this.snackbar),yield this.waitForMaterialScripts()})},exports.notificationsUi.waitForMaterialScripts=function(){return __awaiter(this,void 0,void 0,function*(){return new Promise(resolve=>{var sender=null===(sender=null===(sender=this.snackbar)||void 0===sender?void 0:sender.MaterialSnackbar)||void 0===sender?void 0:sender.showSnackbar;sender?resolve(sender):setTimeout(()=>{this.waitForMaterialScripts().then(resolve)},100)})})},exports.notificationsUi.notify=function(message,timeout=2e3,actionHandler=()=>{},actionText=null){if("string"!=typeof message)throw new Error("message is not a string");var hasAction=actionHandler&&actionText;this.snackbar.MaterialSnackbar.showSnackbar({message:message,timeout:timeout,actionHandler:hasAction?actionHandler:void 0,actionText:hasAction?actionText:void 0})}},{"./components/snackbar.component":21}],27:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.playgroundUi=void 0;const is_tab_active_1=require("../utils/is-tab-active"),range_map_1=require("../utils/range-map"),mappings_ui_1=require("./mappings.ui"),playground_facade_1=require("../facades/playground.facade"),selector_device_1=require("../devices/selector.device");exports.playgroundUi=Object.create(null),exports.playgroundUi.updateParameter=function(name,value){if(void 0===name)throw new Error("parameter is not defined");if(void 0===value)throw new Error("value is not defined");if((0,is_tab_active_1.isTabActive)()){const parameter=mappings_ui_1.mappingsUi.parameterQueries[name];if(!parameter)throw new Error("parameter name was not found in listed nodes");switch(parameter.tagName){case"SELECT":{var max=parameter.children.length-1;const scaledValue=(0,range_map_1.rangeMap)(value,0,127,0,max);var isStep=parseInt(scaledValue.toString());isStep!==parameter.selectedIndex&&(parameter.selectedIndex=isStep,parameter.dispatchEvent(new Event("change")));break}case"BUTTON":parameter.click();break;case"INPUT":{var min=parseInt(parameter.min),max=parseInt(parameter.max),isStep=parseInt(parameter.step);const v=(0,range_map_1.rangeMap)(value,0,127,min,max),n=parseInt(v.toString());isStep=n%isStep==0;const areDifferent=n!==parseInt(parameter.value);isStep&&areDifferent&&(parameter.value=n.toString(),parameter.dispatchEvent(new Event("input")));break}case"LABEL":if(0===value)return;parameter.click();break;default:throw new Error(`${parameter.tagName} target not handled`)}}},exports.playgroundUi.togglePlayback=function(){playground_facade_1.playgroundFacade.togglePlayback(),selector_device_1.selectorDevice.updateLightPlayback()}},{"../devices/selector.device":11,"../facades/playground.facade":13,"../utils/is-tab-active":30,"../utils/range-map":31,"./mappings.ui":23}],28:[function(require,module,exports){"use strict";var Errors;Object.defineProperty(exports,"__esModule",{value:!0}),exports.dialogPrototype=void 0,exports.dialogPrototype=Object.create(null),function(Errors){Errors.ContentNotDiv="The parent content node is not a `div`",Errors.NewContentNotHTML="Please provide an HTML element to add"}(Errors=Errors||{}),exports.dialogPrototype.show=function(){this.node.showModal()},exports.dialogPrototype.hide=function(){this.node.close()},exports.dialogPrototype.attachEvents=function(closeButton){if(void 0===closeButton)throw new Error("Please provide a close button before attaching events");closeButton.addEventListener("click",()=>{this.hide()}),this.node.addEventListener("click",e=>{e.target.open&&this.hide()})},exports.dialogPrototype.purgeContent=function(){if(!(this.content instanceof HTMLDivElement))throw new Error(Errors.ContentNotDiv);Array.from(this.content.children).forEach(child=>{this.content.removeChild(child)})},exports.dialogPrototype.addContent=function(content){if(!(content instanceof HTMLElement))throw new Error(Errors.NewContentNotHTML);if(!(this.content instanceof HTMLDivElement))throw new Error(Errors.ContentNotDiv)}},{}],29:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P=P||Promise)(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):((value=result.value)instanceof P?value:new P(function(resolve){resolve(value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ui=void 0;const mappings_ui_1=require("./mappings.ui"),buttons_ui_1=require("./buttons.ui"),notifications_ui_1=require("./notifications.ui"),neuron_card_ui_1=require("./neuron-card.ui"),devices_ui_1=require("./devices.ui");exports.ui=Object.create(null),exports.ui.init=function(){return __awaiter(this,void 0,void 0,function*(){this.addMaterialScript(),yield notifications_ui_1.notificationsUi.init(),mappings_ui_1.mappingsUi.init(),buttons_ui_1.buttonsUi.init(),neuron_card_ui_1.neuronCardUi.init(),devices_ui_1.devicesUi.init(),notifications_ui_1.notificationsUi.notify("test")})},exports.ui.addMaterialScript=function(){const script=document.createElement("script");script.src="https://code.getmdl.io/1.3.0/material.min.js",script.onload=()=>{window.componentHandler.upgradeAllRegistered()},document.head.appendChild(script)}},{"./buttons.ui":18,"./devices.ui":22,"./mappings.ui":23,"./neuron-card.ui":25,"./notifications.ui":26}],30:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.isTabActive=void 0,exports.isTabActive=function(){return!1===document.hidden}},{}],31:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.rangeMap=void 0,exports.rangeMap=function(n,start1,stop1,start2,stop2){if("number"!=typeof n)throw new Error("n is not a number");if("number"!=typeof start1)throw new Error("start1 is not a number");if("number"!=typeof stop1)throw new Error("stop1 is not a number");if("number"!=typeof start2)throw new Error("start2 is not a number");if("number"!=typeof stop2)throw new Error("stop2 is not a number");return(n-start1)/(stop1-start1)*(stop2-start2)+start2}},{}],32:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Coolearning=void 0,require("./interfaces");const app_1=require("../app/app"),notifications_ui_1=require("../app/ui/notifications.ui");exports.Coolearning=function(){window.addEventListener("load",()=>{try{app_1.app.init()}catch(error){console.error(error),notifications_ui_1.notificationsUi.notify(error.toString(),5e3)}})}},{"../app/app":4,"../app/ui/notifications.ui":26,"./interfaces":33}],33:[function(require,module,exports){},{}],34:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.classifyXORData=exports.classifyCircleData=exports.classifySpiralData=exports.regressGaussian=exports.regressPlane=exports.classifyTwoGaussData=exports.shuffle=void 0;const d3=require("d3");function randUniform(a,b){return Math.random()*(b-a)+a}function normalRandom(mean=0,variance=1){let v1,v2,s;for(;v1=2*Math.random()-1,v2=2*Math.random()-1,s=v1*v1+v2*v2,1<s;);var result=Math.sqrt(-2*Math.log(s)/s)*v1;return mean+Math.sqrt(variance)*result}function dist(a,dy){var dx=a.x-dy.x,dy=a.y-dy.y;return Math.sqrt(dx*dx+dy*dy)}exports.shuffle=function(array){let counter=array.length;for(var temp,index;0<counter;)index=Math.floor(Math.random()*counter),counter--,temp=array[counter],array[counter]=array[index],array[index]=temp},exports.classifyTwoGaussData=function(numSamples,noise){let points=[],varianceScale=d3.scale.linear().domain([0,.5]).range([.5,4]),variance=varianceScale(noise);function genGauss(cx,cy,label){for(let i=0;i<numSamples/2;i++){var x=normalRandom(cx,variance),y=normalRandom(cy,variance);points.push({x:x,y:y,label:label})}}return genGauss(2,2,1),genGauss(-2,-2,-1),points},exports.regressPlane=function(numSamples,noise){let labelScale=d3.scale.linear().domain([-10,10]).range([-1,1]),points=[];for(let i=0;i<numSamples;i++){var x=randUniform(-6,6),y=randUniform(-6,6),label=((x,y)=>labelScale(x+y))(x+randUniform(-6,6)*noise,y+randUniform(-6,6)*noise);points.push({x:x,y:y,label:label})}return points},exports.regressGaussian=function(numSamples,noise){let points=[],labelScale=d3.scale.linear().domain([0,2]).range([1,0]).clamp(!0),gaussians=[[-4,2.5,1],[0,2.5,-1],[4,2.5,1],[-4,-2.5,-1],[0,-2.5,1],[4,-2.5,-1]];for(let i=0;i<numSamples;i++){var x=randUniform(-6,6),y=randUniform(-6,6),label=function(x,y){let label=0;return gaussians.forEach(([cx,newLabel,sign])=>{newLabel=sign*labelScale(dist({x:x,y:y},{x:cx,y:newLabel}));Math.abs(newLabel)>Math.abs(label)&&(label=newLabel)}),label}(x+randUniform(-6,6)*noise,y+randUniform(-6,6)*noise);points.push({x:x,y:y,label:label})}return points},exports.classifySpiralData=function(numSamples,noise){let points=[],n=numSamples/2;function genSpiral(deltaT,label){for(let i=0;i<n;i++){var r=i/n*5,y=1.75*i/n*2*Math.PI+deltaT,x=r*Math.sin(y)+randUniform(-1,1)*noise,y=r*Math.cos(y)+randUniform(-1,1)*noise;points.push({x:x,y:y,label:label})}}return genSpiral(0,1),genSpiral(Math.PI,-1),points},exports.classifyCircleData=function(numSamples,noise){let points=[];function getCircleLabel(p,center){return dist(p,center)<2.5?1:-1}for(let i=0;i<numSamples/2;i++){var y=randUniform(0,2.5),label=randUniform(0,2*Math.PI),x=y*Math.sin(label),y=y*Math.cos(label),label=getCircleLabel({x:x+randUniform(-5,5)*noise,y:y+randUniform(-5,5)*noise},{x:0,y:0});points.push({x:x,y:y,label:label})}for(let i=0;i<numSamples/2;i++){let r=randUniform(3.5,5),angle=randUniform(0,2*Math.PI),x=r*Math.sin(angle),y=r*Math.cos(angle),noiseX=randUniform(-5,5)*noise,noiseY=randUniform(-5,5)*noise,label=getCircleLabel({x:x+noiseX,y:y+noiseY},{x:0,y:0});points.push({x:x,y:y,label:label})}return points},exports.classifyXORData=function(numSamples,noise){let points=[];for(let i=0;i<numSamples;i++){var x=randUniform(-5,5);x+=0<x?.3:-.3;var y=randUniform(-5,5);y+=0<y?.3:-.3;var noiseX=randUniform(-5,5)*noise,label=randUniform(-5,5)*noise,label=0<=(label={x:x+noiseX,y:y+label}).x*label.y?1:-1;points.push({x:x,y:y,label:label})}return points}},{d3:1}],35:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.reduceMatrix=exports.HeatMap=void 0;const d3=require("d3");exports.HeatMap=class{constructor(width,xAxis,xDomain,colors,yAxis,userSettings){this.settings={showAxes:!1,noSvg:!1},this.numSamples=xAxis;var height=width,padding=userSettings.showAxes?20:0;if(userSettings)for(var prop in userSettings)this.settings[prop]=userSettings[prop];this.xScale=d3.scale.linear().domain(xDomain).range([0,width-2*padding]),this.yScale=d3.scale.linear().domain(colors).range([height-2*padding,0]);let tmpScale=d3.scale.linear().domain([0,.5,1]).range(["#f59322","#e8eaeb","#0877bd"]).clamp(!0);colors=d3.range(0,1+1e-9,1/30).map(a=>tmpScale(a));this.color=d3.scale.quantize().domain([-1,1]).range(colors),yAxis=yAxis.append("div").style({width:`${width}px`,height:`${height}px`,position:"relative",top:`-${padding}px`,left:`-${padding}px`}),this.canvas=yAxis.append("canvas").attr("width",xAxis).attr("height",xAxis).style("width",width-2*padding+"px").style("height",height-2*padding+"px").style("position","absolute").style("top",`${padding}px`).style("left",`${padding}px`),this.settings.noSvg||(this.svg=yAxis.append("svg").attr({width:width,height:height}).style({position:"absolute",left:"0",top:"0"}).append("g").attr("transform",`translate(${padding},${padding})`),this.svg.append("g").attr("class","train"),this.svg.append("g").attr("class","test")),this.settings.showAxes&&(xAxis=d3.svg.axis().scale(this.xScale).orient("bottom"),yAxis=d3.svg.axis().scale(this.yScale).orient("right"),this.svg.append("g").attr("class","x axis").attr("transform",`translate(0,${height-2*padding})`).call(xAxis),this.svg.append("g").attr("class","y axis").attr("transform","translate("+(width-2*padding)+",0)").call(yAxis))}updateTestPoints(points){if(this.settings.noSvg)throw Error("Can't add points since noSvg=true");this.updateCircles(this.svg.select("g.test"),points)}updatePoints(points){if(this.settings.noSvg)throw Error("Can't add points since noSvg=true");this.updateCircles(this.svg.select("g.train"),points)}updateBackground(data,discretize){var dx=data[0].length,dy=data.length;if(dx!==this.numSamples||dy!==this.numSamples)throw new Error("The provided data matrix must be of size numSamples X numSamples");let context=this.canvas.node().getContext("2d"),image=context.createImageData(dx,dy);for(let y=0,p=-1;y<dy;++y)for(let x=0;x<dx;++x){let value=data[x][y];discretize&&(value=0<=value?1:-1);var c=d3.rgb(this.color(value));image.data[++p]=c.r,image.data[++p]=c.g,image.data[++p]=c.b,image.data[++p]=160}context.putImageData(image,0,0)}updateCircles(container,points){let xDomain=this.xScale.domain(),yDomain=this.yScale.domain();points=points.filter(p=>p.x>=xDomain[0]&&p.x<=xDomain[1]&&p.y>=yDomain[0]&&p.y<=yDomain[1]);let selection=container.selectAll("circle").data(points);selection.enter().append("circle").attr("r",3),selection.attr({cx:d=>this.xScale(d.x),cy:d=>this.yScale(d.y)}).style("fill",d=>this.color(d.label)),selection.exit().remove()}},exports.reduceMatrix=function(matrix,factor){if(matrix.length!==matrix[0].length)throw new Error("The provided matrix must be a square matrix");if(matrix.length%factor!=0)throw new Error("The width/height of the matrix must be divisible by the reduction factor");let result=new Array(matrix.length/factor);for(let i=0;i<matrix.length;i+=factor){result[i/factor]=new Array(matrix.length/factor);for(let j=0;j<matrix.length;j+=factor){let avg=0;for(let k=0;k<factor;k++)for(let l=0;l<factor;l++)avg+=matrix[i+k][j+l];avg/=factor*factor,result[i/factor][j/factor]=avg}}return result}},{d3:1}],36:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AppendingLineChart=void 0;const d3=require("d3");exports.AppendingLineChart=class{constructor(container,lineColors){this.data=[],this.minY=Number.MAX_VALUE,this.maxY=Number.MIN_VALUE,this.lineColors=lineColors,this.numLines=lineColors.length;var height=container.node(),width=height.offsetWidth,height=height.offsetHeight;let margin_top=2,margin_right=0,margin_bottom=2,margin_left=2;width=width-margin_left-margin_right,height=height-margin_top-margin_bottom;this.xScale=d3.scale.linear().domain([0,0]).range([0,width]),this.yScale=d3.scale.linear().domain([0,0]).range([height,0]),this.svg=container.append("svg").attr("width",width+margin_left+margin_right).attr("height",height+margin_top+margin_bottom).append("g").attr("transform",`translate(${margin_left},${margin_top})`),this.paths=new Array(this.numLines);for(let i=0;i<this.numLines;i++)this.paths[i]=this.svg.append("path").attr("class","line").style({fill:"none",stroke:lineColors[i],"stroke-width":"1.5px"})}reset(){this.data=[],this.redraw(),this.minY=Number.MAX_VALUE,this.maxY=Number.MIN_VALUE}addDataPoint(dataPoint){if(dataPoint.length!==this.numLines)throw Error("Length of dataPoint must equal number of lines");dataPoint.forEach(y=>{this.minY=Math.min(this.minY,y),this.maxY=Math.max(this.maxY,y)}),this.data.push({x:this.data.length+1,y:dataPoint}),this.redraw()}redraw(){this.xScale.domain([1,this.data.length]),this.yScale.domain([this.minY,this.maxY]);var getPathMap=lineIndex=>d3.svg.line().x(d=>this.xScale(d.x)).y(d=>this.yScale(d.y[lineIndex]));for(let i=0;i<this.numLines;i++)this.paths[i].datum(this.data).attr("d",getPathMap(i))}}},{d3:1}],37:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getOutputNode=exports.forEachNode=exports.updateWeights=exports.backProp=exports.forwardProp=exports.buildNetwork=exports.Link=exports.RegularizationFunction=exports.Activations=exports.Errors=exports.Node=void 0;class Node{constructor(id,activation,initZero){this.inputLinks=[],this.bias=.1,this.outputs=[],this.outputDer=0,this.inputDer=0,this.accInputDer=0,this.numAccumulatedDers=0,this.id=id,this.isEnabled=!0,this.activation=activation,initZero&&(this.bias=0)}updateOutput(){this.totalInput=this.bias;for(let j=0;j<this.inputLinks.length;j++){var link=this.inputLinks[j];this.totalInput+=link.weight*link.source.output}return this.output=this.activation.output(this.totalInput),this.output}}exports.Node=Node;class Errors{}(exports.Errors=Errors).SQUARE={error:(output,target)=>.5*Math.pow(output-target,2),der:(output,target)=>output-target},Math.tanh=Math.tanh||function(e2x){if(e2x===1/0)return 1;if(e2x===-1/0)return-1;e2x=Math.exp(2*e2x);return(e2x-1)/(e2x+1)};class Activations{}(exports.Activations=Activations).TANH={output:x=>Math.tanh(x),der:output=>{output=Activations.TANH.output(output);return 1-output*output}},Activations.RELU={output:x=>Math.max(0,x),der:x=>x<=0?0:1},Activations.SIGMOID={output:x=>1/(1+Math.exp(-x)),der:output=>{output=Activations.SIGMOID.output(output);return output*(1-output)}},Activations.LINEAR={output:x=>x,der:_x=>1};class RegularizationFunction{}(exports.RegularizationFunction=RegularizationFunction).L1={output:w=>Math.abs(w),der:w=>w<0?-1:0<w?1:0},RegularizationFunction.L2={output:w=>.5*w*w,der:w=>w};class Link{constructor(source,dest,initZero){this.weight=Math.random()-.5,this.isDead=!1,this.errorDer=0,this.accErrorDer=0,this.numAccumulatedDers=0,this.id=source.id+"-"+dest.id,this.source=source,this.dest=dest,initZero&&(this.weight=0)}}exports.Link=Link,exports.buildNetwork=function(networkShape,activation,outputActivation,inputIds,initZero){var numLayers=networkShape.length;let id=1,network=[];for(let layerIdx=0;layerIdx<numLayers;layerIdx++){var isOutputLayer=layerIdx===numLayers-1,isInputLayer=0===layerIdx;let currentLayer=[];network.push(currentLayer);var numNodes=networkShape[layerIdx];for(let i=0;i<numNodes;i++){let nodeId=id.toString();isInputLayer?nodeId=inputIds[i]:id++;let node=new Node(nodeId,isOutputLayer?outputActivation:activation,initZero);if(currentLayer.push(node),1<=layerIdx)for(let j=0;j<network[layerIdx-1].length;j++){let prevNode=network[layerIdx-1][j];var link=new Link(prevNode,node,initZero);prevNode.outputs.push(link),node.inputLinks.push(link)}}}return network},exports.forwardProp=function(network,inputs){var inputLayer=network[0];if(inputs.length!==inputLayer.length)throw new Error("The number of inputs must match the number of nodes in the input layer");for(let i=0;i<inputLayer.length;i++){let node=inputLayer[i];node.output=inputs[i]}for(let layerIdx=1;layerIdx<network.length;layerIdx++){var currentLayer=network[layerIdx];for(let i=0;i<currentLayer.length;i++){let node=currentLayer[i];node.updateOutput()}}return network[network.length-1][0].output},exports.backProp=function(network,target,errorFunc){let outputNode=network[network.length-1][0];outputNode.outputDer=errorFunc.der(outputNode.output,target);for(let layerIdx=network.length-1;1<=layerIdx;layerIdx--){var currentLayer=network[layerIdx];for(let i=0;i<currentLayer.length;i++){let node=currentLayer[i];node.inputDer=node.outputDer*node.activation.der(node.totalInput),node.accInputDer+=node.inputDer,node.numAccumulatedDers++}for(let i=0;i<currentLayer.length;i++){var node=currentLayer[i];for(let j=0;j<node.inputLinks.length;j++){let link=node.inputLinks[j];link.isDead||(link.errorDer=node.inputDer*link.source.output,link.accErrorDer+=link.errorDer,link.numAccumulatedDers++)}}if(1!==layerIdx){var prevLayer=network[layerIdx-1];for(let i=0;i<prevLayer.length;i++){let node=prevLayer[i];for(let j=node.outputDer=0;j<node.outputs.length;j++){var output=node.outputs[j];node.outputDer+=output.weight*output.dest.inputDer}}}}},exports.updateWeights=function({network,learningRate,regularization,regularizationRate}){for(let layerIdx=1;layerIdx<network.length;layerIdx++){var newLinkWeight,currentLayer=network[layerIdx];for(let i=0;i<currentLayer.length;i++){let node=currentLayer[i];0<node.numAccumulatedDers&&(node.bias-=learningRate*node.accInputDer/node.numAccumulatedDers,node.accInputDer=0,node.numAccumulatedDers=0);for(let j=0;j<node.inputLinks.length;j++){let link=node.inputLinks[j];link.isDead||(newLinkWeight=regularization?regularization.der(link.weight):0,0<link.numAccumulatedDers&&(link.weight=link.weight-learningRate/link.numAccumulatedDers*link.accErrorDer,newLinkWeight=link.weight-learningRate*regularizationRate*newLinkWeight,regularization===RegularizationFunction.L1&&link.weight*newLinkWeight<0?(link.weight=0,link.isDead=!0):link.weight=newLinkWeight,link.accErrorDer=0,link.numAccumulatedDers=0))}}}},exports.forEachNode=function(network,ignoreInputs,accessor){for(let layerIdx=ignoreInputs?1:0;layerIdx<network.length;layerIdx++){var currentLayer=network[layerIdx];for(let i=0;i<currentLayer.length;i++)accessor(currentLayer[i])}},exports.getOutputNode=function(network){return network[network.length-1][0]}},{}],38:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.removeFromSelectedNodes=exports.addToSelectedNodes=exports.getOutputWeights=exports.updateUI=exports.selectedNodes=exports.player=exports.network=void 0;const nn=require("./nn"),heatmap_1=require("./heatmap"),state_1=require("./state"),dataset_1=require("./dataset"),linechart_1=require("./linechart"),d3=require("d3"),coolearning_1=require("../coolearning/coolearning"),network_ui_1=require("../app/ui/network.ui"),playground_ui_1=require("../app/ui/playground.ui");(0,coolearning_1.Coolearning)();let mainWidth;d3.select(".more button").on("click",function(){var offset;d3.transition().duration(1e3).tween("scroll",(offset=800,function(){let i=d3.interpolateNumber(window.pageYOffset||document.documentElement.scrollTop,offset);return function(t){scrollTo(0,i(t))}}))});const RECT_SIZE=30,BIAS_SIZE=5,NUM_SAMPLES_CLASSIFY=500,NUM_SAMPLES_REGRESS=1200,DENSITY=100;var HoverType;!function(HoverType){HoverType[HoverType.BIAS=0]="BIAS",HoverType[HoverType.WEIGHT=1]="WEIGHT"}(HoverType=HoverType||{});let INPUTS={x:{f:(x,_y)=>x,label:"X_1"},y:{f:(x,y)=>y,label:"X_2"},xSquared:{f:(x,_y)=>x*x,label:"X_1^2"},ySquared:{f:(x,y)=>y*y,label:"X_2^2"},xTimesY:{f:(x,y)=>x*y,label:"X_1X_2"},sinX:{f:(x,_y)=>Math.sin(x),label:"sin(X_1)"},sinY:{f:(x,y)=>Math.sin(y),label:"sin(X_2)"}},HIDABLE_CONTROLS=[["Show test data","showTestData"],["Discretize output","discretize"],["Play button","playButton"],["Step button","stepButton"],["Reset button","resetButton"],["Learning rate","learningRate"],["Activation","activation"],["Regularization","regularization"],["Regularization rate","regularizationRate"],["Problem type","problem"],["Which dataset","dataset"],["Ratio train data","percTrainData"],["Noise level","noise"],["Batch size","batchSize"],["# of hidden layers","numHiddenLayers"]];let state=state_1.State.deserializeState();state.getHiddenProps().forEach(prop=>{prop in INPUTS&&delete INPUTS[prop]});let boundary={},xDomain=[-6,6],heatMap=new heatmap_1.HeatMap(300,DENSITY,xDomain,xDomain,d3.select("#heatmap"),{showAxes:!0}),linkWidthScale=d3.scale.linear().domain([0,5]).range([1,10]).clamp(!0),colorScale=d3.scale.linear().domain([-1,0,1]).range(["#f59322","#e8eaeb","#0877bd"]).clamp(!0),iter=0,trainData=[],testData=[];exports.network=null;let lossTrain=0,lossTest=0;exports.player=new class{constructor(){this.timerIndex=0,this.isPlaying=!1,this.callback=null}getIsPlaying(){return this.isPlaying}playOrPause(){this.isPlaying?(this.isPlaying=!1,this.pause()):(this.isPlaying=!0,0===iter&&simulationStarted(),this.play())}onPlayPause(callback){this.callback=callback}play(){this.pause(),this.isPlaying=!0,this.callback&&this.callback(this.isPlaying),this.start(this.timerIndex)}pause(){this.timerIndex++,this.isPlaying=!1,this.callback&&this.callback(this.isPlaying)}start(localTimerIndex){d3.timer(()=>localTimerIndex<this.timerIndex||(oneStep(),!1),0)}};let lineChart=new linechart_1.AppendingLineChart(d3.select("#linechart"),["#777","black"]);exports.selectedNodes=[];let mouseTimer=null;function drawNode(x,y,nodeId,isInput,nodeHeatMap){x-=RECT_SIZE/2,y-=RECT_SIZE/2;let nodeGroup=nodeHeatMap.append("g").attr({class:"node",id:`node${nodeId}`,transform:`translate(${x},${y})`});nodeGroup.append("rect").attr({x:0,y:0,width:RECT_SIZE,height:RECT_SIZE});nodeHeatMap=state[nodeId]?"active":"inactive";if(isInput){let label=null!=INPUTS[nodeId].label?INPUTS[nodeId].label:nodeId,text=nodeGroup.append("text").attr({class:"main-label",x:-10,y:RECT_SIZE/2,"text-anchor":"end"});if(/[_^]/.test(label)){let myRe=/(.*?)([_^])(.)/g;let lastIndex;for(;null!=(suffix=myRe.exec(label));){lastIndex=myRe.lastIndex;var prefix=suffix[1],sep=suffix[2],suffix=suffix[3];prefix&&text.append("tspan").text(prefix),text.append("tspan").attr("baseline-shift","_"===sep?"sub":"super").style("font-size","9px").text(suffix)}label.substring(lastIndex)&&text.append("tspan").text(label.substring(lastIndex))}else text.append("tspan").text(label);nodeGroup.classed(nodeHeatMap,!0)}isInput||nodeGroup.append("rect").attr({id:`bias-${nodeId}`,x:-BIAS_SIZE-2,y:RECT_SIZE-BIAS_SIZE+3,width:BIAS_SIZE,height:BIAS_SIZE});let div=d3.select("#network").insert("div",":first-child").attr({id:`canvas-${nodeId}`,class:"canvas"}).style({position:"absolute",left:`${3+x}px`,top:`${3+y}px`}).style("cursor","pointer").on("mousedown",()=>{mouseTimer=setTimeout(()=>(isInput?clearTimeout(mouseTimer):(network_ui_1.networkUi.toggleNeuron(parseInt(nodeId)),clearTimeout(mouseTimer)),void(mouseTimer=null)),600)}).on("mouseup",()=>{null!==mouseTimer&&(clearTimeout(mouseTimer),mouseTimer=null,div.classed("disabled")||Number.isNaN(parseInt(nodeId))||(div.classed("selected")?network_ui_1.networkUi.toggleNodeSelection(parseInt(nodeId),!1):network_ui_1.networkUi.toggleNodeSelection(parseInt(nodeId),!0)))});isInput&&div.on("click",function(){network_ui_1.networkUi.toggleInput(nodeId),div.classed("disabled",!div.classed("disabled"))}),isInput&&div.classed(nodeHeatMap,!0);nodeHeatMap=new heatmap_1.HeatMap(RECT_SIZE,DENSITY/10,xDomain,xDomain,div,{noSvg:!0});div.datum({heatmap:nodeHeatMap,id:nodeId})}function drawNetwork(network){let svg=d3.select("#svg");svg.select("g.core").remove(),d3.select("#network").selectAll("div.canvas").remove(),d3.select("#network").selectAll("div.plus-minus-neurons").remove();var co=d3.select(".column.output").node(),height=d3.select(".column.features").node(),height=co.offsetLeft-height.offsetLeft;svg.attr("width",height);let node2coord={},container=svg.append("g").classed("core",!0).attr("transform","translate(3,3)");var numLayers=network.length;let layerScale=d3.scale.ordinal().domain(d3.range(1,numLayers-1)).rangePoints([118,height-RECT_SIZE],.7),nodeIndexScale=nodeIndex=>nodeIndex*(RECT_SIZE+25),calloutThumb=d3.select(".callout.thumbnail").style("display","none"),calloutWeights=d3.select(".callout.weights").style("display","none"),idWithCallout=null,targetIdWithCallout=null,cx=RECT_SIZE/2+50,nodeIds=Object.keys(INPUTS),maxY=nodeIndexScale(nodeIds.length);nodeIds.forEach((nodeId,cy)=>{cy=nodeIndexScale(cy)+RECT_SIZE/2;node2coord[nodeId]={cx:cx,cy:cy},drawNode(cx,cy,nodeId,!0,container)});for(let layerIdx=1;layerIdx<numLayers-1;layerIdx++){var numNodes=network[layerIdx].length;let cx=layerScale(layerIdx)+RECT_SIZE/2;maxY=Math.max(maxY,nodeIndexScale(numNodes)),function(x,suffix){let div=d3.select("#network").append("div").classed("plus-minus-neurons",!0).style("left",`${x-10}px`),i=suffix-1,firstRow=div.append("div").attr("class",`ui-numNodes${suffix}`);firstRow.append("button").attr("class","mdl-button mdl-js-button mdl-button--icon").on("click",()=>{8<=state.networkShape[i]||(state.networkShape[i]++,parametersChanged=!0,reset())}).append("i").attr("class","material-icons").text("add"),firstRow.append("button").attr("class","mdl-button mdl-js-button mdl-button--icon").on("click",()=>{state.networkShape[i]<=1||(state.networkShape[i]--,parametersChanged=!0,reset())}).append("i").attr("class","material-icons").text("remove");suffix=1<state.networkShape[i]?"s":"";div.append("div").text(state.networkShape[i]+" neuron"+suffix)}(layerScale(layerIdx),layerIdx);for(let i=0;i<numNodes;i++){let node=network[layerIdx][i],cy=nodeIndexScale(i)+RECT_SIZE/2;node2coord[node.id]={cx:cx,cy:cy},drawNode(cx,cy,node.id,!1,container,node);let numNodes=network[layerIdx].length;var nextNumNodes=network[layerIdx+1].length;null==idWithCallout&&i===numNodes-1&&nextNumNodes<=numNodes&&(calloutThumb.style({display:null,top:`${23+cy}px`,left:`${cx}px`}),idWithCallout=node.id);for(let j=0;j<node.inputLinks.length;j++){var link=node.inputLinks[j];let path=drawLink(link,node2coord,0,container,j,j,node.inputLinks.length).node();var midPoint=network[layerIdx-1],lastNodePrevLayer=midPoint[midPoint.length-1];null==targetIdWithCallout&&i===numNodes-1&&link.source.id===lastNodePrevLayer.id&&(link.source.id!==idWithCallout||numLayers<=5)&&link.dest.id!==idWithCallout&&midPoint.length>=numNodes&&(midPoint=path.getPointAtLength(.7*path.getTotalLength()),calloutWeights.style({display:null,top:`${midPoint.y+5}px`,left:`${midPoint.x+3}px`}),targetIdWithCallout=link.dest.id)}}}cx=height+RECT_SIZE/2;var node=network[numLayers-1][0],height=0*(RECT_SIZE+25)+RECT_SIZE/2;node2coord[node.id]={cx:cx,cy:height};for(let i=0;i<node.inputLinks.length;i++){let link=node.inputLinks[i];drawLink(link,node2coord,0,container,i,i,node.inputLinks.length)}svg.attr("height",maxY);height=Math.max(getRelativeHeight(calloutThumb),getRelativeHeight(calloutWeights),getRelativeHeight(d3.select("#network")));d3.select(".column.features").style("height",height+"px")}function getRelativeHeight(node){node=node.node();return node.offsetHeight+node.offsetTop}function drawLink(input,dest,network,source,isFirst,index,datum){let line=source.insert("path",":first-child");source=dest[input.source.id],dest=dest[input.dest.id],datum={source:{y:source.cx+RECT_SIZE/2+2,x:source.cy},target:{y:dest.cx-RECT_SIZE/2,x:dest.cy+(index-(datum-1)/2)/datum*12}};let diagonal=d3.svg.diagonal().projection(d=>[d.y,d.x]);return line.attr({"marker-start":"url(#markerArrow)",class:"link",id:"link"+input.source.id+"-"+input.dest.id,d:diagonal(datum,0)}),line}function getLoss(network,dataPoints){let loss=0;for(let i=0;i<dataPoints.length;i++){var dataPoint=dataPoints[i],output=constructInput(dataPoint.x,dataPoint.y),output=nn.forwardProp(network,output);loss+=nn.Errors.SQUARE.error(output,dataPoint.label)}return loss/dataPoints.length}function updateUI(firstStep=!1){var network;!function(network,container){for(let layerIdx=1;layerIdx<network.length;layerIdx++){var currentLayer=network[layerIdx];for(let i=0;i<currentLayer.length;i++){var node=currentLayer[i];for(let j=0;j<node.inputLinks.length;j++){var link=node.inputLinks[j];container.select(`#link${link.source.id}-${link.dest.id}`).style({"stroke-dashoffset":-iter/3,"stroke-width":linkWidthScale(Math.abs(link.weight)),stroke:colorScale(link.weight),opacity:link.isDead?0:1}).datum(link)}}}}(exports.network,d3.select("g.core")),network=exports.network,nn.forEachNode(network,!0,node=>{d3.select(`rect#bias-${node.id}`).style("fill",colorScale(node.bias))}),function(network,firstTime){if(firstTime)for(var nodeId in boundary={},nn.forEachNode(network,!0,node=>{boundary[node.id]=new Array(DENSITY)}),INPUTS)boundary[nodeId]=new Array(DENSITY);let xScale=d3.scale.linear().domain([0,DENSITY-1]).range(xDomain),yScale=d3.scale.linear().domain([DENSITY-1,0]).range(xDomain),i=0,j=0;for(i=0;i<DENSITY;i++){if(firstTime){nn.forEachNode(network,!0,node=>{boundary[node.id][i]=new Array(DENSITY)});for(let nodeId in INPUTS)boundary[nodeId][i]=new Array(DENSITY)}for(j=0;j<DENSITY;j++){var x=xScale(i),y=yScale(j),input=constructInput(x,y);if(nn.forwardProp(network,input),nn.forEachNode(network,!0,node=>{boundary[node.id][i][j]=node.output}),firstTime)for(let nodeId in INPUTS)boundary[nodeId][i][j]=INPUTS[nodeId].f(x,y)}}}(exports.network,firstStep),heatMap.updateBackground(boundary[nn.getOutputNode(exports.network).id],state.discretize),d3.select("#network").selectAll("div.canvas").each(function(data){data.heatmap.updateBackground((0,heatmap_1.reduceMatrix)(boundary[data.id],10),state.discretize)}),d3.select("#loss-train").text(lossTrain.toFixed(3)),d3.select("#loss-test").text(lossTest.toFixed(3)),d3.select("#iter-number").text(("000000"+iter).slice(-"000000".length).replace(/\B(?=(\d{3})+(?!\d))/g,",")),lineChart.addDataPoint([lossTrain,lossTest])}function constructInput(x,y){let input=[];for(var inputName in INPUTS)state[inputName]&&input.push(INPUTS[inputName].f(x,y));return input}function oneStep(){iter++,trainData.forEach((point,i)=>{var input=constructInput(point.x,point.y);nn.forwardProp(exports.network,input),nn.backProp(exports.network,point.label,nn.Errors.SQUARE),(i+1)%state.batchSize==0&&nn.updateWeights({network:exports.network,learningRate:state.learningRate,regularization:state.regularization,regularizationRate:state.regularizationRate})}),lossTrain=getLoss(exports.network,trainData),lossTest=getLoss(exports.network,testData),updateUI()}function reset(shape=!1){lineChart.reset(),state.serialize(),shape||userHasInteracted(),exports.player.pause();var outputActivation=1!==state.numHiddenLayers?"s":"";d3.select("#layers-label").text("Hidden layer"+outputActivation),d3.select("#num-layers").text(state.numHiddenLayers);let numInputs=constructInput(iter=0,0).length;shape=[numInputs].concat(state.networkShape).concat([1]),outputActivation=state.problem===state_1.Problem.REGRESSION?nn.Activations.LINEAR:nn.Activations.TANH;exports.network=nn.buildNetwork(shape,state.activation,outputActivation,function(){let result=[];for(var inputName in INPUTS)state[inputName]&&result.push(inputName);return result}(),state.initZero),lossTrain=getLoss(exports.network,trainData),lossTest=getLoss(exports.network,testData),drawNetwork(exports.network),updateUI(!0)}function drawDatasetThumbnails(){function renderThumbnail(canvas,dataGenerator){canvas.setAttribute("width",100),canvas.setAttribute("height",100);let context=canvas.getContext("2d"),data=dataGenerator(200,0);data.forEach(function(d){context.fillStyle=colorScale(d.label),context.fillRect(100*(d.x+6)/12,100*(d.y+6)/12,4,4)}),d3.select(canvas.parentNode).style("display",null)}if(d3.selectAll(".dataset").style("display","none"),state.problem===state_1.Problem.CLASSIFICATION)for(var dataset in state_1.datasets)renderThumbnail(document.querySelector(`canvas[data-dataset=${dataset}]`),state_1.datasets[dataset]);if(state.problem===state_1.Problem.REGRESSION)for(var regDataset in state_1.regDatasets){let canvas=document.querySelector(`canvas[data-regDataset=${regDataset}]`),dataGenerator=state_1.regDatasets[regDataset];renderThumbnail(canvas,dataGenerator)}}function generateData(splitIndex=!1){splitIndex||(state.seed=Math.random().toFixed(5),state.serialize(),userHasInteracted()),Math.seedrandom(state.seed);splitIndex=state.problem===state_1.Problem.REGRESSION?NUM_SAMPLES_REGRESS:NUM_SAMPLES_CLASSIFY;let generator=state.problem===state_1.Problem.CLASSIFICATION?state.dataset:state.regDataset,data=generator(splitIndex,state.noise/100);(0,dataset_1.shuffle)(data);splitIndex=Math.floor(data.length*state.percTrainData/100);trainData=data.slice(0,splitIndex),testData=data.slice(splitIndex),heatMap.updatePoints(trainData),heatMap.updateTestPoints(state.showTestData?testData:[])}exports.updateUI=updateUI,exports.getOutputWeights=function(network){let weights=[];for(let layerIdx=0;layerIdx<network.length-1;layerIdx++){var currentLayer=network[layerIdx];for(let i=0;i<currentLayer.length;i++){var node=currentLayer[i];for(let j=0;j<node.outputs.length;j++){var output=node.outputs[j];weights.push(output.weight)}}}return weights};let firstInteraction=!0,parametersChanged=!1;function userHasInteracted(){if(firstInteraction){firstInteraction=!1;let page="index";null!=state.tutorial&&""!==state.tutorial&&(page=`/v/tutorials/${state.tutorial}`),ga("set","page",page),ga("send","pageview",{sessionControl:"start"})}}function simulationStarted(){ga("send",{hitType:"event",eventCategory:"Starting Simulation",eventAction:parametersChanged?"changed":"unchanged",eventLabel:null==state.tutorial?"":state.tutorial}),parametersChanged=!1}exports.addToSelectedNodes=function(nodeIndex){exports.selectedNodes=[...exports.selectedNodes,nodeIndex]};exports.removeFromSelectedNodes=function(nodeIndex){exports.selectedNodes=exports.selectedNodes.filter(n=>n!==nodeIndex)},drawDatasetThumbnails(),function(){if(null!=state.tutorial&&""!==state.tutorial&&!state.hideText){d3.selectAll("article div.l--body").remove();let tutorial=d3.select("article").append("div").attr("class","l--body");d3.html(`tutorials/${state.tutorial}.html`,(err,htmlFragment)=>{if(err)throw err;tutorial.node().appendChild(htmlFragment);let title=tutorial.select("title");title.size()&&(d3.select("header h1").style({"margin-top":"20px","margin-bottom":"20px"}).text(title.text()),document.title=title.text())})}}(),function(){d3.select("#reset-button").on("click",()=>{reset(),userHasInteracted(),d3.select("#play-pause-button")}),d3.select("#play-pause-button").on("click",function(){userHasInteracted(),playground_ui_1.playgroundUi.togglePlayback()}),exports.player.onPlayPause(isPlaying=>{d3.select("#play-pause-button").classed("playing",isPlaying)}),d3.select("#next-step-button").on("click",()=>{exports.player.pause(),userHasInteracted(),0===iter&&simulationStarted(),oneStep()}),d3.select("#data-regen-button").on("click",()=>{generateData(),parametersChanged=!0});let dataThumbnails=d3.selectAll("canvas[data-dataset]");dataThumbnails.on("click",function(){var newDataset=state_1.datasets[this.dataset.dataset];newDataset!==state.dataset&&(state.dataset=newDataset,dataThumbnails.classed("selected",!1),d3.select(this).classed("selected",!0),generateData(),parametersChanged=!0,reset())});var xAxis=(0,state_1.getKeyFromValue)(state_1.datasets,state.dataset);d3.select(`canvas[data-dataset=${xAxis}]`).classed("selected",!0);let regDataThumbnails=d3.selectAll("canvas[data-regDataset]");regDataThumbnails.on("click",function(){var newDataset=state_1.regDatasets[this.dataset.regdataset];newDataset!==state.regDataset&&(state.regDataset=newDataset,regDataThumbnails.classed("selected",!1),d3.select(this).classed("selected",!0),generateData(),parametersChanged=!0,reset())}),xAxis=(0,state_1.getKeyFromValue)(state_1.regDatasets,state.regDataset),d3.select(`canvas[data-regDataset=${xAxis}]`).classed("selected",!0),d3.select("#add-layers").on("click",()=>{6<=state.numHiddenLayers||(state.networkShape[state.numHiddenLayers]=2,state.numHiddenLayers++,parametersChanged=!0,reset())}),d3.select("#remove-layers").on("click",()=>{state.numHiddenLayers<=0||(state.numHiddenLayers--,state.networkShape.splice(state.numHiddenLayers),parametersChanged=!0,reset())});let showTestData=d3.select("#show-test-data").on("change",function(){state.showTestData=this.checked,state.serialize(),userHasInteracted(),heatMap.updateTestPoints(state.showTestData?testData:[])});showTestData.property("checked",state.showTestData);let discretize=d3.select("#discretize").on("change",function(){state.discretize=this.checked,state.serialize(),userHasInteracted(),updateUI()});discretize.property("checked",state.discretize);let percTrain=d3.select("#percTrainData").on("input",function(){state.percTrainData=this.value,d3.select("label[for='percTrainData'] .value").text(this.value),generateData(),parametersChanged=!0,reset()});percTrain.property("value",state.percTrainData),d3.select("label[for='percTrainData'] .value").text(state.percTrainData);let noise=d3.select("#noise").on("input",function(){state.noise=this.value,d3.select("label[for='noise'] .value").text(this.value),generateData(),parametersChanged=!0,reset()});xAxis=parseInt(noise.property("max")),state.noise>xAxis?state.noise<=80?noise.property("max",state.noise):state.noise=50:state.noise<0&&(state.noise=0),noise.property("value",state.noise),d3.select("label[for='noise'] .value").text(state.noise);let batchSize=d3.select("#batchSize").on("input",function(){state.batchSize=this.value,d3.select("label[for='batchSize'] .value").text(this.value),parametersChanged=!0,reset()});batchSize.property("value",state.batchSize),d3.select("label[for='batchSize'] .value").text(state.batchSize);let activationDropdown=d3.select("#activations").on("change",function(){state.activation=state_1.activations[this.value],parametersChanged=!0,state.serialize(),userHasInteracted()});activationDropdown.property("value",(0,state_1.getKeyFromValue)(state_1.activations,state.activation));let learningRate=d3.select("#learningRate").on("change",function(){state.learningRate=+this.value,parametersChanged=!0,state.serialize(),userHasInteracted()});learningRate.property("value",state.learningRate);let regularDropdown=d3.select("#regularizations").on("change",function(){state.regularization=state_1.regularizations[this.value],parametersChanged=!0,state.serialize(),userHasInteracted()});regularDropdown.property("value",(0,state_1.getKeyFromValue)(state_1.regularizations,state.regularization));let regularRate=d3.select("#regularRate").on("change",function(){state.regularizationRate=+this.value,parametersChanged=!0,state.serialize(),userHasInteracted()});regularRate.property("value",state.regularizationRate);let problem=d3.select("#problem").on("change",function(){state.problem=state_1.problems[this.value],generateData(),drawDatasetThumbnails(),parametersChanged=!0,reset()});problem.property("value",(0,state_1.getKeyFromValue)(state_1.problems,state.problem)),xAxis=d3.scale.linear().domain([-1,1]).range([0,144]),xAxis=d3.svg.axis().scale(xAxis).orient("bottom").tickValues([-1,0,1]).tickFormat(d3.format("d")),d3.select("#colormap g.core").append("g").attr("class","x axis").attr("transform","translate(0,10)").call(xAxis),window.addEventListener("resize",()=>{var newWidth=document.querySelector("#main-part").getBoundingClientRect().width;newWidth!==mainWidth&&(mainWidth=newWidth,drawNetwork(exports.network),updateUI(!0))}),state.hideText&&(d3.select("#article-text").style("display","none"),d3.select("div.more").style("display","none"),d3.select("header").style("display","none"))}(),generateData(!0),reset(!0),function(){let hiddenProps=state.getHiddenProps();hiddenProps.forEach(prop=>{let controls=d3.selectAll(`.ui-${prop}`);0===controls.size()&&console.warn(`0 html elements found with class .ui-${prop}`),controls.style("display","none")});let hideControls=d3.select(".hide-controls");HIDABLE_CONTROLS.forEach(([text,id])=>{let label=hideControls.append("label").attr("class","mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect"),input=label.append("input").attr({type:"checkbox",class:"mdl-checkbox__input"});-1===hiddenProps.indexOf(id)&&input.attr("checked","true"),input.on("change",function(){state.setHideProperty(id,!this.checked),state.serialize(),userHasInteracted(),d3.select(".hide-controls-link").attr("href",window.location.href)}),label.append("span").attr("class","mdl-checkbox__label label").text(text)}),d3.select(".hide-controls-link").attr("href",window.location.href)}()},{"../app/ui/network.ui":24,"../app/ui/playground.ui":27,"../coolearning/coolearning":32,"./dataset":34,"./heatmap":35,"./linechart":36,"./nn":37,"./state":39,d3:1}],39:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.State=exports.problems=exports.Problem=exports.Type=exports.getKeyFromValue=exports.regDatasets=exports.datasets=exports.regularizations=exports.activations=void 0;const nn=require("./nn"),dataset=require("./dataset");function getKeyFromValue(obj,value){for(var key in obj)if(obj[key]===value)return key}function endsWith(s,suffix){return s.substr(-suffix.length)===suffix}function getHideProps(obj){let result=[];for(var prop in obj)endsWith(prop,"_hide")&&result.push(prop);return result}var Type,Problem;exports.activations={relu:nn.Activations.RELU,tanh:nn.Activations.TANH,sigmoid:nn.Activations.SIGMOID,linear:nn.Activations.LINEAR},exports.regularizations={none:null,L1:nn.RegularizationFunction.L1,L2:nn.RegularizationFunction.L2},exports.datasets={circle:dataset.classifyCircleData,xor:dataset.classifyXORData,gauss:dataset.classifyTwoGaussData,spiral:dataset.classifySpiralData},exports.regDatasets={"reg-plane":dataset.regressPlane,"reg-gauss":dataset.regressGaussian},exports.getKeyFromValue=getKeyFromValue,function(Type){Type[Type.STRING=0]="STRING",Type[Type.NUMBER=1]="NUMBER",Type[Type.ARRAY_NUMBER=2]="ARRAY_NUMBER",Type[Type.ARRAY_STRING=3]="ARRAY_STRING",Type[Type.BOOLEAN=4]="BOOLEAN",Type[Type.OBJECT=5]="OBJECT"}(Type=exports.Type||(exports.Type={})),function(Problem){Problem[Problem.CLASSIFICATION=0]="CLASSIFICATION",Problem[Problem.REGRESSION=1]="REGRESSION"}(Problem=exports.Problem||(exports.Problem={})),exports.problems={classification:Problem.CLASSIFICATION,regression:Problem.REGRESSION};class State{constructor(){this.learningRate=.03,this.regularizationRate=0,this.showTestData=!1,this.noise=0,this.batchSize=10,this.discretize=!1,this.tutorial=null,this.percTrainData=50,this.activation=nn.Activations.TANH,this.regularization=null,this.problem=Problem.CLASSIFICATION,this.initZero=!1,this.hideText=!0,this.collectStats=!1,this.numHiddenLayers=1,this.hiddenLayerControls=[],this.networkShape=[8,8,8,8,8,8],this.x=!0,this.y=!0,this.xTimesY=!0,this.xSquared=!0,this.ySquared=!0,this.cosX=!1,this.sinX=!0,this.cosY=!1,this.sinY=!0,this.dataset=dataset.classifyCircleData,this.regDataset=dataset.regressPlane}static deserializeState(){let map={};for(var value of window.location.hash.slice(1).split("&")){var[name,value]=value.split("=");map[name]=value}let state=new State;function hasKey(name){return name in map&&null!=map[name]&&""!==map[name].trim()}function parseArray(value){return""===value.trim()?[]:value.split(",")}return State.PROPS.forEach(({name,type,keyMap})=>{switch(type){case Type.OBJECT:if(null==keyMap)throw Error("A key-value map must be provided for state variables of type Object");hasKey(name)&&map[name]in keyMap&&(state[name]=keyMap[map[name]]);break;case Type.NUMBER:hasKey(name)&&(state[name]=+map[name]);break;case Type.STRING:hasKey(name)&&(state[name]=map[name]);break;case Type.BOOLEAN:hasKey(name)&&(state[name]="false"!==map[name]);break;case Type.ARRAY_NUMBER:name in map&&(state[name]=parseArray(map[name]).map(Number));break;case Type.ARRAY_STRING:name in map&&(state[name]=parseArray(map[name]));break;default:throw Error("Encountered an unknown type for a state variable")}}),getHideProps(map).forEach(prop=>{state[prop]="true"===map[prop]}),state.numHiddenLayers=state.networkShape.length,null==state.seed&&(state.seed=Math.random().toFixed(5)),Math.seedrandom(state.seed),state}serialize(){let props=[];State.PROPS.forEach(({name,type,keyMap})=>{let value=this[name];null!=value&&(type===Type.OBJECT?value=getKeyFromValue(keyMap,value):type!==Type.ARRAY_NUMBER&&type!==Type.ARRAY_STRING||(value=value.join(",")),props.push(`${name}=${value}`))}),getHideProps(this).forEach(prop=>{props.push(`${prop}=${this[prop]}`)}),window.location.hash=props.join("&")}getHiddenProps(){let result=[];for(var prop in this)endsWith(prop,"_hide")&&"true"===String(this[prop])&&result.push(prop.replace("_hide",""));return result}setHideProperty(name,hidden){this[name+"_hide"]=hidden}}exports.State=State,State.PROPS=[{name:"activation",type:Type.OBJECT,keyMap:exports.activations},{name:"regularization",type:Type.OBJECT,keyMap:exports.regularizations},{name:"batchSize",type:Type.NUMBER},{name:"dataset",type:Type.OBJECT,keyMap:exports.datasets},{name:"regDataset",type:Type.OBJECT,keyMap:exports.regDatasets},{name:"learningRate",type:Type.NUMBER},{name:"regularizationRate",type:Type.NUMBER},{name:"noise",type:Type.NUMBER},{name:"networkShape",type:Type.ARRAY_NUMBER},{name:"seed",type:Type.STRING},{name:"showTestData",type:Type.BOOLEAN},{name:"discretize",type:Type.BOOLEAN},{name:"percTrainData",type:Type.NUMBER},{name:"x",type:Type.BOOLEAN},{name:"y",type:Type.BOOLEAN},{name:"xTimesY",type:Type.BOOLEAN},{name:"xSquared",type:Type.BOOLEAN},{name:"ySquared",type:Type.BOOLEAN},{name:"cosX",type:Type.BOOLEAN},{name:"sinX",type:Type.BOOLEAN},{name:"cosY",type:Type.BOOLEAN},{name:"sinY",type:Type.BOOLEAN},{name:"collectStats",type:Type.BOOLEAN},{name:"tutorial",type:Type.STRING},{name:"problem",type:Type.OBJECT,keyMap:exports.problems},{name:"initZero",type:Type.BOOLEAN},{name:"hideText",type:Type.BOOLEAN}]},{"./dataset":34,"./nn":37}]},{},[38]);
